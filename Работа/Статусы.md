
>> **Диаграмма С4**

- [x] Замёрджено 2 уровня
- [ ] Разработан третий уровень, оформлен MR (9 июня)


>>**Логирование событий при работе системы лицензирования**

"Результаты прохождения пунктов ПМИ":
* Проверка механизма пересчета параметров лицензий. _Конфигурация обновляется, но в логах информации об этом нет
* Проверка привязки к железу. _Поддельная лицензия удаляется, но в логах сообщения об этом событии нет. Но соотвтествующие сообщения генерируются в случае ручного удаления файла cert.crt
* Проверка подмены лицензий online и offline - _подложенная лицензия удалилась, но в логах информации об этом нет_

**Добавил** логирование событий изменения текущей конфигурации лицензии (описанные выше относятся сюда). Причины изменения конфигурации, указанные выше, не отслеживаются (библиотека "tclicenses" не разделяет события обновления файлов лицензий на разные категории причин удаления, потому что механизм простой - удаление всего, что есть, и скачивание того, что доступно на сервере) ==**(сообщить Андрею Шкунову, например, нужен лог о том, что подложенная лицензия удалена)**==

"Ещё нужно уточнить результат проверки потери связи с регистрационным сервером и при необходимости доработать механику обработки результата проверки"
**Уточнил, вот результат:**
1. каждая очередная проверка конфигурации должна зафиксировать в локальном журнале событие недоступности регистрационного сервера и увеличить счетчик "неудач" - **TRUE**, в логах пишется сообщение "network is unreachable" с адресом, куда происходит попытка достучаться
2. после превышения счетчиком "неудач" значения, указанного в захардкоденном конфиге, конфигурация SAI должна обнулиться с фиксацией соответствующей записи в локальном журнале - **FALSE**, конфигурация SAI не обнуляется, если речь о папке с лицензиями ==**(сообщить Андрею Шкунову)**==

Итого, что нужно:
- [x] прокинуть в логи вообще все события, приходящие в канал ивентов библиотеки tclicense. ==Прокинул с уровнями вложенности, благодаря которым можно будет увидеть, если какой-то ивент не ожидаемый приходит (для которого не написан код обработки)==
- [ ] Сообщить Андрею Ш. про 2 момента выше, где он указан
- [ ] Добавить недостающие проверки (см. заметку "[[Работа по логированию]]")
- [ ] Корневой сертификат (ca.crt) должен быть зашит в продукт


>> **Логирование событий при работе ядра**

В случае логирования событий **менеджера драйверов** (Д. Виляховец) при удалении вручную файла с логами новый файл не создаётся автоматически. Нужно исправить. В случаях логгирования других событий (например, get-запросов) такой проблемы нет


>> **Драйвера**
* 1 проверка на то, куда драйвер может транслировать (например, драйвер видеоматрицы будет транслировать в websocket, а в mqtt не будет - это  будет настраиваться в конфиге)
	* Также далее будут поддержаны broadcast-потоки сообщений. Там такая же логика будет (например, драйвер камеры не будет транслировать в mqtt происходящие события, а драйвер кондиционера будет)
* 2 проверка на то, кому из клиетнов драйвер работы с клиентами (driver API) будет транслировать

**24.06.2025**:
След. этап - проверка правил маршрутизации событий, сгенерированных в драйверах. Проверим путём просмотра в mqtt-explorer. Что делаем:
	Подгрузим go либу mqtt
	Поставим mosquitto
	Напишем драйвер mqtt. Устанавливаем соединение, драйвер все сообщения, приходящие от ядра, пересылает в mqtt-топик (указано в config-файле, пишем там атрибут "connection string" (там указывается user:password, протокол, хост, порт) и атрибут "topic")