О сертификате **ca.crt**:
* Для регистрации продукта нужен сертификат (ca.crt), он должен быть действующим, и к нему должен быть приватный ключ (private_key.pem)
	==Почему? Я удаляю всё кроме ca.crt, и у меня получается зарегистрировать продукт (после выполнения post-запроса появляется файл private_key.pem)
* Сертификат (ca.crt) - это инструмент для авторизации на рег.сервере. Это подписанный конфиг (некоторый набор параметров "ключ:значение", криптографически подписанный), как печать в аналоговом мире (принимаем всё за правду, подписанное этим сертификатом)

В папку с лицензиями скачиваются лицензии с CRM. Если в CRM 3 лицензии, то будет 3 файла лицензий

О сертификате **cert.crt**:
* Файл-сертификат (cert.crt) выдаётся при регистрации. Он выдаётся на время от даты регистрации до завершения максимальной справа (последней активной) лицензии
* В сертификате (cert.crt) прописывается доменное имя (публичное внешнее имя сервиса)
* В сертификате (cert.crt) есть "HW info" (==это же тот самый HW key, который я вижу в CRM?==) - строка, генерируемая при регистрации. Это слепок текущей инсталляции (его программно-аппаратного окружения), генерируемый продуктом. Он заносится в базу рег-сервера при первой регистрации, после чего все последующие процедуры лицензирования будут проходить со сверкой этого "HW info", и если он отличен от того, что был в первый раз, то клиент вынужден будет связаться с менеджером Труконфа для просьбы сбросить "HW info", объяснив причину, почему конфигурация оборудования поменялась

**Ньюансы:**
* Сертификат (ca.crt) может использоваться как tls-сертификат web-сервера (т.е. как цифровая подпись для авторизации клиента при установке tls-соединения и как сертификат для https-соединения в web-сервере). Это позволяет автоматически настроить https для админки (т.е. можно сразу оперировать шифрованным соединением, только надо будет установить галочку доверия к сертификату в браузере)
* Раз в час (интервал в api.toml) происходит обращение к рег.серверу и скачивание всех актуальных (не аннулированных и не просроченных по дате) лицензий и пересчёт суммарной конфигурации (л1=1, л2=2, л1+л2 = 3)
	==Суммарная конфигурация - это cert.crt?==


**Библиотека Андрея:**
Когда она запускается, она генерирует строчку (hw info) и сравнивает со строкой, которая содержится в сертификате. Это такой механизм привязки к железу
Андрей попросил попросить Андрея доработать библиотеку так, чтобы в лог писалась конфигурация железа (к вопросу прохождения ПМИ). Без этого не сможем проверить пункт ПМИ про механизм пересчёта суммарной конфигурации

Лицензия - это тоже файл-сертификат, только с другим наполнением. Он содержит в себе атрибуты системы лицензирования (флаги и числовые ограничения)
Модуль Андрея Шкунова проверяет, что лицензия соответствует этому сертификату
В лицензии содержится id продукта - первая часть серийного ключа до дефиса (это, грубо говоря, логин учётной записи в crm). Это нужно для того, чтобы нельзя было подсунуть лицензию от другого ключа, другой инсталляции. Модуль, который пересчёт делает, учитывает эту часть
ПМИ на библиотеку Андрея Шкунова - пробуем обмануть систему, подменяя файлик, переделывая ключ и т.п. Если найдём проблемы - сообщить Андрею Шкунову

Регистрация онлайн:
http://localhost/api/admin/v1/register/online
Посылаем post-запросом на ядро ключ и домен (публичное внешнее имя сервиса) - ядро роутит это на CRM, дальше само всё делает, и в папке создаются нужные файлы. Продукт зарегистрирован

Регистрация оффлайн:
1 - http://localhost/api/admin/v1/register/offline/step-one
STEP ONE - посылаем post-запросом на ядро ключ и домен (публичное внешнее имя сервиса) - в ответ ядро даёт бинарник. Декодим его из base64 и сохраняем как request.csr
2 - https://ls.trueconf.com/sai/v1/offline
Посылаем post-запросом request.csr на CRM - в ответ получаем архив с certificate.crt и лицензиями
3 - http://localhost/api/admin/v1/register/offline/step-two
STEP TWO - посылаем post-запросом на ядро архив, ядро выполняет некоторые действия, рассовывает лицензии в папку, делает cert.crt из certificate.crt (я так понимаю, просто раскладывает файлы из архива) и переписывает свой какой-то конфиг. Продукт зарегистрирован




Проект устанавливается в /opt/trueconf/coordinator
Там есть директория /etc/license - в неё нужно положить файл ca.crt, чтобы проект мог запуститься
После этого проект можно будет зарегистрировать
В файле api.toml нужно изменить:
[debug]
  crm_host = "reg.trueconf.com" --> "ls.trueconf.com"
  skip_verification = false --> true