[
    {
        "id": "74ce7173202e08d8",
        "type": "tab",
        "label": "Set IP",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "6c8f21a3d6cd1c5b",
        "type": "tab",
        "label": "Instructions",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "f8689935b8ae0be8",
        "type": "tab",
        "label": "Authorization",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "8bc8d6360358e56f",
        "type": "tab",
        "label": "Flows manager",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "36eae2d7552c58fd",
        "type": "tab",
        "label": "NETWORK_PARAMETERS",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "400344fd8c1a0fdc",
        "type": "tab",
        "label": "Main_v1.4_Configurator",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "18bc0562a1dcc64c",
        "type": "tab",
        "label": "ptz",
        "disabled": false,
        "info": ""
    },
    {
        "id": "ab576495ae266594",
        "type": "tab",
        "label": "ptz_presets",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "b8a7445b0c0c02b3",
        "type": "tab",
        "label": "standby",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "91360b8afc23f470",
        "type": "tab",
        "label": "videomatrix_sx_smx47",
        "disabled": false,
        "info": ""
    },
    {
        "id": "4ab7a6698d04b636",
        "type": "tab",
        "label": "videomixer_avmatrix_shark_s6",
        "disabled": false,
        "info": ""
    },
    {
        "id": "f6992051cb6c0c5c",
        "type": "tab",
        "label": "videomixer_avmatrix_hvs0402u",
        "disabled": true,
        "info": ""
    },
    {
        "id": "92703c264104932a",
        "type": "tab",
        "label": "audioprocessor_clevermic",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "455bfc6c2c30aeae",
        "type": "tab",
        "label": "audioprocessor_clevermic",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "e4fac40aa2dddfeb",
        "type": "tab",
        "label": "tcgroup",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c9de95d1b59eeb87",
        "type": "tab",
        "label": "custom_scenes",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "f7c5cff35e94fee9",
        "type": "tab",
        "label": "confsystem_bkr_bls_u450m",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "e0c1ad36bdd973c8",
        "type": "junction",
        "z": "36eae2d7552c58fd",
        "x": 210,
        "y": 2900,
        "wires": [
            [
                "9a55dd5724da1645"
            ]
        ]
    },
    {
        "id": "46fbc9aaf8fddf7e",
        "type": "junction",
        "z": "36eae2d7552c58fd",
        "x": 1840,
        "y": 80,
        "wires": [
            [
                "674adeceb71a6cbe"
            ]
        ]
    },
    {
        "id": "97d5acc8dcc30632",
        "type": "junction",
        "z": "36eae2d7552c58fd",
        "x": 1360,
        "y": 80,
        "wires": [
            [
                "46fbc9aaf8fddf7e"
            ]
        ]
    },
    {
        "id": "8205c73e05ed7b00",
        "type": "junction",
        "z": "36eae2d7552c58fd",
        "x": 1200,
        "y": 140,
        "wires": [
            [
                "0f90e0f17063437c",
                "97d5acc8dcc30632"
            ]
        ]
    },
    {
        "id": "fe99b048efbcab94",
        "type": "junction",
        "z": "36eae2d7552c58fd",
        "x": 1200,
        "y": 1620,
        "wires": [
            [
                "7411a9e56a253faa",
                "9825083ea7380db7"
            ]
        ]
    },
    {
        "id": "7411a9e56a253faa",
        "type": "junction",
        "z": "36eae2d7552c58fd",
        "x": 1380,
        "y": 1560,
        "wires": [
            [
                "4b5491be7921824d"
            ]
        ]
    },
    {
        "id": "4b5491be7921824d",
        "type": "junction",
        "z": "36eae2d7552c58fd",
        "x": 1840,
        "y": 1560,
        "wires": [
            [
                "674adeceb71a6cbe"
            ]
        ]
    },
    {
        "id": "f5aaeb73dfed4db5",
        "type": "junction",
        "z": "36eae2d7552c58fd",
        "x": 110,
        "y": 2960,
        "wires": [
            [
                "68c8bebf68920ad8",
                "9a55dd5724da1645"
            ]
        ]
    },
    {
        "id": "3d4b7496b7872019",
        "type": "junction",
        "z": "36eae2d7552c58fd",
        "x": 510,
        "y": 3480,
        "wires": [
            [
                "5c17358ec802e88f",
                "3df731ac0d5d70b5"
            ]
        ]
    },
    {
        "id": "d5d6e115a3df2ccd",
        "type": "junction",
        "z": "36eae2d7552c58fd",
        "x": 510,
        "y": 3760,
        "wires": [
            [
                "dd988af6767a3b8d",
                "633f20a4903ed90b"
            ]
        ]
    },
    {
        "id": "b9a1a783b0db463f",
        "type": "junction",
        "z": "36eae2d7552c58fd",
        "x": 510,
        "y": 4020,
        "wires": [
            [
                "eeca3efb9da4bcf4",
                "a0395e9ebe48c88e"
            ]
        ]
    },
    {
        "id": "6b638ce2aa075f39",
        "type": "junction",
        "z": "36eae2d7552c58fd",
        "x": 510,
        "y": 4280,
        "wires": [
            [
                "868487254f602b2d",
                "88326517a210db53"
            ]
        ]
    },
    {
        "id": "b278e6bb50f9a4e5",
        "type": "junction",
        "z": "91360b8afc23f470",
        "x": 4240,
        "y": 340,
        "wires": [
            [
                "acd4d279792de16a"
            ]
        ]
    },
    {
        "id": "acd4d279792de16a",
        "type": "junction",
        "z": "91360b8afc23f470",
        "x": 4480,
        "y": 340,
        "wires": [
            [
                "6ab0f38315e4137c"
            ]
        ]
    },
    {
        "id": "58d7f5003f6f37d1",
        "type": "junction",
        "z": "91360b8afc23f470",
        "x": 4480,
        "y": 860,
        "wires": [
            [
                "6ab0f38315e4137c"
            ]
        ]
    },
    {
        "id": "539656033666b00b",
        "type": "junction",
        "z": "91360b8afc23f470",
        "x": 4240,
        "y": 860,
        "wires": [
            [
                "58d7f5003f6f37d1"
            ]
        ]
    },
    {
        "id": "4067f8838880ebac",
        "type": "junction",
        "z": "455bfc6c2c30aeae",
        "x": 4380,
        "y": 1080,
        "wires": [
            [
                "a3d80c8924893c87"
            ]
        ]
    },
    {
        "id": "59bec82412c3d66f",
        "type": "junction",
        "z": "455bfc6c2c30aeae",
        "x": 4380,
        "y": 560,
        "wires": [
            [
                "39c4600679a9b8e9"
            ]
        ]
    },
    {
        "id": "39c4600679a9b8e9",
        "type": "junction",
        "z": "455bfc6c2c30aeae",
        "x": 4620,
        "y": 560,
        "wires": [
            [
                "2e5784d775cc8a71"
            ]
        ]
    },
    {
        "id": "a3d80c8924893c87",
        "type": "junction",
        "z": "455bfc6c2c30aeae",
        "x": 4620,
        "y": 1080,
        "wires": [
            [
                "2e5784d775cc8a71"
            ]
        ]
    },
    {
        "id": "4678eb274da36b54",
        "type": "junction",
        "z": "4ab7a6698d04b636",
        "x": 1180,
        "y": 2540,
        "wires": [
            [
                "8c5691a0cb337b7d"
            ]
        ]
    },
    {
        "id": "8c5691a0cb337b7d",
        "type": "junction",
        "z": "4ab7a6698d04b636",
        "x": 1200,
        "y": 2760,
        "wires": [
            [
                "e947597301335afe"
            ]
        ]
    },
    {
        "id": "ce9924ee41e33a0a",
        "type": "junction",
        "z": "4ab7a6698d04b636",
        "x": 1120,
        "y": 3140,
        "wires": [
            [
                "8c5691a0cb337b7d"
            ]
        ]
    },
    {
        "id": "af78f4ea83c1efcc",
        "type": "junction",
        "z": "92703c264104932a",
        "x": 4380,
        "y": 1080,
        "wires": [
            [
                "a0692f62abc7cd17"
            ]
        ]
    },
    {
        "id": "eda3652b93c9132e",
        "type": "junction",
        "z": "92703c264104932a",
        "x": 4380,
        "y": 560,
        "wires": [
            [
                "da67f58ebcc28803"
            ]
        ]
    },
    {
        "id": "da67f58ebcc28803",
        "type": "junction",
        "z": "92703c264104932a",
        "x": 4620,
        "y": 560,
        "wires": [
            [
                "d0896c713f9bc870"
            ]
        ]
    },
    {
        "id": "a0692f62abc7cd17",
        "type": "junction",
        "z": "92703c264104932a",
        "x": 4620,
        "y": 1080,
        "wires": [
            [
                "d0896c713f9bc870"
            ]
        ]
    },
    {
        "id": "e0c11a67bf2b1ad5",
        "type": "server",
        "name": "Coordinator Dev",
        "version": 5,
        "addon": false,
        "rejectUnauthorizedCerts": true,
        "ha_boolean": "y|yes|true|on|home|open",
        "connectionDelay": true,
        "cacheJson": true,
        "heartbeat": false,
        "heartbeatInterval": "30",
        "areaSelector": "friendlyName",
        "deviceSelector": "friendlyName",
        "entitySelector": "friendlyName",
        "statusSeparator": ": ",
        "statusYear": "hidden",
        "statusMonth": "short",
        "statusDay": "numeric",
        "statusHourCycle": "default",
        "statusTimeFormat": "h:m",
        "enableGlobalContextStore": false
    },
    {
        "id": "d6688dbfdb474a0f",
        "type": "json-db-collection",
        "name": "audioprocessor",
        "collection": "audioprocessor",
        "save": true
    },
    {
        "id": "93fb52eac18e80d3",
        "type": "serial-port",
        "serialport": "/dev/ttyMOD3",
        "serialbaud": "2400",
        "databits": "8",
        "parity": "none",
        "stopbits": "1",
        "waitfor": "",
        "dtr": "none",
        "rts": "none",
        "cts": "none",
        "dsr": "none",
        "newline": "100",
        "bin": "bin",
        "out": "interbyte",
        "addchar": "",
        "responsetimeout": "1000"
    },
    {
        "id": "807af99980308d2c",
        "type": "ui_base",
        "theme": {
            "name": "theme-custom",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#5cfcff",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#70f8ff",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "TrueConf",
                "default": "#4B7930",
                "baseColor": "#137896",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "reset": false
            },
            "themeState": {
                "base-color": {
                    "default": "#4B7930",
                    "value": "#137896",
                    "edited": true
                },
                "page-titlebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": true
                },
                "page-backgroundColor": {
                    "value": "#ffffff",
                    "edited": true
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": true
                },
                "group-textColor": {
                    "value": "#ffffff",
                    "edited": true
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": true
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": true
                },
                "widget-textColor": {
                    "value": "#ffffff",
                    "edited": true
                },
                "widget-backgroundColor": {
                    "value": "#167298",
                    "edited": true
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": true
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Coordinator Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 30,
                "gy": 30,
                "cx": 6,
                "cy": 6,
                "px": 20,
                "py": 20
            }
        }
    },
    {
        "id": "1ea01473c6ced4e1",
        "type": "json-db-collection",
        "name": "videomixer",
        "collection": "videomixer",
        "save": true
    },
    {
        "id": "8744b7cc29ae1dc6",
        "type": "json-db-collection",
        "name": "chair",
        "collection": "chair",
        "save": true
    },
    {
        "id": "d88c690558e15f84",
        "type": "json-db-collection",
        "name": "current_values",
        "collection": "current_values",
        "save": true
    },
    {
        "id": "5ae3cc41ded3bf16",
        "type": "json-db-collection",
        "name": "presets",
        "collection": "presets",
        "save": true
    },
    {
        "id": "1f09f1228e02e4dc",
        "type": "serial-port",
        "serialport": "/dev/ttyS2",
        "serialbaud": "19200",
        "databits": "8",
        "parity": "none",
        "stopbits": "1",
        "waitfor": "",
        "dtr": "none",
        "rts": "none",
        "cts": "none",
        "dsr": "none",
        "newline": "0",
        "bin": "bin",
        "out": "interbyte",
        "addchar": "",
        "responsetimeout": "10000"
    },
    {
        "id": "98ae7d3282cf3125",
        "type": "json-db-collection",
        "name": "device_statuses",
        "collection": "device_statuses",
        "save": true
    },
    {
        "id": "9c7e5ff72d78b502",
        "type": "ui_group",
        "name": "Видеомикшер",
        "tab": "0a301e486709f27a",
        "order": 1,
        "disp": true,
        "width": 5,
        "collapse": false,
        "className": ""
    },
    {
        "id": "47715a302e162008",
        "type": "ui_group",
        "name": "Видеоматрица",
        "tab": "0a301e486709f27a",
        "order": 2,
        "disp": true,
        "width": 5,
        "collapse": false,
        "className": ""
    },
    {
        "id": "e1b3f68bc0754e54",
        "type": "ui_group",
        "name": "Аудиопроцессор",
        "tab": "0a301e486709f27a",
        "order": 3,
        "disp": true,
        "width": 5,
        "collapse": false,
        "className": ""
    },
    {
        "id": "ea4be7e4d073dec2",
        "type": "ui_group",
        "name": "TCGroup",
        "tab": "0a301e486709f27a",
        "order": 4,
        "disp": true,
        "width": 5,
        "collapse": false,
        "className": ""
    },
    {
        "id": "e3be92b07b670127",
        "type": "ui_group",
        "name": "Камеры",
        "tab": "0a301e486709f27a",
        "order": 6,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "eadbbab9c9723921",
        "type": "ui_group",
        "name": "Параметры",
        "tab": "0a301e486709f27a",
        "order": 7,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "e3a4a76bd8ca0d0d",
        "type": "json-db-collection",
        "name": "network_parameters",
        "collection": "network_parameters",
        "save": true
    },
    {
        "id": "0a301e486709f27a",
        "type": "ui_tab",
        "name": "КОНФИГУРАТОР",
        "icon": "settings",
        "order": 3,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "1d11c7c923e110a2",
        "type": "ui_group",
        "name": "Установка IP-адреса",
        "tab": "83418f9cd226323c",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "56f549ae6fc3f169",
        "type": "ui_group",
        "name": "Назначение порта",
        "tab": "83418f9cd226323c",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "83418f9cd226323c",
        "type": "ui_tab",
        "name": "Инструкция",
        "icon": "info_outline",
        "order": 9,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "01e9c64880837101",
        "type": "ui_tab",
        "name": "ВИДЕОМАТРИЦА",
        "icon": "dashboard",
        "order": 5,
        "disabled": false,
        "hidden": true
    },
    {
        "id": "f04326656c098a23",
        "type": "ui_group",
        "name": "Править_вход",
        "tab": "01e9c64880837101",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "e53775ce8cb1e6cc",
        "type": "ui_group",
        "name": "Входы_видеоматрицы",
        "tab": "01e9c64880837101",
        "order": 2,
        "disp": true,
        "width": "8",
        "collapse": false,
        "className": ""
    },
    {
        "id": "685e1e326592eb00",
        "type": "json-db-collection",
        "name": "audioprocessor_config",
        "collection": "audioprocessor_config",
        "save": true
    },
    {
        "id": "4bb94b5820ddfcdb",
        "type": "ui_group",
        "name": "Выходы_видеоматрицы",
        "tab": "01e9c64880837101",
        "order": 3,
        "disp": true,
        "width": "8",
        "collapse": false,
        "className": ""
    },
    {
        "id": "a63464be2c873bd9",
        "type": "ui_group",
        "name": "Править_выход",
        "tab": "01e9c64880837101",
        "order": 5,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "3d0e245a64d55aa9",
        "type": "ui_group",
        "name": "Назад",
        "tab": "01e9c64880837101",
        "order": 1,
        "disp": false,
        "width": "1",
        "collapse": false,
        "className": ""
    },
    {
        "id": "3aad47d2f496d7f5",
        "type": "ui_tab",
        "name": "АУДИОПРОЦЕССОР",
        "icon": "dashboard",
        "order": 6,
        "disabled": false,
        "hidden": true
    },
    {
        "id": "a7308f94ab8d29d3",
        "type": "ui_group",
        "name": "Назад",
        "tab": "3aad47d2f496d7f5",
        "order": 1,
        "disp": false,
        "width": "1",
        "collapse": false,
        "className": ""
    },
    {
        "id": "b52da2819ad1aaab",
        "type": "ui_group",
        "name": "Входы_аудиопроцессора",
        "tab": "3aad47d2f496d7f5",
        "order": 6,
        "disp": true,
        "width": "8",
        "collapse": false,
        "className": ""
    },
    {
        "id": "e75c15142175c3bc",
        "type": "ui_group",
        "name": "Выходы_аудиопроцессора",
        "tab": "3aad47d2f496d7f5",
        "order": 7,
        "disp": true,
        "width": "8",
        "collapse": false,
        "className": ""
    },
    {
        "id": "4baa93912120146e",
        "type": "ui_group",
        "name": "Править_вход",
        "tab": "3aad47d2f496d7f5",
        "order": 8,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "a00da0272f194b50",
        "type": "ui_group",
        "name": "Править_выход",
        "tab": "3aad47d2f496d7f5",
        "order": 9,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "631fc494a4cc4190",
        "type": "ui_group",
        "name": "Общий мьют",
        "tab": "3aad47d2f496d7f5",
        "order": 4,
        "disp": true,
        "width": "2",
        "collapse": false,
        "className": ""
    },
    {
        "id": "09a0fe67e10ae6cb",
        "type": "ui_tab",
        "name": "ВИДЕОМИКШЕР",
        "icon": "dashboard",
        "order": 4,
        "disabled": false,
        "hidden": true
    },
    {
        "id": "70a61739c2079d6d",
        "type": "ui_group",
        "name": "AEC",
        "tab": "3aad47d2f496d7f5",
        "order": 5,
        "disp": true,
        "width": "2",
        "collapse": false,
        "className": ""
    },
    {
        "id": "85a5f6c9fcd283b6",
        "type": "ui_group",
        "name": "Входы_видеомикшера",
        "tab": "09a0fe67e10ae6cb",
        "order": 3,
        "disp": true,
        "width": "8",
        "collapse": false,
        "className": ""
    },
    {
        "id": "d9adc42cfdfe7ee0",
        "type": "json-db-collection",
        "name": "videomixer_config",
        "collection": "videomixer_config",
        "save": true
    },
    {
        "id": "d881ce800073c6bf",
        "type": "ui_group",
        "name": "Править_вход",
        "tab": "09a0fe67e10ae6cb",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "cdda5da914347f61",
        "type": "ui_group",
        "name": "Назад",
        "tab": "09a0fe67e10ae6cb",
        "order": 1,
        "disp": false,
        "width": 1,
        "collapse": false,
        "className": ""
    },
    {
        "id": "48bf28233cdf1386",
        "type": "json-db-collection",
        "name": "videomatrix_config",
        "collection": "videomatrix_config",
        "save": true
    },
    {
        "id": "2659c0e4.6c014",
        "type": "ui_group",
        "name": "Режим \"Презентация\"",
        "tab": "09a0fe67e10ae6cb",
        "order": 2,
        "disp": true,
        "width": 8,
        "collapse": false,
        "className": ""
    },
    {
        "id": "85f660f87a3cc301",
        "type": "ui_tab",
        "name": "Запасные детали",
        "icon": "dashboard",
        "order": 10,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "79515a82873752fe",
        "type": "ui_group",
        "name": "Прочее",
        "tab": "85f660f87a3cc301",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "6a4d510d.5de65",
        "type": "ui_group",
        "name": "Авторизация",
        "tab": "56715436.c2591c",
        "order": 2,
        "disp": true,
        "width": "4",
        "collapse": false,
        "className": ""
    },
    {
        "id": "56715436.c2591c",
        "type": "ui_tab",
        "name": "Авторизация",
        "icon": "dashboard",
        "order": 2,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "3f5e7803babf95d3",
        "type": "serial-port",
        "serialport": "/dev/ttyMOD1",
        "serialbaud": "19200",
        "databits": "8",
        "parity": "none",
        "stopbits": "1",
        "waitfor": "",
        "dtr": "none",
        "rts": "none",
        "cts": "none",
        "dsr": "none",
        "newline": "",
        "bin": "bin",
        "out": "interbyte",
        "addchar": "",
        "responsetimeout": "1000"
    },
    {
        "id": "f82f835e797f7789",
        "type": "serial-port",
        "serialport": "/dev/serial/by-id/usb-1a86_USB2.0-Ser_-if00-port0",
        "serialbaud": "19200",
        "databits": "8",
        "parity": "none",
        "stopbits": "1",
        "waitfor": "",
        "dtr": "none",
        "rts": "none",
        "cts": "none",
        "dsr": "none",
        "newline": "0",
        "bin": "bin",
        "out": "interbyte",
        "addchar": "",
        "responsetimeout": "200"
    },
    {
        "id": "68b1bf0e03ae0ef9",
        "type": "json-db-collection",
        "name": "pwd",
        "collection": "pwd",
        "save": true
    },
    {
        "id": "a937139dcf0cc2ea",
        "type": "ui_group",
        "name": "Регистрация",
        "tab": "56715436.c2591c",
        "order": 2,
        "disp": true,
        "width": "4",
        "collapse": false,
        "className": ""
    },
    {
        "id": "dd701c20edbc9569",
        "type": "ui_group",
        "name": "Relay",
        "tab": "533a9a8ff6fc2064",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "8260323e51e2eaf7",
        "type": "serial-port",
        "serialport": "/dev/ttyMOD1",
        "serialbaud": "38400",
        "databits": "8",
        "parity": "none",
        "stopbits": "1",
        "waitfor": "",
        "dtr": "none",
        "rts": "none",
        "cts": "none",
        "dsr": "none",
        "newline": "0",
        "bin": "bin",
        "out": "time",
        "addchar": "",
        "responsetimeout": "1000"
    },
    {
        "id": "f6b859379e7fc59c",
        "type": "serial-port",
        "serialport": "/dev/serial/by-id/usb-1a86_USB2.0-Ser_-if00-port0",
        "serialbaud": "19200",
        "databits": "8",
        "parity": "none",
        "stopbits": "1",
        "waitfor": "",
        "dtr": "none",
        "rts": "none",
        "cts": "none",
        "dsr": "none",
        "newline": "0",
        "bin": "bin",
        "out": "interbyte",
        "addchar": "",
        "responsetimeout": "200"
    },
    {
        "id": "533a9a8ff6fc2064",
        "type": "ui_tab",
        "name": "Home",
        "icon": "Relay",
        "order": 11,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "2bcab2171f3cb3b2",
        "type": "json-db-collection",
        "name": "videomatrix",
        "collection": "videomatrix",
        "save": true
    },
    {
        "id": "4f6d1b4955f77a17",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "",
        "verifyservercert": false,
        "alpnprotocol": ""
    },
    {
        "id": "0da1bcc0b8679e07",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "",
        "verifyservercert": false,
        "alpnprotocol": ""
    },
    {
        "id": "0aba6329bf5a0d4f",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "",
        "verifyservercert": false,
        "alpnprotocol": ""
    },
    {
        "id": "031803e327f8c64f",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "",
        "verifyservercert": false,
        "alpnprotocol": ""
    },
    {
        "id": "dd3fe36ba9957e32",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "",
        "verifyservercert": false,
        "alpnprotocol": ""
    },
    {
        "id": "551589e82f0e975d",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "",
        "verifyservercert": false,
        "alpnprotocol": ""
    },
    {
        "id": "02fd5d52443f358c",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "",
        "verifyservercert": false,
        "alpnprotocol": ""
    },
    {
        "id": "76a7ab145891ea38",
        "type": "json-db-collection",
        "name": "mic_info",
        "collection": "mic_info",
        "save": true
    },
    {
        "id": "481e820155473f8f",
        "type": "ui_group",
        "name": "Запись команды",
        "tab": "4e6189e576b30edc",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "f5d17fde598449e6",
        "type": "ui_group",
        "name": "Серийный номер",
        "tab": "4e6189e576b30edc",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "4e6189e576b30edc",
        "type": "ui_tab",
        "name": "Настройка ИК-передатчиков WB-MIR v.2",
        "icon": "settings_remote",
        "order": 7,
        "disabled": false,
        "hidden": true
    },
    {
        "id": "9c92aa8ff7cda4a8",
        "type": "ui_tab",
        "name": "Смена IP-адреса хоста",
        "icon": "dashboard",
        "order": 8,
        "disabled": false,
        "hidden": true
    },
    {
        "id": "a22932f8ad9be812",
        "type": "ui_group",
        "name": "Файл настройки сети:",
        "tab": "9c92aa8ff7cda4a8",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "b9e8d97cbe989f93",
        "type": "ui_group",
        "name": "Текущий адрес хоста:",
        "tab": "9c92aa8ff7cda4a8",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "24b71f40bdd9e5f5",
        "type": "ui_spacer",
        "z": "74ce7173202e08d8",
        "name": "spacer",
        "group": "b9e8d97cbe989f93",
        "order": 2,
        "width": 6,
        "height": 1
    },
    {
        "id": "1402b37475817453",
        "type": "ui_spacer",
        "z": "f6992051cb6c0c5c",
        "name": "spacer",
        "group": "2659c0e4.6c014",
        "order": 4,
        "width": 1,
        "height": 1
    },
    {
        "id": "f831405ac1d6942c",
        "type": "ui_spacer",
        "z": "f6992051cb6c0c5c",
        "name": "spacer",
        "group": "2659c0e4.6c014",
        "order": 6,
        "width": 8,
        "height": 1
    },
    {
        "id": "14d6004981683134",
        "type": "ui_spacer",
        "z": "f6992051cb6c0c5c",
        "name": "spacer",
        "group": "2659c0e4.6c014",
        "order": 10,
        "width": 3,
        "height": 1
    },
    {
        "id": "5e769546c6912ed1",
        "type": "ui_group",
        "name": "USB_in",
        "tab": "3aad47d2f496d7f5",
        "order": 3,
        "disp": true,
        "width": "2",
        "collapse": false,
        "className": ""
    },
    {
        "id": "d73db9aefa1d5022",
        "type": "ui_group",
        "name": "USB_out",
        "tab": "3aad47d2f496d7f5",
        "order": 2,
        "disp": true,
        "width": "2",
        "collapse": false,
        "className": ""
    },
    {
        "id": "d5d40670147f334f",
        "type": "ui_group",
        "name": "Конференц-система",
        "tab": "0a301e486709f27a",
        "order": 5,
        "disp": true,
        "width": "5",
        "collapse": false,
        "className": ""
    },
    {
        "id": "5617fff903bf834f",
        "type": "json-db-collection",
        "name": "confsystem_config",
        "collection": "confsystem_config",
        "save": true
    },
    {
        "id": "0f566ef5b93f8eba",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "9c7e5ff72d78b502",
        "order": 4,
        "width": 2,
        "height": 1
    },
    {
        "id": "a26fc0150e47008b",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "9c7e5ff72d78b502",
        "order": 7,
        "width": 1,
        "height": 1
    },
    {
        "id": "2a05e0a2796bda80",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "9c7e5ff72d78b502",
        "order": 9,
        "width": 2,
        "height": 1
    },
    {
        "id": "b0b6ddc3c41f0836",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "9c7e5ff72d78b502",
        "order": 11,
        "width": 2,
        "height": 1
    },
    {
        "id": "cc663d4716d2d690",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "47715a302e162008",
        "order": 4,
        "width": 2,
        "height": 1
    },
    {
        "id": "25f58b72bdac1ecd",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "47715a302e162008",
        "order": 7,
        "width": 1,
        "height": 1
    },
    {
        "id": "a009b48bbb8de05f",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "47715a302e162008",
        "order": 9,
        "width": 2,
        "height": 1
    },
    {
        "id": "7813467883681ded",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "47715a302e162008",
        "order": 11,
        "width": 2,
        "height": 1
    },
    {
        "id": "2167d9ae89bee5e6",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "e1b3f68bc0754e54",
        "order": 4,
        "width": 2,
        "height": 1
    },
    {
        "id": "e765017560b474a8",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "e1b3f68bc0754e54",
        "order": 7,
        "width": 1,
        "height": 1
    },
    {
        "id": "ed0af985d7655dea",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "e1b3f68bc0754e54",
        "order": 9,
        "width": 2,
        "height": 1
    },
    {
        "id": "7a313ebdad3d196a",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "e1b3f68bc0754e54",
        "order": 11,
        "width": 2,
        "height": 1
    },
    {
        "id": "e82f5d2bde32f7ce",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "ea4be7e4d073dec2",
        "order": 2,
        "width": 1,
        "height": 1
    },
    {
        "id": "478c7074861c0d1f",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "ea4be7e4d073dec2",
        "order": 4,
        "width": 2,
        "height": 1
    },
    {
        "id": "b633e1245087e937",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "ea4be7e4d073dec2",
        "order": 7,
        "width": 1,
        "height": 1
    },
    {
        "id": "3765c97aae7a3e10",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "ea4be7e4d073dec2",
        "order": 9,
        "width": 2,
        "height": 1
    },
    {
        "id": "e68dd6f7e21b85a6",
        "type": "ui_spacer",
        "z": "f7c5cff35e94fee9",
        "name": "spacer",
        "group": "ea4be7e4d073dec2",
        "order": 11,
        "width": 2,
        "height": 1
    },
    {
        "id": "3ef1f780874dd9df",
        "type": "ui_spacer",
        "z": "4ab7a6698d04b636",
        "name": "spacer",
        "group": "2659c0e4.6c014",
        "order": 4,
        "width": 1,
        "height": 1
    },
    {
        "id": "0372bfee738c60dd",
        "type": "ui_spacer",
        "z": "4ab7a6698d04b636",
        "name": "spacer",
        "group": "2659c0e4.6c014",
        "order": 6,
        "width": 8,
        "height": 1
    },
    {
        "id": "9924649e7ddf784a",
        "type": "ui_spacer",
        "z": "4ab7a6698d04b636",
        "name": "spacer",
        "group": "2659c0e4.6c014",
        "order": 10,
        "width": 3,
        "height": 1
    },
    {
        "id": "fc2772e34f6ee2c7",
        "type": "ui_group",
        "name": "USB_in",
        "tab": "3aad47d2f496d7f5",
        "order": 3,
        "disp": true,
        "width": "2",
        "collapse": false,
        "className": ""
    },
    {
        "id": "ebbc8772c1f553eb",
        "type": "ui_group",
        "name": "USB_out",
        "tab": "3aad47d2f496d7f5",
        "order": 2,
        "disp": true,
        "width": "2",
        "collapse": false,
        "className": ""
    },
    {
        "id": "691dea9c0f723bad",
        "type": "exec",
        "z": "74ce7173202e08d8",
        "d": true,
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 670,
        "y": 360,
        "wires": [
            [
                "e14a9d03b7fc46d8",
                "d1b9c3e2f1919963"
            ],
            [],
            []
        ]
    },
    {
        "id": "40425569a42a3a73",
        "type": "function",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": "cat /etc/network/interfaces",
        "func": "msg.payload = 'cat /etc/network/interfaces'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 360,
        "wires": [
            [
                "691dea9c0f723bad"
            ]
        ]
    },
    {
        "id": "f3fa641a7a971335",
        "type": "inject",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 210,
        "y": 360,
        "wires": [
            [
                "40425569a42a3a73"
            ]
        ]
    },
    {
        "id": "e14a9d03b7fc46d8",
        "type": "debug",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": "debug 174",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 870,
        "y": 360,
        "wires": []
    },
    {
        "id": "7bd1618556a58994",
        "type": "exec",
        "z": "74ce7173202e08d8",
        "d": true,
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 590,
        "y": 560,
        "wires": [
            [
                "d47e02797ebd34e4"
            ],
            [],
            []
        ]
    },
    {
        "id": "6091c97d4cff1087",
        "type": "function",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": "10.111.32.146",
        "func": "var data = `\n# This file is automatically generated by wb-nm-helper.\n# interfaces(5) file used by ifup(8) and ifdown(8)\n# Include files from /etc/network/interfaces.d:\n# source /etc/network/interfaces.d/*\nauto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet static\naddress 10.111.32.146\nnetmask 255.255.240.0\ngateway 10.111.32.1\n`;\n\nmsg.payload = `printf \"${data.slice(1)}\" > /etc/network/interfaces`;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 560,
        "wires": [
            [
                "7bd1618556a58994"
            ]
        ]
    },
    {
        "id": "46f5323ef39b0dc0",
        "type": "inject",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 210,
        "y": 560,
        "wires": [
            [
                "6091c97d4cff1087"
            ]
        ]
    },
    {
        "id": "7d91dde239c57d9f",
        "type": "exec",
        "z": "74ce7173202e08d8",
        "d": true,
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 590,
        "y": 620,
        "wires": [
            [
                "d47e02797ebd34e4"
            ],
            [],
            []
        ]
    },
    {
        "id": "1b2b712f746bad69",
        "type": "function",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": "10.111.32.147",
        "func": "var data = `\n# This file is automatically generated by wb-nm-helper.\n# interfaces(5) file used by ifup(8) and ifdown(8)\n# Include files from /etc/network/interfaces.d:\n# source /etc/network/interfaces.d/*\nauto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet static\naddress 10.111.32.147\nnetmask 255.255.240.0\ngateway 10.111.32.1\n`;\n\nmsg.payload = `printf \"${data.slice(1)}\" > /etc/network/interfaces`;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 620,
        "wires": [
            [
                "7d91dde239c57d9f"
            ]
        ]
    },
    {
        "id": "87760933c8f0b4d4",
        "type": "inject",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 210,
        "y": 620,
        "wires": [
            [
                "1b2b712f746bad69"
            ]
        ]
    },
    {
        "id": "afad32fac88f2063",
        "type": "exec",
        "z": "74ce7173202e08d8",
        "d": true,
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 670,
        "y": 140,
        "wires": [
            [
                "344dd83ce19ecb84",
                "8d0938f8ce3adb7a"
            ],
            [],
            []
        ]
    },
    {
        "id": "b19bde72e5d18eb9",
        "type": "function",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": "systemctl restart networking",
        "func": "msg.payload = 'bash /usr/local/bin/update-network.sh';\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 140,
        "wires": [
            [
                "afad32fac88f2063"
            ]
        ]
    },
    {
        "id": "508ec4386df7f87a",
        "type": "inject",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 210,
        "y": 140,
        "wires": [
            [
                "b19bde72e5d18eb9"
            ]
        ]
    },
    {
        "id": "344dd83ce19ecb84",
        "type": "debug",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": "debug 184",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 870,
        "y": 140,
        "wires": []
    },
    {
        "id": "8d0938f8ce3adb7a",
        "type": "function",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": "split",
        "func": "msg.payload = msg.payload.split('\\n')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 100,
        "wires": [
            [
                "573084bca6d52fce"
            ]
        ]
    },
    {
        "id": "573084bca6d52fce",
        "type": "debug",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": "debug 185",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 100,
        "wires": []
    },
    {
        "id": "1c11a88170d8a026",
        "type": "comment",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": "",
        "info": "systemctl не работает из контейнера",
        "x": 380,
        "y": 100,
        "wires": []
    },
    {
        "id": "0df9a0e3ee419f6b",
        "type": "exec",
        "z": "74ce7173202e08d8",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 1730,
        "y": 440,
        "wires": [
            [
                "4b7a6f705e1d7395",
                "3e3751d2b9dfcaf9"
            ],
            [],
            []
        ]
    },
    {
        "id": "c26a5701ebbadb20",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "ls /etc/network",
        "func": "msg.payload = 'ls /etc/network'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1460,
        "y": 440,
        "wires": [
            [
                "0df9a0e3ee419f6b"
            ]
        ]
    },
    {
        "id": "0b06b092f8fc55a2",
        "type": "inject",
        "z": "74ce7173202e08d8",
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1270,
        "y": 440,
        "wires": [
            [
                "c26a5701ebbadb20"
            ]
        ]
    },
    {
        "id": "4b7a6f705e1d7395",
        "type": "debug",
        "z": "74ce7173202e08d8",
        "name": "debug 204",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 440,
        "wires": []
    },
    {
        "id": "3e3751d2b9dfcaf9",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "split",
        "func": "msg.payload = msg.payload.split('\\n')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1910,
        "y": 400,
        "wires": [
            [
                "90ea9c3dae6d4998"
            ]
        ]
    },
    {
        "id": "90ea9c3dae6d4998",
        "type": "debug",
        "z": "74ce7173202e08d8",
        "name": "debug 205",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2090,
        "y": 400,
        "wires": []
    },
    {
        "id": "d1b9c3e2f1919963",
        "type": "function",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": "split",
        "func": "msg.payload = msg.payload.split('\\n')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 320,
        "wires": [
            [
                "5ef76a0f349342a1"
            ]
        ]
    },
    {
        "id": "5ef76a0f349342a1",
        "type": "debug",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": "debug 177",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 320,
        "wires": []
    },
    {
        "id": "08b553fc9b2d154c",
        "type": "ui_text",
        "z": "74ce7173202e08d8",
        "d": true,
        "group": "a22932f8ad9be812",
        "order": 1,
        "width": 6,
        "height": 6,
        "name": "",
        "label": "{{msg.topic}}",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 1390,
        "y": 580,
        "wires": []
    },
    {
        "id": "554757c10a0d54a5",
        "type": "ui_text_input",
        "z": "74ce7173202e08d8",
        "name": "",
        "label": "",
        "tooltip": "",
        "group": "b9e8d97cbe989f93",
        "order": 3,
        "width": 3,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 360,
        "y": 980,
        "wires": [
            [
                "f5e8fb7d410b5bb4"
            ]
        ]
    },
    {
        "id": "967f24b5cc2c808b",
        "type": "exec",
        "z": "74ce7173202e08d8",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 610,
        "y": 780,
        "wires": [
            [
                "064f02f6a6a813c4"
            ],
            [],
            []
        ]
    },
    {
        "id": "1e0f3a797f71f699",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "ip addr show eth0",
        "func": "msg.payload = 'ip addr show eth0'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 780,
        "wires": [
            [
                "967f24b5cc2c808b"
            ]
        ]
    },
    {
        "id": "c981d53e0a40f603",
        "type": "inject",
        "z": "74ce7173202e08d8",
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 210,
        "y": 780,
        "wires": [
            [
                "1e0f3a797f71f699"
            ]
        ]
    },
    {
        "id": "9797fe15084dfc0d",
        "type": "debug",
        "z": "74ce7173202e08d8",
        "name": "address",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "address",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 960,
        "y": 740,
        "wires": []
    },
    {
        "id": "064f02f6a6a813c4",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "get address",
        "func": "msg.payload = msg.payload.split('\\n')\nmsg.address = msg.payload[2].trim().split(' ')[1].split('/')[0]\nmsg.payload = undefined\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 760,
        "wires": [
            [
                "9797fe15084dfc0d",
                "11a80e52d9fc2a37"
            ]
        ]
    },
    {
        "id": "11a80e52d9fc2a37",
        "type": "ui_text",
        "z": "74ce7173202e08d8",
        "group": "b9e8d97cbe989f93",
        "order": 1,
        "width": 6,
        "height": 1,
        "name": "",
        "label": "{{msg.address}}",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 950,
        "y": 780,
        "wires": []
    },
    {
        "id": "d47e02797ebd34e4",
        "type": "function",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": "cat /etc/network/interfaces",
        "func": "msg.payload = 'cat /etc/network/interfaces'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 600,
        "wires": [
            [
                "c45fa4149bef05e2"
            ]
        ]
    },
    {
        "id": "c45fa4149bef05e2",
        "type": "exec",
        "z": "74ce7173202e08d8",
        "d": true,
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 1050,
        "y": 600,
        "wires": [
            [
                "bba5d22ec2e6fc5c"
            ],
            [],
            []
        ]
    },
    {
        "id": "bba5d22ec2e6fc5c",
        "type": "function",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": "function 20",
        "func": "msg.payload = msg.payload.split('\\n')\nmsg.topic = msg.payload.join(\"<br>\")\nmsg.payload = undefined\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1210,
        "y": 580,
        "wires": [
            [
                "08b553fc9b2d154c"
            ]
        ]
    },
    {
        "id": "47397b5e95d6117f",
        "type": "inject",
        "z": "74ce7173202e08d8",
        "d": true,
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 790,
        "y": 540,
        "wires": [
            [
                "d47e02797ebd34e4"
            ]
        ]
    },
    {
        "id": "8c6d2870aa6c1ed9",
        "type": "ui_button",
        "z": "74ce7173202e08d8",
        "name": "",
        "group": "b9e8d97cbe989f93",
        "order": 4,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Назначить IP",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "ip",
        "topicType": "msg",
        "x": 720,
        "y": 980,
        "wires": [
            [
                "e4f91d7f5924d200"
            ]
        ]
    },
    {
        "id": "f5e8fb7d410b5bb4",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "return input",
        "func": "msg.ip = msg.payload\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 980,
        "wires": [
            [
                "8c6d2870aa6c1ed9"
            ]
        ]
    },
    {
        "id": "e4f91d7f5924d200",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "validation",
        "func": "const keys = global.keys().filter((key) => key.includes(\"_ip\"));\nconst ip_s = keys.map(key => global.get(key))\n\nif (msg.topic == undefined || msg.topic == '')\n{\n    global.set(\"tcgroup_ip\", undefined) // <---\n    msg.log = 'empty'\n}\nelse if (ip_s.includes(msg.topic) && (global.get(\"tcgroup_ip\")) != msg.topic) // <---\n{\n    msg.log = 'busy'\n}\nelse \n{\n    const regex = new RegExp(/^\\d{1,3}.\\d{1,3}\\.\\d{1,3}.\\d{1,3}$/);\n    \n    let ip = msg.topic.split('.').map(el => Number(parseInt(el) <= 255));\n    let total = ip.reduce((acc, val) => acc + val, 0);\n\n    if ((regex.test(msg.topic) && total === 4))\n    {\n        global.set(\"tcgroup_ip\", msg.topic) // <---\n        msg.log = 'ok'\n    }\n    else\n    {\n        msg.log = 'incorrect'\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 980,
        "wires": [
            [
                "24b437e66b7f3eb3",
                "ee167474df4004da"
            ]
        ]
    },
    {
        "id": "1019b0c53e2b1aa3",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "return IP",
        "func": "msg.payload = global.get(\"tcgroup_ip\")\nif (!msg.payload)\n{\n    msg.payload = ''\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 940,
        "wires": [
            [
                "554757c10a0d54a5"
            ]
        ]
    },
    {
        "id": "24b437e66b7f3eb3",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "not valid",
        "func": "if (msg.log == 'incorrect' || msg.log == 'busy')\n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 980,
        "wires": [
            [
                "1019b0c53e2b1aa3"
            ]
        ]
    },
    {
        "id": "ee167474df4004da",
        "type": "switch",
        "z": "74ce7173202e08d8",
        "name": "log",
        "property": "log",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "empty",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ok",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "incorrect",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "busy",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1030,
        "y": 1120,
        "wires": [
            [
                "2508cbaa7d293781"
            ],
            [
                "2f416e026c4d5bc9"
            ],
            [
                "5eea14ea7ad7d903"
            ],
            [
                "c6ce4909efdeac9c"
            ]
        ]
    },
    {
        "id": "13c762ca947e53cb",
        "type": "ui_toast",
        "z": "74ce7173202e08d8",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Введёный вами IP-адрес используется другим устройством",
        "name": "Busy",
        "x": 1390,
        "y": 1180,
        "wires": []
    },
    {
        "id": "46807268a2c3ee98",
        "type": "ui_toast",
        "z": "74ce7173202e08d8",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "IP-адрес назначен",
        "name": "Successful",
        "x": 1370,
        "y": 1100,
        "wires": []
    },
    {
        "id": "a191b1d3161686e2",
        "type": "ui_toast",
        "z": "74ce7173202e08d8",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Некорректный IP-адрес",
        "name": "Incorrect",
        "x": 1380,
        "y": 1140,
        "wires": []
    },
    {
        "id": "5eea14ea7ad7d903",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1210,
        "y": 1140,
        "wires": [
            [
                "a191b1d3161686e2"
            ]
        ]
    },
    {
        "id": "c6ce4909efdeac9c",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1210,
        "y": 1180,
        "wires": [
            [
                "13c762ca947e53cb"
            ]
        ]
    },
    {
        "id": "2f416e026c4d5bc9",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1210,
        "y": 1100,
        "wires": [
            [
                "46807268a2c3ee98",
                "df29596056bdf234"
            ]
        ]
    },
    {
        "id": "40abed35419ba258",
        "type": "ui_toast",
        "z": "74ce7173202e08d8",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Поле очищено",
        "name": "Empty",
        "x": 1390,
        "y": 1060,
        "wires": []
    },
    {
        "id": "2508cbaa7d293781",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1210,
        "y": 1060,
        "wires": [
            [
                "40abed35419ba258"
            ]
        ]
    },
    {
        "id": "df29596056bdf234",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "function 21",
        "func": "msg.topic\n\nvar data = `\n# This file is automatically generated by wb-nm-helper.\n# interfaces(5) file used by ifup(8) and ifdown(8)\n# Include files from /etc/network/interfaces.d:\n# source /etc/network/interfaces.d/*\nauto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet static\naddress ${msg.topic}\nnetmask 255.255.240.0\ngateway 10.111.32.1\n`;\n\nmsg.payload = `printf \"${data.slice(1)}\" > /etc/network/interfaces`;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 980,
        "wires": [
            [
                "09d83b86bcfa018a",
                "beffa11400450255"
            ]
        ]
    },
    {
        "id": "09d83b86bcfa018a",
        "type": "debug",
        "z": "74ce7173202e08d8",
        "name": "debug 206",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1650,
        "y": 980,
        "wires": []
    },
    {
        "id": "beffa11400450255",
        "type": "exec",
        "z": "74ce7173202e08d8",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 1490,
        "y": 920,
        "wires": [
            [
                "fc3441518f709985"
            ],
            [],
            []
        ]
    },
    {
        "id": "dddfbd5b66485996",
        "type": "ui_text",
        "z": "74ce7173202e08d8",
        "group": "a22932f8ad9be812",
        "order": 2,
        "width": 6,
        "height": 6,
        "name": "",
        "label": "{{msg.topic}}",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 2290,
        "y": 880,
        "wires": []
    },
    {
        "id": "fc3441518f709985",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "cat /etc/network/interfaces",
        "func": "msg.payload = 'cat /etc/network/interfaces'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1750,
        "y": 900,
        "wires": [
            [
                "e15ac7df7b9191d7"
            ]
        ]
    },
    {
        "id": "e15ac7df7b9191d7",
        "type": "exec",
        "z": "74ce7173202e08d8",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 1950,
        "y": 900,
        "wires": [
            [
                "bf51baf0996a088c"
            ],
            [],
            []
        ]
    },
    {
        "id": "bf51baf0996a088c",
        "type": "function",
        "z": "74ce7173202e08d8",
        "name": "function 22",
        "func": "msg.payload = msg.payload.split('\\n')\nmsg.topic = msg.payload.join(\"<br>\")\nmsg.payload = undefined\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2110,
        "y": 880,
        "wires": [
            [
                "dddfbd5b66485996"
            ]
        ]
    },
    {
        "id": "bd51710af2246ef4",
        "type": "inject",
        "z": "74ce7173202e08d8",
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1570,
        "y": 840,
        "wires": [
            [
                "fc3441518f709985"
            ]
        ]
    },
    {
        "id": "1e38d53b1324c866",
        "type": "ui_text",
        "z": "6c8f21a3d6cd1c5b",
        "group": "1d11c7c923e110a2",
        "order": 1,
        "width": "6",
        "height": "8",
        "name": "",
        "label": "{{msg.topic}}",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 470,
        "y": 80,
        "wires": []
    },
    {
        "id": "8e42cc9eeebabe2a",
        "type": "inject",
        "z": "6c8f21a3d6cd1c5b",
        "name": "IP-адреса",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 170,
        "y": 80,
        "wires": [
            [
                "bef6523cc0236d01"
            ]
        ]
    },
    {
        "id": "bef6523cc0236d01",
        "type": "function",
        "z": "6c8f21a3d6cd1c5b",
        "name": "text",
        "func": "msg.topic = \"<b>IP-адрес</b> - уникальный числовой идентификатор устройства в компьютерной сети, работающей по протоколу IP<br><br>\\\nIP-адреса указываются в виде строк из четырех чисел, разделенных точками.<br><br>\\\nКаждое число должно быть в диапазоне <b>[0-255]</b><br><br>\\\nТаким образом, полный диапазон IP-адресов варьируется от <b>0.0.0.0</b> до <b>255.255.255.255</b><br><br>\\\nПримеры ввода:<br>\\\n&bull; <b>192.168.5.12</b><br>\\\n&bull; <b>10.111.12.40</b><br>\\\n&bull; <b>215.124.23.1</b>\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 80,
        "wires": [
            [
                "1e38d53b1324c866"
            ]
        ]
    },
    {
        "id": "a9a72b6baf10495e",
        "type": "inject",
        "z": "6c8f21a3d6cd1c5b",
        "name": "Порты",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 120,
        "wires": [
            [
                "4af19cadbf22da16"
            ]
        ]
    },
    {
        "id": "2f27ecacded1f0c7",
        "type": "ui_text",
        "z": "6c8f21a3d6cd1c5b",
        "group": "56f549ae6fc3f169",
        "order": 1,
        "width": "6",
        "height": "8",
        "name": "",
        "label": "{{msg.topic}}",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 470,
        "y": 120,
        "wires": []
    },
    {
        "id": "4af19cadbf22da16",
        "type": "function",
        "z": "6c8f21a3d6cd1c5b",
        "name": "text",
        "func": "msg.topic = \"<b>Порт</b> – это числовой идентификатор программы или процесса, которые обслуживают сетевые соединения на заданном сетевом адресе (IP-адресе)<br><br>\\\nВсе порты разделены на три диапазона:<br>\\\n&bull; <i>общеизвестные (системные)</i>:<br>&nbsp;&nbsp;[0-1023]<br>\\\n&bull; <i>зарегистрированные (пользовательские)</i>:<br>&nbsp;&nbsp;[1024-49151]<br>\\\n&bull; <i>динамические (частные)</i><br>&nbsp;&nbsp;[49152-65535]<br><br>\\\nПримеры ввода:<br>\\\n&bull; <b>5678</b><br>\\\n&bull; <b>19523</b><br>\\\n&bull; <b>52381</b>\\\n\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 120,
        "wires": [
            [
                "2f27ecacded1f0c7"
            ]
        ]
    },
    {
        "id": "d056712dcf89dabc",
        "type": "debug",
        "z": "f8689935b8ae0be8",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 730,
        "y": 160,
        "wires": []
    },
    {
        "id": "8fa4f0bfe9e07a98",
        "type": "ui_text_input",
        "z": "f8689935b8ae0be8",
        "name": "",
        "label": "Логин",
        "tooltip": "",
        "group": "6a4d510d.5de65",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "0",
        "topic": "",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 330,
        "y": 120,
        "wires": [
            [
                "cd6884b5de8f292e"
            ]
        ]
    },
    {
        "id": "aa734467af7cb82a",
        "type": "ui_text_input",
        "z": "f8689935b8ae0be8",
        "name": "",
        "label": "Пароль",
        "tooltip": "",
        "group": "6a4d510d.5de65",
        "order": 2,
        "width": 4,
        "height": 1,
        "passthru": true,
        "mode": "password",
        "delay": 300,
        "topic": "",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 340,
        "y": 160,
        "wires": [
            [
                "ce21aea6784cdf9c"
            ]
        ]
    },
    {
        "id": "121f8af5ce36cfcd",
        "type": "ui_template",
        "z": "f8689935b8ae0be8",
        "d": true,
        "group": "6a4d510d.5de65",
        "name": "Virtual Keyboard",
        "order": 4,
        "width": "0",
        "height": "0",
        "format": "<div id=\"empty\"></div>\n<button class=\"VK\">V-KeyBoard On</button>\n\n<!-- The Modal -->\n<div id=\"myModal\" class=\"modal\">\n\n  <!-- Modal content -->\n  <div class=\"modal-content\">\n      <div class=\"modal-header\">\n      <span class=\"close\" onclick=\"closeModal()\">&times;</span>\n      <h2 id=\"vkeyname\" style=\"background-color: aliceblue !important; color: black !important; text-align: center; min-height: 30px;\">V-Keyboard</h2>\n    </div>\n    <div class=\"modal-body\">\n        <div id=\"keyboard\"></div>\n        <div>\n        </div>\n    </div>\n  </div>\n</div>\n\n<style>\n.VK{\n    position: fixed;\n    top: 60px;\n    right: 20px;\n    height: 30px;\n}\n</style>\n\n<script>\n\nvar clickState = 0;\nvar btn = document.querySelector('.VK');\n\nbtn.addEventListener('click', function(){\n\n  if (clickState == 0) {\n    this.textContent = 'V-KeyBoard On';\n    modal = document.getElementById('myModal');\n    clickState = 1;\n  } else {\n    this.textContent = 'V-KeyBoard Off';\n    modal = document.getElementById('empty');\n    clickState = 0;\n  }\n\n});\n</script>\n\n<script>\n    // Get the modal\nvar modal = document.getElementById('myModal');\nvar inputTags;\nvar inputType;\nvar inputTarget;\n\nvar getinputs = function() {\n    inputTags = document.getElementsByTagName(\"input\");\n    console.log(inputTags)\n    for (var i = 0; i < inputTags.length; i++) {\n        inputTags[i].addEventListener('click', openModal, false)\n    }\n}\n\nsetTimeout(function(){ getinputs(); }, 1000);\n\nvar openModal = function() {\n    inputType = event.target.type\n    inputTarget = event.target\n    var layoutName;\n    if (inputType == \"number\"){\n        //inputTarget.type = \"number\" //hack because chrome doesn't allow setselection in number inputs\n        //inputTarget.value = \"\"\n        layoutName = \"numbers_only\"\n    }else{\n        layoutName = \"english\"\n    }\n    $('#vkeyname').text(event.target.value)\n    $('#keyboard').unbind().removeData();\n    modal.style.display = \"block\";\n    $('#keyboard').jkeyboard({\n        layout: layoutName,\n        input: $('#'+$(this).attr('id'))\n    });\n}\n\n\n// Get the <span> element that closes the modal\nvar span = document.getElementsByClassName(\"close\")[0];\n\n// When the user clicks anywhere outside of the modal, close it\nwindow.onclick = function(event) {\n    var source = event.target;\n    if (source == modal || source == span) {\n        closeModal(source)\n    }\n};\n\nvar closeModal = function(source){\n    //console.log(\"closing\")\n    modal.style.display = \"none\";\n   \n    if (inputType == \"number\"){\n        inputTarget.type = \"number\" //hack because chrome doesn't allow selectionstart on number inputs\n    }\n}\n\n    \n// the semi-colon before function invocation is a safety net against concatenated\n// scripts and/or other plugins which may not be closed properly.\n; (function ($, window, document, undefined) {\n\n    // undefined is used here as the undefined global variable in ECMAScript 3 is\n    // mutable (ie. it can be changed by someone else). undefined isn't really being\n    // passed in so we can ensure the value of it is truly undefined. In ES5, undefined\n    // can no longer be modified.\n\n    // window and document are passed through as local variable rather than global\n    // as this (slightly) quickens the resolution process and can be more efficiently\n    // minified (especially when both are regularly referenced in your plugin).\n\n    // Create the defaults once\n    var pluginName = \"jkeyboard\",\n        defaults = {\n            layout: \"english\",\n            input: $('#input'),\n            customLayouts: {\n                selectable: []\n            },\n        };\n\n\n    var function_keys = {\n        backspace: {\n            text: 'DEL',\n        },\n        return: {\n            text: 'Enter'\n        },\n        shift: {\n            text: 'Shift'\n        },\n        space: {\n            text: 'Space'\n        },\n        numeric_switch: {\n            text: '123',\n            command: function () {\n                this.createKeyboard('numeric');\n                this.events();\n            }\n        },\n        layout_switch: {\n            text: '<i class=\"fa fa-keyboard-o\" aria-hidden=\"true\"></i>',\n            command: function () {\n                var l = this.toggleLayout();\n                this.createKeyboard(l);\n                this.events();\n            }\n        },\n        character_switch: {\n            text: 'ABC',\n            command: function () {\n                this.createKeyboard(layout);\n                this.events();\n            }\n        },\n        symbol_switch: {\n            text: '#+=',\n            command: function () {\n                this.createKeyboard('symbolic');\n                this.events();\n            }\n        }\n    };\n\n\n    var layouts = {\n        selectable: ['english', 'russian'],\n        english: [\n            ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p',],\n            ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l',],\n            ['shift', 'z', 'x', 'c', 'v', 'b', 'n', 'm', 'backspace'],\n            ['numeric_switch', 'layout_switch', 'space', 'return']\n        ],\n        russian: [\n            ['й', 'ц', 'у', 'к', 'е', 'н', 'г', 'ш', 'щ', 'з', 'х'],\n            ['ф', 'ы', 'в', 'а', 'п', 'р', 'о', 'л', 'д', 'ж', 'э'],\n            ['shift', 'я', 'ч', 'с', 'м', 'и', 'т', 'ь', 'б', 'ю', 'backspace'],\n            ['numeric_switch', 'layout_switch', 'space', 'return']\n        ],\n        numeric: [\n            ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0'],\n            ['-', '/', ':', ';', '(', ')', '$', '&', '@', '\"'],\n            ['symbol_switch', '.', ',', '?', '!', \"'\", 'backspace'],\n            ['character_switch', 'layout_switch', 'space', 'return'],\n        ],\n        numbers_only: [\n            ['1', '2', '3',],\n            ['4', '5', '6',],\n            ['7', '8', '9',],\n            ['0', 'backspace', 'return'],\n        ],\n        symbolic: [\n            ['[', ']', '{', '}', '#', '%', '^', '*', '+', '='],\n            ['_', '\\\\', '|', '~', '<', '>'],\n            ['numeric_switch', '.', ',', '?', '!', \"'\", 'backspace'],\n            ['character_switch', 'layout_switch', 'space', 'return'],\n\n        ]\n    }\n\n    var shift = false, capslock = false, layout = 'english', layout_id = 0;\n\n    // The actual plugin constructor\n    function Plugin(element, options) {\n        this.element = element;\n        // jQuery has an extend method which merges the contents of two or\n        // more objects, storing the result in the first object. The first object\n        // is generally empty as we don't want to alter the default options for\n        // future instances of the plugin\n        this.settings = $.extend({}, defaults, options);\n        // Extend & Merge the cusom layouts\n        layouts = $.extend(true, {}, this.settings.customLayouts, layouts);\n        if (Array.isArray(this.settings.customLayouts.selectable)) {\n            $.merge(layouts.selectable, this.settings.customLayouts.selectable);\n        }\n        this._defaults = defaults;\n        this._name = pluginName;\n        this.init();\n    }\n\n    Plugin.prototype = {\n        init: function () {\n            layout = this.settings.layout;\n            this.createKeyboard(layout);\n            this.events();\n        },\n\n        setInput: function (newInputField) {\n            this.settings.input = newInputField;\n        },\n\n        createKeyboard: function (layout) {\n            shift = false;\n            capslock = false;\n\n            var keyboard_container = $('<ul/>').addClass('jkeyboard'),\n                me = this;\n\n            layouts[layout].forEach(function (line, index) {\n                var line_container = $('<li/>').addClass('jline');\n                line_container.append(me.createLine(line));\n                keyboard_container.append(line_container);\n            });\n\n            $(this.element).html('').append(keyboard_container);\n        },\n\n        createLine: function (line) {\n            var line_container = $('<ul/>');\n\n            line.forEach(function (key, index) {\n                var key_container = $('<li/>').addClass('jkey').data('command', key);\n\n                if (function_keys[key]) {\n                    key_container.addClass(key).html(function_keys[key].text);\n                }\n                else {\n                    key_container.addClass('letter').html(key);\n                }\n\n                line_container.append(key_container);\n            })\n\n            return line_container;\n        },\n\n        events: function () {\n            var letters = $(this.element).find('.letter'),\n                shift_key = $(this.element).find('.shift'),\n                space_key = $(this.element).find('.space'),\n                backspace_key = $(this.element).find('.backspace'),\n                return_key = $(this.element).find('.return'),\n\n                me = this,\n                fkeys = Object.keys(function_keys).map(function (k) {\n                    return '.' + k;\n                }).join(',');\n\n            letters.on('click', function () {\n                me.type((shift || capslock) ? $(this).text().toUpperCase() : $(this).text());\n            });\n\n            space_key.on('click', function () {\n                me.type(' ');\n            });\n\n            return_key.on('click', function () {\n                me.enter();\n            });\n\n            backspace_key.on('click', function () {\n                me.backspace();\n            });\n\n            shift_key.on('click', function () {\n                if (capslock) {\n                    me.toggleShiftOff();\n                    capslock = false;\n                } else {\n                    me.toggleShiftOn();\n                }\n            }).on('dblclick', function () {\n                capslock = true;\n            });\n\n\n            $(fkeys).on('click', function () {\n                var command = function_keys[$(this).data('command')].command;\n                if (!command) return;\n\n                command.call(me);\n            });\n        },\n\n        type: function (key) {\n            var input = this.settings.input,\n                val = input.val(),\n                input_node = input.get(0),\n                start = input_node.selectionStart,\n                end = input_node.selectionEnd;\n\n            var max_length = $(input).attr(\"maxlength\");\n            if (start == end && end == val.length) {\n                if (!max_length || val.length < max_length) {\n                    input.val(val + key);\n                    input.change()\n                    $('#vkeyname').text(val + key)\n                }\n            } else {\n                if (input_node.type == \"text\"){\n                    var new_string = this.insertToString(start, end, val, key);\n                    input.val(new_string);\n                    start++;\n                    end = start;\n                    input_node.setSelectionRange(start, end);\n                    input.change()\n                }else if (input_node.type == \"number\"){\n                    input.val(val + key);\n                }else{\n                    input.val(val + key);\n                    input.change()\n                }\n                $('#vkeyname').text(val + key)\n                \n            }\n            input.trigger('focus');\n\n            if (shift && !capslock) {\n                this.toggleShiftOff();\n            }\n        },\n        \n        enter: function () {\n            var input = this.settings.input,\n                val = input.val();\n                input_node = input.get(0),\n                start = input_node.selectionStart,\n                end = input_node.selectionEnd;\n            if (input_node.type == \"text\"){\n                val = val + \"\\n\";\n                $('#vkeyname').text(val)\n            }\n            input.change()\n            input.focus()\n            if (input_node.type == \"number\"){\n                modal.style.display = \"none\";\n            }\n        },\n\n        backspace: function () {\n            var input = this.settings.input,\n                val = input.val();\n                input_node = input.get(0),\n                start = input_node.selectionStart,\n                end = input_node.selectionEnd;\n            if (input.type == \"text\"){\n                input.val(val.slice(0, start-1) + val.slice(start))\n                input_node.setSelectionRange(start-1, start-1);\n                //console.log(val)\n                $('#vkeyname').text(val)\n            }else{\n                input.val(val.slice(0,-1))\n                $('#vkeyname').text(val.slice(0,-1))\n            }\n            //input.change()\n            //input.focus()\n        },\n\n        toggleShiftOn: function () {\n            var letters = $(this.element).find('.letter'),\n                shift_key = $(this.element).find('.shift');\n\n            letters.addClass('uppercase');\n            shift_key.addClass('active')\n            shift = true;\n        },\n\n        toggleShiftOff: function () {\n            var letters = $(this.element).find('.letter'),\n                shift_key = $(this.element).find('.shift');\n\n            letters.removeClass('uppercase');\n            shift_key.removeClass('active');\n            shift = false;\n        },\n\n        toggleLayout: function () {\n            layout_id = layout_id || 0;\n            var plain_layouts = layouts.selectable;\n            layout_id++;\n\n            var current_id = layout_id % plain_layouts.length;\n            var SelectedLayoutName = plain_layouts[current_id];\n            $('#vkeyname').text('V-Keyboard ' + SelectedLayoutName )\n            return plain_layouts[current_id];\n        },\n\n        insertToString: function (start, end, string, insert_string) {\n            return string.substring(0, start) + insert_string + string.substring(end, string.length);\n        }\n    };\n\n        /*\n\t\t// A really lightweight plugin wrapper around the constructor,\n\t\t// preventing against multiple instantiations\n\t\t$.fn[ pluginName ] = function ( options ) {\n\t\t\t\treturn this.each(function() {\n\t\t\t\t\t\tif ( !$.data( this, \"plugin_\" + pluginName ) ) {\n\t\t\t\t\t\t\t\t$.data( this, \"plugin_\" + pluginName, new Plugin( this, options ) );\n\t\t\t\t\t\t}\n\t\t\t\t});\n\t\t};\n        */\n        var methods = {\n            init: function(options) {\n                if (!this.data(\"plugin_\" + pluginName)) {\n                    this.data(\"plugin_\" + pluginName, new Plugin(this, options));\n                }\n            },\n\t\t\tsetInput: function(content) {\n\t\t\t\tthis.data(\"plugin_\" + pluginName).setInput($(content));\n            },\n            setLayout: function(layoutname) {\n                // change layout if it is not match current\n                object = this.data(\"plugin_\" + pluginName);\n                if (typeof(layouts[layoutname]) !== 'undefined' && object.settings.layout != layoutname) {\n                    object.settings.layout = layoutname;\n                    object.createKeyboard(layoutname);\n                    object.events();\n                };\n            },\n        };\n\n\t\t$.fn[pluginName] = function (methodOrOptions) {\n            if (methods[methodOrOptions]) {\n                return methods[methodOrOptions].apply(this.first(), Array.prototype.slice.call( arguments, 1));\n            } else if (typeof methodOrOptions === 'object' || ! methodOrOptions) {\n                // Default to \"init\"\n                return methods.init.apply(this.first(), arguments);\n            } else {\n                $.error('Method ' +  methodOrOptions + ' does not exist on jQuery.tooltip');\n            }\n        };\n\n})(jQuery, window, document);\n</script>\n\n<style>\nbody {font-family: Arial, Helvetica, sans-serif;}\n\n.nr-dashboard-theme .nr-dashboard-template .md-button:not(:first-of-type) {\n    margin-top: 0px;\n}\n\n/* The Modal (background) */\n.modal {\n    display: none; /* Hidden by default */\n    position: fixed; /* Stay in place */\n    opacity:0.99;\n    z-index: 100; /* Sit on top */\n    left: 0;\n    top: 0;\n    width: 100%; /* Full width */\n    height: 100%; /* Full height */\n    overflow: auto; /* Enable scroll if needed */\n    background-color: rgb(0,0,0); /* Fallback color */\n    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\n}\n\n/* Modal Content */\n.modal-content {\n    position: fixed;\n    background-color: #fefefe;\n    margin: auto;\n    padding: 0;\n    bottom: 0%;\n    left: 50%;\n    transform: translate(-50%, 0%);\n    border: 1px solid #888;\n    width: fit-content;\n    max-width: 100%;\n    max-height: 100%;\n    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);\n    -webkit-animation-name: animate;\n    -webkit-animation-duration: 0.4s;\n    animation-name: animate;\n    animation-duration: 0.4s\n}\n\n/* Add Animation */\n@-webkit-keyframes animate {\n    from {bottom:100%; opacity:0} \n    to {bottom:0%; opacity:1}\n}\n\n@keyframes animate {\n    from {bottom:100%; opacity:0}\n    to {bottom:0%; opacity:1}\n}\n\n/* The Close Button */\n.close {\n    color: black;\n    float: right;\n    font-size: 28px;\n    font-weight: bold;\n}\n\n.close:hover,\n.close:focus {\n    color: #000;\n    text-decoration: none;\n    cursor: pointer;\n}\n\n.modal-header {\n    padding: 2px 16px;\n    background-color: aliceblue;\n    color: white;\n}\n\n.modal-body {padding: 2px 16px;}\n\n.modal-footer {\n    padding: 2px 16px;\n    background-color: #5cb85c;\n    color: white;\n}\n\n.jkeyboard {\n  display: inline-block;\n}\n.jkeyboard, .jkeyboard .jline, .jkeyboard .jline ul {\n  display: block;\n  margin: 0;\n  padding: 0;\n}\n.jkeyboard .jline {\n  text-align: center;\n  margin-left: -14px;\n}\n.jkeyboard .jline ul li {\n  font-family: arial, sans-serif;\n  font-size: 20px;\n  display: inline-block;\n  border: 1px solid #468db3;\n  -webkit-box-shadow: 0 0 3px #468db3;\n  -webkit-box-shadow: inset 0 0 3px #468db3;\n  margin: 5px 0 1px 6px;\n  color: #000000;\n  border-radius: 5px;\n  width: 52px;\n  height: 52px;\n  box-sizing: border-box;\n  text-align: center;\n  line-height: 52px;\n  overflow: hidden;\n  cursor: pointer;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: -moz-none;\n  -ms-user-select: none;\n  user-select: none;\n}\n.jkeyboard .jline ul li.uppercase {\n  text-transform: uppercase;\n}\n.jkeyboard .jline ul li:hover, .jkeyboard .jline ul li:active {\n  background-color: #185a82;\n}\n.jkeyboard .jline .return {\n  width: 80px;\n}\n.jkeyboard .jline .space {\n  width: 366px;\n}\n.jkeyboard .jline .numeric_switch {\n  width: 65px;\n}\n.jkeyboard .jline .layout_switch {\n}\n.jkeyboard .jline .shift {\n  width: 60px;\n}\n.jkeyboard .jline .backspace {\n  width: 69px;\n}\n</style>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 160,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "4ec209d722f7ac07",
        "type": "debug",
        "z": "f8689935b8ae0be8",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 730,
        "y": 120,
        "wires": []
    },
    {
        "id": "df893459047fef38",
        "type": "ui_button",
        "z": "f8689935b8ae0be8",
        "name": "",
        "group": "6a4d510d.5de65",
        "order": 3,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Подтвердить",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 220,
        "y": 220,
        "wires": [
            [
                "cc8ba3d49149401d",
                "8bad0d2ad256ac20"
            ]
        ]
    },
    {
        "id": "4a3d6326b904d2b7",
        "type": "ui_ui_control",
        "z": "f8689935b8ae0be8",
        "name": "",
        "events": "all",
        "x": 1180,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "1417d5499eae58f4",
        "type": "change",
        "z": "f8689935b8ae0be8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"tab\":\"КОНФИГУРАТОР\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 940,
        "y": 220,
        "wires": [
            [
                "6f112530b4cdc488",
                "4a3d6326b904d2b7"
            ]
        ]
    },
    {
        "id": "b5847f613ce89c82",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "access filter",
        "func": "function simpleHash(str) {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n        hash = (hash << 5) - hash + str.charCodeAt(i);\n        hash = hash | 0; // Приведение к 32-битному целому\n    }\n    return hash.toString(16); // Возвращаем хэш в шестнадцатеричном формате\n}\n\nconst login = flow.get('login')\nconst password = flow.get('password')\nconst data = login + password\nconst myHash = simpleHash(data);\n\nif (myHash === msg.payload)\n{   \n    msg.result = true\n}\nelse\n{\n    msg.result = false\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 220,
        "wires": [
            [
                "6a99a4663079625f"
            ]
        ]
    },
    {
        "id": "cd6884b5de8f292e",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "flow.set login",
        "func": "flow.set('login', msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 120,
        "wires": [
            [
                "4ec209d722f7ac07"
            ]
        ]
    },
    {
        "id": "ce21aea6784cdf9c",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "flow.set password",
        "func": "flow.set('password', msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 160,
        "wires": [
            [
                "d056712dcf89dabc"
            ]
        ]
    },
    {
        "id": "6f112530b4cdc488",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "manage tabs",
        "func": "msg.payload = { \"tabs\": { \"show\": [\"КОНФИГУРАТОР\", \"Настройка ИК-передатчиков WB-MIR v.2\", \"Смена IP-адреса хоста\", \"Инструкция\"], \"hide\": [\"Авторизация\"]}}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 260,
        "wires": [
            [
                "4a3d6326b904d2b7",
                "52201a584961de3b"
            ]
        ]
    },
    {
        "id": "ed6e4f067ba47bed",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "clear",
        "func": "msg.payload = ''\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 120,
        "wires": [
            [
                "8fa4f0bfe9e07a98"
            ]
        ]
    },
    {
        "id": "c87f3853f8ece4c9",
        "type": "link in",
        "z": "f8689935b8ae0be8",
        "name": "clear auth",
        "links": [
            "f010b4564dfed552"
        ],
        "x": 95,
        "y": 140,
        "wires": [
            [
                "ed6e4f067ba47bed",
                "aef4c4e2fe8340e9"
            ]
        ]
    },
    {
        "id": "f010b4564dfed552",
        "type": "link out",
        "z": "f8689935b8ae0be8",
        "name": "link out 11",
        "mode": "link",
        "links": [
            "c87f3853f8ece4c9"
        ],
        "x": 875,
        "y": 260,
        "wires": []
    },
    {
        "id": "1ad5b3d9ea971a59",
        "type": "DataOut",
        "z": "f8689935b8ae0be8",
        "collection": "68b1bf0e03ae0ef9",
        "name": "pwd",
        "path": "/",
        "error": false,
        "x": 910,
        "y": 540,
        "wires": [
            [
                "f9c1c638fa9ec890"
            ]
        ]
    },
    {
        "id": "2880218f28383a64",
        "type": "DataIn",
        "z": "f8689935b8ae0be8",
        "collection": "68b1bf0e03ae0ef9",
        "name": "pwd",
        "update": false,
        "path": "/",
        "x": 1650,
        "y": 780,
        "wires": []
    },
    {
        "id": "b3647589031bf247",
        "type": "ui_ui_control",
        "z": "f8689935b8ae0be8",
        "name": "",
        "events": "all",
        "x": 180,
        "y": 540,
        "wires": [
            [
                "f1d795e65dfe6395"
            ]
        ]
    },
    {
        "id": "f1d795e65dfe6395",
        "type": "switch",
        "z": "f8689935b8ae0be8",
        "name": "payload == 'connect'",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "connect",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 380,
        "y": 540,
        "wires": [
            [
                "bfb092a4b021b4fc"
            ]
        ]
    },
    {
        "id": "f9c1c638fa9ec890",
        "type": "switch",
        "z": "f8689935b8ae0be8",
        "name": "is empty",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            },
            {
                "t": "empty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1060,
        "y": 540,
        "wires": [
            [
                "7c1379957cc66805"
            ],
            [
                "458c0fd58238c1f1"
            ]
        ]
    },
    {
        "id": "bfb092a4b021b4fc",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "show tabs",
        "func": "msg.payload = {\"tabs\": {\"hide\": [\"КОНФИГУРАТОР\", \"Настройка ИК-передатчиков WB-MIR v.2\", \"Смена IP-адреса хоста\"], \"show\": [\"Авторизация\", \"Инструкция\"]}}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 540,
        "wires": [
            [
                "b3647589031bf247",
                "f76c6e829e0df9a4"
            ]
        ]
    },
    {
        "id": "f76c6e829e0df9a4",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "set tab",
        "func": "msg.payload = {\"tab\": \"Авторизация\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 540,
        "wires": [
            [
                "1ad5b3d9ea971a59",
                "b3647589031bf247"
            ]
        ]
    },
    {
        "id": "458c0fd58238c1f1",
        "type": "change",
        "z": "f8689935b8ae0be8",
        "name": "Регистрация",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"show\":[\"Авторизация_Регистрация\"], \"hide\":[\"Авторизация_Авторизация\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1270,
        "y": 540,
        "wires": [
            [
                "d2c4533b26e23ee3",
                "96ac7da968be4348",
                "b3647589031bf247"
            ]
        ]
    },
    {
        "id": "7c1379957cc66805",
        "type": "change",
        "z": "f8689935b8ae0be8",
        "name": "Авторизация",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"show\":[\"Авторизация_Авторизация\"], \"hide\":[\"Авторизация_Регистрация\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 460,
        "wires": [
            [
                "b3647589031bf247"
            ]
        ]
    },
    {
        "id": "ae4014544c365636",
        "type": "ui_text_input",
        "z": "f8689935b8ae0be8",
        "name": "",
        "label": "Логин",
        "tooltip": "",
        "group": "a937139dcf0cc2ea",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "0",
        "topic": "",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 1650,
        "y": 540,
        "wires": [
            [
                "d96e94429929a33d"
            ]
        ]
    },
    {
        "id": "4267c6841f53df44",
        "type": "ui_text_input",
        "z": "f8689935b8ae0be8",
        "name": "",
        "label": "Пароль",
        "tooltip": "",
        "group": "a937139dcf0cc2ea",
        "order": 2,
        "width": 4,
        "height": 1,
        "passthru": true,
        "mode": "password",
        "delay": 300,
        "topic": "",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 1660,
        "y": 580,
        "wires": [
            [
                "e24644cf081f3bd8"
            ]
        ]
    },
    {
        "id": "d96e94429929a33d",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "flow.set login",
        "func": "flow.set('login', msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1910,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "e24644cf081f3bd8",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "flow.set password1",
        "func": "flow.set('password1', msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1930,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "d2c4533b26e23ee3",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "clear",
        "func": "msg.payload = ''\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 560,
        "wires": [
            [
                "4267c6841f53df44",
                "a248069a1ae299c4"
            ]
        ]
    },
    {
        "id": "a248069a1ae299c4",
        "type": "ui_text_input",
        "z": "f8689935b8ae0be8",
        "name": "",
        "label": "Подтвердите пароль",
        "tooltip": "",
        "group": "a937139dcf0cc2ea",
        "order": 3,
        "width": 4,
        "height": 1,
        "passthru": true,
        "mode": "password",
        "delay": 300,
        "topic": "",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 1700,
        "y": 620,
        "wires": [
            [
                "bcc3e48ac6ac18d2"
            ]
        ]
    },
    {
        "id": "f6a322e5fef45d81",
        "type": "ui_button",
        "z": "f8689935b8ae0be8",
        "name": "",
        "group": "a937139dcf0cc2ea",
        "order": 4,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Подтвердить",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 1680,
        "y": 660,
        "wires": [
            [
                "f595084df48ada6d"
            ]
        ]
    },
    {
        "id": "f595084df48ada6d",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "access filter",
        "func": "var login = flow.get('login')\nvar password1 = flow.get('password1')\nvar password2 = flow.get('password2')\n\n\n\nif (password1 === password2)\n{\n    msg.result = true\n}\nelse\n{\n    msg.result = false\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1870,
        "y": 660,
        "wires": [
            [
                "bc01bc18beca43c0"
            ]
        ]
    },
    {
        "id": "bcc3e48ac6ac18d2",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "flow.set password2",
        "func": "flow.set('password2', msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1930,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "96ac7da968be4348",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "clear",
        "func": "msg.payload = ''\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 520,
        "wires": [
            [
                "ae4014544c365636"
            ]
        ]
    },
    {
        "id": "bc01bc18beca43c0",
        "type": "switch",
        "z": "f8689935b8ae0be8",
        "name": "result",
        "property": "result",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1310,
        "y": 740,
        "wires": [
            [
                "d2c4533b26e23ee3",
                "398e9049779b910d"
            ],
            [
                "195197dd6a64afc8"
            ]
        ]
    },
    {
        "id": "4c99dda974ea1824",
        "type": "ui_toast",
        "z": "f8689935b8ae0be8",
        "position": "top right",
        "displayTime": "3",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Введённые пароли не совпадают, повторите ввод",
        "name": "Failed",
        "x": 1650,
        "y": 740,
        "wires": []
    },
    {
        "id": "398e9049779b910d",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 740,
        "wires": [
            [
                "4c99dda974ea1824"
            ]
        ]
    },
    {
        "id": "4bb2f8ab15dd928b",
        "type": "DataOut",
        "z": "f8689935b8ae0be8",
        "collection": "68b1bf0e03ae0ef9",
        "name": "pwd",
        "path": "/",
        "error": false,
        "x": 2110,
        "y": 200,
        "wires": [
            [
                "69d072df8855ad51"
            ]
        ]
    },
    {
        "id": "eb50e2fb4a008d57",
        "type": "DataIn",
        "z": "f8689935b8ae0be8",
        "collection": "68b1bf0e03ae0ef9",
        "name": "pwd",
        "update": false,
        "path": "/",
        "x": 2250,
        "y": 160,
        "wires": []
    },
    {
        "id": "05d041189946d932",
        "type": "inject",
        "z": "f8689935b8ae0be8",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 1970,
        "y": 200,
        "wires": [
            [
                "4bb2f8ab15dd928b"
            ]
        ]
    },
    {
        "id": "1a3111630f2b367a",
        "type": "inject",
        "z": "f8689935b8ae0be8",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 1970,
        "y": 160,
        "wires": [
            [
                "c863556645187566"
            ]
        ]
    },
    {
        "id": "69d072df8855ad51",
        "type": "debug",
        "z": "f8689935b8ae0be8",
        "name": "debug 131",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2250,
        "y": 200,
        "wires": []
    },
    {
        "id": "c863556645187566",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "reset",
        "func": "msg.payload = {}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2090,
        "y": 160,
        "wires": [
            [
                "eb50e2fb4a008d57"
            ]
        ]
    },
    {
        "id": "195197dd6a64afc8",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "to hash",
        "func": "function simpleHash(str) {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n        hash = (hash << 5) - hash + str.charCodeAt(i);\n        hash = hash | 0; // Приведение к 32-битному целому\n    }\n    return hash.toString(16); // Возвращаем хэш в шестнадцатеричном формате\n}\n\nconst data = flow.get('login') + flow.get('password1')\nconst myHash = simpleHash(data);\nnode.warn(data)\n\nmsg.payload = myHash\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 780,
        "wires": [
            [
                "2880218f28383a64",
                "1a0da00bf98fc945"
            ]
        ]
    },
    {
        "id": "1a0da00bf98fc945",
        "type": "change",
        "z": "f8689935b8ae0be8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"tab\":\"КОНФИГУРАТОР\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 200,
        "y": 780,
        "wires": [
            [
                "a8133f86647a0520",
                "b3647589031bf247"
            ]
        ]
    },
    {
        "id": "cc8ba3d49149401d",
        "type": "DataOut",
        "z": "f8689935b8ae0be8",
        "collection": "68b1bf0e03ae0ef9",
        "name": "pwd",
        "path": "/",
        "error": false,
        "x": 390,
        "y": 220,
        "wires": [
            [
                "b5847f613ce89c82"
            ]
        ]
    },
    {
        "id": "aef4c4e2fe8340e9",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "clear",
        "func": "msg.payload = ''\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 160,
        "wires": [
            [
                "aa734467af7cb82a"
            ]
        ]
    },
    {
        "id": "6a99a4663079625f",
        "type": "switch",
        "z": "f8689935b8ae0be8",
        "name": "result",
        "property": "result",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 710,
        "y": 220,
        "wires": [
            [
                "c7951eec9c8743bd",
                "aef4c4e2fe8340e9"
            ],
            [
                "1417d5499eae58f4",
                "f010b4564dfed552"
            ]
        ]
    },
    {
        "id": "cdffdff9f74bd860",
        "type": "ui_toast",
        "z": "f8689935b8ae0be8",
        "position": "top right",
        "displayTime": "3",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Неверная пара \"логин/пароль\". Повторите ввод",
        "name": "Failed",
        "x": 1030,
        "y": 160,
        "wires": []
    },
    {
        "id": "c7951eec9c8743bd",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 160,
        "wires": [
            [
                "cdffdff9f74bd860"
            ]
        ]
    },
    {
        "id": "ec76cb30af3da476",
        "type": "inject",
        "z": "f8689935b8ae0be8",
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "20",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 710,
        "y": 340,
        "wires": [
            [
                "ad3c0959130328d3"
            ]
        ]
    },
    {
        "id": "ad3c0959130328d3",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "reset_times = 0",
        "func": "flow.set('reset_times', 0)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "8bad0d2ad256ac20",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "reset_times + 1",
        "func": "flow.set('reset_times', flow.get('reset_times') + 1)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 400,
        "wires": [
            [
                "50971b631e8016f8"
            ]
        ]
    },
    {
        "id": "50971b631e8016f8",
        "type": "switch",
        "z": "f8689935b8ae0be8",
        "name": "reset_times = 10",
        "property": "reset_times",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "10",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 950,
        "y": 400,
        "wires": [
            [
                "4a5ff2e5a8190489"
            ]
        ]
    },
    {
        "id": "7e8c79ac108402b4",
        "type": "DataIn",
        "z": "f8689935b8ae0be8",
        "collection": "68b1bf0e03ae0ef9",
        "name": "pwd",
        "update": false,
        "path": "/",
        "x": 1270,
        "y": 400,
        "wires": []
    },
    {
        "id": "4a5ff2e5a8190489",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "reset",
        "func": "msg.payload = {}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 400,
        "wires": [
            [
                "7e8c79ac108402b4",
                "458c0fd58238c1f1"
            ]
        ]
    },
    {
        "id": "a8133f86647a0520",
        "type": "function",
        "z": "f8689935b8ae0be8",
        "name": "manage tabs",
        "func": "msg.payload = { \"tabs\": { \"show\": [\"КОНФИГУРАТОР\", \"Настройка ИК-передатчиков WB-MIR v.2\", \"Смена IP-адреса хоста\", \"Инструкция\"], \"hide\": [\"Авторизация\"]}}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 780,
        "wires": [
            [
                "b3647589031bf247"
            ]
        ]
    },
    {
        "id": "52201a584961de3b",
        "type": "debug",
        "z": "f8689935b8ae0be8",
        "name": "debug 203",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 260,
        "wires": []
    },
    {
        "id": "313aa0681b0c446b",
        "type": "http request",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "Запрос токена",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://localhost:1880/auth/token",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 380,
        "y": 160,
        "wires": [
            [
                "9aa0dd8414821512"
            ]
        ]
    },
    {
        "id": "7567980c4e4e323b",
        "type": "inject",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "admin:coord",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"client_id\":\"node-red-admin\",\"grant_type\":\"password\",\"scope\":\"*\",\"username\":\"admin\",\"password\":\"coord\"}",
        "payloadType": "json",
        "x": 190,
        "y": 160,
        "wires": [
            [
                "313aa0681b0c446b"
            ]
        ]
    },
    {
        "id": "9aa0dd8414821512",
        "type": "debug",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "debug 126",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 590,
        "y": 160,
        "wires": []
    },
    {
        "id": "df7b18b7f249cbe3",
        "type": "comment",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "token",
        "info": "az/pCxWG//sBwou/4xYsFaZ0XGuJdD6tRgVJ4MepeI/xa8eID/Rw7NlckWN4Gc/XhCtOyRqEvRcolS8i5vTtzpfGFJzqbz72gOq01EsLWVyF147GANM4EGTOQfGo+O2iQq/vxf4suTr8+mhTqo8mVW210y9+9s/RFt44wC1aX5c=",
        "x": 570,
        "y": 120,
        "wires": []
    },
    {
        "id": "3604b4523fab3dce",
        "type": "http request",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "http GET local",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [],
        "x": 800,
        "y": 300,
        "wires": [
            [
                "447abf4e72d25d87"
            ]
        ]
    },
    {
        "id": "f0f679bf9f529929",
        "type": "http request",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "http POST",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://10.111.8.61:1880/flow",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [],
        "x": 1230,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "447abf4e72d25d87",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "collect payload",
        "func": "const flow_data = msg.payload.filter(item => item.type == 'tab')\nconst id = flow_data[0].id\nconst label = flow_data[0].label\nconst data = msg.payload.filter(item => item.type !== 'server' && item.type !== 'tab' && item.type !== 'json-db-collection');\n\nmsg.payload = {\n  \"id\": id,\n  \"label\": label,\n  \"nodes\": data,\n  \"configs\": [ ]\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 300,
        "wires": [
            [
                "f0f679bf9f529929"
            ]
        ]
    },
    {
        "id": "18e57979a15db29a",
        "type": "inject",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "/videomatrix/videomatrix_sx_smx46.json",
        "props": [
            {
                "p": "path",
                "v": "/videomatrix/videomatrix_sx_smx46.json",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 280,
        "y": 280,
        "wires": [
            [
                "3c7f667ad2ae8fcb"
            ]
        ]
    },
    {
        "id": "3c7f667ad2ae8fcb",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "make URL",
        "func": "msg.url = 'http://localhost:1880/library/local/flows/' + msg.path \nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 300,
        "wires": [
            [
                "3604b4523fab3dce"
            ]
        ]
    },
    {
        "id": "d8d3e2b5b689debe",
        "type": "inject",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "/videomixer/videomixer_roland_XS_62S.json",
        "props": [
            {
                "p": "path",
                "v": "/videomixer/videomixer_roland_XS_62S.json",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 290,
        "y": 320,
        "wires": [
            [
                "3c7f667ad2ae8fcb"
            ]
        ]
    },
    {
        "id": "2d7ade4ad2b18e79",
        "type": "http request",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "http POST",
        "method": "DELETE",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [],
        "x": 1070,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "16c3111d905fbbcc",
        "type": "inject",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "videomatrix_sx_smx46",
        "props": [
            {
                "p": "flow_name",
                "v": "videomatrix_sx_smx47",
                "vt": "str"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 200,
        "y": 440,
        "wires": [
            [
                "0f2e33bf5b57baed"
            ]
        ]
    },
    {
        "id": "0f2e33bf5b57baed",
        "type": "http request",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "http GET flows",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost:1880/flows",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [],
        "x": 440,
        "y": 460,
        "wires": [
            [
                "2faf4b6fc440e40a"
            ]
        ]
    },
    {
        "id": "2faf4b6fc440e40a",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "find ID by flow_name",
        "func": "const flows = msg.payload.filter(item => item.type === 'tab');\nconst result = flows.find(item => item.label === msg.flow_name);\nmsg.id = result.id\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 460,
        "wires": [
            [
                "9928f4459adf27bb"
            ]
        ]
    },
    {
        "id": "9928f4459adf27bb",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "make URL",
        "func": "msg.url = 'http://localhost:1880/flow/' + msg.id\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 460,
        "wires": [
            [
                "2d7ade4ad2b18e79"
            ]
        ]
    },
    {
        "id": "555fec7df3dd4a64",
        "type": "inject",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "videomixer_roland_xs62s",
        "props": [
            {
                "p": "flow_name",
                "v": "videomixer_roland_xs62s",
                "vt": "str"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 210,
        "y": 480,
        "wires": [
            [
                "0f2e33bf5b57baed"
            ]
        ]
    },
    {
        "id": "f0a0bd309e07db9c",
        "type": "comment",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "Развернуть поток из локального хранилища",
        "info": "",
        "x": 270,
        "y": 240,
        "wires": []
    },
    {
        "id": "b90799ed685dcd1f",
        "type": "comment",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "Удалить поток из числа развёрнутых",
        "info": "",
        "x": 250,
        "y": 400,
        "wires": []
    },
    {
        "id": "bf8df91f570639ef",
        "type": "comment",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": "Узнать токен",
        "info": "",
        "x": 170,
        "y": 120,
        "wires": []
    },
    {
        "id": "da91563200b4b88c",
        "type": "ui_dropdown",
        "z": "8bc8d6360358e56f",
        "name": "VMI model",
        "label": "",
        "tooltip": "",
        "place": "Выберите модель",
        "group": "9c7e5ff72d78b502",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "AVMatrix HVS0402U",
                "value": "videomixer_avmatrix_hvs0402u",
                "type": "str"
            },
            {
                "label": "Roland XS-62S",
                "value": "videomixer_roland_xs62s",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 890,
        "y": 680,
        "wires": [
            [
                "9e457f12ac3936f1"
            ]
        ]
    },
    {
        "id": "575aaccfb52b1014",
        "type": "comment",
        "z": "8bc8d6360358e56f",
        "name": "Модели",
        "info": "VMI:\n - videomixer_avmatrix_hvs0402u\n - videomixer_roland_xs62s\n\nVMA:\n - videomatrix_sx_smx46\n - videomatrix_sx_smx47\n - videomatrix_sx_smx99",
        "x": 880,
        "y": 640,
        "wires": []
    },
    {
        "id": "dff0eae75ae0e715",
        "type": "ui_dropdown",
        "z": "8bc8d6360358e56f",
        "name": "VMA model",
        "label": "",
        "tooltip": "",
        "place": "Выберите модель",
        "group": "47715a302e162008",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "SX-SMX46",
                "value": "videomatrix_sx_smx46",
                "type": "str"
            },
            {
                "label": "SX-SMX47",
                "value": "videomatrix_sx_smx47",
                "type": "str"
            },
            {
                "label": "SX-SMX99",
                "value": "videomatrix_sx_smx99",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 890,
        "y": 720,
        "wires": [
            [
                "9e457f12ac3936f1"
            ]
        ]
    },
    {
        "id": "cfb3406f5ff68b1e",
        "type": "http request",
        "z": "8bc8d6360358e56f",
        "name": "http GET flows",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost:1880/flows",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [],
        "x": 1160,
        "y": 800,
        "wires": [
            [
                "8e8e093f0e330dd7"
            ]
        ]
    },
    {
        "id": "8e8e093f0e330dd7",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "find ID by flow_name",
        "func": "const flows = msg.payload.filter(item => item.type === 'tab');\nconst equal = flows.find(item => item.label === msg.flow_name)\n\nif (!equal)\n{\n    const same = flows.find(item => item.label.startsWith(msg.equipment_type));\n    var id = undefined\n    if (same)\n    {\n        id = same.id\n    }\n\n    return {\n        id: id, \n        flow_name: msg.flow_name,\n        equipment_type: msg.equipment_type,\n    };\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1400,
        "y": 800,
        "wires": [
            [
                "f6349eead161357f",
                "832f48520d58cb0b"
            ]
        ]
    },
    {
        "id": "9e457f12ac3936f1",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "get equipment_type",
        "func": "msg.flow_name = msg.payload\nmsg.equipment_type = msg.payload.split('_')[0]\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 700,
        "wires": [
            [
                "dc268d9f5ac874d3"
            ]
        ]
    },
    {
        "id": "36ca622107c052c7",
        "type": "http request",
        "z": "8bc8d6360358e56f",
        "name": "http POST",
        "method": "DELETE",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [],
        "x": 1550,
        "y": 880,
        "wires": [
            [
                "0b6d3db322288e68"
            ]
        ]
    },
    {
        "id": "84c757b0ac843347",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "URL and Token",
        "func": "msg.url = 'http://localhost:1880/flow/' + msg.id\nmsg.headers = {\n    Authorization: \"Bearer \"+ flow.get('token')\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1360,
        "y": 880,
        "wires": [
            [
                "36ca622107c052c7"
            ]
        ]
    },
    {
        "id": "0b6d3db322288e68",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "make path",
        "func": "msg.path = msg.equipment_type + '/' + msg.flow_name + '.json'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1370,
        "y": 940,
        "wires": [
            [
                "004246844b2378f4"
            ]
        ]
    },
    {
        "id": "004246844b2378f4",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "URL and Token",
        "func": "msg.url = 'http://localhost:1880/library/local/flows/' + msg.path\nmsg.headers = {\n    Authorization: \"Bearer \"+ flow.get('token')\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1560,
        "y": 940,
        "wires": [
            [
                "309b31b9b2d64651"
            ]
        ]
    },
    {
        "id": "309b31b9b2d64651",
        "type": "http request",
        "z": "8bc8d6360358e56f",
        "name": "http GET local",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [],
        "x": 1740,
        "y": 940,
        "wires": [
            [
                "5837caac499f91bc"
            ]
        ]
    },
    {
        "id": "8b0e7821ed659c97",
        "type": "http request",
        "z": "8bc8d6360358e56f",
        "name": "http POST",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [],
        "x": 1750,
        "y": 980,
        "wires": [
            []
        ]
    },
    {
        "id": "5837caac499f91bc",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "collect payload",
        "func": "const flow_data = msg.payload.filter(item => item.type == 'tab')\nconst id = flow_data[0].id\nconst label = flow_data[0].label\n\nconst invalid_types = ['server', 'tab', 'json-db-collection', 'ui_base', 'ui_tab', 'ui_group']\nconst data = msg.payload.filter(item => !invalid_types.includes(item.type));\n\nmsg.payload = {\n  \"id\": id,\n  \"label\": label,\n  \"nodes\": data,\n  \"configs\": [ ]\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1380,
        "y": 980,
        "wires": [
            [
                "c0f3cd334ab4cad7"
            ]
        ]
    },
    {
        "id": "6247dbd2818ab0c9",
        "type": "comment",
        "z": "8bc8d6360358e56f",
        "name": "<< удаляю старый поток",
        "info": "",
        "x": 1790,
        "y": 880,
        "wires": []
    },
    {
        "id": "6fe6e61b5b680185",
        "type": "comment",
        "z": "8bc8d6360358e56f",
        "name": "<< разворачиваю новый поток",
        "info": "",
        "x": 1970,
        "y": 980,
        "wires": []
    },
    {
        "id": "f6349eead161357f",
        "type": "switch",
        "z": "8bc8d6360358e56f",
        "name": "there is ID",
        "property": "id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1150,
        "y": 900,
        "wires": [
            [
                "84c757b0ac843347"
            ],
            [
                "0b6d3db322288e68"
            ]
        ]
    },
    {
        "id": "9427f8ebfb2e4b94",
        "type": "ui_toast",
        "z": "8bc8d6360358e56f",
        "position": "top right",
        "displayTime": "9999",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "ВНИМАНИЕ! Производится перезагрузка потока управления оборудованием",
        "name": "",
        "x": 1870,
        "y": 800,
        "wires": []
    },
    {
        "id": "832f48520d58cb0b",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "msg.payload = ' '",
        "func": "msg.payload = ' '\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1650,
        "y": 800,
        "wires": [
            [
                "9427f8ebfb2e4b94"
            ]
        ]
    },
    {
        "id": "60ba87cb34bbd908",
        "type": "ui_text",
        "z": "8bc8d6360358e56f",
        "group": "ea4be7e4d073dec2",
        "order": 1,
        "width": 4,
        "height": 1,
        "name": "",
        "label": "TrueConf Group 2.0",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 920,
        "y": 800,
        "wires": []
    },
    {
        "id": "c0f3cd334ab4cad7",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "URL and Token",
        "func": "msg.url = 'http://localhost:1880/flow/'\nmsg.headers = {\n    Authorization: \"Bearer \"+ flow.get('token')\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1560,
        "y": 980,
        "wires": [
            [
                "8b0e7821ed659c97"
            ]
        ]
    },
    {
        "id": "8343801007cd2029",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "token",
        "func": "let payload = JSON.parse(msg.payload)\nlet token = payload['access_token']\nflow.set('token', token)\nmsg.headers = {\n    Authorization: \"Bearer \"+ token\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1690,
        "y": 700,
        "wires": [
            [
                "cfb3406f5ff68b1e"
            ]
        ]
    },
    {
        "id": "680345fbcb244c48",
        "type": "http request",
        "z": "8bc8d6360358e56f",
        "name": "Запрос токена",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://localhost:1880/auth/token",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1520,
        "y": 700,
        "wires": [
            [
                "8343801007cd2029"
            ]
        ]
    },
    {
        "id": "dc268d9f5ac874d3",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "auth",
        "func": "msg.payload = {\"client_id\":\"node-red-admin\",\"grant_type\":\"password\",\"scope\":\"*\",\"username\":\"admin\",\"password\":\"coord\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 700,
        "wires": [
            [
                "680345fbcb244c48"
            ]
        ]
    },
    {
        "id": "680ef2eb7bea1a22",
        "type": "http request",
        "z": "8bc8d6360358e56f",
        "name": "http GET flows",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost:1880/flows",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "bearer",
        "senderr": false,
        "headers": [],
        "x": 320,
        "y": 700,
        "wires": [
            [
                "38b89b43ea8504a3"
            ]
        ]
    },
    {
        "id": "38b89b43ea8504a3",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "get flows",
        "func": "msg.flows = msg.payload.filter(item => item.type === 'tab');\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 700,
        "wires": [
            [
                "f2302b853f5db3cf",
                "326b35e7592c478d"
            ]
        ]
    },
    {
        "id": "17ffa32bcfb83df5",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "token",
        "func": "let payload = JSON.parse(msg.payload)\nlet token = payload['access_token']\nflow.set('token', token)\nmsg.headers = {\n    Authorization: \"Bearer \"+ token\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 660,
        "wires": [
            [
                "680ef2eb7bea1a22"
            ]
        ]
    },
    {
        "id": "f0d08272555cc6ec",
        "type": "http request",
        "z": "8bc8d6360358e56f",
        "name": "Запрос токена",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://localhost:1880/auth/token",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 320,
        "y": 660,
        "wires": [
            [
                "17ffa32bcfb83df5"
            ]
        ]
    },
    {
        "id": "593b03e7b3b60d27",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "auth",
        "func": "msg.payload = {\"client_id\":\"node-red-admin\",\"grant_type\":\"password\",\"scope\":\"*\",\"username\":\"admin\",\"password\":\"coord\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 130,
        "y": 660,
        "wires": [
            [
                "f0d08272555cc6ec"
            ]
        ]
    },
    {
        "id": "edca0836d966f0f3",
        "type": "inject",
        "z": "8bc8d6360358e56f",
        "d": true,
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 700,
        "wires": [
            [
                "593b03e7b3b60d27"
            ]
        ]
    },
    {
        "id": "f2302b853f5db3cf",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "find VMI label",
        "func": "msg.payload = msg.flows.find(item => item.label.startsWith('videomixer')).label\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 680,
        "wires": [
            [
                "da91563200b4b88c"
            ]
        ]
    },
    {
        "id": "326b35e7592c478d",
        "type": "function",
        "z": "8bc8d6360358e56f",
        "name": "find VMA label",
        "func": "msg.payload = msg.flows.find(item => item.label.startsWith('videomatrix')).label\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 720,
        "wires": [
            [
                "dff0eae75ae0e715"
            ]
        ]
    },
    {
        "id": "63c8dcda3f3fe737",
        "type": "comment",
        "z": "8bc8d6360358e56f",
        "name": "Вызов сохраненного состояния при старте HomeAssistant",
        "info": "",
        "x": 300,
        "y": 560,
        "wires": []
    },
    {
        "id": "5e46d2b984087a2b",
        "type": "switch",
        "z": "8bc8d6360358e56f",
        "name": "new about.homeAssistantis true",
        "property": "about.new_state.attributes.homeAssistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 810,
        "y": 600,
        "wires": [
            [
                "593b03e7b3b60d27"
            ]
        ]
    },
    {
        "id": "3fcceb92ada1dd52",
        "type": "switch",
        "z": "8bc8d6360358e56f",
        "name": "old about.homeAssistant!= new about.homeAssistant",
        "property": "about.old_state.attributes.homeAssistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "about.new_state.attributes.homeAssistant",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 420,
        "y": 600,
        "wires": [
            [
                "5e46d2b984087a2b"
            ]
        ]
    },
    {
        "id": "b021b4c47354fed4",
        "type": "server-state-changed",
        "z": "8bc8d6360358e56f",
        "name": "about",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.about",
        "entityIdType": "exact",
        "outputInitially": false,
        "ifState": "",
        "ifStateType": "str",
        "outputOnlyOnStateChange": false,
        "for": "0",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "about",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.about",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "haltifstate": "",
        "halt_if_type": "str",
        "output_only_on_state_change": false,
        "x": 130,
        "y": 600,
        "wires": [
            [
                "3fcceb92ada1dd52"
            ]
        ]
    },
    {
        "id": "41922e02aec40653",
        "type": "inject",
        "z": "8bc8d6360358e56f",
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1070,
        "y": 600,
        "wires": [
            [
                "593b03e7b3b60d27"
            ]
        ]
    },
    {
        "id": "46c9e78250912d0e",
        "type": "ui_text_input",
        "z": "36eae2d7552c58fd",
        "name": "",
        "label": "IP-адрес",
        "tooltip": "Например: 192.168.0.2",
        "group": "9c7e5ff72d78b502",
        "order": 3,
        "width": 3,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 540,
        "y": 360,
        "wires": [
            [
                "9307480c56478e34"
            ]
        ]
    },
    {
        "id": "10ddcc05ab43d767",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "VMI",
        "info": "",
        "x": 530,
        "y": 320,
        "wires": []
    },
    {
        "id": "91a9267df3c2b1b1",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "9c7e5ff72d78b502",
        "order": 5,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Назначить IP",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "style=\"background: none !important;\"",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "ip",
        "topicType": "msg",
        "x": 900,
        "y": 360,
        "wires": [
            [
                "2430e6bac1a39e05"
            ]
        ]
    },
    {
        "id": "9307480c56478e34",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return input",
        "func": "msg.ip = msg.payload\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 360,
        "wires": [
            [
                "91a9267df3c2b1b1"
            ]
        ]
    },
    {
        "id": "7944d5bdb5ac7a60",
        "type": "ui_text_input",
        "z": "36eae2d7552c58fd",
        "name": "",
        "label": "IP-адрес",
        "tooltip": "Например: 192.168.0.2",
        "group": "47715a302e162008",
        "order": 3,
        "width": 3,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 540,
        "y": 700,
        "wires": [
            [
                "2d6a4a4e1557f99c"
            ]
        ]
    },
    {
        "id": "5d2d0078d7729c50",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "VMA",
        "info": "",
        "x": 530,
        "y": 660,
        "wires": []
    },
    {
        "id": "ebcee80c94aac014",
        "type": "ui_text_input",
        "z": "36eae2d7552c58fd",
        "name": "",
        "label": "IP-адрес",
        "tooltip": "Например: 192.168.0.2",
        "group": "e1b3f68bc0754e54",
        "order": 3,
        "width": 3,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 540,
        "y": 1040,
        "wires": [
            [
                "9f1e142db6b48bee"
            ]
        ]
    },
    {
        "id": "eba550ec7090b41c",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "APr",
        "info": "",
        "x": 530,
        "y": 1000,
        "wires": []
    },
    {
        "id": "8134496c47a529fe",
        "type": "ui_text_input",
        "z": "36eae2d7552c58fd",
        "name": "",
        "label": "IP-адрес",
        "tooltip": "Например: 192.168.0.2",
        "group": "ea4be7e4d073dec2",
        "order": 3,
        "width": 3,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 540,
        "y": 1380,
        "wires": [
            [
                "6a343a4a9b6884ee"
            ]
        ]
    },
    {
        "id": "6cfa76bf0fea1cd5",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "TCG",
        "info": "",
        "x": 530,
        "y": 1340,
        "wires": []
    },
    {
        "id": "924717ea88d0350e",
        "type": "change",
        "z": "36eae2d7552c58fd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"show\":[\"КОНФИГУРАТОР_Параметры\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1890,
        "y": 2920,
        "wires": [
            [
                "41ff6aa710351f6f"
            ]
        ]
    },
    {
        "id": "a2b084acc9169863",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "e3be92b07b670127",
        "order": 4,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Очистить таблицу",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 1320,
        "y": 2660,
        "wires": [
            [
                "98bbf577f9a13c79"
            ]
        ]
    },
    {
        "id": "98bbf577f9a13c79",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "clearData",
        "func": "msg.payload = {\n    \"command\" : \"clearData\",\n    arguments: []\n}\n\nflow.set(\"id\", 0)\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 2700,
        "wires": [
            [
                "e3730cc4d17011c7"
            ]
        ]
    },
    {
        "id": "9a55dd5724da1645",
        "type": "ui_form",
        "z": "36eae2d7552c58fd",
        "name": "",
        "label": "",
        "group": "eadbbab9c9723921",
        "order": 2,
        "width": 6,
        "height": 1,
        "options": [
            {
                "label": "IP-адрес",
                "value": "ip",
                "type": "text",
                "required": true,
                "rows": null
            },
            {
                "label": "Порт",
                "value": "port",
                "type": "number",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "ip": "",
            "port": ""
        },
        "payload": "",
        "submit": "Подтвердить",
        "cancel": "",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "className": "",
        "x": 320,
        "y": 2700,
        "wires": [
            [
                "dba29742818826e9"
            ]
        ]
    },
    {
        "id": "e20efce1423e30c7",
        "type": "change",
        "z": "36eae2d7552c58fd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"hide\":[\"КОНФИГУРАТОР_Параметры\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 910,
        "y": 2560,
        "wires": [
            [
                "dfb4c09d55156b1d"
            ]
        ]
    },
    {
        "id": "b92fc82553e93239",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "eadbbab9c9723921",
        "order": 3,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Закрыть",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 170,
        "y": 2560,
        "wires": [
            [
                "e20efce1423e30c7",
                "e54ec02b832dfa07"
            ]
        ]
    },
    {
        "id": "e54ec02b832dfa07",
        "type": "change",
        "z": "36eae2d7552c58fd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"ip\":\"\", \"port\":\"\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 2600,
        "wires": [
            [
                "9a55dd5724da1645"
            ]
        ]
    },
    {
        "id": "dfdd66c8962227dd",
        "type": "ui_ui_control",
        "z": "36eae2d7552c58fd",
        "name": "",
        "events": "all",
        "x": 710,
        "y": 2080,
        "wires": [
            []
        ]
    },
    {
        "id": "4726cc2d8a540302",
        "type": "ui_text_input",
        "z": "36eae2d7552c58fd",
        "name": "",
        "label": "Порт",
        "tooltip": "Например: 19523",
        "group": "9c7e5ff72d78b502",
        "order": 8,
        "width": 3,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 530,
        "y": 400,
        "wires": [
            [
                "ed0d80b95e8ec724"
            ]
        ]
    },
    {
        "id": "97ca2b0c02cda54c",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "9c7e5ff72d78b502",
        "order": 10,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Назначить порт",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "port",
        "topicType": "msg",
        "x": 900,
        "y": 400,
        "wires": [
            [
                "3eb486cd67cb2340"
            ]
        ]
    },
    {
        "id": "c22618dd5a39c5bf",
        "type": "ui_text_input",
        "z": "36eae2d7552c58fd",
        "name": "",
        "label": "Порт",
        "tooltip": "Например: 5678",
        "group": "47715a302e162008",
        "order": 8,
        "width": 3,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 530,
        "y": 740,
        "wires": [
            [
                "bf8eb42f39b0bb85"
            ]
        ]
    },
    {
        "id": "d902ea0548ed51be",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "47715a302e162008",
        "order": 10,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Назначить порт",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "port",
        "topicType": "msg",
        "x": 900,
        "y": 740,
        "wires": [
            [
                "245fe7d467a2f699"
            ]
        ]
    },
    {
        "id": "1125eeb99959f7ce",
        "type": "ui_text_input",
        "z": "36eae2d7552c58fd",
        "name": "",
        "label": "Порт",
        "tooltip": "Например: 50000",
        "group": "e1b3f68bc0754e54",
        "order": 8,
        "width": 3,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 530,
        "y": 1080,
        "wires": [
            [
                "418f6f9220d5b4f8"
            ]
        ]
    },
    {
        "id": "31934d2b60360123",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "e1b3f68bc0754e54",
        "order": 10,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Назначить порт",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "port",
        "topicType": "msg",
        "x": 900,
        "y": 1080,
        "wires": [
            [
                "0aa393d8b04ad938"
            ]
        ]
    },
    {
        "id": "2ecd420352a4b19f",
        "type": "ui_text_input",
        "z": "36eae2d7552c58fd",
        "name": "",
        "label": "Порт",
        "tooltip": "Например: 5678",
        "group": "ea4be7e4d073dec2",
        "order": 8,
        "width": 3,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 530,
        "y": 1420,
        "wires": [
            [
                "f36de2e457fd524f"
            ]
        ]
    },
    {
        "id": "9f1ba65782374ebb",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "ea4be7e4d073dec2",
        "order": 10,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Назначить порт",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "port",
        "topicType": "msg",
        "x": 900,
        "y": 1420,
        "wires": [
            [
                "f08842cb522f1650"
            ]
        ]
    },
    {
        "id": "683a763fcaa03408",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "videomatrix_ip",
        "payloadType": "global",
        "x": 240,
        "y": 700,
        "wires": [
            [
                "7944d5bdb5ac7a60"
            ]
        ]
    },
    {
        "id": "1da81a3ae1edcb28",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "videomatrix_port",
        "payloadType": "global",
        "x": 250,
        "y": 740,
        "wires": [
            [
                "c22618dd5a39c5bf"
            ]
        ]
    },
    {
        "id": "822e1a3543c12030",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "videomixer_ip",
        "payloadType": "global",
        "x": 240,
        "y": 360,
        "wires": [
            [
                "46c9e78250912d0e"
            ]
        ]
    },
    {
        "id": "5bb833b1284a165a",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "videomixer_port",
        "payloadType": "global",
        "x": 240,
        "y": 400,
        "wires": [
            [
                "4726cc2d8a540302"
            ]
        ]
    },
    {
        "id": "6d75cc055e2463bd",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "audioprocessor_ip",
        "payloadType": "global",
        "x": 250,
        "y": 1040,
        "wires": [
            [
                "ebcee80c94aac014"
            ]
        ]
    },
    {
        "id": "0833aed48ca48b3e",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "audioprocessor_port",
        "payloadType": "global",
        "x": 260,
        "y": 1080,
        "wires": [
            [
                "1125eeb99959f7ce"
            ]
        ]
    },
    {
        "id": "6f6ca8b9b98602d3",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "tcgroup_ip",
        "payloadType": "global",
        "x": 230,
        "y": 1380,
        "wires": [
            [
                "8134496c47a529fe"
            ]
        ]
    },
    {
        "id": "62706072a622665f",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "tcgroup_port",
        "payloadType": "global",
        "x": 230,
        "y": 1420,
        "wires": [
            [
                "2ecd420352a4b19f"
            ]
        ]
    },
    {
        "id": "a70ce34be3f4f917",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get data to refresh table",
        "func": "var keys = global.keys()\nkeys = keys.filter((key) => key.includes(\"camera_\") && (key.includes(\"_ip\")));\n\nlet data = []\n\nfor (let key of keys) {\n    let name = Number(key.split('_')[1]);\n    let ip = global.get('camera_' + String(name) + '_ip')\n    let port = global.get('camera_' + String(name) + '_port')\n    data.push({\"name\": name, \"ip\": ip, \"port\": port});\n}\n\nmsg.payload = data\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1400,
        "y": 2600,
        "wires": [
            [
                "1182368bddbed310"
            ]
        ]
    },
    {
        "id": "e3730cc4d17011c7",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "clear global and get camera_names",
        "func": "var keys = global.keys()\nkeys = keys.filter((key) => key.includes(\"camera_\"));\n\nvar names = []\n\nvar suffix = \"_ip\"\nfor (var key in keys)\n{\n    global.set(keys[key], undefined);\n    if (keys[key].endsWith(suffix))\n    {\n        names.push(keys[key].slice(0, -suffix.length).replace(\"_\", \"\"))\n    }\n}\n\nmsg.names = names\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1370,
        "y": 2740,
        "wires": [
            [
                "1182368bddbed310",
                "80d9d95f251ef6fc"
            ]
        ]
    },
    {
        "id": "bf078762d6b7eb40",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "global set",
        "func": "let data = msg.payload\nlet name = flow.get('selectedRow')['name']\nnode.warn(name)\nglobal.set('camera_' + String(name) + '_ip', data['ip'])\nglobal.set('camera_' + String(name) + '_port', data['port'])\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 2600,
        "wires": [
            [
                "a70ce34be3f4f917"
            ]
        ]
    },
    {
        "id": "282c3baa3881f9e2",
        "type": "DataIn",
        "z": "36eae2d7552c58fd",
        "collection": "e3a4a76bd8ca0d0d",
        "name": "-> network_parameters",
        "update": false,
        "path": "/",
        "x": 2830,
        "y": 2740,
        "wires": []
    },
    {
        "id": "a040058c48bde993",
        "type": "DataOut",
        "z": "36eae2d7552c58fd",
        "collection": "e3a4a76bd8ca0d0d",
        "name": "network_parameters ->",
        "path": "/",
        "error": false,
        "x": 2830,
        "y": 2700,
        "wires": [
            [
                "7a67823d061a0f5a"
            ]
        ]
    },
    {
        "id": "7a67823d061a0f5a",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "set all to global",
        "func": "for (let el of msg.payload)\n{\n    global.set(el['attr'], el['val'])\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3060,
        "y": 2700,
        "wires": [
            [
                "affcf05a13e1c8a4",
                "a70ce34be3f4f917",
                "566518a3eab752e4"
            ]
        ]
    },
    {
        "id": "cca24545a40ce285",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "Вызов сохраненного состояния при старте HomeAssistant",
        "info": "",
        "x": 2010,
        "y": 2660,
        "wires": []
    },
    {
        "id": "84d509bfce6f6508",
        "type": "switch",
        "z": "36eae2d7552c58fd",
        "name": "new about.homeAssistantis true",
        "property": "about.new_state.attributes.homeAssistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2520,
        "y": 2700,
        "wires": [
            [
                "a040058c48bde993"
            ]
        ]
    },
    {
        "id": "ee08173cdc6dfad0",
        "type": "switch",
        "z": "36eae2d7552c58fd",
        "name": "old about.homeAssistant!= new about.homeAssistant",
        "property": "about.old_state.attributes.homeAssistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "about.new_state.attributes.homeAssistant",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2130,
        "y": 2700,
        "wires": [
            [
                "84d509bfce6f6508"
            ]
        ]
    },
    {
        "id": "dba29742818826e9",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "validation",
        "func": "const regex = new RegExp(/^\\d{1,3}.\\d{1,3}\\.\\d{1,3}.\\d{1,3}$/);\n\nlet ip = msg.payload['ip'].split('.').map(el => parseInt(el) <= 255);\nlet total = ip.reduce((acc, val) => acc + val, 0);\nlet ip_correct = (regex.test(msg.payload['ip']) && total === 4)\n\nlet port = msg.payload['port']\nlet port_correct = (1 <= port && port <= 65535)\n\nif (ip_correct && port_correct)\n{\n    const keys = global.keys().filter((key) => key.includes(\"_ip\")); // названия IP-переменных всего оборудования\n    const eq_keys = keys.filter((key) => !key.includes(\"camera\")); // названия IP-переменных остального оборудования (не камер)\n    const cam_keys = keys.filter((key) => key.includes(\"camera\")); // названия IP-переменных камер\n    const ips = keys.map(key => global.get(key)) // IP-адреса всего оборудования\n    const eq_ips = eq_keys.map(key => global.get(key)) // IP-адреса остального оборудования (не камер)\n    const cam_ips = cam_keys.map(key => global.get(key)) // IP-адреса камер\n\n    if (eq_ips.includes(msg.payload['ip']))\n    {\n        msg.err = 'used'\n    }\n    else\n    {\n        msg.err = 'ok'\n        // Дописать (если в камерах есть такой IP, то меняю местами, а если нет, то просто назначаю)\n        const name = 'camera_' + flow.get('selectedRow')['name'].toString() + '_ip'\n        const pairs = cam_keys.map(key => [key, global.get(key)]).filter((el) => (el[0] != name))\n        for (const pair of pairs)\n        {\n            if (pair[1] == msg.payload['ip'])\n            {\n                global.set(pair[0], global.get(name))\n            }\n        }\n    }\n\n}\nelse if (ip_correct)\n{\n    msg.err = 'port'\n}\nelse if (port_correct)\n{\n    msg.err = 'ip'\n}\nelse\n{\n    msg.err = 'all'\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 2700,
        "wires": [
            [
                "8065f646e099e963"
            ]
        ]
    },
    {
        "id": "9197afe3cf8048bd",
        "type": "ui_toast",
        "z": "36eae2d7552c58fd",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "IP-адрес указан некорректно, повторите ввод",
        "name": "Failed IP",
        "x": 1050,
        "y": 2700,
        "wires": []
    },
    {
        "id": "8065f646e099e963",
        "type": "switch",
        "z": "36eae2d7552c58fd",
        "name": "err",
        "property": "err",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ok",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ip",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "port",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "all",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "used",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 640,
        "y": 2700,
        "wires": [
            [
                "e20efce1423e30c7",
                "2dfb3d19e96f7290",
                "bf078762d6b7eb40"
            ],
            [
                "023db706bf804552"
            ],
            [
                "261ba2a82d7def78"
            ],
            [
                "a9b52bd5af66c9e8"
            ],
            [
                "c43a24978f4a3cd3"
            ]
        ]
    },
    {
        "id": "d5dc7ac343688471",
        "type": "ui_toast",
        "z": "36eae2d7552c58fd",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Устройство добавлено",
        "name": "Successful",
        "x": 1060,
        "y": 2640,
        "wires": []
    },
    {
        "id": "f162944d75a709aa",
        "type": "ui_toast",
        "z": "36eae2d7552c58fd",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Порт должен находиться в диапазоне [1 - 65535]",
        "name": "Failed PORT",
        "x": 1060,
        "y": 2740,
        "wires": []
    },
    {
        "id": "1d9bf0fb24b29638",
        "type": "ui_toast",
        "z": "36eae2d7552c58fd",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "IP-адрес и порт заданы некорректно, повторите ввод",
        "name": "Failed ALL",
        "x": 1060,
        "y": 2780,
        "wires": []
    },
    {
        "id": "f4b1b00abf257861",
        "type": "ui_toast",
        "z": "36eae2d7552c58fd",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Введёный вами IP-адрес используется другим устройством",
        "name": "Failed: IP busy",
        "x": 1070,
        "y": 2820,
        "wires": []
    },
    {
        "id": "2430e6bac1a39e05",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "validation",
        "func": "const keys = global.keys().filter((key) => key.includes(\"_ip\"));\nconst ip_s = keys.map(key => global.get(key))\n\nif (msg.topic == undefined || msg.topic == '')\n{\n    global.set(\"videomixer_ip\", undefined) // <---\n    msg.log = 'empty'\n}\nelse if (ip_s.includes(msg.topic) && (global.get(\"videomixer_ip\")) != msg.topic) // <---\n{\n    msg.log = 'busy'\n}\nelse \n{\n    const regex = new RegExp(/^\\d{1,3}.\\d{1,3}\\.\\d{1,3}.\\d{1,3}$/);\n    \n    let ip = msg.topic.split('.').map(el => Number(parseInt(el) <= 255));\n    let total = ip.reduce((acc, val) => acc + val, 0);\n\n    if ((regex.test(msg.topic) && total === 4))\n    {\n        global.set(\"videomixer_ip\", msg.topic) // <---\n        msg.log = 'ok'\n    }\n    else\n    {\n        msg.log = 'incorrect'\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 360,
        "wires": [
            [
                "8205c73e05ed7b00",
                "ad58a2ca17a1f10e"
            ]
        ]
    },
    {
        "id": "f8ce2fb4731f5a59",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "CAMERAS",
        "info": "",
        "x": 830,
        "y": 2380,
        "wires": []
    },
    {
        "id": "a1ecb89e2aefa966",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "47715a302e162008",
        "order": 5,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Назначить IP",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "ip",
        "topicType": "msg",
        "x": 900,
        "y": 700,
        "wires": [
            [
                "80b6a64940bc07df"
            ]
        ]
    },
    {
        "id": "8d286e5206126087",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "e1b3f68bc0754e54",
        "order": 5,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Назначить IP",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "ip",
        "topicType": "msg",
        "x": 900,
        "y": 1040,
        "wires": [
            [
                "1a1e6f8fa38863d1"
            ]
        ]
    },
    {
        "id": "ec6c3e146abe8cf0",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "ea4be7e4d073dec2",
        "order": 5,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Назначить IP",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "ip",
        "topicType": "msg",
        "x": 900,
        "y": 1380,
        "wires": [
            [
                "81c1a474e8a59745"
            ]
        ]
    },
    {
        "id": "a007f6c70e330847",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get all from global",
        "func": "var keys = global.keys()\n\nlet cameras = keys.filter((key) => key.includes(\"camera\") && (key.includes(\"ip\")));\nkeys['cameras_qty'] = cameras.length\nglobal.set(\"cameras_qty\", cameras.length)\n\nvar ans = []\nfor (let key of keys) {\n    ans.push({ 'attr': key, 'val': global.get(key)})\n}\n\nmsg.payload = ans\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2580,
        "y": 2740,
        "wires": [
            [
                "282c3baa3881f9e2"
            ]
        ]
    },
    {
        "id": "023db706bf804552",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 2700,
        "wires": [
            [
                "9197afe3cf8048bd",
                "e485c709b8d2e555"
            ]
        ]
    },
    {
        "id": "261ba2a82d7def78",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 2740,
        "wires": [
            [
                "f162944d75a709aa",
                "e485c709b8d2e555"
            ]
        ]
    },
    {
        "id": "a9b52bd5af66c9e8",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 2780,
        "wires": [
            [
                "1d9bf0fb24b29638",
                "e485c709b8d2e555"
            ]
        ]
    },
    {
        "id": "c43a24978f4a3cd3",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 2820,
        "wires": [
            [
                "f4b1b00abf257861",
                "e485c709b8d2e555"
            ]
        ]
    },
    {
        "id": "2dfb3d19e96f7290",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 2640,
        "wires": [
            [
                "d5dc7ac343688471"
            ]
        ]
    },
    {
        "id": "1182368bddbed310",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "sort data by name",
        "func": "let data = msg.payload\ntry \n{\n    msg.payload = data.sort((a, b) => (a.name > b.name) ? 1 : -1);\n} \nfinally \n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1660,
        "y": 2740,
        "wires": [
            [
                "a007f6c70e330847",
                "96d4782f89bccbf1"
            ]
        ]
    },
    {
        "id": "0f90e0f17063437c",
        "type": "switch",
        "z": "36eae2d7552c58fd",
        "name": "log",
        "property": "log",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "empty",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ok",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "incorrect",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "busy",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1410,
        "y": 200,
        "wires": [
            [
                "5b55e0b033600570"
            ],
            [
                "c115c9ab6db27760"
            ],
            [
                "1441315a0a9b70ad"
            ],
            [
                "d6855cbd11fc824f"
            ]
        ]
    },
    {
        "id": "45337d3ba2b08bbd",
        "type": "ui_toast",
        "z": "36eae2d7552c58fd",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Введёный вами IP-адрес используется другим устройством",
        "name": "Busy",
        "x": 1770,
        "y": 260,
        "wires": []
    },
    {
        "id": "c76efd4bf00edf68",
        "type": "ui_toast",
        "z": "36eae2d7552c58fd",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "IP-адрес назначен",
        "name": "Successful",
        "x": 1750,
        "y": 180,
        "wires": []
    },
    {
        "id": "f4dd5900cc02253c",
        "type": "ui_toast",
        "z": "36eae2d7552c58fd",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Некорректный IP-адрес",
        "name": "Incorrect",
        "x": 1760,
        "y": 220,
        "wires": []
    },
    {
        "id": "1441315a0a9b70ad",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1590,
        "y": 220,
        "wires": [
            [
                "f4dd5900cc02253c"
            ]
        ]
    },
    {
        "id": "d6855cbd11fc824f",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1590,
        "y": 260,
        "wires": [
            [
                "45337d3ba2b08bbd"
            ]
        ]
    },
    {
        "id": "c115c9ab6db27760",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1590,
        "y": 180,
        "wires": [
            [
                "c76efd4bf00edf68"
            ]
        ]
    },
    {
        "id": "b461f0efd381713e",
        "type": "ui_toast",
        "z": "36eae2d7552c58fd",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Поле очищено",
        "name": "Empty",
        "x": 1770,
        "y": 140,
        "wires": []
    },
    {
        "id": "5b55e0b033600570",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1590,
        "y": 140,
        "wires": [
            [
                "b461f0efd381713e"
            ]
        ]
    },
    {
        "id": "c560142028a627ca",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return IP",
        "func": "msg.payload = global.get(\"videomixer_ip\")\nif (!msg.payload)\n{\n    msg.payload = ''\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1460,
        "y": 320,
        "wires": [
            [
                "46c9e78250912d0e"
            ]
        ]
    },
    {
        "id": "2d6a4a4e1557f99c",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return input",
        "func": "msg.ip = msg.payload\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 700,
        "wires": [
            [
                "a1ecb89e2aefa966"
            ]
        ]
    },
    {
        "id": "80b6a64940bc07df",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "validation",
        "func": "const keys = global.keys().filter((key) => key.includes(\"_ip\"));\nconst ip_s = keys.map(key => global.get(key))\n\nif (msg.topic == undefined || msg.topic == '')\n{\n    global.set(\"videomatrix_ip\", undefined) // <---\n    msg.log = 'empty'\n}\nelse if (ip_s.includes(msg.topic) && (global.get(\"videomatrix_ip\")) != msg.topic) // <---\n{\n    msg.log = 'busy'\n}\nelse \n{\n    const regex = new RegExp(/^\\d{1,3}.\\d{1,3}\\.\\d{1,3}.\\d{1,3}$/);\n    \n    let ip = msg.topic.split('.').map(el => Number(parseInt(el) <= 255));\n    let total = ip.reduce((acc, val) => acc + val, 0);\n\n    if ((regex.test(msg.topic) && total === 4))\n    {\n        global.set(\"videomatrix_ip\", msg.topic) // <---\n        msg.log = 'ok'\n    }\n    else\n    {\n        msg.log = 'incorrect'\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 700,
        "wires": [
            [
                "8205c73e05ed7b00",
                "7b57196839db720b"
            ]
        ]
    },
    {
        "id": "9f1e142db6b48bee",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return input",
        "func": "msg.ip = msg.payload\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 1040,
        "wires": [
            [
                "8d286e5206126087"
            ]
        ]
    },
    {
        "id": "1a1e6f8fa38863d1",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "validation",
        "func": "const keys = global.keys().filter((key) => key.includes(\"_ip\"));\nconst ip_s = keys.map(key => global.get(key))\n\nif (msg.topic == undefined || msg.topic == '')\n{\n    global.set(\"audioprocessor_ip\", undefined) // <---\n    msg.log = 'empty'\n}\nelse if (ip_s.includes(msg.topic) && (global.get(\"audioprocessor_ip\")) != msg.topic) // <---\n{\n    msg.log = 'busy'\n}\nelse \n{\n    const regex = new RegExp(/^\\d{1,3}.\\d{1,3}\\.\\d{1,3}.\\d{1,3}$/);\n    \n    let ip = msg.topic.split('.').map(el => Number(parseInt(el) <= 255));\n    let total = ip.reduce((acc, val) => acc + val, 0);\n\n    if ((regex.test(msg.topic) && total === 4))\n    {\n        global.set(\"audioprocessor_ip\", msg.topic) // <---\n        msg.log = 'ok'\n    }\n    else\n    {\n        msg.log = 'incorrect'\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 1040,
        "wires": [
            [
                "8205c73e05ed7b00",
                "d835a560c7b36b9e"
            ]
        ]
    },
    {
        "id": "6a343a4a9b6884ee",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return input",
        "func": "msg.ip = msg.payload\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 1380,
        "wires": [
            [
                "ec6c3e146abe8cf0"
            ]
        ]
    },
    {
        "id": "81c1a474e8a59745",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "validation",
        "func": "const keys = global.keys().filter((key) => key.includes(\"_ip\"));\nconst ip_s = keys.map(key => global.get(key))\n\nif (msg.topic == undefined || msg.topic == '')\n{\n    global.set(\"tcgroup_ip\", undefined) // <---\n    msg.log = 'empty'\n}\nelse if (ip_s.includes(msg.topic) && (global.get(\"tcgroup_ip\")) != msg.topic) // <---\n{\n    msg.log = 'busy'\n}\nelse \n{\n    const regex = new RegExp(/^\\d{1,3}.\\d{1,3}\\.\\d{1,3}.\\d{1,3}$/);\n    \n    let ip = msg.topic.split('.').map(el => Number(parseInt(el) <= 255));\n    let total = ip.reduce((acc, val) => acc + val, 0);\n\n    if ((regex.test(msg.topic) && total === 4))\n    {\n        global.set(\"tcgroup_ip\", msg.topic) // <---\n        msg.log = 'ok'\n    }\n    else\n    {\n        msg.log = 'incorrect'\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 1380,
        "wires": [
            [
                "8205c73e05ed7b00",
                "871998ff2329f7a2"
            ]
        ]
    },
    {
        "id": "c535e4313e0c9c3e",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return IP",
        "func": "msg.payload = global.get(\"videomatrix_ip\")\nif (!msg.payload)\n{\n    msg.payload = ''\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1460,
        "y": 660,
        "wires": [
            [
                "7944d5bdb5ac7a60"
            ]
        ]
    },
    {
        "id": "ef9af4d4750cf54b",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return IP",
        "func": "msg.payload = global.get(\"audioprocessor_ip\")\nif (!msg.payload)\n{\n    msg.payload = ''\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1460,
        "y": 1000,
        "wires": [
            [
                "ebcee80c94aac014"
            ]
        ]
    },
    {
        "id": "1dc642d88f57dc2c",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return IP",
        "func": "msg.payload = global.get(\"tcgroup_ip\")\nif (!msg.payload)\n{\n    msg.payload = ''\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1460,
        "y": 1340,
        "wires": [
            [
                "8134496c47a529fe"
            ]
        ]
    },
    {
        "id": "ed0d80b95e8ec724",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return input",
        "func": "msg.port = msg.payload\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 400,
        "wires": [
            [
                "97ca2b0c02cda54c"
            ]
        ]
    },
    {
        "id": "3eb486cd67cb2340",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "validation",
        "func": "if (msg.topic === undefined || msg.topic === null || msg.topic === \"\")\n{\n    global.set(\"videomixer_port\", undefined) // <---\n    msg.log = 'empty'\n}\nelse \n{\n    if ((1 <= Number(msg.topic) && Number(msg.topic) <= 65535))\n    {\n        global.set(\"videomixer_port\", Number(msg.topic)) // <---\n        msg.log = 'ok'\n    }\n    else\n    {\n        msg.log = 'incorrect'\n    }\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 400,
        "wires": [
            [
                "ae4f0f2821bd6aa2",
                "fe99b048efbcab94"
            ]
        ]
    },
    {
        "id": "9825083ea7380db7",
        "type": "switch",
        "z": "36eae2d7552c58fd",
        "name": "log",
        "property": "log",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "empty",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ok",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "incorrect",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1430,
        "y": 1720,
        "wires": [
            [
                "efc4bed4ae1531e0"
            ],
            [
                "7a95367b05b87777"
            ],
            [
                "088f2a63daa61aa8"
            ]
        ]
    },
    {
        "id": "29e67a33f72f05f2",
        "type": "ui_toast",
        "z": "36eae2d7552c58fd",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Порт назначен",
        "name": "Successful",
        "x": 1770,
        "y": 1720,
        "wires": []
    },
    {
        "id": "ef740bd258eb1e78",
        "type": "ui_toast",
        "z": "36eae2d7552c58fd",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Порт должен находиться в диапазоне [1 - 65535]",
        "name": "Incorrect",
        "x": 1780,
        "y": 1760,
        "wires": []
    },
    {
        "id": "088f2a63daa61aa8",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1610,
        "y": 1760,
        "wires": [
            [
                "ef740bd258eb1e78"
            ]
        ]
    },
    {
        "id": "7a95367b05b87777",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1610,
        "y": 1720,
        "wires": [
            [
                "29e67a33f72f05f2"
            ]
        ]
    },
    {
        "id": "ee71c841e573b03c",
        "type": "ui_toast",
        "z": "36eae2d7552c58fd",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Поле очищено",
        "name": "Empty",
        "x": 1790,
        "y": 1680,
        "wires": []
    },
    {
        "id": "efc4bed4ae1531e0",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1610,
        "y": 1680,
        "wires": [
            [
                "ee71c841e573b03c"
            ]
        ]
    },
    {
        "id": "ae4f0f2821bd6aa2",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return port",
        "func": "msg.payload = global.get(\"videomixer_port\")\nif (!msg.payload)\n{\n    msg.payload = null\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 400,
        "wires": [
            [
                "4726cc2d8a540302"
            ]
        ]
    },
    {
        "id": "bf8eb42f39b0bb85",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return input",
        "func": "msg.port = msg.payload\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 740,
        "wires": [
            [
                "d902ea0548ed51be"
            ]
        ]
    },
    {
        "id": "245fe7d467a2f699",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "validation",
        "func": "if (msg.topic === undefined || msg.topic === null || msg.topic === \"\")\n{\n    node.warn(msg.topic)\n    global.set(\"videomatrix_port\", undefined) // <---\n    msg.log = 'empty'\n}\nelse \n{\n    if ((1 <= Number(msg.topic) && Number(msg.topic) <= 65535))\n    {\n        global.set(\"videomatrix_port\", Number(msg.topic)) // <---\n        msg.log = 'ok'\n    }\n    else\n    {\n        msg.log = 'incorrect'\n    }\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 740,
        "wires": [
            [
                "be8a28dea933d7a0",
                "fe99b048efbcab94"
            ]
        ]
    },
    {
        "id": "be8a28dea933d7a0",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return port",
        "func": "msg.payload = global.get(\"videomatrix_port\")\nif (!msg.payload)\n{\n    msg.payload = null\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 740,
        "wires": [
            [
                "c22618dd5a39c5bf"
            ]
        ]
    },
    {
        "id": "418f6f9220d5b4f8",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return input",
        "func": "msg.port = msg.payload\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 1080,
        "wires": [
            [
                "31934d2b60360123"
            ]
        ]
    },
    {
        "id": "0aa393d8b04ad938",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "validation",
        "func": "if (msg.topic === undefined || msg.topic === null || msg.topic === \"\")\n{\n    node.warn(msg.topic)\n    global.set(\"audioprocessor_port\", undefined) // <---\n    msg.log = 'empty'\n}\nelse \n{\n    if ((1 <= Number(msg.topic) && Number(msg.topic) <= 65535))\n    {\n        global.set(\"audioprocessor_port\", Number(msg.topic)) // <---\n        msg.log = 'ok'\n    }\n    else\n    {\n        msg.log = 'incorrect'\n    }\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 1080,
        "wires": [
            [
                "6e85707710c58d4b",
                "fe99b048efbcab94"
            ]
        ]
    },
    {
        "id": "6e85707710c58d4b",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return port",
        "func": "msg.payload = global.get(\"audioprocessor_port\")\nif (!msg.payload)\n{\n    msg.payload = null\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 1080,
        "wires": [
            [
                "1125eeb99959f7ce"
            ]
        ]
    },
    {
        "id": "f36de2e457fd524f",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return input",
        "func": "msg.port = msg.payload\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 1420,
        "wires": [
            [
                "9f1ba65782374ebb"
            ]
        ]
    },
    {
        "id": "f08842cb522f1650",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "validation",
        "func": "if (msg.topic === undefined || msg.topic === null || msg.topic === \"\")\n{\n    node.warn(msg.topic)\n    global.set(\"tcgroup_port\", undefined) // <---\n    msg.log = 'empty'\n}\nelse \n{\n    if ((1 <= Number(msg.topic) && Number(msg.topic) <= 65535))\n    {\n        global.set(\"tcgroup_port\", Number(msg.topic)) // <---\n        msg.log = 'ok'\n    }\n    else\n    {\n        msg.log = 'incorrect'\n    }\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 1420,
        "wires": [
            [
                "d00ce3d95234b42b",
                "fe99b048efbcab94"
            ]
        ]
    },
    {
        "id": "d00ce3d95234b42b",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return port",
        "func": "msg.payload = global.get(\"tcgroup_port\")\nif (!msg.payload)\n{\n    msg.payload = null\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 1420,
        "wires": [
            [
                "2ecd420352a4b19f"
            ]
        ]
    },
    {
        "id": "674adeceb71a6cbe",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get all from global",
        "func": "var keys = global.keys()\nvar ans = []\nfor (let key of keys) {\n    ans.push({ 'attr': key, 'val': global.get(key)})\n}\nmsg.payload = ans\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1990,
        "y": 920,
        "wires": [
            [
                "dff9d738af7fbcf0"
            ]
        ]
    },
    {
        "id": "dff9d738af7fbcf0",
        "type": "DataIn",
        "z": "36eae2d7552c58fd",
        "collection": "e3a4a76bd8ca0d0d",
        "name": "-> network_parameters",
        "update": false,
        "path": "/",
        "x": 2250,
        "y": 920,
        "wires": []
    },
    {
        "id": "44f21a618752e9e8",
        "type": "link in",
        "z": "36eae2d7552c58fd",
        "name": "link in 1",
        "links": [
            "b3664acb052b97a5"
        ],
        "x": 385,
        "y": 1520,
        "wires": [
            [
                "8134496c47a529fe",
                "2ecd420352a4b19f",
                "1125eeb99959f7ce",
                "ebcee80c94aac014",
                "c22618dd5a39c5bf",
                "7944d5bdb5ac7a60",
                "4726cc2d8a540302",
                "46c9e78250912d0e"
            ]
        ]
    },
    {
        "id": "4cd54dc8f080d2cc",
        "type": "change",
        "z": "36eae2d7552c58fd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"tab\":\"ВИДЕОМАТРИЦА\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 490,
        "y": 2060,
        "wires": [
            [
                "dfdd66c8962227dd"
            ]
        ]
    },
    {
        "id": "145b343dc9a9e87e",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "47715a302e162008",
        "order": 2,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-gear Icon",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 300,
        "y": 2060,
        "wires": [
            [
                "4cd54dc8f080d2cc"
            ]
        ]
    },
    {
        "id": "0f7fde87304ec6ca",
        "type": "change",
        "z": "36eae2d7552c58fd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"tab\":\"ВИДЕОМИКШЕР\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 490,
        "y": 2020,
        "wires": [
            [
                "dfdd66c8962227dd"
            ]
        ]
    },
    {
        "id": "124458cfd9ce5d57",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "9c7e5ff72d78b502",
        "order": 2,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-gear Icon",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 300,
        "y": 2020,
        "wires": [
            [
                "0f7fde87304ec6ca"
            ]
        ]
    },
    {
        "id": "86fe07e4f03995d8",
        "type": "change",
        "z": "36eae2d7552c58fd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"tab\":\"АУДИОПРОЦЕССОР\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 490,
        "y": 2100,
        "wires": [
            [
                "dfdd66c8962227dd"
            ]
        ]
    },
    {
        "id": "abf1b86d23f52c06",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "e1b3f68bc0754e54",
        "order": 2,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-gear Icon",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 300,
        "y": 2100,
        "wires": [
            [
                "86fe07e4f03995d8"
            ]
        ]
    },
    {
        "id": "783b705be9c5dd76",
        "type": "change",
        "z": "36eae2d7552c58fd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"tab\":\"TCGroup\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 490,
        "y": 2140,
        "wires": [
            [
                "dfdd66c8962227dd"
            ]
        ]
    },
    {
        "id": "67a9e3a42f60ae8d",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "ВМИ",
        "info": "",
        "x": 180,
        "y": 2020,
        "wires": []
    },
    {
        "id": "dce14f80fa3904b3",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "ВМА",
        "info": "",
        "x": 180,
        "y": 2060,
        "wires": []
    },
    {
        "id": "68026132f42fea1a",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "АМА",
        "info": "",
        "x": 180,
        "y": 2100,
        "wires": []
    },
    {
        "id": "b8d31fc4e4a769bb",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "TCG",
        "info": "",
        "x": 180,
        "y": 2140,
        "wires": []
    },
    {
        "id": "a93698f4eaf4c052",
        "type": "server-state-changed",
        "z": "36eae2d7552c58fd",
        "name": "about",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.about",
        "entityIdType": "exact",
        "outputInitially": false,
        "ifState": "",
        "ifStateType": "str",
        "outputOnlyOnStateChange": false,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "about",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.about",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "haltifstate": "",
        "halt_if_type": "str",
        "output_only_on_state_change": false,
        "x": 1840,
        "y": 2700,
        "wires": [
            [
                "ee08173cdc6dfad0"
            ]
        ]
    },
    {
        "id": "33bf3ab8f1c3fe5d",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "e3be92b07b670127",
        "order": 1,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-plus-square",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 940,
        "y": 2480,
        "wires": [
            [
                "9bb7f5b4ca4e2ed5"
            ]
        ]
    },
    {
        "id": "9bb7f5b4ca4e2ed5",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "add empty",
        "func": "var keys = global.keys()\nkeys = keys.filter((key) => key.includes(\"camera_\") && (key.includes(\"_ip\")));\nglobal.set('camera_' + String(keys.length + 1) + '_ip', '___.___.___.___')\nglobal.set('camera_' + String(keys.length + 1) + '_port', '___')\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 2480,
        "wires": [
            [
                "a70ce34be3f4f917"
            ]
        ]
    },
    {
        "id": "aef92f2cf5972782",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "e3be92b07b670127",
        "order": 2,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 940,
        "y": 2440,
        "wires": [
            [
                "43b919ba168bf229"
            ]
        ]
    },
    {
        "id": "43b919ba168bf229",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "delete last",
        "func": "var keys = global.keys()\nkeys = keys.filter((key) => key.includes(\"camera_\") && (key.includes(\"_ip\")));\nglobal.set('camera_' + String(keys.length) + '_ip', undefined)\nglobal.set('camera_' + String(keys.length) + '_port', undefined)\n\nmsg.name = 'camera' + String(keys.length) // Для обнуления статуса\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 2440,
        "wires": [
            [
                "a70ce34be3f4f917",
                "9e3be5885782fd64"
            ]
        ]
    },
    {
        "id": "edcb70c683c19199",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "if edit empty row, fill fields as empty",
        "func": "if (msg.payload['ip'] == '___.___.___.___')\n{\n    msg.payload['ip'] = ''\n    msg.payload['port'] = ''\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1920,
        "y": 2960,
        "wires": [
            [
                "f5aaeb73dfed4db5"
            ]
        ]
    },
    {
        "id": "68c8bebf68920ad8",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "set text \"Camera X\"",
        "func": "msg.payload = 'Камера ' + String(msg.payload['name'])\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 2960,
        "wires": [
            [
                "9f598076ac950569"
            ]
        ]
    },
    {
        "id": "9f598076ac950569",
        "type": "ui_text",
        "z": "36eae2d7552c58fd",
        "group": "eadbbab9c9723921",
        "order": 1,
        "width": 6,
        "height": 1,
        "name": "",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 460,
        "y": 2960,
        "wires": []
    },
    {
        "id": "41ff6aa710351f6f",
        "type": "ui_ui_control",
        "z": "36eae2d7552c58fd",
        "name": "",
        "events": "all",
        "x": 2070,
        "y": 2920,
        "wires": [
            []
        ]
    },
    {
        "id": "dfb4c09d55156b1d",
        "type": "ui_ui_control",
        "z": "36eae2d7552c58fd",
        "name": "",
        "events": "all",
        "x": 1110,
        "y": 2560,
        "wires": [
            []
        ]
    },
    {
        "id": "3c5feb6775439019",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "set selectedRow",
        "func": "flow.set('selectedRow', msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1860,
        "y": 2880,
        "wires": [
            []
        ]
    },
    {
        "id": "e485c709b8d2e555",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "return last data",
        "func": "msg.payload = Object.fromEntries(Object.entries(flow.get('selectedRow')).filter(([key]) => key !== 'id'));\nmsg.event = {'bbox': [607, 488, 930, 440]}\nmsg.socketid = 'w2Odcv9mxJeXaAeHAABV'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 2900,
        "wires": [
            [
                "e0c1ad36bdd973c8"
            ]
        ]
    },
    {
        "id": "80d9d95f251ef6fc",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "data",
        "func": "// var state = new Date()\n// state = state.getTime()\n\nvar data = {\n    \"entity_id\": \"sensor.device_statuses\",\n//     \"state\": state\n};\n\nfor (const name of msg.names) {\n    data[name] = 0\n}\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1280,
        "y": 2800,
        "wires": [
            [
                "fd6384c02cc1797c"
            ]
        ]
    },
    {
        "id": "9e3be5885782fd64",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "data",
        "func": "// var state = new Date()\n// state = state.getTime()\n\nvar data = {\n    \"entity_id\": \"sensor.device_statuses\",\n//    \"state\": state\n};\n\ndata[msg.name] = 0\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 2440,
        "wires": [
            [
                "2454601740ca667b"
            ]
        ]
    },
    {
        "id": "111c91940e26fa56",
        "type": "api-call-service",
        "z": "36eae2d7552c58fd",
        "name": "set Camera to \"0\"",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1820,
        "y": 2440,
        "wires": [
            []
        ]
    },
    {
        "id": "8ac1018c7ad85436",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "delete",
        "info": "",
        "x": 820,
        "y": 2440,
        "wires": []
    },
    {
        "id": "7d287dd9fafb4c84",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "add",
        "info": "",
        "x": 820,
        "y": 2480,
        "wires": []
    },
    {
        "id": "e9eb15189e7d6482",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "check all and fields",
        "func": "var keys = global.keys()\nmsg.keys = keys\nfor (let key of keys)\n{\n    msg[key] = global.get(key);\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3440,
        "y": 260,
        "wires": [
            [
                "446c3bf86326bc7c"
            ]
        ]
    },
    {
        "id": "7792a97fa7174b2d",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "name": "Check",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 3260,
        "y": 260,
        "wires": [
            [
                "e9eb15189e7d6482"
            ]
        ]
    },
    {
        "id": "446c3bf86326bc7c",
        "type": "debug",
        "z": "36eae2d7552c58fd",
        "name": "GLOBAL.KEYS",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 3640,
        "y": 260,
        "wires": []
    },
    {
        "id": "3df731ac0d5d70b5",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "9c7e5ff72d78b502",
        "order": 6,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "{{msg.background}}",
        "className": "abc",
        "icon": "{{msg.icon}}",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 960,
        "y": 3480,
        "wires": [
            [
                "944a00443688ee4b",
                "def6984c838eb3aa"
            ]
        ]
    },
    {
        "id": "944a00443688ee4b",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get VMI IP",
        "func": "let ip = global.get('videomixer_ip')\nmsg.payload = \"ping -c 3 \" + ip; \nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 3380,
        "wires": [
            [
                "08bf5b833f0e7046"
            ]
        ]
    },
    {
        "id": "08bf5b833f0e7046",
        "type": "exec",
        "z": "36eae2d7552c58fd",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "0",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 220,
        "y": 3380,
        "wires": [
            [],
            [],
            [
                "5db144b9d857b69b"
            ]
        ]
    },
    {
        "id": "5db144b9d857b69b",
        "type": "switch",
        "z": "36eae2d7552c58fd",
        "name": "ans",
        "property": "payload.code",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 240,
        "y": 3480,
        "wires": [
            [
                "1b55177e42ae8d85"
            ],
            [
                "9c74fceda2fe795b"
            ]
        ]
    },
    {
        "id": "1b55177e42ae8d85",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "CLR green",
        "func": "msg.icon = 'done'\nmsg.background = 'green'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 3460,
        "wires": [
            [
                "3d4b7496b7872019"
            ]
        ]
    },
    {
        "id": "9c74fceda2fe795b",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "CLR red",
        "func": "msg.icon = 'close'\nmsg.background = 'red'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 3500,
        "wires": [
            [
                "3d4b7496b7872019"
            ]
        ]
    },
    {
        "id": "5c17358ec802e88f",
        "type": "delay",
        "z": "36eae2d7552c58fd",
        "name": "3 sec",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 460,
        "y": 3560,
        "wires": [
            [
                "5709ce9a1ab01c44"
            ]
        ]
    },
    {
        "id": "5709ce9a1ab01c44",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "CLR none",
        "func": "msg.background = ''\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 3560,
        "wires": [
            [
                "21667422feae2008"
            ]
        ]
    },
    {
        "id": "def6984c838eb3aa",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "loading style",
        "func": "msg.icon = 'schedule'\nmsg.background = 'gray'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 3480,
        "wires": [
            [
                "3df731ac0d5d70b5"
            ]
        ]
    },
    {
        "id": "21667422feae2008",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "ICON def",
        "func": "msg.icon = 'call_missed_outgoing'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 3560,
        "wires": [
            [
                "3df731ac0d5d70b5"
            ]
        ]
    },
    {
        "id": "89ed30f602c2d22a",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "name": ">",
        "props": [
            {
                "p": "background",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 760,
        "y": 3520,
        "wires": [
            [
                "21667422feae2008"
            ]
        ]
    },
    {
        "id": "f5ba9ecd44916195",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get VMA IP",
        "func": "let ip = global.get('videomatrix_ip')\nmsg.payload = \"ping -c 3 \" + ip; \nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 3660,
        "wires": [
            [
                "b7c48acd485efb9b"
            ]
        ]
    },
    {
        "id": "0644285cf6c925e6",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "VMI ping",
        "info": "",
        "x": 970,
        "y": 3440,
        "wires": []
    },
    {
        "id": "633f20a4903ed90b",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "47715a302e162008",
        "order": 6,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "{{msg.background}}",
        "className": "abc",
        "icon": "{{msg.icon}}",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 960,
        "y": 3760,
        "wires": [
            [
                "b86458096d58cdfb",
                "f5ba9ecd44916195"
            ]
        ]
    },
    {
        "id": "b7c48acd485efb9b",
        "type": "exec",
        "z": "36eae2d7552c58fd",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "0",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 220,
        "y": 3660,
        "wires": [
            [],
            [],
            [
                "b762b188c223e71f"
            ]
        ]
    },
    {
        "id": "b762b188c223e71f",
        "type": "switch",
        "z": "36eae2d7552c58fd",
        "name": "ans",
        "property": "payload.code",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 240,
        "y": 3760,
        "wires": [
            [
                "34886bceb5befe29"
            ],
            [
                "df386d4058fb9349"
            ]
        ]
    },
    {
        "id": "34886bceb5befe29",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "CLR green",
        "func": "msg.icon = 'done'\nmsg.background = 'green'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 3740,
        "wires": [
            [
                "d5d6e115a3df2ccd"
            ]
        ]
    },
    {
        "id": "df386d4058fb9349",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "CLR red",
        "func": "msg.icon = 'close'\nmsg.background = 'red'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 3780,
        "wires": [
            [
                "d5d6e115a3df2ccd"
            ]
        ]
    },
    {
        "id": "dd988af6767a3b8d",
        "type": "delay",
        "z": "36eae2d7552c58fd",
        "name": "3 sec",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 460,
        "y": 3840,
        "wires": [
            [
                "f4acefe4e604d2dc"
            ]
        ]
    },
    {
        "id": "f4acefe4e604d2dc",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "CLR none",
        "func": "msg.background = ''\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 3840,
        "wires": [
            [
                "d7d52e9466ac5986"
            ]
        ]
    },
    {
        "id": "b86458096d58cdfb",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "loading style",
        "func": "msg.icon = 'schedule'\nmsg.background = 'gray'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 3760,
        "wires": [
            [
                "633f20a4903ed90b"
            ]
        ]
    },
    {
        "id": "d7d52e9466ac5986",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "ICON def",
        "func": "msg.icon = 'call_missed_outgoing'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 3840,
        "wires": [
            [
                "633f20a4903ed90b"
            ]
        ]
    },
    {
        "id": "76339ae099378ad3",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "name": ">",
        "props": [
            {
                "p": "background",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 760,
        "y": 3800,
        "wires": [
            [
                "d7d52e9466ac5986"
            ]
        ]
    },
    {
        "id": "5f779234cdfa5da9",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "VMA ping",
        "info": "",
        "x": 970,
        "y": 3720,
        "wires": []
    },
    {
        "id": "a0395e9ebe48c88e",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "e1b3f68bc0754e54",
        "order": 6,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "{{msg.background}}",
        "className": "abc",
        "icon": "{{msg.icon}}",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 960,
        "y": 4020,
        "wires": [
            [
                "9ccde9ae25524197",
                "18e4bb13d829115c"
            ]
        ]
    },
    {
        "id": "9ccde9ae25524197",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get AMA IP",
        "func": "let ip = global.get('audioprocessor_ip')\nmsg.payload = \"ping -c 3 \" + ip; \nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 3920,
        "wires": [
            [
                "d9018819ee0c38c3"
            ]
        ]
    },
    {
        "id": "d9018819ee0c38c3",
        "type": "exec",
        "z": "36eae2d7552c58fd",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "0",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 220,
        "y": 3920,
        "wires": [
            [],
            [],
            [
                "66df4148d3390283"
            ]
        ]
    },
    {
        "id": "66df4148d3390283",
        "type": "switch",
        "z": "36eae2d7552c58fd",
        "name": "ans",
        "property": "payload.code",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 240,
        "y": 4020,
        "wires": [
            [
                "b969641605a05c06"
            ],
            [
                "195b591553efaa35"
            ]
        ]
    },
    {
        "id": "b969641605a05c06",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "CLR green",
        "func": "msg.icon = 'done'\nmsg.background = 'green'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 4000,
        "wires": [
            [
                "b9a1a783b0db463f"
            ]
        ]
    },
    {
        "id": "195b591553efaa35",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "CLR red",
        "func": "msg.icon = 'close'\nmsg.background = 'red'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 4040,
        "wires": [
            [
                "b9a1a783b0db463f"
            ]
        ]
    },
    {
        "id": "eeca3efb9da4bcf4",
        "type": "delay",
        "z": "36eae2d7552c58fd",
        "name": "3 sec",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 460,
        "y": 4100,
        "wires": [
            [
                "57979eba17c39986"
            ]
        ]
    },
    {
        "id": "57979eba17c39986",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "CLR none",
        "func": "msg.background = ''\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 4100,
        "wires": [
            [
                "22baf71fe653174a"
            ]
        ]
    },
    {
        "id": "18e4bb13d829115c",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "loading style",
        "func": "msg.icon = 'schedule'\nmsg.background = 'gray'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 4020,
        "wires": [
            [
                "a0395e9ebe48c88e"
            ]
        ]
    },
    {
        "id": "22baf71fe653174a",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "ICON def",
        "func": "msg.icon = 'call_missed_outgoing'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 4100,
        "wires": [
            [
                "a0395e9ebe48c88e"
            ]
        ]
    },
    {
        "id": "954dcd8663a63ddd",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "name": ">",
        "props": [
            {
                "p": "background",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 760,
        "y": 4060,
        "wires": [
            [
                "22baf71fe653174a"
            ]
        ]
    },
    {
        "id": "46c020573a845f1b",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "AMA ping",
        "info": "",
        "x": 970,
        "y": 3980,
        "wires": []
    },
    {
        "id": "88326517a210db53",
        "type": "ui_button",
        "z": "36eae2d7552c58fd",
        "name": "",
        "group": "ea4be7e4d073dec2",
        "order": 6,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "{{msg.background}}",
        "className": "abc",
        "icon": "{{msg.icon}}",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 960,
        "y": 4280,
        "wires": [
            [
                "cf71f280e54527f8",
                "c56d726e152abb50"
            ]
        ]
    },
    {
        "id": "cf71f280e54527f8",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get TCG IP",
        "func": "let ip = global.get('tcgroup_ip')\nmsg.payload = \"ping -c 3 \" + ip; \nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 4180,
        "wires": [
            [
                "2c82247a27b3e018"
            ]
        ]
    },
    {
        "id": "2c82247a27b3e018",
        "type": "exec",
        "z": "36eae2d7552c58fd",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "0",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 220,
        "y": 4180,
        "wires": [
            [],
            [],
            [
                "52b0c820052213e0"
            ]
        ]
    },
    {
        "id": "52b0c820052213e0",
        "type": "switch",
        "z": "36eae2d7552c58fd",
        "name": "ans",
        "property": "payload.code",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 240,
        "y": 4280,
        "wires": [
            [
                "185156bf8eef668d"
            ],
            [
                "3ac3d9f9edb8c46a"
            ]
        ]
    },
    {
        "id": "185156bf8eef668d",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "CLR green",
        "func": "msg.icon = 'done'\nmsg.background = 'green'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 4260,
        "wires": [
            [
                "6b638ce2aa075f39"
            ]
        ]
    },
    {
        "id": "3ac3d9f9edb8c46a",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "CLR red",
        "func": "msg.icon = 'close'\nmsg.background = 'red'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 4300,
        "wires": [
            [
                "6b638ce2aa075f39"
            ]
        ]
    },
    {
        "id": "868487254f602b2d",
        "type": "delay",
        "z": "36eae2d7552c58fd",
        "name": "3 sec",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 460,
        "y": 4360,
        "wires": [
            [
                "828b0b99330641b8"
            ]
        ]
    },
    {
        "id": "828b0b99330641b8",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "CLR none",
        "func": "msg.background = ''\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 4360,
        "wires": [
            [
                "e03f31de33d0d806"
            ]
        ]
    },
    {
        "id": "c56d726e152abb50",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "loading style",
        "func": "msg.icon = 'schedule'\nmsg.background = 'gray'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 4280,
        "wires": [
            [
                "88326517a210db53"
            ]
        ]
    },
    {
        "id": "e03f31de33d0d806",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "ICON def",
        "func": "msg.icon = 'call_missed_outgoing'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 4360,
        "wires": [
            [
                "88326517a210db53"
            ]
        ]
    },
    {
        "id": "1fb58720c5fbd876",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "name": ">",
        "props": [
            {
                "p": "background",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 760,
        "y": 4320,
        "wires": [
            [
                "e03f31de33d0d806"
            ]
        ]
    },
    {
        "id": "09c6cda693742c2c",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "TCG ping",
        "info": "",
        "x": 970,
        "y": 4240,
        "wires": []
    },
    {
        "id": "ad58a2ca17a1f10e",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "not valid",
        "func": "if (msg.log == 'incorrect' || msg.log == 'busy')\n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 360,
        "wires": [
            [
                "c560142028a627ca"
            ]
        ]
    },
    {
        "id": "7b57196839db720b",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "not valid",
        "func": "if (msg.log == 'incorrect' || msg.log == 'busy')\n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 700,
        "wires": [
            [
                "c535e4313e0c9c3e"
            ]
        ]
    },
    {
        "id": "d835a560c7b36b9e",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "not valid",
        "func": "if (msg.log == 'incorrect' || msg.log == 'busy')\n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 1040,
        "wires": [
            [
                "ef9af4d4750cf54b"
            ]
        ]
    },
    {
        "id": "871998ff2329f7a2",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "not valid",
        "func": "if (msg.log == 'incorrect' || msg.log == 'busy')\n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 1380,
        "wires": [
            [
                "1dc642d88f57dc2c"
            ]
        ]
    },
    {
        "id": "db4960826ee31543",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "PINGS",
        "info": "",
        "x": 200,
        "y": 3300,
        "wires": []
    },
    {
        "id": "61ce23d965545a7e",
        "type": "comment",
        "z": "36eae2d7552c58fd",
        "name": "ПЕРЕХОДЫ В НАСТРОЙКИ",
        "info": "",
        "x": 250,
        "y": 1960,
        "wires": []
    },
    {
        "id": "affcf05a13e1c8a4",
        "type": "link out",
        "z": "36eae2d7552c58fd",
        "name": "> set global",
        "mode": "link",
        "links": [
            "2b10451ec03c7c0f"
        ],
        "x": 3225,
        "y": 2700,
        "wires": []
    },
    {
        "id": "2b10451ec03c7c0f",
        "type": "link in",
        "z": "36eae2d7552c58fd",
        "name": "set global >",
        "links": [
            "affcf05a13e1c8a4"
        ],
        "x": 175,
        "y": 860,
        "wires": [
            [
                "b9dcfee8df50d4b0",
                "52fd5acd366c7ff0",
                "b8481506d7a122ad",
                "3f77a6f8c3499017",
                "1b684d34eedc5f03",
                "045d64ec2a8d2a16",
                "95232539877b3141",
                "455ed0169e97ea6e"
            ]
        ]
    },
    {
        "id": "b9dcfee8df50d4b0",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get videomixer_ip",
        "func": "msg.payload = global.get('videomixer_ip')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 440,
        "wires": [
            [
                "46c9e78250912d0e"
            ]
        ]
    },
    {
        "id": "52fd5acd366c7ff0",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get videomixer_port",
        "func": "msg.payload = global.get('videomixer_port')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 480,
        "wires": [
            [
                "4726cc2d8a540302"
            ]
        ]
    },
    {
        "id": "1987fcab7b2e7159",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "name": ">",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 260,
        "y": 560,
        "wires": [
            [
                "b9dcfee8df50d4b0",
                "52fd5acd366c7ff0"
            ]
        ]
    },
    {
        "id": "b8481506d7a122ad",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get videomatrix_ip",
        "func": "msg.payload = global.get('videomatrix_ip')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 780,
        "wires": [
            [
                "7944d5bdb5ac7a60"
            ]
        ]
    },
    {
        "id": "3f77a6f8c3499017",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get videomatrix_port",
        "func": "msg.payload = global.get('videomatrix_port')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 820,
        "wires": [
            [
                "c22618dd5a39c5bf"
            ]
        ]
    },
    {
        "id": "1b684d34eedc5f03",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get audioprocessor_ip",
        "func": "msg.payload = global.get('audioprocessor_ip')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 1120,
        "wires": [
            [
                "ebcee80c94aac014"
            ]
        ]
    },
    {
        "id": "045d64ec2a8d2a16",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get audioprocessor_port",
        "func": "msg.payload = global.get('audioprocessor_port')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 1160,
        "wires": [
            [
                "1125eeb99959f7ce"
            ]
        ]
    },
    {
        "id": "95232539877b3141",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get tcgroup_ip",
        "func": "msg.payload = global.get('tcgroup_ip')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 1300,
        "wires": [
            [
                "8134496c47a529fe"
            ]
        ]
    },
    {
        "id": "455ed0169e97ea6e",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "get tcgroup_port",
        "func": "msg.payload = global.get('tcgroup_port')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 1340,
        "wires": [
            [
                "2ecd420352a4b19f"
            ]
        ]
    },
    {
        "id": "566518a3eab752e4",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "set cameras qty",
        "func": "var keys = global.keys()\nkeys = keys.filter((key) => key.includes(\"camera\") && (key.includes(\"ip\")));\nglobal.set(\"cameras_qty\", keys.length)",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3060,
        "y": 2740,
        "wires": [
            []
        ]
    },
    {
        "id": "96d4782f89bccbf1",
        "type": "ui_table",
        "z": "36eae2d7552c58fd",
        "group": "e3be92b07b670127",
        "name": "",
        "order": 3,
        "width": 6,
        "height": 3,
        "columns": [
            {
                "field": "name",
                "title": "№",
                "width": "20%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "ip",
                "title": "IP-адрес",
                "width": "40%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "port",
                "title": "Порт",
                "width": "40%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 1670,
        "y": 2920,
        "wires": [
            [
                "924717ea88d0350e",
                "edcb70c683c19199",
                "3c5feb6775439019"
            ]
        ]
    },
    {
        "id": "6c3b9dd4ec471c3c",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "state + 1",
        "func": "msg.payload.data.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1630,
        "y": 2440,
        "wires": [
            [
                "111c91940e26fa56"
            ]
        ]
    },
    {
        "id": "2454601740ca667b",
        "type": "api-current-state",
        "z": "36eae2d7552c58fd",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1470,
        "y": 2440,
        "wires": [
            [
                "6c3b9dd4ec471c3c"
            ]
        ]
    },
    {
        "id": "6fbefc749e1b992f",
        "type": "function",
        "z": "36eae2d7552c58fd",
        "name": "state + 1",
        "func": "msg.payload.data.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1280,
        "y": 2840,
        "wires": [
            [
                "7d633645aa556467"
            ]
        ]
    },
    {
        "id": "fd6384c02cc1797c",
        "type": "api-current-state",
        "z": "36eae2d7552c58fd",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1420,
        "y": 2800,
        "wires": [
            [
                "6fbefc749e1b992f"
            ]
        ]
    },
    {
        "id": "7d633645aa556467",
        "type": "api-call-service",
        "z": "36eae2d7552c58fd",
        "name": "set Cameras to \"0\"",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1450,
        "y": 2840,
        "wires": [
            []
        ]
    },
    {
        "id": "392b1b85960e4d54",
        "type": "inject",
        "z": "36eae2d7552c58fd",
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2720,
        "y": 2620,
        "wires": [
            [
                "a040058c48bde993"
            ]
        ]
    },
    {
        "id": "ae94dc417af2da31",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "name": "clear all and fields",
        "func": "var keys = global.keys()\n\nfor (var key in keys)\n{\n    global.set(keys[key], undefined);\n}\nmsg.payload = ''\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1670,
        "y": 220,
        "wires": [
            [
                "b3664acb052b97a5"
            ]
        ]
    },
    {
        "id": "15db80c6e21c60a9",
        "type": "inject",
        "z": "400344fd8c1a0fdc",
        "name": "CLEAR",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1490,
        "y": 220,
        "wires": [
            [
                "ae94dc417af2da31"
            ]
        ]
    },
    {
        "id": "b3664acb052b97a5",
        "type": "link out",
        "z": "400344fd8c1a0fdc",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "44f21a618752e9e8"
        ],
        "x": 1805,
        "y": 220,
        "wires": []
    },
    {
        "id": "dd5f965e.fb70b8",
        "type": "ui_template",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "group": "",
        "name": "CSS-Basics",
        "order": 4,
        "width": 0,
        "height": 0,
        "format": "<style>\n\n* {\n    background: none !important;\n}\n\n    root, a, button, p, div {\n        -webkit-user-select: none !important;\n    }\n\n    body {\n        // background-image: url(\"http://192.168.178.1:1880/ui/2023.jpg\");\n        // background: linear-gradient(120deg, rgba(40, 42, 49, 1.0) 40%, rgba(47, 49, 56, 1.0) 80%) !important;\n        background-size: cover !important;\n        background: transparent !important;\n\n        background: -webkit-linear-gradient(\n            55deg,\n            #009785 0%,\n            #245aa5 100%\n        ) !important;\n        \n        -webkit-touch-callout: none !important;\n        color: #ffffff !important;\n        padding-top:5px !important;\n    }\n    \n    body.nr-dashboard-theme md-toolbar,\n    body.nr-dashboard-theme md-content md-card {\n\n    }\n\n    \n    ui-card-panel {\n        background-color: rgba(250,250,250,0.15) !important;\n        border:none !important;\n        border-radius: 10px !important;\n        box-shadow: 0 3px 6px 0 rgba(0, 0, 0, 0.2), 0 4px 8px 0 rgba(0, 0, 0, 0.19) !important;\n      }\n\n\n    md-sidenav {\n        background: linear-gradient(120deg, rgba(40, 42, 49, 0.90) 20%, rgba(47, 49, 56, 0.90) 80%) !important;\n    }\n\n</style>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "global",
        "className": "",
        "x": 1510,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "92efc63c76123189",
        "type": "comment",
        "z": "400344fd8c1a0fdc",
        "name": "STYLE",
        "info": "",
        "x": 1490,
        "y": 60,
        "wires": []
    },
    {
        "id": "a4029a5a5c63381b",
        "type": "ui_template",
        "z": "400344fd8c1a0fdc",
        "group": "",
        "name": "CSS-Basics",
        "order": 4,
        "width": 0,
        "height": 0,
        "format": "<style>\n    *:not(button, table) {\n        background: none !important;\n        color: #ffffff !important; /* Устанавливаем белый цвет текста для всех элементов */\n    }\n\n    root, a, button, p, div {\n        -webkit-user-select: none !important;\n    }\n\n    body {\n        // background-image: url(\"http://192.168.178.1:1880/ui/2023.jpg\");\n        // background: linear-gradient(120deg, rgba(40, 42, 49, 1.0) 40%, rgba(47, 49, 56, 1.0) 80%) !important;\n        background-size: cover !important;\n        background: transparent !important;\n\n        background: -webkit-linear-gradient(55deg,\n                #009785 0%,\n                #245aa5 100%) !important;\n\n        -webkit-touch-callout: none !important;\n        color: #ffffff !important;\n        padding-top: 5px !important;\n    }\n\n    ui-card-panel {\n        background-color: rgba(250, 250, 250, 0.15) !important;\n        border: none !important;\n        border-radius: 10px !important;\n        box-shadow: 0 3px 6px 0 rgba(0, 0, 0, 0.2), 0 4px 8px 0 rgba(0, 0, 0, 0.19) !important;\n    }\n    \n    md-sidenav {\n        background: linear-gradient(120deg, rgba(40, 42, 49, 0.90) 20%, rgba(47, 49, 56, 0.90) 80%) !important;\n    }\n\n    relay {\n        color: #ffffff !important;\n    }\n\n</style>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "global",
        "className": "",
        "x": 1510,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "2de5a265f6910732",
        "type": "comment",
        "z": "400344fd8c1a0fdc",
        "name": "Поток SMX99 и SMX46 проверить",
        "info": "Нечаянно сделал их под копирку как SMX47",
        "x": 220,
        "y": 100,
        "wires": []
    },
    {
        "id": "e85b37a92a9f53b8",
        "type": "comment",
        "z": "400344fd8c1a0fdc",
        "name": "Заметки:",
        "info": "",
        "x": 140,
        "y": 60,
        "wires": []
    },
    {
        "id": "8a795ad367d07f7e",
        "type": "inject",
        "z": "400344fd8c1a0fdc",
        "name": "Init",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "x": 150,
        "y": 220,
        "wires": [
            [
                "15c3faf0c65c9661"
            ]
        ]
    },
    {
        "id": "582429e5a44ea7e7",
        "type": "comment",
        "z": "400344fd8c1a0fdc",
        "name": "GLOBAL VARIABLES",
        "info": "",
        "x": 180,
        "y": 180,
        "wires": []
    },
    {
        "id": "f0354dfda67643b5",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "name": "GLOBAL VARIABLES (demo)",
        "func": "// Камера 1: \nglobal.set(\"camera_1_ip\", \"10.111.32.141\")\nglobal.set(\"camera_1_port\", 5678)\n\n// Камера 2: \nglobal.set(\"camera_2_ip\", \"10.111.32.140\")\nglobal.set(\"camera_2_port\", 1259)\n\n// Аудиопроцессор: \nglobal.set(\"audioprocessor_ip\", \"10.111.32.160\")\nglobal.set(\"audioprocessor_port\", 50000)\n\n// Видеоматрица:\nglobal.set(\"videomatrix_ip\", \"10.111.32.153\")\nglobal.set(\"videomatrix_port\", 99999)\n\n// Видеомикшер: \nglobal.set(\"videomixer_ip\", \"10.111.33.10\")\nglobal.set(\"videomixer_port\", 19523)\n\n// TCGroup: \nglobal.set(\"tcgroup_ip\", \"10.111.32.148\")\nglobal.set(\"tcgroup_port\", 99999)\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 220,
        "wires": [
            [
                "0402956229754e0a"
            ]
        ]
    },
    {
        "id": "15c3faf0c65c9661",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "name": "clear global",
        "func": "var keys = global.keys()\nfor (var i in keys)\n{\n    global.set(keys[i], undefined);\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 220,
        "wires": [
            [
                "f0354dfda67643b5"
            ]
        ]
    },
    {
        "id": "f3a004c8cc989e01",
        "type": "comment",
        "z": "400344fd8c1a0fdc",
        "name": "НАСТРОЙКА",
        "info": "",
        "x": 490,
        "y": 180,
        "wires": []
    },
    {
        "id": "0402956229754e0a",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "name": "set cameras qty",
        "func": "var keys = global.keys()\nkeys = keys.filter((key) => key.includes(\"camera\") && (key.includes(\"ip\")));\nglobal.set(\"cameras_qty\", keys.length)",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "41f02ed8df4c5a7c",
        "type": "server-state-changed",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "about",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.about",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "200",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": true,
        "ignorePrevStateUnknown": true,
        "ignorePrevStateUnavailable": true,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 150,
        "y": 380,
        "wires": [
            [
                "5f29caa1b5480481"
            ]
        ]
    },
    {
        "id": "d51f8689d01dcb6b",
        "type": "switch",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "flag == checked",
        "property": "flag",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "checked",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 640,
        "y": 380,
        "wires": [
            [],
            [
                "7b17daceab0bd4fa"
            ]
        ]
    },
    {
        "id": "5f29caa1b5480481",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "state",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 380,
        "wires": [
            [
                "95cff8a558033081"
            ]
        ]
    },
    {
        "id": "67b3d267bca3c366",
        "type": "comment",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "fix",
        "info": "200 ms",
        "x": 150,
        "y": 340,
        "wires": []
    },
    {
        "id": "b712a9606401476a",
        "type": "api-call-service",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "homeAssistant = true",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.about\",\"state\":{{state}}, \"serverVersion\":\"{{serverVersion}}\", \"homeAssistant\":true}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1060,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "95cff8a558033081",
        "type": "switch",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 450,
        "y": 380,
        "wires": [
            [
                "d51f8689d01dcb6b"
            ]
        ]
    },
    {
        "id": "c65e09b53541e09b",
        "type": "server-state-changed",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "about",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.about",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "200",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": true,
        "ignorePrevStateUnknown": true,
        "ignorePrevStateUnavailable": true,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 1470,
        "y": 420,
        "wires": [
            [
                "ec34bcf8291086cc"
            ]
        ]
    },
    {
        "id": "fc3bb77b9f63a71e",
        "type": "switch",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "flag == true",
        "property": "flag",
        "propertyType": "global",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1970,
        "y": 420,
        "wires": [
            [],
            [
                "711a0f1a4b729183"
            ]
        ]
    },
    {
        "id": "ec34bcf8291086cc",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "state",
        "func": "msg.state = Number(msg.state)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1630,
        "y": 420,
        "wires": [
            [
                "0fd972b63560c0e9"
            ]
        ]
    },
    {
        "id": "3d03ea9140fb3880",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "state to compare",
        "func": "var messages = []\n\nconst sensors = [\n    \"about\"\n    ]\n\nvar state = msg.state\nfor (const sensor of sensors) {\n    msg = {}\n    msg.state_about = Number(state)\n    var data = {}\n    data['entityId'] = 'sensor.' + sensor\n    msg.payload = data\n    messages.push(msg)\n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1770,
        "y": 480,
        "wires": [
            [
                "af528dc18229896d"
            ]
        ]
    },
    {
        "id": "af528dc18229896d",
        "type": "api-current-state",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1960,
        "y": 480,
        "wires": [
            [
                "8c94b2a62a7a146f"
            ]
        ]
    },
    {
        "id": "8c94b2a62a7a146f",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "good state + 1",
        "func": "if (Number(msg.state_about) > Number(msg.state))\n{\n    msg.state = Number(msg.state_about)\n}\nelse\n{\n    msg.state = Number(msg.state)\n}\n\nconst entity_id = msg.payload.entityId\nvar data = {}\ndata[\"entity_id\"] = entity_id\ndata[\"state\"] = msg.state + 100000\n\nif (entity_id == \"sensor.about\")\n{\n    data[\"homeAssistant\"] = true\n    data[\"version\"] = '1.3.0.1'\n}\n\nvar msg = {}\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\": data\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2140,
        "y": 480,
        "wires": [
            [
                "fc99255677890204"
            ]
        ]
    },
    {
        "id": "fc99255677890204",
        "type": "api-call-service",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "set state to sensor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "all",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 2370,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "711a0f1a4b729183",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "flag = true",
        "func": "global.set('flag', true)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 480,
        "wires": [
            [
                "3d03ea9140fb3880"
            ]
        ]
    },
    {
        "id": "3d84e3120e89e8f2",
        "type": "comment",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "fix",
        "info": "200 ms",
        "x": 1470,
        "y": 380,
        "wires": []
    },
    {
        "id": "0fd972b63560c0e9",
        "type": "switch",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1790,
        "y": 420,
        "wires": [
            [
                "fc3bb77b9f63a71e"
            ]
        ]
    },
    {
        "id": "7b17daceab0bd4fa",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "serverVersion",
        "func": "flow.set('flag', true)\nmsg.serverVersion = \"1.3.0.5\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 380,
        "wires": [
            [
                "b712a9606401476a"
            ]
        ]
    },
    {
        "id": "5f3d6aa0bd37c2eb",
        "type": "comment",
        "z": "400344fd8c1a0fdc",
        "d": true,
        "name": "v1.3.0.5",
        "info": "",
        "x": 810,
        "y": 340,
        "wires": []
    },
    {
        "id": "8de9e7d7e5781e86",
        "type": "inject",
        "z": "400344fd8c1a0fdc",
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "x": 170,
        "y": 640,
        "wires": [
            [
                "febe301bef72c402"
            ]
        ]
    },
    {
        "id": "1e603e1c0c842d6c",
        "type": "debug",
        "z": "400344fd8c1a0fdc",
        "name": "debug 189",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "flag",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 530,
        "y": 640,
        "wires": []
    },
    {
        "id": "febe301bef72c402",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "name": "flag = false",
        "func": "flow.set('flag', false)\nmsg.flag = flow.get('flag')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 640,
        "wires": [
            [
                "1e603e1c0c842d6c"
            ]
        ]
    },
    {
        "id": "12142025b96ca5ba",
        "type": "server-state-changed",
        "z": "400344fd8c1a0fdc",
        "name": "about",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.about",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "200",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": true,
        "ignorePrevStateUnknown": true,
        "ignorePrevStateUnavailable": true,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 150,
        "y": 760,
        "wires": [
            [
                "d58538c8c7111119"
            ]
        ]
    },
    {
        "id": "adfda76a239c4651",
        "type": "switch",
        "z": "400344fd8c1a0fdc",
        "name": "flag == checked",
        "property": "flag",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "checked",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 780,
        "y": 760,
        "wires": [
            [],
            [
                "a15e024687192f46"
            ]
        ]
    },
    {
        "id": "f6814b6e2bc20359",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "name": "state",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 760,
        "wires": [
            [
                "549f9cff95952771"
            ]
        ]
    },
    {
        "id": "fb97eb8f1986cb6b",
        "type": "comment",
        "z": "400344fd8c1a0fdc",
        "name": "fix",
        "info": "200 ms",
        "x": 150,
        "y": 720,
        "wires": []
    },
    {
        "id": "32a3ef111cd5c152",
        "type": "api-call-service",
        "z": "400344fd8c1a0fdc",
        "name": "homeAssistant = true",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.about\",\"state\":{{state}}, \"serverVersion\":\"{{serverVersion}}\", \"homeAssistant\":true}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 880,
        "y": 880,
        "wires": [
            [
                "febe0b66aa7c2e02"
            ]
        ]
    },
    {
        "id": "549f9cff95952771",
        "type": "switch",
        "z": "400344fd8c1a0fdc",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gte",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 590,
        "y": 760,
        "wires": [
            [
                "adfda76a239c4651"
            ]
        ]
    },
    {
        "id": "c3ea7e3a5c4347b2",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "name": "serverVersion",
        "func": "flow.set('flag', \"checked\")\nmsg.serverVersion = \"1.4.0.4\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 880,
        "wires": [
            [
                "32a3ef111cd5c152"
            ]
        ]
    },
    {
        "id": "6380da3e2ea6e3e1",
        "type": "comment",
        "z": "400344fd8c1a0fdc",
        "name": "v1.4.0.4",
        "info": "",
        "x": 630,
        "y": 840,
        "wires": []
    },
    {
        "id": "a15e024687192f46",
        "type": "delay",
        "z": "400344fd8c1a0fdc",
        "name": "",
        "pauseType": "delay",
        "timeout": "7",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 160,
        "y": 880,
        "wires": [
            [
                "d952a7cb901375b1"
            ]
        ]
    },
    {
        "id": "d952a7cb901375b1",
        "type": "api-current-state",
        "z": "400344fd8c1a0fdc",
        "name": "about",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.about",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 330,
        "y": 880,
        "wires": [
            [
                "5fbfebf928b119c7"
            ]
        ]
    },
    {
        "id": "5fbfebf928b119c7",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "name": "state",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 880,
        "wires": [
            [
                "c3ea7e3a5c4347b2"
            ]
        ]
    },
    {
        "id": "f13bb85d38b159dc",
        "type": "comment",
        "z": "400344fd8c1a0fdc",
        "name": "№259447",
        "info": "Приходит коннект, вылетают все сенсоры \nот нас сначала в \"unknown\", потом в \"0\"",
        "x": 160,
        "y": 840,
        "wires": []
    },
    {
        "id": "617f856ef973565a",
        "type": "inject",
        "z": "400344fd8c1a0fdc",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "iso",
        "payloadType": "date",
        "x": 190,
        "y": 500,
        "wires": [
            [
                "653743c3841ae9f0"
            ]
        ]
    },
    {
        "id": "5b030b76aac410fd",
        "type": "moment",
        "z": "400344fd8c1a0fdc",
        "name": "",
        "topic": "",
        "input": "payload",
        "inputType": "msg",
        "inTz": "Africa/Abidjan",
        "adjAmount": "3",
        "adjType": "hours",
        "adjDir": "add",
        "format": "ISO8601",
        "locale": "en-US",
        "output": "payload",
        "outputType": "msg",
        "outTz": "Europe/Moscow",
        "x": 580,
        "y": 500,
        "wires": [
            [
                "8420c065b7ae6841"
            ]
        ]
    },
    {
        "id": "653743c3841ae9f0",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "name": "function 23",
        "func": "msg.date = new Date(msg.payload)\n\nmsg.minutes = msg.date.getMinutes()\n\nif (msg.minutes != flow.get(\"prevMinutes\")) {\n    flow.set(\"prevMinutes\", msg.minutes)\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 500,
        "wires": [
            [
                "5b030b76aac410fd"
            ]
        ]
    },
    {
        "id": "8420c065b7ae6841",
        "type": "api-call-service",
        "z": "400344fd8c1a0fdc",
        "name": "date_time",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.date_time\", \"iso8601\":\"{{payload}}\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 780,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "febe0b66aa7c2e02",
        "type": "delay",
        "z": "400344fd8c1a0fdc",
        "name": "",
        "pauseType": "delay",
        "timeout": "14",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 620,
        "y": 980,
        "wires": [
            [
                "66bc5f2f2094bb87"
            ]
        ]
    },
    {
        "id": "66bc5f2f2094bb87",
        "type": "function",
        "z": "400344fd8c1a0fdc",
        "name": "state",
        "func": "var state = 10000000001\n\nvar sensors = [\n    \"videomixer\",\n    \"videomatrix\",\n    \"audioprocessor\",\n    \"device_statuses\",\n    \"current_values\",\n]\n\nvar messages = []\n\nfor (var sensor of sensors)\n{\n    var msg = {};\n    var data = {}\n    data[\"entity_id\"] = \"sensor.\" + sensor\n\n    data[\"state\"] = state \n\n\n    msg.payload = {\n        \"entity_id\": \"sensor.\" + sensor,\n        \"domain\": \"python_script\",\n        \"service\": \"set_state\",\n        \"data\": data\n    }\n    messages.push(msg)\n}\n\n\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 270,
        "y": 1100,
        "wires": [
            [
                "82a030a98f91d956"
            ]
        ]
    },
    {
        "id": "1aa3b20bac9eedbf",
        "type": "api-call-service",
        "z": "400344fd8c1a0fdc",
        "name": "to sensor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "all",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 760,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "82a030a98f91d956",
        "type": "api-current-state",
        "z": "400344fd8c1a0fdc",
        "name": "sensor state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 430,
        "y": 1100,
        "wires": [
            [
                "9f614d31ad3818ec"
            ]
        ]
    },
    {
        "id": "9f614d31ad3818ec",
        "type": "switch",
        "z": "400344fd8c1a0fdc",
        "name": "bad state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 600,
        "y": 1100,
        "wires": [
            [
                "1aa3b20bac9eedbf"
            ]
        ]
    },
    {
        "id": "d58538c8c7111119",
        "type": "api-current-state",
        "z": "400344fd8c1a0fdc",
        "name": "about",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.about",
        "state_type": "num",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 290,
        "y": 760,
        "wires": [
            [
                "f6814b6e2bc20359"
            ]
        ]
    },
    {
        "id": "00368be90b2c900c",
        "type": "inject",
        "z": "400344fd8c1a0fdc",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 130,
        "y": 1280,
        "wires": [
            [
                "01559d9b8d2b284b"
            ]
        ]
    },
    {
        "id": "01559d9b8d2b284b",
        "type": "api-current-state",
        "z": "400344fd8c1a0fdc",
        "name": "",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "num",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 370,
        "y": 1280,
        "wires": [
            [
                "787b3fcb4eb29343"
            ]
        ]
    },
    {
        "id": "787b3fcb4eb29343",
        "type": "switch",
        "z": "400344fd8c1a0fdc",
        "name": "if state <  3000000000000",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "3000000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 670,
        "y": 1280,
        "wires": [
            [
                "1c2015657c9ea1c4"
            ]
        ]
    },
    {
        "id": "0477bd474107ddfa",
        "type": "api-call-service",
        "z": "400344fd8c1a0fdc",
        "name": "",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1190,
        "y": 1280,
        "wires": [
            []
        ]
    },
    {
        "id": "1c2015657c9ea1c4",
        "type": "change",
        "z": "400344fd8c1a0fdc",
        "name": "state = 3000000000000",
        "rules": [
            {
                "t": "set",
                "p": "state",
                "pt": "msg",
                "to": "3000000000000",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 930,
        "y": 1280,
        "wires": [
            [
                "0477bd474107ddfa"
            ]
        ]
    },
    {
        "id": "d5641bea8b7a07fd",
        "type": "server-state-changed",
        "z": "18bc0562a1dcc64c",
        "name": "joystick",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.joystick",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "joystick",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 110,
        "y": 100,
        "wires": [
            [
                "42a99c5cc72c6983"
            ]
        ]
    },
    {
        "id": "3c539a8ba59a31b3",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "name": "JOYSTICK",
        "info": "",
        "x": 120,
        "y": 60,
        "wires": []
    },
    {
        "id": "1d7f7736221a7612",
        "type": "server-state-changed",
        "z": "18bc0562a1dcc64c",
        "name": "device_power",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.device_power",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "seconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 130,
        "y": 440,
        "wires": [
            [
                "b722f6a2732c9d9b"
            ]
        ]
    },
    {
        "id": "b722f6a2732c9d9b",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "parse msg",
        "func": "var cmd = msg.payload.new_state.attributes.command\nglobal.set(cmd[0]+'pwr', cmd[1])\n\nif (cmd[0].slice(0, 6) == 'camera'){\n    msg.camera = Number(cmd[0].slice(-1))\n    msg.power = cmd[1]\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 440,
        "wires": [
            [
                "2d71a356cae31f76",
                "01b174728677081c"
            ]
        ]
    },
    {
        "id": "56fedea1db8cf721",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "ip + port",
        "func": "msg.host = global.get(\"camera_\" + msg.camera + \"_ip\")\nmsg.port = global.get(\"camera_\" + msg.camera + \"_port\")\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 360,
        "wires": [
            [
                "3bc49d6d2e53e7e7"
            ]
        ]
    },
    {
        "id": "3bc49d6d2e53e7e7",
        "type": "tcp request",
        "z": "18bc0562a1dcc64c",
        "name": "tcp request",
        "server": "",
        "port": "",
        "out": "time",
        "ret": "buffer",
        "splitc": "10",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 910,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "2d71a356cae31f76",
        "type": "switch",
        "z": "18bc0562a1dcc64c",
        "name": "power",
        "property": "power",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 450,
        "y": 360,
        "wires": [
            [
                "49bc038f5bb2e4ab",
                "8415f9ea3ddb94f2"
            ],
            [
                "bcca3aecd33e31c2",
                "4466678aa464d396"
            ]
        ]
    },
    {
        "id": "360b16cbad96fc56",
        "type": "api-call-service",
        "z": "18bc0562a1dcc64c",
        "name": "Cam Status to 1",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 900,
        "y": 520,
        "wires": [
            [
                "adb5cf054f180a62"
            ]
        ]
    },
    {
        "id": "1aadc8d1f40f528d",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "global cameras",
        "func": "var keys = global.keys()\nvar keys = global.keys()\nvar qty = global.get(\"cameras_qty\")\nkeys = keys.filter((key) => key.includes(\"camera\") && (key.includes(\"ip\") || key.includes(\"port\")));\nvar cameras = []\nfor (let i = 1; i <= qty; i++)\n{\n    var id = i\n    var ip = global.get(keys.find((key) => key.includes(i+\"_ip\")));\n    var port = global.get(keys.find((key) => key.includes(i + \"_port\")));\n    cameras.push({\"id\": id, \"ip\": ip, \"port\": port})\n}\n// msg.cameras = cameras\nmsg.payload = cameras\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 240,
        "wires": [
            [
                "04dace56a56f65bc"
            ]
        ]
    },
    {
        "id": "04dace56a56f65bc",
        "type": "split",
        "z": "18bc0562a1dcc64c",
        "name": "",
        "splt": "",
        "spltType": "str",
        "arraySplt": "1",
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 450,
        "y": 240,
        "wires": [
            [
                "b177ef60dc590cec"
            ]
        ]
    },
    {
        "id": "b177ef60dc590cec",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "data",
        "func": "// var state = new Date()\n// state = state.getTime()\n\nmsg.camera = msg.payload[\"id\"]\nmsg.host = msg.payload[\"ip\"]\nmsg.port = msg.payload[\"port\"]\n\nvar data = {\n    \"entity_id\": \"sensor.device_statuses\",\n//    \"state\": state\n};\n\ndata[\"camera\" + msg.camera.toString()] = 1 // [status = 0/1/2]\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 240,
        "wires": [
            [
                "4d67e2767244ae46"
            ]
        ]
    },
    {
        "id": "44030272d7b8dd62",
        "type": "server-state-changed",
        "z": "18bc0562a1dcc64c",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.standby",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "seconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 110,
        "y": 240,
        "wires": [
            [
                "1aadc8d1f40f528d"
            ]
        ]
    },
    {
        "id": "3bb37a213b2d8304",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "name": "STANDBY",
        "info": "",
        "x": 120,
        "y": 200,
        "wires": []
    },
    {
        "id": "0684db42b2970a9d",
        "type": "switch",
        "z": "18bc0562a1dcc64c",
        "name": "standby",
        "property": "standby.new_state.attributes.standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "turningoff",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turningon",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1000,
        "y": 240,
        "wires": [
            [
                "89d2233e95f63793"
            ],
            [
                "8c79f78782913a12"
            ]
        ]
    },
    {
        "id": "18af0762f9eb305f",
        "type": "tcp request",
        "z": "18bc0562a1dcc64c",
        "name": "tcp request",
        "server": "",
        "port": "",
        "out": "time",
        "ret": "buffer",
        "splitc": "10",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 1670,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "4a67b3fd7bb425f1",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "name": "TOGGLES",
        "info": "",
        "x": 120,
        "y": 400,
        "wires": []
    },
    {
        "id": "89d2233e95f63793",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "cmd \"ON\"",
        "func": "msg.cmd = Buffer.from([129, 1, 4, 0, 2, 255])\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 220,
        "wires": [
            [
                "d0c71eda7def1fb9",
                "95d2d0a372b64467"
            ]
        ]
    },
    {
        "id": "8c79f78782913a12",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "cmd \"SB\"",
        "func": "msg.cmd = Buffer.from([129, 1, 4, 0, 3, 255])\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 260,
        "wires": [
            [
                "d0c71eda7def1fb9"
            ]
        ]
    },
    {
        "id": "87f477d779c4002c",
        "type": "api-call-service",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "current_camera = 2",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.current_values\",\"state\":{{state}}, \"camera\":2}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1670,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "f5879336ce1bfec5",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "- for GREEN",
        "info": "",
        "x": 1850,
        "y": 200,
        "wires": []
    },
    {
        "id": "bcca3aecd33e31c2",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "cmd \"ON\"",
        "func": "msg.payload = Buffer.from([129, 1, 4, 0, 2, 255])\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 380,
        "wires": [
            [
                "56fedea1db8cf721"
            ]
        ]
    },
    {
        "id": "49bc038f5bb2e4ab",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "cmd \"SB\"",
        "func": "msg.payload = Buffer.from([129, 1, 4, 0, 3, 255])\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 340,
        "wires": [
            [
                "56fedea1db8cf721"
            ]
        ]
    },
    {
        "id": "adb5cf054f180a62",
        "type": "switch",
        "z": "18bc0562a1dcc64c",
        "name": "power",
        "property": "power",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1050,
        "y": 520,
        "wires": [
            [],
            [
                "572ee7bd3921b27b"
            ]
        ]
    },
    {
        "id": "f3f5c0f52ebc535a",
        "type": "api-current-state",
        "z": "18bc0562a1dcc64c",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1580,
        "y": 540,
        "wires": [
            [
                "840dc8e0ceabfd78"
            ]
        ]
    },
    {
        "id": "b596a199126c6020",
        "type": "api-call-service",
        "z": "18bc0562a1dcc64c",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1700,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "840dc8e0ceabfd78",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "func",
        "func": "var cameras = Object.keys(msg.device_statuses.attributes);\ncameras = cameras.filter((key) => key.includes(\"camera\"));\nmsg.new_camera = 0;\n\nfor (let i = 0; i < cameras.length; i++)\n{\n    var status = msg.device_statuses.attributes[cameras[i]]\n    if (status == 2 && msg.camera != (i + 1))\n    {\n        msg.new_camera = Number(cameras[i].split(\"camera\")[1])\n        // var state = new Date()\n        // state = state.getTime()\n        break\n    }\n}\n\nvar data = {\n    \"entity_id\": \"sensor.current_values\",\n//    \"state\": state,\n    \"camera\": msg.new_camera\n}\n\nif (msg.new_camera == 0)\n{\n    data[\"preset\"] = -1,\n    data[\"chair\"] = -1\n}\n\nmsg.payload = {\n        \"domain\": \"python_script\",\n        \"service\": \"set_state\",\n        data\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1730,
        "y": 540,
        "wires": [
            [
                "760788cd506e6f9c"
            ]
        ]
    },
    {
        "id": "572ee7bd3921b27b",
        "type": "api-current-state",
        "z": "18bc0562a1dcc64c",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "current_values",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1220,
        "y": 540,
        "wires": [
            [
                "a9bd5cdf1e8fffc4"
            ]
        ]
    },
    {
        "id": "a9bd5cdf1e8fffc4",
        "type": "switch",
        "z": "18bc0562a1dcc64c",
        "name": "is active camera",
        "property": "current_values.attributes.camera",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "camera",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1400,
        "y": 540,
        "wires": [
            [
                "f3f5c0f52ebc535a"
            ]
        ]
    },
    {
        "id": "4781984a3cffb8fe",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "ip + port",
        "func": "msg.host = global.get(\"camera_\" + msg.camera + \"_ip\")\nmsg.port = global.get(\"camera_\" + msg.camera + \"_port\")\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2420,
        "y": 240,
        "wires": [
            [
                "fd0aaa45b48de3f5"
            ]
        ]
    },
    {
        "id": "fd0aaa45b48de3f5",
        "type": "tcp request",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "tcp request",
        "server": "",
        "port": "",
        "out": "time",
        "ret": "buffer",
        "splitc": "10",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 2570,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "ea1bfad96a237f99",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "cmd \"ON\"",
        "func": "msg.payload = Buffer.from([129, 1, 4, 0, 2, 255])\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2240,
        "y": 220,
        "wires": [
            [
                "4781984a3cffb8fe"
            ]
        ]
    },
    {
        "id": "8b1dfee1eeeb3ef4",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "cmd \"SB\"",
        "func": "msg.payload = Buffer.from([129, 1, 4, 0, 3, 255])\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2240,
        "y": 260,
        "wires": [
            [
                "4781984a3cffb8fe"
            ]
        ]
    },
    {
        "id": "448626f4c2b1802f",
        "type": "inject",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "1",
        "props": [
            {
                "p": "camera",
                "v": "1",
                "vt": "num"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2070,
        "y": 100,
        "wires": [
            [
                "ea1bfad96a237f99"
            ]
        ]
    },
    {
        "id": "d4bf4f1157bb6172",
        "type": "inject",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "2",
        "props": [
            {
                "p": "camera",
                "v": "2",
                "vt": "num"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2070,
        "y": 140,
        "wires": [
            [
                "ea1bfad96a237f99"
            ]
        ]
    },
    {
        "id": "7faad5ba012575ba",
        "type": "inject",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "3",
        "props": [
            {
                "p": "camera",
                "v": "3",
                "vt": "num"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2070,
        "y": 180,
        "wires": [
            [
                "ea1bfad96a237f99"
            ]
        ]
    },
    {
        "id": "0af794e0fde7b552",
        "type": "inject",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "1",
        "props": [
            {
                "p": "camera",
                "v": "1",
                "vt": "num"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2070,
        "y": 300,
        "wires": [
            [
                "8b1dfee1eeeb3ef4"
            ]
        ]
    },
    {
        "id": "18ba1d69d118d27d",
        "type": "inject",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "2",
        "props": [
            {
                "p": "camera",
                "v": "2",
                "vt": "num"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2070,
        "y": 340,
        "wires": [
            [
                "8b1dfee1eeeb3ef4"
            ]
        ]
    },
    {
        "id": "1bc44fb0f565f047",
        "type": "inject",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "3",
        "props": [
            {
                "p": "camera",
                "v": "3",
                "vt": "num"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2070,
        "y": 380,
        "wires": [
            [
                "8b1dfee1eeeb3ef4"
            ]
        ]
    },
    {
        "id": "9b88aef505a21571",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "ON",
        "info": "",
        "x": 2070,
        "y": 60,
        "wires": []
    },
    {
        "id": "da3f52fb67b72827",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "OFF",
        "info": "",
        "x": 2070,
        "y": 260,
        "wires": []
    },
    {
        "id": "42a99c5cc72c6983",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "event parsing",
        "func": "// Предыдущее состояние\nvar x_old = msg.joystick.old_state.attributes.x\nvar y_old = msg.joystick.old_state.attributes.y\nvar z_old = msg.joystick.old_state.attributes.zoom \n\n// Новое состояние\nvar x_new = msg.joystick.new_state.attributes.x\nvar y_new = msg.joystick.new_state.attributes.y\nvar z_new = msg.joystick.new_state.attributes.zoom \n\n// Массив выходных сообщений\nvar messages = []\n\nif (z_old != z_new) {\n    messages.push({\n        z: z_new,\n        type: \"zoom\"\n    })\n}\nelse if ((x_old != x_new) || (y_old != y_new)) {\n    messages.push({\n        x: x_new,\n        y: y_new,\n        type: \"pan_tilt\"\n    })\n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 100,
        "wires": [
            [
                "97d5d1f605254950"
            ]
        ]
    },
    {
        "id": "97d5d1f605254950",
        "type": "switch",
        "z": "18bc0562a1dcc64c",
        "name": "switch msg.type",
        "property": "type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "pan_tilt",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "zoom",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 500,
        "y": 100,
        "wires": [
            [
                "76fc97071dbc573b"
            ],
            [
                "dabe0f1a1e47a291"
            ]
        ]
    },
    {
        "id": "76fc97071dbc573b",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "PT_Direct/Speed",
        "func": "var x = msg.x;\nvar y = msg.y;\n\nvar distx;\nvar disty;\nvar speedx;\nvar speedy;\n\nif (x > 0) {\n    distx = 2\n} else if (x < 0) {\n    distx = 1\n} else {\n    distx = 3\n}\n\nif (y > 0) {\n    disty = 1\n} else if (y < 0) {\n    disty = 2\n} else {\n    disty = 3\n}\n\nvar speedcountx = (Math.abs(x)) * 10;\nvar speedcounty = (Math.abs(y)) * 10;\n\nspeedx = parseInt(Math.abs(Math.round(1 + ((9-1)/(10-1))*(speedcountx-1))), 16);\nspeedy = parseInt(Math.abs(Math.round(1 + ((7-1)/(10-1))*(speedcounty-1))), 16);\n\nmsg.payload = Buffer.from([129, 1, 6, 1, speedx, speedy, distx, disty, 255])\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 80,
        "wires": [
            [
                "df23451f99873dd7"
            ]
        ]
    },
    {
        "id": "d1ae4b1448607a66",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "ip + port",
        "func": "var camera = msg.current_values.attributes.camera.toString();\nmsg.host = global.get(\"camera_\" + camera + \"_ip\")\nmsg.port = global.get(\"camera_\" + camera + \"_port\")\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 100,
        "wires": [
            [
                "b1a3618e7632dced"
            ]
        ]
    },
    {
        "id": "27acac2b8af40c5e",
        "type": "tcp request",
        "z": "18bc0562a1dcc64c",
        "name": "tcp request",
        "server": "",
        "port": "",
        "out": "time",
        "ret": "buffer",
        "splitc": "10",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 1390,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "df23451f99873dd7",
        "type": "api-current-state",
        "z": "18bc0562a1dcc64c",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "current_values",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 920,
        "y": 100,
        "wires": [
            [
                "d1ae4b1448607a66"
            ]
        ]
    },
    {
        "id": "dabe0f1a1e47a291",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "Z_Direct/Speed",
        "func": "var z = msg.z;\n\nvar distz;\nvar zz;\n\nvar speedcountz = (Math.abs(z)) * 10;\nvar speedz = Math.abs(Math.round(1 + ((7-1)/(10-1))*(speedcountz-1)));\n\nif (z > 0) {\n    distz = 20\n    zz = 20 + speedz\n} else if (z < 0) {\n    distz = 30\n    zz = 30 + speedz\n} else {\n    distz = 0\n    zz = 0\n}\n\nvar zoom = parseInt(zz, 16)\n\nmsg.payload = Buffer.from([129, 1, 4, 7, zoom, 255])\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 120,
        "wires": [
            [
                "df23451f99873dd7"
            ]
        ]
    },
    {
        "id": "b1a3618e7632dced",
        "type": "delay",
        "z": "18bc0562a1dcc64c",
        "name": "6 msg / 1 s",
        "pauseType": "rate",
        "timeout": "350",
        "timeoutUnits": "milliseconds",
        "rate": "6",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1230,
        "y": 100,
        "wires": [
            [
                "27acac2b8af40c5e"
            ]
        ]
    },
    {
        "id": "96ab6062a0436ca1",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "name": "STATUS",
        "info": "",
        "x": 120,
        "y": 600,
        "wires": []
    },
    {
        "id": "6525ebd0ad7b6564",
        "type": "http request",
        "z": "18bc0562a1dcc64c",
        "name": "ping",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 370,
        "y": 800,
        "wires": [
            [
                "bad2d012f0e1dcdf"
            ]
        ]
    },
    {
        "id": "a801497de9c8e2c9",
        "type": "switch",
        "z": "18bc0562a1dcc64c",
        "name": "status",
        "property": "status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 650,
        "y": 900,
        "wires": [
            [
                "cb8900db17301065"
            ],
            [
                "b38d9317e2738294"
            ]
        ]
    },
    {
        "id": "4ea8c225670c0981",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "status 0 or 2",
        "func": "if (JSON.stringify(msg.payload) == JSON.stringify(Buffer.from([144, 80, 3, 255]))) \n{\n    msg.status = 0;\n}\n/*\nelse // if (JSON.stringify(msg.payload) == JSON.stringify(Buffer.from([144, 80, 2, 255]))) \n{\n    msg.status = 2;\n}\n*/\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 860,
        "wires": [
            [
                "0339b79d68429fd9"
            ]
        ]
    },
    {
        "id": "0339b79d68429fd9",
        "type": "switch",
        "z": "18bc0562a1dcc64c",
        "name": "status",
        "property": "status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1050,
        "y": 800,
        "wires": [
            [
                "7105e01a5e6cacb1"
            ],
            [
                "b38d9317e2738294"
            ]
        ]
    },
    {
        "id": "7105e01a5e6cacb1",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "CAM_PanTiltPosInq",
        "func": "msg.payload = Buffer.from([0x81, 0x09, 0x06, 0x12, 0xFF])\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1280,
        "y": 720,
        "wires": [
            [
                "1aa9b81cac848279"
            ]
        ]
    },
    {
        "id": "1aa9b81cac848279",
        "type": "tcp request",
        "z": "18bc0562a1dcc64c",
        "name": ">",
        "server": "",
        "port": "",
        "out": "time",
        "ret": "buffer",
        "splitc": "10",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 1250,
        "y": 760,
        "wires": [
            [
                "25f3492d12212ab5"
            ]
        ]
    },
    {
        "id": "25f3492d12212ab5",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "status 1 if BAD ANS",
        "func": "if (\n    (msg.payload.length != 11) &&\n    (msg.payload[1] != 80) &&\n    \n    (JSON.stringify(msg.payload) != JSON.stringify(Buffer.from([144, 96, 2, 255]))) &&\n    (JSON.stringify(msg.payload) != JSON.stringify(Buffer.from([144, 65, 255]))) &&\n    (JSON.stringify(msg.payload) != JSON.stringify(Buffer.from([144, 81, 255]))) &&\n    (JSON.stringify(msg.payload) != JSON.stringify(Buffer.from([144, 65, 255, 144, 81, 255]))) &&\n    (JSON.stringify(msg.payload) != JSON.stringify(Buffer.from([144, 66, 255]))) &&\n    (JSON.stringify(msg.payload) != JSON.stringify(Buffer.from([144, 82, 255]))) &&\n    (JSON.stringify(msg.payload) != JSON.stringify(Buffer.from([144, 66, 255, 144, 82, 255])))\n) {\n    msg.status = 1;\n}\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1320,
        "y": 800,
        "wires": [
            [
                "6d7cd083c36bf079"
            ]
        ]
    },
    {
        "id": "f90a8ca96429607c",
        "type": "inject",
        "z": "18bc0562a1dcc64c",
        "name": "init ping",
        "props": [
            {
                "p": "requestTimeout",
                "v": "1000",
                "vt": "num"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 120,
        "y": 640,
        "wires": [
            [
                "e6b7432e1dcc8770"
            ]
        ]
    },
    {
        "id": "9f11e14b29bf0d04",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "URL from HOST",
        "func": "msg.url = msg.host\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 760,
        "wires": [
            [
                "6525ebd0ad7b6564"
            ]
        ]
    },
    {
        "id": "389297e810ff8414",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "set status",
        "func": "var time = Number(global.get(\"time\"));\nif (msg.statusCode == \"ETIMEDOUT\")\n{\n    msg.status = 0\n}\nelse\n{\n    msg.status = 2\n    msg.task = 'SB'\n}\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 860,
        "wires": [
            [
                "a801497de9c8e2c9"
            ]
        ]
    },
    {
        "id": "e6b7432e1dcc8770",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "global cameras",
        "func": "var keys = global.keys()\nvar qty = global.get(\"cameras_qty\")\nkeys = keys.filter((key) => key.includes(\"camera\") && (key.includes(\"ip\") || key.includes(\"port\")));\nvar cameras = []\nfor (let i = 1; i <= qty; i++)\n{\n    var id = i\n    var ip = global.get(keys.find((key) => key.includes(i+\"_ip\")));\n    var port = global.get(keys.find((key) => key.includes(i + \"_port\")));\n    cameras.push({\"id\": id, \"ip\": ip, \"port\": port})\n}\n// msg.cameras = cameras\nmsg.payload = cameras\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 140,
        "y": 680,
        "wires": [
            [
                "409353b431f24bbe"
            ]
        ]
    },
    {
        "id": "4f0b86e41e79114c",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "HOST+PORT",
        "func": "msg.camera = msg.payload[\"id\"]\nmsg.host = msg.payload[\"ip\"]\nmsg.port = msg.payload[\"port\"]\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 720,
        "wires": [
            [
                "9f11e14b29bf0d04"
            ]
        ]
    },
    {
        "id": "409353b431f24bbe",
        "type": "split",
        "z": "18bc0562a1dcc64c",
        "name": "",
        "splt": "",
        "spltType": "str",
        "arraySplt": "1",
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 110,
        "y": 720,
        "wires": [
            [
                "31c46a2561e737aa"
            ]
        ]
    },
    {
        "id": "b0269570ba93d2dc",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "data",
        "func": "// if (msg.status != msg.device_statuses.attributes[\"camera\" + msg.camera.toString()])\n// {\n    // var state = new Date()\n    // state = state.getTime()\n\n    var data = {\n        \"entity_id\": \"sensor.device_statuses\",\n    //    \"state\": state\n    };\n\n    data[\"camera\" + msg.camera.toString()] = msg.status\n\n    msg.payload = {\n        \"domain\": \"python_script\",\n        \"service\": \"set_state\",\n        data\n    }\n    return msg;\n// }",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1430,
        "y": 860,
        "wires": [
            [
                "52b433a6f94e5e1c"
            ]
        ]
    },
    {
        "id": "cb8900db17301065",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "CAM_PowerInq",
        "func": "msg.payload = Buffer.from([0x81, 0x09, 0x04, 0x00, 0xFF])\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 780,
        "wires": [
            [
                "2b8299e6a6871193"
            ]
        ]
    },
    {
        "id": "c6db0d7ac60ed891",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "name": "check SB",
        "info": "",
        "x": 800,
        "y": 600,
        "wires": []
    },
    {
        "id": "1fc6b4c0e1cc0097",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "name": "not pinged (0)",
        "info": "",
        "x": 670,
        "y": 940,
        "wires": []
    },
    {
        "id": "e7cdd1b3e428eaf7",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "name": "pinged (2)",
        "info": "",
        "x": 660,
        "y": 860,
        "wires": []
    },
    {
        "id": "d6e7a573c578a020",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "name": "ON (2)",
        "info": "",
        "x": 1050,
        "y": 760,
        "wires": []
    },
    {
        "id": "d6cb58ba7ca4716c",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "name": "SB (0)",
        "info": "",
        "x": 1050,
        "y": 840,
        "wires": []
    },
    {
        "id": "f021f85ec4f742d9",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "name": "(1)",
        "info": "",
        "x": 1450,
        "y": 760,
        "wires": []
    },
    {
        "id": "91e734f9496cef5f",
        "type": "api-current-state",
        "z": "18bc0562a1dcc64c",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1280,
        "y": 880,
        "wires": [
            [
                "b0269570ba93d2dc"
            ]
        ]
    },
    {
        "id": "0ffbcb9a8ee9e29a",
        "type": "api-call-service",
        "z": "18bc0562a1dcc64c",
        "name": "set new Camera Status",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1990,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "d0c71eda7def1fb9",
        "type": "api-call-service",
        "z": "18bc0562a1dcc64c",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1340,
        "y": 240,
        "wires": [
            [
                "3cd43eebf64934cc"
            ]
        ]
    },
    {
        "id": "945d5b6d0631ce02",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 200,
        "wires": [
            [
                "87f477d779c4002c"
            ]
        ]
    },
    {
        "id": "95d2d0a372b64467",
        "type": "api-current-state",
        "z": "18bc0562a1dcc64c",
        "d": true,
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1320,
        "y": 200,
        "wires": [
            [
                "945d5b6d0631ce02"
            ]
        ]
    },
    {
        "id": "559805b66b9d6731",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "state + 1",
        "func": "msg.payload.data.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 520,
        "wires": [
            [
                "360b16cbad96fc56"
            ]
        ]
    },
    {
        "id": "fe759a947448ed46",
        "type": "api-current-state",
        "z": "18bc0562a1dcc64c",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 600,
        "y": 520,
        "wires": [
            [
                "559805b66b9d6731"
            ]
        ]
    },
    {
        "id": "3d4a71da15caa2d7",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "state + 1",
        "func": "msg.payload.data.state = Number(msg.state) + 1\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 240,
        "wires": [
            [
                "0684db42b2970a9d"
            ]
        ]
    },
    {
        "id": "4d67e2767244ae46",
        "type": "api-current-state",
        "z": "18bc0562a1dcc64c",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 720,
        "y": 240,
        "wires": [
            [
                "3d4a71da15caa2d7"
            ]
        ]
    },
    {
        "id": "01b174728677081c",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "status \"1\"",
        "func": "var data = {\n    \"entity_id\": \"sensor.device_statuses\",\n//    \"state\": msg.state,\n};\n\nvar key = \"camera\" + (msg.camera).toString();\ndata[key] = 1\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 520,
        "wires": [
            [
                "fe759a947448ed46"
            ]
        ]
    },
    {
        "id": "cb6e0f703dece40f",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "state + 1",
        "func": "msg.payload.data.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1540,
        "y": 600,
        "wires": [
            [
                "b596a199126c6020"
            ]
        ]
    },
    {
        "id": "760788cd506e6f9c",
        "type": "api-current-state",
        "z": "18bc0562a1dcc64c",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1400,
        "y": 600,
        "wires": [
            [
                "cb6e0f703dece40f"
            ]
        ]
    },
    {
        "id": "47bd617f9bb4d0a3",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "state + 1",
        "func": "msg.payload.data.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1780,
        "y": 820,
        "wires": [
            [
                "0ffbcb9a8ee9e29a"
            ]
        ]
    },
    {
        "id": "52b433a6f94e5e1c",
        "type": "api-current-state",
        "z": "18bc0562a1dcc64c",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1620,
        "y": 820,
        "wires": [
            [
                "47bd617f9bb4d0a3"
            ]
        ]
    },
    {
        "id": "7a67897ff609295f",
        "type": "switch",
        "z": "18bc0562a1dcc64c",
        "name": "old != new",
        "property": "about.old_state.attributes.homeAssistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "about.new_state.attributes.homeAssistant",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 370,
        "y": 1140,
        "wires": [
            [
                "43a5882db129f6b1"
            ]
        ]
    },
    {
        "id": "43a5882db129f6b1",
        "type": "switch",
        "z": "18bc0562a1dcc64c",
        "name": "new = true",
        "property": "about.new_state.attributes.homeAssistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 550,
        "y": 1140,
        "wires": [
            [
                "a2c5dda798205e32"
            ]
        ]
    },
    {
        "id": "5896b9e5cad8a009",
        "type": "server-state-changed",
        "z": "18bc0562a1dcc64c",
        "name": "about homeAssistant",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.about",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "150",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "about",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 160,
        "y": 1140,
        "wires": [
            [
                "7a67897ff609295f"
            ]
        ]
    },
    {
        "id": "d1736599e1af2769",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "name": "Вызов состояния при включении хоста",
        "info": "",
        "x": 220,
        "y": 1100,
        "wires": []
    },
    {
        "id": "d16b10b36803e90c",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "global cameras",
        "func": "var keys = global.keys()\nvar keys = global.keys()\nvar qty = global.get(\"cameras_qty\")\nkeys = keys.filter((key) => key.includes(\"camera\") && (key.includes(\"ip\") || key.includes(\"port\")));\nvar cameras = []\nfor (let i = 1; i <= qty; i++)\n{\n    var id = i\n    var ip = global.get(keys.find((key) => key.includes(i+\"_ip\")));\n    var port = global.get(keys.find((key) => key.includes(i + \"_port\")));\n    cameras.push({\"id\": id, \"ip\": ip, \"port\": port})\n}\n// msg.cameras = cameras\nmsg.payload = cameras\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 1140,
        "wires": [
            [
                "afc967755c62c707"
            ]
        ]
    },
    {
        "id": "afc967755c62c707",
        "type": "split",
        "z": "18bc0562a1dcc64c",
        "name": "",
        "splt": "",
        "spltType": "str",
        "arraySplt": "1",
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 1010,
        "y": 1140,
        "wires": [
            [
                "ee90867332767c05"
            ]
        ]
    },
    {
        "id": "ee90867332767c05",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "data",
        "func": "// var state = new Date()\n// state = state.getTime()\n\nmsg.camera = msg.payload[\"id\"]\nmsg.host = msg.payload[\"ip\"]\nmsg.port = msg.payload[\"port\"]\n\nvar data = {\n    \"entity_id\": \"sensor.device_statuses\",\n//    \"state\": state\n};\n\ndata[\"camera\" + msg.camera.toString()] = 1 // [status = 0/1/2]\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1150,
        "y": 1140,
        "wires": [
            [
                "07f502068c74c8e1"
            ]
        ]
    },
    {
        "id": "66b5802c87dc518e",
        "type": "tcp request",
        "z": "18bc0562a1dcc64c",
        "name": "tcp request",
        "server": "",
        "port": "",
        "out": "time",
        "ret": "buffer",
        "splitc": "10",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 2110,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "9edbe81ea46ffbc5",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "cmd \"ON\"",
        "func": "msg.cmd = Buffer.from([129, 1, 4, 0, 2, 255])\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 1140,
        "wires": [
            [
                "6b7e63d5baac2c51"
            ]
        ]
    },
    {
        "id": "6b7e63d5baac2c51",
        "type": "api-call-service",
        "z": "18bc0562a1dcc64c",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1760,
        "y": 1140,
        "wires": [
            [
                "b5f6cfb67b2fe70a"
            ]
        ]
    },
    {
        "id": "329784a4cadd34bd",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "state + 1",
        "func": "msg.payload.data.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1420,
        "y": 1140,
        "wires": [
            [
                "9edbe81ea46ffbc5"
            ]
        ]
    },
    {
        "id": "07f502068c74c8e1",
        "type": "api-current-state",
        "z": "18bc0562a1dcc64c",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1280,
        "y": 1140,
        "wires": [
            [
                "329784a4cadd34bd"
            ]
        ]
    },
    {
        "id": "a2c5dda798205e32",
        "type": "delay",
        "z": "18bc0562a1dcc64c",
        "name": "150 ms",
        "pauseType": "delay",
        "timeout": "150",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 700,
        "y": 1140,
        "wires": [
            [
                "d16b10b36803e90c"
            ]
        ]
    },
    {
        "id": "2b8299e6a6871193",
        "type": "tcp request",
        "z": "18bc0562a1dcc64c",
        "name": ">",
        "server": "",
        "port": "",
        "out": "time",
        "ret": "buffer",
        "splitc": "400",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 830,
        "y": 820,
        "wires": [
            [
                "4ea8c225670c0981"
            ]
        ]
    },
    {
        "id": "3cd43eebf64934cc",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "payload",
        "func": "msg.payload = msg.cmd\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 240,
        "wires": [
            [
                "18af0762f9eb305f"
            ]
        ]
    },
    {
        "id": "b5f6cfb67b2fe70a",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "payload",
        "func": "msg.payload = msg.cmd\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1940,
        "y": 1140,
        "wires": [
            [
                "66b5802c87dc518e"
            ]
        ]
    },
    {
        "id": "9fcdfb7621e8c9f2",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "name": "fix",
        "info": "return msg завёл внутрь if",
        "x": 300,
        "y": 520,
        "wires": []
    },
    {
        "id": "bad2d012f0e1dcdf",
        "type": "switch",
        "z": "18bc0562a1dcc64c",
        "name": "ETIMEDOUT?",
        "property": "statusCode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ETIMEDOUT",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 540,
        "y": 800,
        "wires": [
            [
                "6913058929273ffa"
            ],
            [
                "389297e810ff8414"
            ]
        ]
    },
    {
        "id": "0c14e8d6fab3d4bd",
        "type": "api-call-service",
        "z": "18bc0562a1dcc64c",
        "name": "set new Camera Status",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1070,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "cf78bdeb277cdb10",
        "type": "api-current-state",
        "z": "18bc0562a1dcc64c",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 640,
        "y": 660,
        "wires": [
            [
                "1efaa991e163fb3a"
            ]
        ]
    },
    {
        "id": "1efaa991e163fb3a",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "status=0, state+1",
        "func": "var data = {\n    \"entity_id\": \"sensor.device_statuses\",\n    \"state\": Number(msg.state) + 1\n};\n\ndata[\"camera\" + msg.camera.toString()] = 0\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 660,
        "wires": [
            [
                "0c14e8d6fab3d4bd"
            ]
        ]
    },
    {
        "id": "4466678aa464d396",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "set ping_counter_on",
        "func": "flow.set(\"ping_counter_on\" + msg.camera, 0)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "b38d9317e2738294",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "count_on >= max ?",
        "func": "var count = flow.get(\"ping_counter_on\" + msg.camera.toString())\nif (count >= flow.get(\"ping_counter_max\"))\n{\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 900,
        "wires": [
            [
                "91e734f9496cef5f"
            ]
        ]
    },
    {
        "id": "31c46a2561e737aa",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "ping_counter += 1",
        "func": "var count = flow.get(\"ping_counter_on\" + msg.payload.id.toString())\nif (count == undefined) {\n    flow.set(\"ping_counter_on\" + msg.payload.id.toString(), flow.get(\"ping_counter_max\"))\n    flow.set(\"ping_counter_off\" + msg.payload.id.toString(), flow.get(\"ping_counter_max\"))\n}\nelse if (count < flow.get(\"ping_counter_max\")) {\n    flow.set(\"ping_counter_on\" + msg.payload.id.toString(), count + 1)\n    flow.set(\"ping_counter_off\" + msg.payload.id.toString(), count + 1)\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 150,
        "y": 760,
        "wires": [
            [
                "4f0b86e41e79114c"
            ]
        ]
    },
    {
        "id": "6913058929273ffa",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "count_on >= max ?",
        "func": "var count = flow.get(\"ping_counter_on\" + msg.camera.toString())\nif (count >= flow.get(\"ping_counter_max\"))\n{\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 720,
        "wires": [
            [
                "cf78bdeb277cdb10"
            ]
        ]
    },
    {
        "id": "fbda9c2af13bf29f",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "set ping_counter_max",
        "func": "flow.set(\"ping_counter_max\", msg.count)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "74fb3fc6811403d0",
        "type": "inject",
        "z": "18bc0562a1dcc64c",
        "name": "count",
        "props": [
            {
                "p": "count",
                "v": "8",
                "vt": "num"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 610,
        "y": 460,
        "wires": [
            [
                "fbda9c2af13bf29f"
            ]
        ]
    },
    {
        "id": "2cdfe7e589743e55",
        "type": "comment",
        "z": "18bc0562a1dcc64c",
        "name": "fix 278825",
        "info": "return msg завёл внутрь if",
        "x": 820,
        "y": 320,
        "wires": []
    },
    {
        "id": "6d7cd083c36bf079",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "count_off >= max ?",
        "func": "var count = flow.get(\"ping_counter_off\" + msg.camera.toString())\nif (count >= flow.get(\"ping_counter_max\"))\n{\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1270,
        "y": 840,
        "wires": [
            [
                "91e734f9496cef5f"
            ]
        ]
    },
    {
        "id": "8415f9ea3ddb94f2",
        "type": "function",
        "z": "18bc0562a1dcc64c",
        "name": "set ping_counter_off",
        "func": "flow.set(\"ping_counter_off\" + msg.camera, 0)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "250744389193eb5a",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "cameras",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.cameras\",\"state\":{{state}},\"qty\":{{payload}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 2520,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "fbf09f27d3c7efd8",
        "type": "inject",
        "z": "ab576495ae266594",
        "name": "SET QTY",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "state",
                "v": "",
                "vt": "date"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "2",
        "payloadType": "num",
        "x": 2360,
        "y": 160,
        "wires": [
            [
                "250744389193eb5a",
                "041798039c6f9560"
            ]
        ]
    },
    {
        "id": "84e7c39472302b51",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "Количество камер",
        "info": "",
        "x": 2370,
        "y": 100,
        "wires": []
    },
    {
        "id": "041798039c6f9560",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "func",
        "func": "var qty = global.get('cameras_qty');\nvar data = {\n    \"entity_id\": \"sensor.presets\",\n    \"chairs\": []\n};\n\nfor (let i = 1; i <= qty; i++) {\n    let key = \"preset\" + i.toString();\n    data[key] = []\n}\n\nvar state = new Date()\nstate = state.getTime()\ndata['state'] = state\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2510,
        "y": 140,
        "wires": [
            [
                "848b8e76f5a33ef9"
            ]
        ]
    },
    {
        "id": "848b8e76f5a33ef9",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 2640,
        "y": 140,
        "wires": [
            [
                "7f4a1d16e2387a28"
            ]
        ]
    },
    {
        "id": "945b5329b05352c9",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.presets",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "about",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 2900,
        "y": 140,
        "wires": [
            [
                "0fed92b794518221"
            ]
        ]
    },
    {
        "id": "0fed92b794518221",
        "type": "debug",
        "z": "ab576495ae266594",
        "name": "debug 39",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2900,
        "y": 180,
        "wires": []
    },
    {
        "id": "7f4a1d16e2387a28",
        "type": "delay",
        "z": "ab576495ae266594",
        "name": "10ms",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2770,
        "y": 140,
        "wires": [
            [
                "945b5329b05352c9"
            ]
        ]
    },
    {
        "id": "99c414b1ba9b19ac",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 2680,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "2cb45b6bb97afcdc",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "func",
        "func": "var qty = global.get(\"cameras_qty\");\n\nvar data = {\n    \"entity_id\": \"sensor.presets\",\n    \"chairs\": []\n};\n\nvar state = new Date()\nstate = state.getTime()\ndata['state'] = state\n\nvar presets = msg.payload;\n\nfor (let camera = 1; camera <= qty; camera++) { \n    let key = \"preset\" + (camera).toString(); // 0 = sensor.preset1, 1 = sensor.preset2, ...\n\n    data[key] = []\n}\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2490,
        "y": 280,
        "wires": [
            [
                "99c414b1ba9b19ac",
                "05ee96d1ac4f0eea"
            ]
        ]
    },
    {
        "id": "5095e697df04dafc",
        "type": "inject",
        "z": "ab576495ae266594",
        "name": "clear",
        "props": [
            {
                "p": "state",
                "v": "",
                "vt": "date"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2350,
        "y": 280,
        "wires": [
            [
                "2cb45b6bb97afcdc"
            ]
        ]
    },
    {
        "id": "3a0547aa5ac355c0",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.presets",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "presets",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 260,
        "y": 180,
        "wires": [
            [
                "29546e9823d9053c"
            ]
        ]
    },
    {
        "id": "859320249c6f0a0a",
        "type": "server-state-changed",
        "z": "ab576495ae266594",
        "name": "Presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.presets",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "300",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "preset",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 2850,
        "y": 300,
        "wires": [
            [
                "d74e1b715988c789"
            ]
        ]
    },
    {
        "id": "d74e1b715988c789",
        "type": "debug",
        "z": "ab576495ae266594",
        "name": "debug 99",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2980,
        "y": 300,
        "wires": []
    },
    {
        "id": "24a30c414218ea80",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "function 5",
        "func": "// {name: \"Положение 1709110905795\", id: null, chair: null}\n\nvar qty = global.get(\"cameras_qty\");\nvar data = {\n    \"entity_id\": \"sensor.presets\",\n    \"state\": msg.state\n};\n\nvar chairs = []\nvar presets = msg.payload;\n\n\ndata[\"preset1\"] = [{ name: \"c1p1\", id: 1, chair: 1, coordinates: [0.2, 0.2, -0.5]}, { name: \"c1p2\", id: 2, chair: 2, coordinates: [0.3, 0.2, -0.85]}];\ndata[\"preset2\"] = [{ name: \"c2p1\", id: 1, chair: 4, coordinates: [-0.777, 0.029, -1] }, { name: \"c2p2\", id: 2, chair: 5, coordinates: [-0.677, 0.029, -0.39]}];\ndata[\"preset3\"] = [{ name: \"c2p1\", id: 1, chair: 0}];\ndata[\"chairs\"] = [0,1,2,4,5]\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2500,
        "y": 320,
        "wires": [
            [
                "99c414b1ba9b19ac",
                "05ee96d1ac4f0eea"
            ]
        ]
    },
    {
        "id": "0800e7e5cd29029e",
        "type": "inject",
        "z": "ab576495ae266594",
        "name": "init",
        "props": [
            {
                "p": "state",
                "v": "",
                "vt": "date"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2350,
        "y": 320,
        "wires": [
            [
                "24a30c414218ea80"
            ]
        ]
    },
    {
        "id": "844fd0298f017b2f",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "presets managment",
        "func": "// Все кресла из того, что были в пресетах:\nlet chairs = []\nlet qty = global.get(\"cameras_qty\");\nfor (let camera = 1; camera <= qty; camera++) {\n    let key = \"preset\" + (camera).toString(); // 1 = sensor.preset1, 2 = sensor.preset2, ...\n    for (let i = 0; i < msg.presets.attributes[key].length; i++) {\n        if (msg.presets.attributes[key][i]['chair'] != null) {\n            chairs.push(msg.presets.attributes[key][i]['chair'])\n        }\n    }\n}\n// node.warn(qty)\n// node.warn(chairs)\n\nlet preset = msg.save_preset.new_state.attributes.preset; // preset = [name, chair, id, coordinates] из save_preset\nlet index = msg.save_preset.new_state.attributes.index; // Индекс пресета в списке карточки\n\n// save_preset:\nlet name = preset['name']\nlet chair = preset['chair']\nnode.warn(\"chair\")\nnode.warn(chair)\nlet id = preset['id']\nlet coordinates = preset['coordinates']\n\n\nlet camera_number = msg.save_preset.new_state.attributes.camera; // - камера, пресеты который мы менеджерим сейчас\nlet key = \"preset\" + (camera_number).toString(); // 1 = sensor.preset1, 2 = sensor.preset2, ...\nlet presets_of_camera = msg.presets.attributes[key] //  пресеты этой камеры\n\n\nif (presets_of_camera[index]) // Если есть такой пресет:\n{\n    if (presets_of_camera[index]['name'] != name) // Если пресет просто переименовывается:\n    {\n        presets_of_camera[index]['name'] = name\n    }\n    else {\n        let prev_chair = presets_of_camera[index]['chair']\n        if (chair === null) // Если просто удаляем кресло:\n        {   // ТУТ БАГ\n            node.warn('Просто удаляем кресло')\n            msg.presets.attributes[key][index]['chair'] = null\n            chairs.splice(chairs.indexOf(prev_chair), 1);\n        }\n        else // Если назначаем кресло:\n        {\n            if (!chairs.includes(chair)) // Если назначаем кресло, которого нет в списке:\n            {\n                node.warn('Назначаем кресло, которого нет в списке')\n                msg.presets.attributes[key][index]['chair'] = chair\n                chairs.push(chair)\n                if (prev_chair != null) {\n                    chairs.splice(chairs.indexOf(prev_chair), 1);\n                }\n            }\n            else // Если назначаем кресло, которое есть в списке:\n            {\n                node.warn('Назначаем кресло, которое есть в списке')\n                // Теперь нужен цикл по всем пресетам, чтобы найти занятое кресло:\n                let qty = global.get(\"cameras_qty\");\n                for (let camera = 1; camera <= qty; camera++) {\n                    let key = \"preset\" + (camera).toString(); // 1 = sensor.preset1, 2 = sensor.preset2, ...\n                    for (let i = 0; i < msg.presets.attributes[key].length; i++) {\n                        if (msg.presets.attributes[key][i]['chair'] == chair) {\n                            msg.presets.attributes[key][i]['chair'] = null\n                        }\n                    }\n\n                }\n                msg.presets.attributes[key][index]['chair'] = chair\n                chairs.push(chair)\n                chairs.splice(chairs.indexOf(prev_chair), 1);\n            }\n        }\n    }\n}\nelse\n// Нет такого пресета, т.е. добавляем новый:\n{\n    // ID всех пресетов камеры:\n    let ids = []\n    for (let i = 0; i < presets_of_camera.length; i++) {\n        ids.push(presets_of_camera[i]['id'])\n    }\n    let id = 1;\n    while (true) {\n        if (!(ids.includes(id))) {\n            break;\n        }\n        id += 1;\n    }\n    msg.presets.attributes[key].push({ 'name': name, 'id': id, 'chair': chair, 'coordinates': coordinates })\n}\n\nmsg.redrawed_presets = msg.presets.attributes;\nmsg.chair = chair\nmsg.chairs = chairs\nreturn msg\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 160,
        "wires": [
            [
                "e80d1879f90efa74"
            ]
        ]
    },
    {
        "id": "59e515d0a6c8943e",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "to sensor.presets",
        "func": "var data = {\n    \"entity_id\": \"sensor.presets\",\n    \"state\": msg.state\n};\n\nvar presets = msg.payload;\n\n// Даю пресеты\nlet qty = global.get(\"cameras_qty\");\n    for (let camera = 1; camera <= qty; camera++) { \n        let key = \"preset\" + (camera).toString(); // 1 = sensor.preset1, 2 = sensor.preset2, ...\n        data[key] = msg.redrawed_presets[key]\n}\n\n\ndata[\"chairs\"] = msg.chairs\n\n\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1410,
        "y": 160,
        "wires": [
            [
                "26f189e54adb7760"
            ]
        ]
    },
    {
        "id": "26f189e54adb7760",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1580,
        "y": 160,
        "wires": [
            [
                "febd3985bcae00ed"
            ]
        ]
    },
    {
        "id": "571b102af8d7c71e",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.presets",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "presets",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 260,
        "y": 300,
        "wires": [
            [
                "67b73f91e4759016"
            ]
        ]
    },
    {
        "id": "67b73f91e4759016",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "presets managment",
        "func": "let camera_number = msg.delete_preset.new_state.attributes.camera; // - камера, пресеты который мы менеджерим сейчас\nlet key = \"preset\" + (camera_number).toString(); // 1 = sensor.preset1, 2 = sensor.preset2, ...\nlet presets_of_camera = msg.presets.attributes[key] //  пресеты этой камеры\n\n// let preset = msg.save_preset.new_state.attributes.presets; // preset = [name, chair, id, coordinates] из SavePreset\nlet index = msg.delete_preset.new_state.attributes.index; // Индекс пресета в списке карточки\n\nlet data = {};\n\nlet chairs = []\nlet qty = global.get(\"cameras_qty\");\nfor (let camera = 1; camera <= qty; camera++) { \n    let key = \"preset\" + (camera).toString(); // 1 = sensor.preset1, 2 = sensor.preset2, ...\n    data[key] = msg.presets.attributes[key]\n    for (let i = 0; i < msg.presets.attributes[key].length; i++) {\n        if (msg.presets.attributes[key][i]['chair'] != null)\n        {\n            chairs.push(msg.presets.attributes[key][i]['chair'])\n        }\n    }\n}\n\n// Удаляем пресет и стул:\nlet chair = presets_of_camera[index]['chair']\npresets_of_camera.splice(index, 1);\n\nif ((chairs != null) && (chairs.indexOf(chair) != -1))\n{\n    chairs.splice(chairs.indexOf(chair), 1);\n}\n\nmsg.redrawed_presets = data\nmsg.chair = chair\nmsg.chairs = chairs\nmsg.index = index\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 300,
        "wires": [
            [
                "718bbe120330b8ec"
            ]
        ]
    },
    {
        "id": "2caf016f0badec92",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "to sensor.presets",
        "func": "var data = {\n    \"entity_id\": \"sensor.presets\",\n    \"state\": msg.state\n};\n\ndata['chairs'] = msg.chairs\n\nvar presets = msg.payload;\n\n\nlet qty = global.get(\"cameras_qty\");\nfor (let camera = 1; camera <= qty; camera++) {\n    let key = \"preset\" + (camera).toString(); // 1 = sensor.preset1, 2 = sensor.preset2, ...\n    data[key] = msg.redrawed_presets[key]\n}\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 300,
        "wires": [
            [
                "3382d62fbc306475"
            ]
        ]
    },
    {
        "id": "3382d62fbc306475",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1280,
        "y": 300,
        "wires": [
            [
                "14aad3968f9754d9"
            ]
        ]
    },
    {
        "id": "6dcfad3e10b61fae",
        "type": "server-state-changed",
        "z": "ab576495ae266594",
        "name": "refresh",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.refresh",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": 0,
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "refresh",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 90,
        "y": 420,
        "wires": [
            [
                "3c206f87815e4b8a"
            ]
        ]
    },
    {
        "id": "febd3985bcae00ed",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "current_values",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1740,
        "y": 160,
        "wires": [
            [
                "952a517d5f446252"
            ]
        ]
    },
    {
        "id": "68bdb40ea64ea54f",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "func (#280682)",
        "func": "var curr_camera = msg.current_values.attributes.camera\nlet curr_key = \"preset\" + (curr_camera).toString();\nvar curr_index = msg.current_values.attributes[curr_key]\n\nvar save_camera = msg.save_preset.new_state.attributes.camera\nvar save_index = msg.save_preset.new_state.attributes.index\n\nvar place = msg.save_preset.new_state.attributes.preset['chair']\n\nvar data = {\n    \"entity_id\": \"sensor.current_values\",\n    \"state\": msg.state,\n};\n\n// Если пересохраняю выбранный:\nif (save_index == curr_index && save_camera == curr_camera) {\n    if (place == null) {\n        data[\"chair\"] = -1\n    }\n    else {\n        data[\"chair\"] = place\n    }\n}\nelse if (place == msg.current_values.attributes.chair) {\n    data[\"chair\"] = -1\n}\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1880,
        "y": 220,
        "wires": [
            [
                "225fc8405813c2fe"
            ]
        ]
    },
    {
        "id": "225fc8405813c2fe",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 2080,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "4aba7a7b3702061b",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "Сброс выделения кресла с удаляемого кресла",
        "info": "",
        "x": 1920,
        "y": 120,
        "wires": []
    },
    {
        "id": "88b96079f263aac9",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "Сброс выедления кресла при удалении активного пресета",
        "info": "",
        "x": 1600,
        "y": 260,
        "wires": []
    },
    {
        "id": "433f57793b5a3755",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1780,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "53f3d6f9dc9d5b1f",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "func",
        "func": "var index = msg.index\nvar camera = msg.current_values.attributes.camera\nvar preset = msg.current_values.attributes[\"preset\" + camera.toString()];\n\nif (index == preset) {\n    var key = \"preset\" + camera.toString();\n    var data = {\n        \"entity_id\": \"sensor.current_values\",\n        \"state\": msg.state,\n        \"preset\": -1,\n        \"chair\": -1,\n    };\n    \n    data[key] = -1\n\n    msg.payload = {\n        \"domain\": \"python_script\",\n        \"service\": \"set_state\",\n        data\n    }\n\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1610,
        "y": 360,
        "wires": [
            [
                "433f57793b5a3755"
            ]
        ]
    },
    {
        "id": "14aad3968f9754d9",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "current_values",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1440,
        "y": 300,
        "wires": [
            [
                "6a31dba6c9eea4f4"
            ]
        ]
    },
    {
        "id": "f74b078f1d3f33b6",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "Добавление пресета",
        "info": "",
        "x": 140,
        "y": 140,
        "wires": []
    },
    {
        "id": "03e5cc0538ab4839",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "Удаление пресета",
        "info": "",
        "x": 130,
        "y": 260,
        "wires": []
    },
    {
        "id": "9573a6972acebcde",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "Обновление списка пресетов",
        "info": "",
        "x": 170,
        "y": 380,
        "wires": []
    },
    {
        "id": "0f0b825bf41a5eed",
        "type": "server-state-changed",
        "z": "ab576495ae266594",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.current_values",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "current_values",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 120,
        "y": 80,
        "wires": [
            [
                "bcfd4b9b78f5597c"
            ]
        ]
    },
    {
        "id": "8378b40257a07a1f",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.current_values\", \"camera\":{{camera}}, \"chair\":{{chair}}, \"preset\":{{preset}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 620,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "99e0f359333555fa",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "camera | chair",
        "func": "var camera = msg.current_values.new_state.attributes.camera;\nvar old_camera = msg.current_values.old_state.attributes.camera;\n\nif (old_camera != camera) {\n    var key = \"preset\" + camera.toString()\n    var active_preset_of_camera = msg.current_values.new_state.attributes[key];\n    // var state = msg.current_values.new_state.state;\n\n    var presets_of_camera = msg.presets.attributes[key]\n    var chair = -1\n    if (active_preset_of_camera != -1)\n    {\n        if (presets_of_camera[active_preset_of_camera]['chair'] != null) {\n            chair = presets_of_camera[active_preset_of_camera]['chair']\n        }\n    }\n    return {\n        // state: state,\n        camera: camera,\n        chair: chair,\n        preset: active_preset_of_camera\n    }\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 80,
        "wires": [
            [
                "8378b40257a07a1f"
            ]
        ]
    },
    {
        "id": "3078d50cfbea0ac6",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "Переключение камер",
        "info": "",
        "x": 140,
        "y": 40,
        "wires": []
    },
    {
        "id": "be0473eef3987cfc",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "Вызов пресета",
        "info": "",
        "x": 120,
        "y": 820,
        "wires": []
    },
    {
        "id": "efc566e1bba16e33",
        "type": "server-state-changed",
        "z": "ab576495ae266594",
        "name": "chair",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.chair",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": 0,
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "chair",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 90,
        "y": 540,
        "wires": [
            [
                "d52e25f7aeab36e6"
            ]
        ]
    },
    {
        "id": "0ca16b46d6c73c8b",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "state | camera | index",
        "func": "var state = new Date()\nmsg.state = state.getTime()\n\nvar chair = msg.chair.new_state.attributes.chair;\n\n// Цикл по всем пресетам, чтобы найти занятое кресло:\nlet qty = global.get(\"cameras_qty\");\nfor (let camera = 1; camera <= qty; camera++) { \n    let key = \"preset\" + camera.toString(); // 1 = sensor.preset1, 2 = sensor.preset2, ...\n    for (let i = 0; i < msg.presets.attributes[key].length; i++) {\n        if (msg.presets.attributes[key][i]['chair'] == chair) {\n            msg.camera = camera\n            msg.index = i\n            return msg\n        }\n    }\n}\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 540,
        "wires": [
            [
                "01492ef485b3ad09",
                "17799152c1e65ef5"
            ]
        ]
    },
    {
        "id": "3b5cbba66b8b779e",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "Нажатие на кресло",
        "info": "",
        "x": 130,
        "y": 500,
        "wires": []
    },
    {
        "id": "28b3493f2dd5cc5e",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "call_preset",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.call_preset\",\"state\":{{state}}, \"index\":{{index}}, \"camera\":{{camera}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1070,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "a3511578400785ea",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "d": true,
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1120,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "7d3ee5198c687f16",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1240,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "82a2d948655a8721",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "func",
        "func": "var data = {\n    \"entity_id\": \"sensor.current_values\",\n    \"state\": msg.state,\n    \"preset\": msg.index,\n    \"chair\": msg.chair,\n    \"camera\": msg.camera\n};\n\ndata[\"preset\" + msg.camera.toString()] = msg.index\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 840,
        "wires": [
            [
                "7d3ee5198c687f16"
            ]
        ]
    },
    {
        "id": "07fb73fd40124ba6",
        "type": "function",
        "z": "ab576495ae266594",
        "d": true,
        "name": "func",
        "func": "var data = {\n    \"entity_id\": \"sensor.current_values\",\n    \"state\": msg.state,\n    \"camera\": msg.camera\n};\n\nvar key = \"preset\" + msg.camera.toString();\ndata[key] = msg.index\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 500,
        "wires": [
            [
                "a3511578400785ea"
            ]
        ]
    },
    {
        "id": "373d074e584a7dd3",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "(определение пресета по креслу)",
        "info": "",
        "x": 440,
        "y": 500,
        "wires": []
    },
    {
        "id": "bcfd4b9b78f5597c",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.presets",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "presets",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 280,
        "y": 80,
        "wires": [
            [
                "99e0f359333555fa"
            ]
        ]
    },
    {
        "id": "902e165e4f45528c",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "index | camera",
        "func": "var index = msg.call_preset.new_state.attributes.index;\nvar camera = msg.call_preset.new_state.attributes.camera;\n\n\nvar key = \"preset\" + camera.toString()\nvar presets_of_camera = msg.presets.attributes[key]\n\nvar chair = presets_of_camera[index]['chair']\nif (chair == null) {\n    chair = -1\n}\n\nvar coordinates = presets_of_camera[index]['coordinates']\n\nreturn {\n    index: index,\n    chair: chair,\n    camera: camera,\n    coordinates: coordinates\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 860,
        "wires": [
            [
                "adb7911ee0beb257",
                "5d8ebd53600a13e0"
            ]
        ]
    },
    {
        "id": "174d423786b4f203",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.presets",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "presets",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 240,
        "y": 860,
        "wires": [
            [
                "902e165e4f45528c"
            ]
        ]
    },
    {
        "id": "d52e25f7aeab36e6",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.presets",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "presets",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 220,
        "y": 540,
        "wires": [
            [
                "0ca16b46d6c73c8b"
            ]
        ]
    },
    {
        "id": "0f8c9a7c88132a91",
        "type": "function",
        "z": "ab576495ae266594",
        "d": true,
        "name": "abs PTZ",
        "func": "let coordinates = msg.coordinates // [float, float, float]\n\nlet pan = Math.round(coordinates['pan'] * 2448);\nif (pan < 0) {\n    pan = Math.pow(2, 16) + pan;\n}\nlet panHex = pan.toString(16);\nlet pan_bytes = Array.from(panHex, el => parseInt(el, 16));\nif (pan_bytes.length < 4) {\n    pan_bytes = Array(4 - pan_bytes.length).fill(0).concat(pan_bytes);\n}\n\nnode.warn(pan)\nnode.warn(pan_bytes)\n\nlet tilt = Math.round(coordinates['tilt'] * 1296);\nif (tilt < 0) {\n    tilt = Math.pow(2, 16) + tilt;\n}\nlet tiltHex = tilt.toString(16);\nlet tilt_bytes = Array.from(tiltHex, el => parseInt(el, 16));\nif (tilt_bytes.length < 4) {\n    tilt_bytes = Array(4 - tilt_bytes.length).fill(0).concat(tilt_bytes);\n}\n\nlet zoom = Math.round(coordinates['zoom'] * 8192) + 8192;\nlet zoomHex = zoom.toString(16);\nlet zoom_bytes = Array.from(zoomHex, el => parseInt(el, 16));\nif (zoom_bytes.length < 4) {\n    zoom_bytes = Array(4 - zoom_bytes.length).fill(0).concat(zoom_bytes);\n}\n\nlet connection_id = this.connection_id; // Assuming 'this.connection_id' is defined in your context\nlet cmd_pantilt = [0x81, 1, 6, 2, 20, 24].concat(pan_bytes).concat(tilt_bytes).concat([255]);\nlet cmd_zoom = [0x81, 1, 4, 71].concat(zoom_bytes).concat([255]);\n\n// Массив выходных сообщений\nvar messages = []\nmessages.push({payload: Buffer.from(cmd_pantilt)})\nmessages.push({payload: Buffer.from(cmd_zoom)})\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2540,
        "y": 500,
        "wires": [
            [
                "dfde65c65e1c0076"
            ]
        ]
    },
    {
        "id": "2c1e90689095be56",
        "type": "comment",
        "z": "ab576495ae266594",
        "d": true,
        "name": "abs PTZ",
        "info": "",
        "x": 2340,
        "y": 400,
        "wires": []
    },
    {
        "id": "dfde65c65e1c0076",
        "type": "delay",
        "z": "ab576495ae266594",
        "d": true,
        "name": "5 msg / 1 s",
        "pauseType": "rate",
        "timeout": "350",
        "timeoutUnits": "milliseconds",
        "rate": "10",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2690,
        "y": 500,
        "wires": [
            [
                "a3ed35fd807b4404"
            ]
        ]
    },
    {
        "id": "a3ed35fd807b4404",
        "type": "function",
        "z": "ab576495ae266594",
        "d": true,
        "name": "HOST+PORT",
        "func": "msg.host = global.get(\"camera_1_ip\")\nmsg.port = global.get(\"camera_1_port\")\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2880,
        "y": 500,
        "wires": [
            [
                "40eec75ed1cd5a41"
            ]
        ]
    },
    {
        "id": "40eec75ed1cd5a41",
        "type": "tcp request",
        "z": "ab576495ae266594",
        "d": true,
        "name": "tcp request",
        "server": "",
        "port": "",
        "out": "time",
        "ret": "buffer",
        "splitc": "10",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 3070,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "5fa70bcbdce38ef1",
        "type": "inject",
        "z": "ab576495ae266594",
        "d": true,
        "name": "[0.5, 0, 0]",
        "props": [
            {
                "p": "coordinates",
                "v": "{'pan': 0.5, 'tilt': 0, 'zoom': 0}",
                "vt": "jsonata"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2360,
        "y": 480,
        "wires": [
            [
                "0f8c9a7c88132a91"
            ]
        ]
    },
    {
        "id": "7b87dc84bbd39b20",
        "type": "inject",
        "z": "ab576495ae266594",
        "d": true,
        "name": "[-0.5, 0, 0]",
        "props": [
            {
                "p": "coordinates",
                "v": "{'pan': -0.5, 'tilt': 0, 'zoom': 0}",
                "vt": "jsonata"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2360,
        "y": 520,
        "wires": [
            [
                "0f8c9a7c88132a91"
            ]
        ]
    },
    {
        "id": "af930e7cebf99d88",
        "type": "inject",
        "z": "ab576495ae266594",
        "d": true,
        "name": "[1, 0, 0]",
        "props": [
            {
                "p": "coordinates",
                "v": "{'pan': 1, 'tilt': 0, 'zoom': 0}",
                "vt": "jsonata"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2350,
        "y": 440,
        "wires": [
            [
                "0f8c9a7c88132a91"
            ]
        ]
    },
    {
        "id": "93df940913b76d9d",
        "type": "inject",
        "z": "ab576495ae266594",
        "d": true,
        "name": "[-1, 0, 0]",
        "props": [
            {
                "p": "coordinates",
                "v": "{'pan': -1, 'tilt': 0, 'zoom': 0}",
                "vt": "jsonata"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2360,
        "y": 560,
        "wires": [
            [
                "0f8c9a7c88132a91"
            ]
        ]
    },
    {
        "id": "60dca77ba8fce9e0",
        "type": "function",
        "z": "ab576495ae266594",
        "d": true,
        "name": "CMD_GET_PAN_TILT",
        "func": "var CMD_GET_PAN_TILT = [0x81, 0x09, 0x06, 0x12, 0xFF]\nmsg.payload= Buffer.from(CMD_GET_PAN_TILT)\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2700,
        "y": 700,
        "wires": [
            [
                "3a631d1e106c4970"
            ]
        ]
    },
    {
        "id": "c842cb91617daba0",
        "type": "function",
        "z": "ab576495ae266594",
        "d": true,
        "name": "HOST+PORT",
        "func": "msg.host = global.get(\"camera_1_ip\")\nmsg.port = global.get(\"camera_1_port\")\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2500,
        "y": 700,
        "wires": [
            [
                "60dca77ba8fce9e0"
            ]
        ]
    },
    {
        "id": "3a631d1e106c4970",
        "type": "tcp request",
        "z": "ab576495ae266594",
        "d": true,
        "name": "tcp request",
        "server": "",
        "port": "",
        "out": "time",
        "ret": "buffer",
        "splitc": "10",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 2730,
        "y": 740,
        "wires": [
            [
                "0b2c956a23e86482"
            ]
        ]
    },
    {
        "id": "737bbddf8f1ffbdb",
        "type": "inject",
        "z": "ab576495ae266594",
        "d": true,
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2350,
        "y": 700,
        "wires": [
            [
                "c842cb91617daba0"
            ]
        ]
    },
    {
        "id": "0b2c956a23e86482",
        "type": "function",
        "z": "ab576495ae266594",
        "d": true,
        "name": "save PAN TILT",
        "func": "msg.pan_tilt = msg.payload\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2720,
        "y": 780,
        "wires": [
            [
                "0a719163010bddf2"
            ]
        ]
    },
    {
        "id": "0a719163010bddf2",
        "type": "function",
        "z": "ab576495ae266594",
        "d": true,
        "name": "CMD_GET_ZOOM",
        "func": "var CMD_GET_ZOOM = [0x81, 0x09, 0x04, 0x47, 0xFF]\nmsg.payload = Buffer.from(CMD_GET_ZOOM)\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2710,
        "y": 820,
        "wires": [
            [
                "60fbd6f680cf057a"
            ]
        ]
    },
    {
        "id": "60fbd6f680cf057a",
        "type": "tcp request",
        "z": "ab576495ae266594",
        "d": true,
        "name": "tcp request",
        "server": "",
        "port": "",
        "out": "time",
        "ret": "buffer",
        "splitc": "10",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 2730,
        "y": 860,
        "wires": [
            [
                "ad445fdb339049c8"
            ]
        ]
    },
    {
        "id": "ad445fdb339049c8",
        "type": "function",
        "z": "ab576495ae266594",
        "d": true,
        "name": "save ZOOM",
        "func": "msg.zoom = msg.payload\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2750,
        "y": 900,
        "wires": [
            [
                "d4731c6d164e2f16"
            ]
        ]
    },
    {
        "id": "a03b4d8fc71b86a8",
        "type": "debug",
        "z": "ab576495ae266594",
        "d": true,
        "name": "debug 72",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 3040,
        "y": 900,
        "wires": []
    },
    {
        "id": "d4731c6d164e2f16",
        "type": "function",
        "z": "ab576495ae266594",
        "d": true,
        "name": "save PTZ",
        "func": "const pan_tilt = msg.pan_tilt\nconst zoom = msg.zoom\n\nconst pan_bytes = pan_tilt.slice(2, 6);\nlet pan_sum = pan_bytes.reduce((acc, el, i) => acc + el * Math.pow(16, pan_bytes.length - 1 - i), 0);\nif (pan_sum >= Math.pow(2, 16) - 2448) {\n    pan_sum -= Math.pow(2, 16);\n}\nconst pan_pos = Math.round(pan_sum / 2448 * 1000) / 1000;\nconst tilt_bytes = pan_tilt.slice(6, 10);\nlet tilt_sum = tilt_bytes.reduce((acc, el, i) => acc + el * Math.pow(16, tilt_bytes.length - 1 - i), 0);\nif (tilt_sum >= Math.pow(2, 16) - 1296) {\n    tilt_sum -= Math.pow(2, 16);\n}\nconst tilt_pos = Math.round(tilt_sum / 1296 * 1000) / 1000;\nconst zoom_bytes = zoom.slice(2, 6);\nlet zoom_sum = zoom_bytes.reduce((acc, el, i) => acc + el * Math.pow(16, zoom_bytes.length - 1 - i), 0);\nconst zoom_pos = Math.round((zoom_sum / 8192 - 1) * 100) / 100;\n\nreturn {pan_pos: pan_pos, tilt_pos: tilt_pos, zoom_pos: zoom_pos};\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2900,
        "y": 900,
        "wires": [
            [
                "a03b4d8fc71b86a8"
            ]
        ]
    },
    {
        "id": "639746fc1b530598",
        "type": "comment",
        "z": "ab576495ae266594",
        "d": true,
        "name": "save PTZ",
        "info": "",
        "x": 2340,
        "y": 660,
        "wires": []
    },
    {
        "id": "2129807e8ec4875e",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "CMD_GET_PAN_TILT",
        "func": "var CMD_GET_PAN_TILT = [0x81, 0x09, 0x06, 0x12, 0xFF]\nmsg.payload= Buffer.from(CMD_GET_PAN_TILT)\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 660,
        "wires": [
            [
                "d6df7e49c964e2cc"
            ]
        ]
    },
    {
        "id": "32e24e3ed238e8c1",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "HOST+PORT",
        "func": "let camera = msg.save_position.new_state.attributes.camera.toString()\nlet index = msg.save_position.new_state.attributes.index\nlet host = global.get(\"camera_\" + camera + \"_ip\")\nlet port = global.get(\"camera_\" + camera + \"_port\")\n \nreturn {camera: camera, index: index, host: host, port: port}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 120,
        "y": 740,
        "wires": [
            [
                "2129807e8ec4875e"
            ]
        ]
    },
    {
        "id": "d6df7e49c964e2cc",
        "type": "tcp request",
        "z": "ab576495ae266594",
        "name": "tcp request",
        "server": "",
        "port": "",
        "out": "time",
        "ret": "buffer",
        "splitc": "10",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 610,
        "y": 660,
        "wires": [
            [
                "e440cb4ae3432cc7"
            ]
        ]
    },
    {
        "id": "e440cb4ae3432cc7",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "save PAN TILT",
        "func": "msg.pan_tilt = msg.payload\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 660,
        "wires": [
            [
                "2191fe4984138c3a"
            ]
        ]
    },
    {
        "id": "2191fe4984138c3a",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "CMD_GET_ZOOM",
        "func": "var CMD_GET_ZOOM = [0x81, 0x09, 0x04, 0x47, 0xFF]\nmsg.payload = Buffer.from(CMD_GET_ZOOM)\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 700,
        "wires": [
            [
                "9f554d1a66577183"
            ]
        ]
    },
    {
        "id": "9f554d1a66577183",
        "type": "tcp request",
        "z": "ab576495ae266594",
        "name": "tcp request",
        "server": "",
        "port": "",
        "out": "time",
        "ret": "buffer",
        "splitc": "10",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 610,
        "y": 700,
        "wires": [
            [
                "fec19af6e7bc6577"
            ]
        ]
    },
    {
        "id": "fec19af6e7bc6577",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "save ZOOM",
        "func": "msg.zoom = msg.payload\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 700,
        "wires": [
            [
                "022f225e0628d372"
            ]
        ]
    },
    {
        "id": "022f225e0628d372",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "save PTZ",
        "func": "const pan_tilt = msg.pan_tilt\nconst zoom = msg.zoom\n\nconst pan_bytes = pan_tilt.slice(2, 6);\nlet pan_sum = pan_bytes.reduce((acc, el, i) => acc + el * Math.pow(16, pan_bytes.length - 1 - i), 0);\nif (pan_sum >= Math.pow(2, 16) - 2448) {\n    pan_sum -= Math.pow(2, 16);\n}\nconst pan_pos = Math.round(pan_sum / 2448 * 1000) / 1000;\nconst tilt_bytes = pan_tilt.slice(6, 10);\nlet tilt_sum = tilt_bytes.reduce((acc, el, i) => acc + el * Math.pow(16, tilt_bytes.length - 1 - i), 0);\nif (tilt_sum >= Math.pow(2, 16) - 1296) {\n    tilt_sum -= Math.pow(2, 16);\n}\nconst tilt_pos = Math.round(tilt_sum / 1296 * 1000) / 1000;\nconst zoom_bytes = zoom.slice(2, 6);\nlet zoom_sum = zoom_bytes.reduce((acc, el, i) => acc + el * Math.pow(16, zoom_bytes.length - 1 - i), 0);\nconst zoom_pos = Math.round((zoom_sum / 8192 - 1) * 100) / 100;\n\nmsg.coordinates = [pan_pos, tilt_pos, zoom_pos]\n\nreturn msg\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 740,
        "wires": [
            [
                "cec9be4b8979b578"
            ]
        ]
    },
    {
        "id": "ca6fcbd75ed5b08d",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "Сохранение положения",
        "info": "",
        "x": 150,
        "y": 660,
        "wires": []
    },
    {
        "id": "01a5594e5b7197d6",
        "type": "server-state-changed",
        "z": "ab576495ae266594",
        "name": "save_position",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.save_position",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": 0,
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "save_position",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 110,
        "y": 700,
        "wires": [
            [
                "32e24e3ed238e8c1"
            ]
        ]
    },
    {
        "id": "cec9be4b8979b578",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.presets",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "presets",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 520,
        "y": 740,
        "wires": [
            [
                "6a81990d167781e8"
            ]
        ]
    },
    {
        "id": "b61c83d801faf3d0",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "to sensor.presets",
        "func": "var data = {\n    \"entity_id\": \"sensor.presets\",\n    \"state\": Number(msg.presets.state) + 1\n};\n\nlet index = msg.index\nlet key = \"preset\" + msg.camera;\nmsg.presets.attributes[key][index]['coordinates'] = msg.coordinates\ndata[key] = msg.presets.attributes[key]\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 740,
        "wires": [
            [
                "b82c44eb5745e0b5"
            ]
        ]
    },
    {
        "id": "b82c44eb5745e0b5",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1060,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "adb7911ee0beb257",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "abs PTZ",
        "func": "let coordinates = {'pan': msg.coordinates[0], 'tilt': msg.coordinates[1], 'zoom': msg.coordinates[2]} // [float, float, float]\nlet pan = Math.round(coordinates['pan'] * 2448);\nif (pan < 0) {\n    pan = Math.pow(2, 16) + pan;\n}\nlet panHex = pan.toString(16);\nlet pan_bytes = Array.from(panHex, el => parseInt(el, 16));\nif (pan_bytes.length < 4) {\n    pan_bytes = Array(4 - pan_bytes.length).fill(0).concat(pan_bytes);\n}\n\nlet tilt = Math.round(coordinates['tilt'] * 1296);\nif (tilt < 0) {\n    tilt = Math.pow(2, 16) + tilt;\n}\nlet tiltHex = tilt.toString(16);\nlet tilt_bytes = Array.from(tiltHex, el => parseInt(el, 16));\nif (tilt_bytes.length < 4) {\n    tilt_bytes = Array(4 - tilt_bytes.length).fill(0).concat(tilt_bytes);\n}\n\nlet zoom = Math.round(coordinates['zoom'] * 8192) + 8192;\nlet zoomHex = zoom.toString(16);\nlet zoom_bytes = Array.from(zoomHex, el => parseInt(el, 16));\nif (zoom_bytes.length < 4) {\n    zoom_bytes = Array(4 - zoom_bytes.length).fill(0).concat(zoom_bytes);\n}\n\nlet connection_id = this.connection_id; // Assuming 'this.connection_id' is defined in your context\nlet cmd_pantilt = [0x81, 1, 6, 2, 20, 24].concat(pan_bytes).concat(tilt_bytes).concat([255]);\nlet cmd_zoom = [0x81, 1, 4, 71].concat(zoom_bytes).concat([255]);\n\n// Массив выходных сообщений\nvar messages = []\nmessages.push({payload: Buffer.from(cmd_pantilt), camera: msg.camera})\nmessages.push({payload: Buffer.from(cmd_zoom), camera: msg.camera})\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 880,
        "wires": [
            [
                "ed24e08d388f3e8f"
            ]
        ]
    },
    {
        "id": "ed24e08d388f3e8f",
        "type": "delay",
        "z": "ab576495ae266594",
        "name": "5 msg / 1 s",
        "pauseType": "rate",
        "timeout": "350",
        "timeoutUnits": "milliseconds",
        "rate": "10",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 750,
        "y": 880,
        "wires": [
            [
                "ccc01e2d93ef6263"
            ]
        ]
    },
    {
        "id": "ccc01e2d93ef6263",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "HOST+PORT",
        "func": "msg.host = global.get(\"camera_\" + msg.camera.toString() + \"_ip\")\nmsg.port = global.get(\"camera_\" + msg.camera.toString() + \"_port\")\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 880,
        "wires": [
            [
                "38328e1e816cb8de"
            ]
        ]
    },
    {
        "id": "38328e1e816cb8de",
        "type": "tcp request",
        "z": "ab576495ae266594",
        "name": "tcp request",
        "server": "",
        "port": "",
        "out": "time",
        "ret": "buffer",
        "splitc": "10",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 1090,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "d9a61cc59ba7c8cc",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "Очистка пресетов камер",
        "info": "",
        "x": 2390,
        "y": 240,
        "wires": []
    },
    {
        "id": "350af49f3efba015",
        "type": "server-state-changed",
        "z": "ab576495ae266594",
        "name": "save_preset",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.save_preset",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "save_preset",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 110,
        "y": 180,
        "wires": [
            [
                "3a0547aa5ac355c0"
            ]
        ]
    },
    {
        "id": "6051e5f5fa1cea0e",
        "type": "server-state-changed",
        "z": "ab576495ae266594",
        "name": "delete_preset",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.delete_preset",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "delete_preset",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 110,
        "y": 300,
        "wires": [
            [
                "571b102af8d7c71e"
            ]
        ]
    },
    {
        "id": "bbdd1f636ce0b83f",
        "type": "server-state-changed",
        "z": "ab576495ae266594",
        "name": "call_preset",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.call_preset",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "call_preset",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 100,
        "y": 860,
        "wires": [
            [
                "174d423786b4f203"
            ]
        ]
    },
    {
        "id": "a8ebdd8c2a6b2d88",
        "type": "DataIn",
        "z": "ab576495ae266594",
        "collection": "d88c690558e15f84",
        "name": "-> current_values",
        "update": false,
        "path": "/current_values",
        "x": 510,
        "y": 1000,
        "wires": []
    },
    {
        "id": "7a54163c1e9f9583",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "Запоминание состояния",
        "info": "",
        "x": 150,
        "y": 960,
        "wires": []
    },
    {
        "id": "641323f4fb06ca9b",
        "type": "server-state-changed",
        "z": "ab576495ae266594",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.current_values",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 120,
        "y": 1000,
        "wires": [
            [
                "e8be209820663c27"
            ]
        ]
    },
    {
        "id": "1ac372ce3006a514",
        "type": "server-state-changed",
        "z": "ab576495ae266594",
        "name": "chair",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.chair",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": 0,
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 90,
        "y": 1080,
        "wires": [
            [
                "c11dcfd4f61d9e27"
            ]
        ]
    },
    {
        "id": "3f2a725ee7970afa",
        "type": "server-state-changed",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.presets",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 90,
        "y": 1040,
        "wires": [
            [
                "f87d7a1d959f85d1"
            ]
        ]
    },
    {
        "id": "f9d0de79bd3a4270",
        "type": "DataIn",
        "z": "ab576495ae266594",
        "collection": "5ae3cc41ded3bf16",
        "name": "-> presets",
        "update": false,
        "path": "/presets",
        "x": 480,
        "y": 1040,
        "wires": []
    },
    {
        "id": "e8be209820663c27",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "+ attributes",
        "func": "let data = msg.data.new_state.attributes\ndelete data.friendly_name\n\nif (Object.keys(data).length) {\n    msg.payload = msg.data.new_state\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 1000,
        "wires": [
            [
                "a8ebdd8c2a6b2d88"
            ]
        ]
    },
    {
        "id": "f87d7a1d959f85d1",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "+ attributes",
        "func": "let data = msg.data.new_state.attributes\ndelete data.friendly_name\n\nif (Object.keys(data).length)\n{\n    msg.payload = msg.data.new_state\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 1040,
        "wires": [
            [
                "f9d0de79bd3a4270"
            ]
        ]
    },
    {
        "id": "c11dcfd4f61d9e27",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "+ attributes",
        "func": "let data = msg.data.new_state.attributes\ndelete data.friendly_name\n\nif (Object.keys(data).length)\n{\n    msg.payload = msg.data.new_state\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 1080,
        "wires": [
            [
                "d011ef686867474a"
            ]
        ]
    },
    {
        "id": "43102ff101bb7860",
        "type": "DataOut",
        "z": "ab576495ae266594",
        "collection": "5ae3cc41ded3bf16",
        "name": "presets ->",
        "path": "/presets",
        "error": false,
        "x": 1160,
        "y": 1180,
        "wires": [
            [
                "fd6dde39a335a757"
            ]
        ]
    },
    {
        "id": "9ca6a394e7ab2ca0",
        "type": "DataOut",
        "z": "ab576495ae266594",
        "collection": "8744b7cc29ae1dc6",
        "name": " chair ->",
        "path": "/chair",
        "error": false,
        "x": 1160,
        "y": 1220,
        "wires": [
            [
                "fd6dde39a335a757"
            ]
        ]
    },
    {
        "id": "176b4bd5b2a92787",
        "type": "DataOut",
        "z": "ab576495ae266594",
        "collection": "d88c690558e15f84",
        "name": "current_values ->",
        "path": "/current_values",
        "error": false,
        "x": 1190,
        "y": 1140,
        "wires": [
            [
                "fd6dde39a335a757"
            ]
        ]
    },
    {
        "id": "a31d73efb7bcd3d8",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "set data",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "all",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1580,
        "y": 1200,
        "wires": [
            []
        ]
    },
    {
        "id": "fd6dde39a335a757",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "+ state, data",
        "func": "var data = msg.payload.attributes\ndata[\"entity_id\"] = msg.payload.entity_id\ndata[\"state\"] = Number(msg.state)\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\": data\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1410,
        "y": 1200,
        "wires": [
            [
                "a31d73efb7bcd3d8"
            ]
        ]
    },
    {
        "id": "05ee96d1ac4f0eea",
        "type": "debug",
        "z": "ab576495ae266594",
        "name": "debug 100",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2690,
        "y": 260,
        "wires": []
    },
    {
        "id": "29546e9823d9053c",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "empty?",
        "func": "let data = msg.presets.attributes\ndelete data.friendly_name\ndelete data.chairs\nif (Object.keys(data).length)\n{\n    msg.empty = false;\n}\nelse\n{\n    msg.empty = true;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 180,
        "wires": [
            [
                "700d7b8cfecab6cb"
            ]
        ]
    },
    {
        "id": "56c6bd03a84e42f7",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "func",
        "func": "var qty = global.get(\"cameras_qty\");\n\nvar data = {\n    \"entity_id\": \"sensor.presets\",\n    \"chairs\": []\n};\n\nvar presets = msg.payload;\n\nfor (let camera = 1; camera <= qty; camera++) { \n    let key = \"preset\" + (camera).toString(); // 0 = sensor.preset1, 1 = sensor.preset2, ...\n\n    data[key] = []\n}\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 220,
        "wires": [
            [
                "ffa01635487980db"
            ]
        ]
    },
    {
        "id": "ffa01635487980db",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 840,
        "y": 220,
        "wires": [
            [
                "131fc9e9a447d84a"
            ]
        ]
    },
    {
        "id": "700d7b8cfecab6cb",
        "type": "switch",
        "z": "ab576495ae266594",
        "name": "",
        "property": "empty",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 550,
        "y": 180,
        "wires": [
            [
                "844fd0298f017b2f"
            ],
            [
                "56c6bd03a84e42f7"
            ]
        ]
    },
    {
        "id": "131fc9e9a447d84a",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "presets",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.presets",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "presets",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 980,
        "y": 220,
        "wires": [
            [
                "844fd0298f017b2f"
            ]
        ]
    },
    {
        "id": "d011ef686867474a",
        "type": "DataIn",
        "z": "ab576495ae266594",
        "collection": "8744b7cc29ae1dc6",
        "name": "-> chair",
        "update": false,
        "path": "/chair",
        "x": 480,
        "y": 1080,
        "wires": []
    },
    {
        "id": "fd08078c53539b40",
        "type": "DataOut",
        "z": "ab576495ae266594",
        "collection": "5ae3cc41ded3bf16",
        "name": "presets ->",
        "path": "/presets",
        "error": false,
        "x": 360,
        "y": 420,
        "wires": [
            [
                "a054eaf04f0755b0",
                "96db7c2415469bf6"
            ]
        ]
    },
    {
        "id": "2a2dccc0a3e08378",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "set data",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1100,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "030742df82547a8b",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "+ state, data",
        "func": "var data = msg.payload.attributes\ndata[\"entity_id\"] = msg.payload.entity_id\ndata[\"state\"] = msg.state\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\": data\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 420,
        "wires": [
            [
                "2a2dccc0a3e08378"
            ]
        ]
    },
    {
        "id": "4e917bf5e19c11a3",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 540,
        "wires": [
            [
                "28b3493f2dd5cc5e"
            ]
        ]
    },
    {
        "id": "01492ef485b3ad09",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.call_preset",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 600,
        "y": 540,
        "wires": [
            [
                "b5cd60187f0311ce"
            ]
        ]
    },
    {
        "id": "f34d741fcef31e46",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 160,
        "wires": [
            [
                "59e515d0a6c8943e"
            ]
        ]
    },
    {
        "id": "e80d1879f90efa74",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.presets",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 940,
        "y": 160,
        "wires": [
            [
                "475141e737e8d109"
            ]
        ]
    },
    {
        "id": "952a517d5f446252",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1920,
        "y": 160,
        "wires": [
            [
                "f629e46393e697f8"
            ]
        ]
    },
    {
        "id": "078e35486feeb26f",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1700,
        "y": 220,
        "wires": [
            [
                "68bdb40ea64ea54f"
            ]
        ]
    },
    {
        "id": "718bbe120330b8ec",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.presets",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 620,
        "y": 300,
        "wires": [
            [
                "0f3c8492a8c82327"
            ]
        ]
    },
    {
        "id": "af435728638e9005",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 300,
        "wires": [
            [
                "2caf016f0badec92"
            ]
        ]
    },
    {
        "id": "6a31dba6c9eea4f4",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1600,
        "y": 300,
        "wires": [
            [
                "943282242a06c5ae"
            ]
        ]
    },
    {
        "id": "3e59a65b7a04f5f7",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1460,
        "y": 360,
        "wires": [
            [
                "53f3d6f9dc9d5b1f"
            ]
        ]
    },
    {
        "id": "a054eaf04f0755b0",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.presets",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 500,
        "y": 420,
        "wires": [
            [
                "d4b770ce190f3921"
            ]
        ]
    },
    {
        "id": "8821fa70a6f431f1",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 420,
        "wires": [
            [
                "030742df82547a8b"
            ]
        ]
    },
    {
        "id": "57e916c2768d9519",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 840,
        "wires": [
            [
                "82a2d948655a8721"
            ]
        ]
    },
    {
        "id": "5d8ebd53600a13e0",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 600,
        "y": 840,
        "wires": [
            [
                "e24a2b6188b57167"
            ]
        ]
    },
    {
        "id": "0ca93b61f0a8f972",
        "type": "function",
        "z": "ab576495ae266594",
        "d": true,
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 500,
        "wires": [
            [
                "07fb73fd40124ba6"
            ]
        ]
    },
    {
        "id": "17799152c1e65ef5",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "d": true,
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 700,
        "y": 500,
        "wires": [
            [
                "0ca93b61f0a8f972"
            ]
        ]
    },
    {
        "id": "8c342507d9848a2a",
        "type": "server-state-changed",
        "z": "ab576495ae266594",
        "name": "cur",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.current_values",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": false,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 90,
        "y": 1200,
        "wires": [
            [
                "8ec3e052d9b28a9e"
            ]
        ]
    },
    {
        "id": "3d84291649098549",
        "type": "switch",
        "z": "ab576495ae266594",
        "name": "flag == checked",
        "property": "flag_cur",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "checked",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 580,
        "y": 1200,
        "wires": [
            [],
            [
                "138e16c76c5a25e8"
            ]
        ]
    },
    {
        "id": "8ec3e052d9b28a9e",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "state",
        "func": "msg.state = Number(msg.state)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 1200,
        "wires": [
            [
                "889c85a197f03cbc"
            ]
        ]
    },
    {
        "id": "f921ed8807cf59c9",
        "type": "comment",
        "z": "ab576495ae266594",
        "name": "fix",
        "info": "200 ms",
        "x": 90,
        "y": 1160,
        "wires": []
    },
    {
        "id": "889c85a197f03cbc",
        "type": "switch",
        "z": "ab576495ae266594",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 390,
        "y": 1200,
        "wires": [
            [
                "3d84291649098549"
            ]
        ]
    },
    {
        "id": "138e16c76c5a25e8",
        "type": "function",
        "z": "ab576495ae266594",
        "name": "flag = checked",
        "func": "flow.set('flag_cur', 'checked')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 1200,
        "wires": [
            [
                "b9dbeabdfd84fd18"
            ]
        ]
    },
    {
        "id": "3c206f87815e4b8a",
        "type": "delay",
        "z": "ab576495ae266594",
        "name": "",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 220,
        "y": 420,
        "wires": [
            [
                "fd08078c53539b40"
            ]
        ]
    },
    {
        "id": "b9dbeabdfd84fd18",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 960,
        "y": 1200,
        "wires": [
            [
                "176b4bd5b2a92787",
                "43102ff101bb7860",
                "9ca6a394e7ab2ca0",
                "9e8b1bde3a0a1902"
            ]
        ]
    },
    {
        "id": "6a81990d167781e8",
        "type": "switch",
        "z": "ab576495ae266594",
        "name": "good state",
        "property": "presets.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 690,
        "y": 740,
        "wires": [
            [
                "b61c83d801faf3d0"
            ]
        ]
    },
    {
        "id": "e24a2b6188b57167",
        "type": "switch",
        "z": "ab576495ae266594",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 750,
        "y": 840,
        "wires": [
            [
                "57e916c2768d9519"
            ]
        ]
    },
    {
        "id": "b5cd60187f0311ce",
        "type": "switch",
        "z": "ab576495ae266594",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 750,
        "y": 540,
        "wires": [
            [
                "4e917bf5e19c11a3"
            ]
        ]
    },
    {
        "id": "d4b770ce190f3921",
        "type": "switch",
        "z": "ab576495ae266594",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 650,
        "y": 420,
        "wires": [
            [
                "8821fa70a6f431f1"
            ]
        ]
    },
    {
        "id": "0f3c8492a8c82327",
        "type": "switch",
        "z": "ab576495ae266594",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 770,
        "y": 300,
        "wires": [
            [
                "af435728638e9005"
            ]
        ]
    },
    {
        "id": "943282242a06c5ae",
        "type": "switch",
        "z": "ab576495ae266594",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1290,
        "y": 360,
        "wires": [
            [
                "3e59a65b7a04f5f7"
            ]
        ]
    },
    {
        "id": "475141e737e8d109",
        "type": "switch",
        "z": "ab576495ae266594",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1090,
        "y": 160,
        "wires": [
            [
                "f34d741fcef31e46"
            ]
        ]
    },
    {
        "id": "f629e46393e697f8",
        "type": "switch",
        "z": "ab576495ae266594",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2070,
        "y": 160,
        "wires": [
            [
                "078e35486feeb26f"
            ]
        ]
    },
    {
        "id": "9e8b1bde3a0a1902",
        "type": "api-call-service",
        "z": "ab576495ae266594",
        "name": "call_preset",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.call_preset\",\"state\":{{state}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1170,
        "y": 1260,
        "wires": [
            []
        ]
    },
    {
        "id": "96db7c2415469bf6",
        "type": "debug",
        "z": "ab576495ae266594",
        "name": "debug 236",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 370,
        "y": 460,
        "wires": []
    },
    {
        "id": "b4c1893613a18525",
        "type": "function",
        "z": "ab576495ae266594",
        "d": true,
        "name": "old func",
        "func": "var call_camera = msg.call_preset.attributes.camera\nvar call_index = msg.call_preset.attributes.index\n\nvar save_camera = msg.save_preset.new_state.attributes.camera\nvar save_index = msg.save_preset.new_state.attributes.index\n\nvar place = msg.save_preset.new_state.attributes.preset['chair']\n\nvar data = {\n    \"entity_id\": \"sensor.current_values\",\n    \"state\": msg.state,\n};\n\nif (save_index == call_index && save_camera == call_camera && place == null)\n{\n    data[\"chair\"] = -1\n}\n// Поправить на chair активного пресета\nelse {\n    let key = \"preset\" + (call_camera).toString(); // 1 = sensor.preset1, 2 = sensor.preset2, ...\n    if (msg.redrawed_presets[key][call_index][\"chair\"] == null)\n    {\n        data[\"chair\"] = -1\n    }\n    else\n    {\n        data[\"chair\"] = msg.redrawed_presets[key][call_index][\"chair\"]\n    }\n}\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1860,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "bac66b2d2c2efd41",
        "type": "api-current-state",
        "z": "ab576495ae266594",
        "d": true,
        "name": "call_preset",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.call_preset",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "call_preset",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1730,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "2f772e40e6e42020",
        "type": "switch",
        "z": "b8a7445b0c0c02b3",
        "name": "",
        "property": "payload.new_state.attributes.standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "turningoff",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turningon",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 390,
        "y": 80,
        "wires": [
            [
                "ea0169689864c12b"
            ],
            [
                "2e0e0fd80c0d65de"
            ]
        ]
    },
    {
        "id": "8176d160f7bfc95f",
        "type": "api-call-service",
        "z": "b8a7445b0c0c02b3",
        "name": "SB on",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.standby\",\"state\":{{state}},\"standby\":\"on\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1010,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "f9110f4315476972",
        "type": "api-call-service",
        "z": "b8a7445b0c0c02b3",
        "name": "SB off",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.standby\",\"state\":{{state}},\"standby\":\"off\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1010,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "2e0e0fd80c0d65de",
        "type": "delay",
        "z": "b8a7445b0c0c02b3",
        "name": "SB",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 550,
        "y": 100,
        "wires": [
            [
                "425bf86b96ae1898"
            ]
        ]
    },
    {
        "id": "57c06db73ea141cf",
        "type": "function",
        "z": "b8a7445b0c0c02b3",
        "name": "+state",
        "func": "var state = new Date()\nmsg.state = state.getTime()\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 80,
        "wires": [
            [
                "2f772e40e6e42020"
            ]
        ]
    },
    {
        "id": "ea0169689864c12b",
        "type": "delay",
        "z": "b8a7445b0c0c02b3",
        "name": "SB",
        "pauseType": "delay",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 550,
        "y": 60,
        "wires": [
            [
                "6e15f41baffd240c"
            ]
        ]
    },
    {
        "id": "e393301561d53995",
        "type": "server-state-changed",
        "z": "b8a7445b0c0c02b3",
        "name": "Standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.standby",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "seconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 120,
        "y": 80,
        "wires": [
            [
                "57c06db73ea141cf"
            ]
        ]
    },
    {
        "id": "ebb37a5813de36b7",
        "type": "function",
        "z": "b8a7445b0c0c02b3",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 60,
        "wires": [
            [
                "f9110f4315476972"
            ]
        ]
    },
    {
        "id": "6e15f41baffd240c",
        "type": "api-current-state",
        "z": "b8a7445b0c0c02b3",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 700,
        "y": 60,
        "wires": [
            [
                "ebb37a5813de36b7"
            ]
        ]
    },
    {
        "id": "8a0a135f3ac4d376",
        "type": "function",
        "z": "b8a7445b0c0c02b3",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 100,
        "wires": [
            [
                "8176d160f7bfc95f"
            ]
        ]
    },
    {
        "id": "425bf86b96ae1898",
        "type": "api-current-state",
        "z": "b8a7445b0c0c02b3",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 700,
        "y": 100,
        "wires": [
            [
                "8a0a135f3ac4d376"
            ]
        ]
    },
    {
        "id": "ca5df63166141d45",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "event parsing",
        "func": "// Предыдущее состояние выходов\nvar old_isEnabledOut = [\n    msg.data.old_state.attributes.isEnabledOut1,\n    msg.data.old_state.attributes.isEnabledOut2,\n    msg.data.old_state.attributes.isEnabledOut3,\n    msg.data.old_state.attributes.isEnabledOut4\n]\n\n// Новое состояние выходов\nvar new_isEnabledOut = [\n    msg.data.new_state.attributes.isEnabledOut1,\n    msg.data.new_state.attributes.isEnabledOut2,\n    msg.data.new_state.attributes.isEnabledOut3,\n    msg.data.new_state.attributes.isEnabledOut4\n]\n\n// Предыдущее состояние матрицы\nvar old_out = [\n    msg.data.old_state.attributes.out1,\n    msg.data.old_state.attributes.out2,\n    msg.data.old_state.attributes.out3,\n    msg.data.old_state.attributes.out4\n]\n\n// Новое состояние матрицы\nvar new_out = [\n    msg.data.new_state.attributes.out1,\n    msg.data.new_state.attributes.out2,\n    msg.data.new_state.attributes.out3,\n    msg.data.new_state.attributes.out4\n]\n\n// Массив выходных сообщений\nvar messages = []\n\n   \nfor (let i = 0; i < new_out.length; i++) {\n    \n    // Включение/выключение выхода\n    if (old_isEnabledOut[i] != new_isEnabledOut[i] && typeof new_isEnabledOut[i] != \"undefined\") {\n\n        var output = Number(i + 1)\n\n        if (Number(new_isEnabledOut[i]) == 1) {\n            var power = true\n        } else if (Number(new_isEnabledOut[i]) == 0) {\n            var power = false\n        }\n\n        messages.push({\n            output: output,\n            power: power,\n            type: \"set output power\",\n            new_isEnabledOut: new_isEnabledOut,\n            new_out: new_out\n        })\n    }\n\n    // Переключение матрицы\n    if (old_out[i] != new_out[i] && typeof new_out[i] != \"undefined\") {\n\n        var output = Number(i + 1)\n\n        var input = Number(new_out[i])\n\n        messages.push({\n            output: output,\n            input: input,\n            type: \"set input to output\",\n            new_isEnabledOut: new_isEnabledOut,\n            new_out: new_out\n        })\n    }\n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 160,
        "wires": [
            [
                "256e4696a6aa5871"
            ]
        ]
    },
    {
        "id": "a316db0d5299b621",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "switch msg.type",
        "property": "type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "set input to output",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set output power",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 970,
        "y": 160,
        "wires": [
            [
                "9abb62ea865c10fa"
            ],
            [
                "1f808692be53fcc9"
            ]
        ]
    },
    {
        "id": "aee4eb75baf42187",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "2. Вкл/выкл выхода",
        "info": "",
        "x": 980,
        "y": 120,
        "wires": []
    },
    {
        "id": "ce63e9bd70fdd49b",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "1. Переключение матрицы",
        "info": "",
        "x": 1010,
        "y": 80,
        "wires": []
    },
    {
        "id": "9abb62ea865c10fa",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "set input to output",
        "func": "msg.payload = \"#video_d out\" + (msg.output - 1) + \" source=\" + (msg.input - 1)\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 100,
        "wires": [
            [
                "78f003d5312d1c90"
            ]
        ]
    },
    {
        "id": "1f808692be53fcc9",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "set output power",
        "func": "if (msg.power == true) {\n    msg.power = 1\n} else if (msg.power == false) {\n    msg.power = 0\n}\n\nmsg.payload = \"#video_d out\" + (msg.output - 1) + \" onoff=\" + msg.power\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 220,
        "wires": [
            [
                "b29641aff950deb5"
            ]
        ]
    },
    {
        "id": "1078eaef4966d038",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "Входные параметры: msg.output, msg.input",
        "info": "",
        "x": 1340,
        "y": 60,
        "wires": []
    },
    {
        "id": "4bee445657437ee2",
        "type": "delay",
        "z": "91360b8afc23f470",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "4",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1650,
        "y": 160,
        "wires": [
            [
                "097e0ff975907516"
            ]
        ]
    },
    {
        "id": "097e0ff975907516",
        "type": "http request",
        "z": "91360b8afc23f470",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1830,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "78f003d5312d1c90",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomatrix_ip\") + \"/video_set\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1440,
        "y": 100,
        "wires": [
            [
                "4bee445657437ee2"
            ]
        ]
    },
    {
        "id": "9d5a5ce3f5cfe6b2",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "Входные параметры: msg.output, msg.power",
        "info": "",
        "x": 1340,
        "y": 180,
        "wires": []
    },
    {
        "id": "b29641aff950deb5",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomatrix_ip\") + \"/output.set\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1440,
        "y": 220,
        "wires": [
            [
                "4bee445657437ee2"
            ]
        ]
    },
    {
        "id": "83d26561323d5130",
        "type": "server-state-changed",
        "z": "91360b8afc23f470",
        "name": "videomatrix",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomatrix",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 130,
        "y": 160,
        "wires": [
            [
                "ca5df63166141d45",
                "1899ffe83cf3f166"
            ]
        ]
    },
    {
        "id": "424bf8d508c728b4",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "+ old_status, new_status, standby",
        "func": "msg.prev_status = msg.device_statuses.attributes.videomatrix\n\nmsg.new_status = msg.payload\n\nmsg.standby = msg.standby.attributes.standby\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 1120,
        "wires": [
            [
                "f6f5e28b37a3a60b"
            ]
        ]
    },
    {
        "id": "2a0f749415d009eb",
        "type": "api-current-state",
        "z": "91360b8afc23f470",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 760,
        "y": 940,
        "wires": [
            [
                "4d033172ea188ca2"
            ]
        ]
    },
    {
        "id": "bbb763e56237c106",
        "type": "api-call-service",
        "z": "91360b8afc23f470",
        "name": "device_statuses.videomatrix = 0",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"videomatrix\":0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 2090,
        "y": 1160,
        "wires": [
            []
        ]
    },
    {
        "id": "8a3175881b7c1f3c",
        "type": "api-current-state",
        "z": "91360b8afc23f470",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 740,
        "y": 1060,
        "wires": [
            [
                "424bf8d508c728b4"
            ]
        ]
    },
    {
        "id": "e68307c07c30ebaf",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "payload",
        "func": "msg.payload = global.get(\"videomatrix_ip\")\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 940,
        "wires": [
            [
                "5c14276eea6cb18f"
            ]
        ]
    },
    {
        "id": "0e1f0fb9f6dea22e",
        "type": "inject",
        "z": "91360b8afc23f470",
        "name": "",
        "props": [],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 130,
        "y": 940,
        "wires": [
            [
                "e68307c07c30ebaf"
            ]
        ]
    },
    {
        "id": "158f7518acfc6acd",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "switch msg.standby",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turning on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turning off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1090,
        "y": 1220,
        "wires": [
            [
                "29658e376a9f75e9"
            ],
            [
                "7613ede4cba10b35"
            ],
            [
                "7613ede4cba10b35"
            ],
            [
                "4e53cedadef2a0a5"
            ]
        ]
    },
    {
        "id": "b96baf1ed2f2d7e2",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "1. standby == \"on\"",
        "info": "",
        "x": 1090,
        "y": 1280,
        "wires": []
    },
    {
        "id": "b199dad69270a125",
        "type": "api-call-service",
        "z": "91360b8afc23f470",
        "name": "device_statuses.videomatrix = 1",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"videomatrix\":1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 2090,
        "y": 1220,
        "wires": [
            []
        ]
    },
    {
        "id": "78645cd57d316720",
        "type": "api-call-service",
        "z": "91360b8afc23f470",
        "name": "device_statuses.videomatrix = 2",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"videomatrix\":2}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 2090,
        "y": 1280,
        "wires": [
            []
        ]
    },
    {
        "id": "e054621ccdce1a7c",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "2. standby == \"turning on\"",
        "info": "",
        "x": 1110,
        "y": 1320,
        "wires": []
    },
    {
        "id": "61add7075ab395b7",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "3. standby == \"turning off\"",
        "info": "",
        "x": 1110,
        "y": 1360,
        "wires": []
    },
    {
        "id": "5c9855533c632e9b",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "4. standby == \"off\"",
        "info": "",
        "x": 1090,
        "y": 1400,
        "wires": []
    },
    {
        "id": "98e60cdca8639ff6",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "switch msg.standby",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "turningoff",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turningon",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 770,
        "y": 500,
        "wires": [
            [
                "2a6c469f814cb8dc"
            ],
            [
                "0eb7322bf274ea25"
            ]
        ]
    },
    {
        "id": "031a413f651f23fc",
        "type": "server-state-changed",
        "z": "91360b8afc23f470",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.standby",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 110,
        "y": 500,
        "wires": [
            [
                "c6355a6694732439"
            ]
        ]
    },
    {
        "id": "0eb7322bf274ea25",
        "type": "api-call-service",
        "z": "91360b8afc23f470",
        "name": "videomatrix OFF",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomatrix\",\"state\":{{state}},\"isEnabledOut1\":0,\"isEnabledOut2\":0,\"isEnabledOut3\":0,\"isEnabledOut4\":0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1020,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "2a6c469f814cb8dc",
        "type": "api-call-service",
        "z": "91360b8afc23f470",
        "name": "videomatrix ON",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomatrix\",\"state\":{{state}},\"isEnabledOut1\":1,\"isEnabledOut2\":1,\"isEnabledOut3\":1,\"isEnabledOut4\":1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1020,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "c6355a6694732439",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "standby",
        "func": "msg.standby = msg.standby.new_state.attributes.standby\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 500,
        "wires": [
            [
                "9177b194883abed9"
            ]
        ]
    },
    {
        "id": "6507705fa0d6a3e7",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "2. standby == \"turning on\"",
        "info": "",
        "x": 790,
        "y": 460,
        "wires": []
    },
    {
        "id": "d8d7bd0b28376e9f",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "1. standby == \"turning off\"",
        "info": "",
        "x": 790,
        "y": 420,
        "wires": []
    },
    {
        "id": "c8dc6636c3df58b6",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "Отслеживание статуса",
        "info": "",
        "x": 160,
        "y": 900,
        "wires": []
    },
    {
        "id": "dfdee13901b3324e",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "Режим StandBy",
        "info": "",
        "x": 140,
        "y": 460,
        "wires": []
    },
    {
        "id": "f6f5e28b37a3a60b",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "new_status == false",
        "property": "new_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "false",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 860,
        "y": 1180,
        "wires": [
            [
                "29658e376a9f75e9"
            ],
            [
                "158f7518acfc6acd"
            ]
        ]
    },
    {
        "id": "da5829427f69a2a0",
        "type": "DataIn",
        "z": "91360b8afc23f470",
        "collection": "2bcab2171f3cb3b2",
        "name": "-> videomatrix",
        "update": false,
        "path": "/",
        "x": 560,
        "y": 320,
        "wires": []
    },
    {
        "id": "9073cfca8771f220",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "data_to_save",
        "func": "if ((Object.keys(msg.data.new_state.attributes).length) > 4)\n{\n    msg.payload = msg.data.new_state\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 320,
        "wires": [
            [
                "da5829427f69a2a0"
            ]
        ]
    },
    {
        "id": "5a6d66ae532d47e1",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "Запоминание состояния",
        "info": "",
        "x": 170,
        "y": 280,
        "wires": []
    },
    {
        "id": "1219c12eb1b8a2c4",
        "type": "server-state-changed",
        "z": "91360b8afc23f470",
        "name": "videomatrix",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomatrix",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": true,
        "ignorePrevStateUnknown": true,
        "ignorePrevStateUnavailable": true,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 130,
        "y": 320,
        "wires": [
            [
                "9073cfca8771f220"
            ]
        ]
    },
    {
        "id": "d86ed5fc7592619d",
        "type": "change",
        "z": "91360b8afc23f470",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"show\":[\"ВИДЕОМАТРИЦА_Править_вход\"], \"hide\":[\"ВИДЕОМАТРИЦА_Править_выход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4080,
        "y": 360,
        "wires": [
            [
                "b278e6bb50f9a4e5"
            ]
        ]
    },
    {
        "id": "8cd562de12c1cb46",
        "type": "ui_button",
        "z": "91360b8afc23f470",
        "name": "",
        "group": "e53775ce8cb1e6cc",
        "order": 5,
        "width": "8",
        "height": 1,
        "passthru": false,
        "label": "Вернуть к заводским настройкам",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "rotate_left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3040,
        "y": 360,
        "wires": [
            [
                "9c89894122e9b7f3"
            ]
        ]
    },
    {
        "id": "46852f68d13dc077",
        "type": "ui_form",
        "z": "91360b8afc23f470",
        "name": "",
        "label": "",
        "group": "f04326656c098a23",
        "order": 1,
        "width": 6,
        "height": 1,
        "options": [
            {
                "label": "Программный вход",
                "value": "inSoftware",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Физический вход",
                "value": "inHardware",
                "type": "number",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "inSoftware": "",
            "inHardware": ""
        },
        "payload": "",
        "submit": "Подтвердить",
        "cancel": "",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "className": "",
        "x": 4290,
        "y": 400,
        "wires": [
            [
                "d7bcb55a49d432eb"
            ]
        ]
    },
    {
        "id": "9341c4297574de4c",
        "type": "ui_button",
        "z": "91360b8afc23f470",
        "name": "",
        "group": "f04326656c098a23",
        "order": 2,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Закрыть",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3860,
        "y": 320,
        "wires": [
            [
                "1e62fa64cf0447f3"
            ]
        ]
    },
    {
        "id": "73d1414603be1ef1",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "get data to refresh table",
        "func": "var inputs = flow.get('inputs')\n\nvar data = []\n\nfor (const key of inputs.keys()) {\n  data.push({'inSoftware': key, 'inHardware': inputs.get(key)})\n}\n\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3610,
        "y": 400,
        "wires": [
            [
                "5d2652127357b117",
                "8182b06bb86365f9"
            ]
        ]
    },
    {
        "id": "1337936feb07f7b4",
        "type": "ui_button",
        "z": "91360b8afc23f470",
        "name": "",
        "group": "e53775ce8cb1e6cc",
        "order": 1,
        "width": "4",
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-plus-square",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 2950,
        "y": 400,
        "wires": [
            [
                "25dcce7ef09b4ebb"
            ]
        ]
    },
    {
        "id": "d7bcb55a49d432eb",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "validation",
        "func": "if ((msg.payload.inHardware <= flow.get('inputs').size) && (msg.payload.inHardware >= 1) && (msg.payload.inSoftware <= flow.get('inputs').size) && (msg.payload.inSoftware >= 1))\n{\n    msg.log = 'ok'\n    var inputs = flow.get('inputs')\n    inputs.set(msg.payload.inSoftware, msg.payload.inHardware)\n    flow.set('inputs', inputs)\n}\nelse\n{\n    msg.log = 'incorrect'\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3560,
        "y": 460,
        "wires": [
            [
                "691870994683e4d6"
            ]
        ]
    },
    {
        "id": "8899ce8edc69abb3",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "VMA Inpits",
        "info": "",
        "x": 2960,
        "y": 200,
        "wires": []
    },
    {
        "id": "25dcce7ef09b4ebb",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "manage inputs (add)",
        "func": "if (flow.get('inputs') == undefined) {\n    flow.set('inputs', new Map())\n}\n\nvar inputs = flow.get('inputs')\ninputs.set(inputs.size + 1, inputs.size + 1)\n\nflow.set('inputs', inputs)\n\nmsg.inputs = inputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3280,
        "y": 400,
        "wires": [
            [
                "73d1414603be1ef1"
            ]
        ]
    },
    {
        "id": "373dcec6d415818e",
        "type": "ui_button",
        "z": "91360b8afc23f470",
        "name": "",
        "group": "e53775ce8cb1e6cc",
        "order": 2,
        "width": "4",
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 2950,
        "y": 440,
        "wires": [
            [
                "8150ed545d670572"
            ]
        ]
    },
    {
        "id": "8150ed545d670572",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "manage inputs (del)",
        "func": "var inputs = flow.get('inputs')\ninputs.delete(inputs.size)\n\nflow.set('inputs', inputs)\n\nmsg.inputs = inputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3280,
        "y": 440,
        "wires": [
            [
                "73d1414603be1ef1"
            ]
        ]
    },
    {
        "id": "1e62fa64cf0447f3",
        "type": "change",
        "z": "91360b8afc23f470",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"hide\":[\"ВИДЕОМАТРИЦА_Править_вход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4080,
        "y": 320,
        "wires": [
            [
                "b278e6bb50f9a4e5"
            ]
        ]
    },
    {
        "id": "a16fbce7d9eefab0",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "validation",
        "func": "var key = msg.row + 1\nvar val = flow.get('inputs').get(msg.row + 1)\n\nflow.set('selectedInput', {'inSoftware': key, 'inHardware': val})\n\nmsg.payload = flow.get('selectedInput')\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4060,
        "y": 400,
        "wires": [
            [
                "46852f68d13dc077"
            ]
        ]
    },
    {
        "id": "691870994683e4d6",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "log",
        "property": "log",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "incorrect",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ok",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 3670,
        "y": 540,
        "wires": [
            [
                "8ba0d91facab4ec9",
                "7de4a52041a0a073"
            ],
            [
                "c75028a2c17c0e3d",
                "7cc54543f8584bbb"
            ]
        ]
    },
    {
        "id": "a279d21c558bd1d5",
        "type": "ui_toast",
        "z": "91360b8afc23f470",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Вход назначен",
        "name": "Successful",
        "x": 4030,
        "y": 560,
        "wires": []
    },
    {
        "id": "fd1350373085df57",
        "type": "ui_toast",
        "z": "91360b8afc23f470",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Укажите вход в пределах табличных значений",
        "name": "Incorrect",
        "x": 4040,
        "y": 520,
        "wires": []
    },
    {
        "id": "8ba0d91facab4ec9",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3850,
        "y": 520,
        "wires": [
            [
                "fd1350373085df57"
            ]
        ]
    },
    {
        "id": "c75028a2c17c0e3d",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3850,
        "y": 560,
        "wires": [
            [
                "a279d21c558bd1d5"
            ]
        ]
    },
    {
        "id": "7de4a52041a0a073",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "return last data",
        "func": "msg.payload = {'inSoftware': msg.payload.inSoftware, 'inHardware': flow.get('inputs').get(msg.payload.inSoftware) }\nmsg.event = {'bbox': [580, 221, 898, 173]}\nmsg.socketid = 'w0SaiBu-ePmh8nhNAABF'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3880,
        "y": 480,
        "wires": [
            [
                "46852f68d13dc077"
            ]
        ]
    },
    {
        "id": "9c89894122e9b7f3",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "reset func",
        "func": "var inputs = flow.get('inputs')\n\nfor (const key of inputs.keys()) {\n  inputs.set(key, key)\n}\n\nflow.set('inputs', inputs)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3320,
        "y": 360,
        "wires": [
            [
                "73d1414603be1ef1"
            ]
        ]
    },
    {
        "id": "7cc54543f8584bbb",
        "type": "delay",
        "z": "91360b8afc23f470",
        "name": "-->",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 3330,
        "y": 540,
        "wires": [
            [
                "73d1414603be1ef1"
            ]
        ]
    },
    {
        "id": "cd26c1b3cb466237",
        "type": "DataIn",
        "z": "91360b8afc23f470",
        "collection": "48bf28233cdf1386",
        "name": "-> videomatrix_config",
        "update": false,
        "path": "/",
        "x": 4100,
        "y": 240,
        "wires": []
    },
    {
        "id": "c8dbaf5f467342e3",
        "type": "DataOut",
        "z": "91360b8afc23f470",
        "collection": "48bf28233cdf1386",
        "name": "videomatrix_config ->",
        "path": "/",
        "error": false,
        "x": 4100,
        "y": 200,
        "wires": [
            [
                "37587e8371d179ce"
            ]
        ]
    },
    {
        "id": "37587e8371d179ce",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "set all to flow",
        "func": "for (let el of msg.payload)\n{\n    if ((el['attr'] == 'inputs') || (el['attr'] == 'outputs')) {\n        const map = new Map(Object.entries(el['val']).map(([key, value]) => [Number(key), value]));\n        flow.set(el['attr'], map)\n    }\n    else\n    {\n        flow.set(el['attr'], el['val'])\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4310,
        "y": 200,
        "wires": [
            [
                "18be2ddc82fc5059"
            ]
        ]
    },
    {
        "id": "b7060d9f04352458",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "Вызов сохраненного состояния при старте HomeAssistant",
        "info": "",
        "x": 3300,
        "y": 160,
        "wires": []
    },
    {
        "id": "00cbcbba217e2ce7",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "new about.home_assistant is true",
        "property": "about.new_state.attributes.home_assistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 3820,
        "y": 200,
        "wires": [
            [
                "c8dbaf5f467342e3"
            ]
        ]
    },
    {
        "id": "0f2d657077a344c4",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "old about.home_assistant != new about.home_assistant",
        "property": "about.old_state.attributes.home_assistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "about.new_state.attributes.home_assistant",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 3430,
        "y": 200,
        "wires": [
            [
                "00cbcbba217e2ce7"
            ]
        ]
    },
    {
        "id": "eb9436f7121888b6",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "get all from flow",
        "func": "var keys = flow.keys()\nvar ans = []\nfor (let key of keys) {\n    if (Object.prototype.toString.call(flow.get(key)) == '[object Map]') {\n        ans.push({ 'attr': key, 'val': Object.fromEntries(flow.get(key))})\n    }\n    else\n    {\n        ans.push({ 'attr': key, 'val': flow.get(key)})\n    }\n}\nmsg.payload = ans\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3880,
        "y": 240,
        "wires": [
            [
                "cd26c1b3cb466237"
            ]
        ]
    },
    {
        "id": "91be4948ca64f5c5",
        "type": "change",
        "z": "91360b8afc23f470",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"show\":[\"ВИДЕОМАТРИЦА_Править_выход\"], \"hide\":[\"ВИДЕОМАТРИЦА_Править_вход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4080,
        "y": 880,
        "wires": [
            [
                "539656033666b00b"
            ]
        ]
    },
    {
        "id": "09a8862303262038",
        "type": "ui_button",
        "z": "91360b8afc23f470",
        "name": "",
        "group": "4bb94b5820ddfcdb",
        "order": 5,
        "width": "8",
        "height": 1,
        "passthru": false,
        "label": "Вернуть к заводским настройкам",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "rotate_left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3040,
        "y": 880,
        "wires": [
            [
                "63c211f9eaca67e8"
            ]
        ]
    },
    {
        "id": "d84c40f19794132c",
        "type": "ui_form",
        "z": "91360b8afc23f470",
        "name": "",
        "label": "",
        "group": "a63464be2c873bd9",
        "order": 1,
        "width": 6,
        "height": 1,
        "options": [
            {
                "label": "Программный выход",
                "value": "outSoftware",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Физический выход",
                "value": "outHardware",
                "type": "number",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "outSoftware": "",
            "outHardware": ""
        },
        "payload": "",
        "submit": "Подтвердить",
        "cancel": "",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "className": "",
        "x": 4290,
        "y": 920,
        "wires": [
            [
                "dc6d7361c56dea2e"
            ]
        ]
    },
    {
        "id": "b98dcccc98c2501e",
        "type": "ui_button",
        "z": "91360b8afc23f470",
        "name": "",
        "group": "a63464be2c873bd9",
        "order": 2,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Закрыть",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3860,
        "y": 840,
        "wires": [
            [
                "8141ccc6d984f589"
            ]
        ]
    },
    {
        "id": "710b61274690396d",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "get data to refresh table",
        "func": "var outputs = flow.get('outputs')\n\nvar data = []\n\nfor (const key of outputs.keys()) {\n  data.push({'outSoftware': key, 'outHardware': outputs.get(key)})\n}\n\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3610,
        "y": 920,
        "wires": [
            [
                "aa061368dbd78438",
                "0ad4262d4b83c8d6"
            ]
        ]
    },
    {
        "id": "aa6c205966552fc4",
        "type": "ui_button",
        "z": "91360b8afc23f470",
        "name": "",
        "group": "4bb94b5820ddfcdb",
        "order": 1,
        "width": "4",
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-plus-square",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 2950,
        "y": 920,
        "wires": [
            [
                "899f6f5525e13315"
            ]
        ]
    },
    {
        "id": "dc6d7361c56dea2e",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "validation",
        "func": "if ((msg.payload.outHardware <= flow.get('outputs').size) && (msg.payload.outHardware >= 1) && (msg.payload.outSoftware <= flow.get('outputs').size) && (msg.payload.outSoftware >= 1))\n{\n    msg.log = 'ok'\n    var outputs = flow.get('outputs')\n    outputs.set(msg.payload.outSoftware, msg.payload.outHardware)\n    flow.set('outputs', outputs)\n}\nelse\n{\n    msg.log = 'incorrect'\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3560,
        "y": 980,
        "wires": [
            [
                "ba6bf0133f5aeac8"
            ]
        ]
    },
    {
        "id": "8b73073fa6eea0ce",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "VMA Outputs",
        "info": "",
        "x": 2970,
        "y": 820,
        "wires": []
    },
    {
        "id": "899f6f5525e13315",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "manage outputs (add)",
        "func": "if (flow.get('outputs') == undefined)\n{\n    flow.set('outputs', new Map())\n}\n\nvar outputs = flow.get('outputs')\noutputs.set(outputs.size + 1, outputs.size + 1)\n\nflow.set('outputs', outputs)\n\nmsg.outputs = outputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3280,
        "y": 920,
        "wires": [
            [
                "710b61274690396d"
            ]
        ]
    },
    {
        "id": "634e0d93c45ce9ca",
        "type": "ui_button",
        "z": "91360b8afc23f470",
        "name": "",
        "group": "4bb94b5820ddfcdb",
        "order": 2,
        "width": "4",
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 2950,
        "y": 960,
        "wires": [
            [
                "f8470c049af84af8"
            ]
        ]
    },
    {
        "id": "f8470c049af84af8",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "manage outputs (del)",
        "func": "var outputs = flow.get('outputs')\noutputs.delete(outputs.size)\n\nflow.set('outputs', outputs)\n\nmsg.outputs = outputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3280,
        "y": 960,
        "wires": [
            [
                "710b61274690396d"
            ]
        ]
    },
    {
        "id": "8141ccc6d984f589",
        "type": "change",
        "z": "91360b8afc23f470",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"hide\":[\"ВИДЕОМАТРИЦА_Править_выход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4080,
        "y": 840,
        "wires": [
            [
                "539656033666b00b"
            ]
        ]
    },
    {
        "id": "3c5e6499670cb012",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "validation",
        "func": "var key = msg.row + 1\nvar val = flow.get('outputs').get(msg.row + 1)\n\nflow.set('selectedOutput', {'outSoftware': key, 'outHardware': val})\n\nmsg.payload = flow.get('selectedOutput')\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4060,
        "y": 920,
        "wires": [
            [
                "d84c40f19794132c"
            ]
        ]
    },
    {
        "id": "ba6bf0133f5aeac8",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "log",
        "property": "log",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "incorrect",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ok",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 3670,
        "y": 1060,
        "wires": [
            [
                "54a5b192290d1047",
                "d9de8aa529cd03d9"
            ],
            [
                "b711833575f07590",
                "90e8e7fe7a3c963c"
            ]
        ]
    },
    {
        "id": "1e48e8e2948d20a3",
        "type": "ui_toast",
        "z": "91360b8afc23f470",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Вход назначен",
        "name": "Successful",
        "x": 4030,
        "y": 1080,
        "wires": []
    },
    {
        "id": "0cd4f65a7e0af2e6",
        "type": "ui_toast",
        "z": "91360b8afc23f470",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Укажите вход в пределах табличных значений",
        "name": "Incorrect",
        "x": 4040,
        "y": 1040,
        "wires": []
    },
    {
        "id": "54a5b192290d1047",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3850,
        "y": 1040,
        "wires": [
            [
                "0cd4f65a7e0af2e6"
            ]
        ]
    },
    {
        "id": "b711833575f07590",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3850,
        "y": 1080,
        "wires": [
            [
                "1e48e8e2948d20a3"
            ]
        ]
    },
    {
        "id": "d9de8aa529cd03d9",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "return last data",
        "func": "msg.payload = {'outSoftware': msg.payload.outSoftware, 'outHardware': flow.get('outputs').get(msg.payload.outSoftware) }\nmsg.event = {'bbox': [580, 221, 898, 173]}\nmsg.socketid = 'w0SaiBu-ePmh8nhNAABF'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3880,
        "y": 1000,
        "wires": [
            [
                "d84c40f19794132c"
            ]
        ]
    },
    {
        "id": "63c211f9eaca67e8",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "reset func",
        "func": "var outputs = flow.get('outputs')\n\nfor (const key of outputs.keys()) {\n  outputs.set(key, key)\n}\n\nflow.set('outputs', outputs)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3320,
        "y": 880,
        "wires": [
            [
                "710b61274690396d"
            ]
        ]
    },
    {
        "id": "90e8e7fe7a3c963c",
        "type": "delay",
        "z": "91360b8afc23f470",
        "name": "-->",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 3330,
        "y": 1060,
        "wires": [
            [
                "710b61274690396d"
            ]
        ]
    },
    {
        "id": "0dda4ae35329736b",
        "type": "change",
        "z": "91360b8afc23f470",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"tab\":\"КОНФИГУРАТОР\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4440,
        "y": 600,
        "wires": [
            [
                "6ab0f38315e4137c"
            ]
        ]
    },
    {
        "id": "ce821cc6060e9dfd",
        "type": "ui_button",
        "z": "91360b8afc23f470",
        "name": "",
        "group": "3d0e245a64d55aa9",
        "order": 1,
        "width": "1",
        "height": "1",
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "arrow_back",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 4250,
        "y": 600,
        "wires": [
            [
                "0dda4ae35329736b"
            ]
        ]
    },
    {
        "id": "b1e8e8c7fdf346e0",
        "type": "server-state-changed",
        "z": "91360b8afc23f470",
        "name": "about",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.about",
        "entityIdType": "exact",
        "outputInitially": false,
        "ifState": "",
        "ifStateType": "str",
        "outputOnlyOnStateChange": false,
        "for": "0",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "about",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.about",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "haltifstate": "",
        "halt_if_type": "str",
        "output_only_on_state_change": false,
        "x": 3130,
        "y": 200,
        "wires": [
            [
                "0f2d657077a344c4"
            ]
        ]
    },
    {
        "id": "b5d3acae5b54c528",
        "type": "function",
        "z": "91360b8afc23f470",
        "d": true,
        "name": "clear all and fields",
        "func": "var keys = flow.keys()\n\nfor (let key of keys)\n{\n    flow.set(key, undefined);\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3150,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "4a96890c077a37ac",
        "type": "inject",
        "z": "91360b8afc23f470",
        "d": true,
        "name": "CLEAR",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2970,
        "y": 60,
        "wires": [
            [
                "b5d3acae5b54c528"
            ]
        ]
    },
    {
        "id": "dfd3bb14c0447e36",
        "type": "function",
        "z": "91360b8afc23f470",
        "d": true,
        "name": "check all and fields",
        "func": "var keys = flow.keys()\nmsg.keys = keys\nfor (let key of keys)\n{\n    msg[key] = flow.get(key);\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3150,
        "y": 100,
        "wires": [
            [
                "19a3c2ee22fc6e88"
            ]
        ]
    },
    {
        "id": "a404b27c9e56b259",
        "type": "inject",
        "z": "91360b8afc23f470",
        "d": true,
        "name": "Check",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2970,
        "y": 100,
        "wires": [
            [
                "dfd3bb14c0447e36"
            ]
        ]
    },
    {
        "id": "19a3c2ee22fc6e88",
        "type": "debug",
        "z": "91360b8afc23f470",
        "d": true,
        "name": "FLOW.KEYS",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 3340,
        "y": 100,
        "wires": []
    },
    {
        "id": "256e4696a6aa5871",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "input commutation",
        "func": "try\n{\n    if (flow.get('inputs').has(msg.input))\n    {\n        msg.input = flow.get('inputs').get(msg.input)\n    }\n}\nfinally \n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 160,
        "wires": [
            [
                "0bdf24e0b3527382"
            ]
        ]
    },
    {
        "id": "0bdf24e0b3527382",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "output commutation",
        "func": "try\n{\n    if (flow.get('outputs').has(msg.output))\n    {\n        msg.output = flow.get('outputs').get(msg.output)\n    }\n}\nfinally \n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 160,
        "wires": [
            [
                "a316db0d5299b621"
            ]
        ]
    },
    {
        "id": "6ab0f38315e4137c",
        "type": "ui_ui_control",
        "z": "91360b8afc23f470",
        "name": "",
        "events": "all",
        "x": 4660,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "a17324647298f0fe",
        "type": "ping",
        "z": "91360b8afc23f470",
        "protocol": "IPv4",
        "mode": "triggered",
        "name": "",
        "host": "",
        "timer": "2",
        "inputs": 1,
        "x": 590,
        "y": 920,
        "wires": [
            [
                "2a0f749415d009eb"
            ]
        ]
    },
    {
        "id": "732655fc2081e4d1",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "false",
        "func": "msg.payload = false;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 960,
        "wires": [
            [
                "2a0f749415d009eb"
            ]
        ]
    },
    {
        "id": "5c14276eea6cb18f",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "is empty?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 440,
        "y": 940,
        "wires": [
            [
                "a17324647298f0fe"
            ],
            [
                "732655fc2081e4d1"
            ]
        ]
    },
    {
        "id": "6df406be606fbbd0",
        "type": "inject",
        "z": "91360b8afc23f470",
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4050,
        "y": 280,
        "wires": [
            [
                "1e62fa64cf0447f3"
            ]
        ]
    },
    {
        "id": "8fae87f29f8de700",
        "type": "inject",
        "z": "91360b8afc23f470",
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4050,
        "y": 800,
        "wires": [
            [
                "8141ccc6d984f589"
            ]
        ]
    },
    {
        "id": "ebf74ca4fc4edac2",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "get all from flow",
        "func": "var keys = flow.keys()\nvar ans = []\nfor (let key of keys) {\n    ans.push({ 'attr': key, 'val': flow.get(key)})\n}\nmsg.payload = ans\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3340,
        "y": 1320,
        "wires": [
            [
                "fd314c0d57b4be32"
            ]
        ]
    },
    {
        "id": "35cd0e99a3e068ad",
        "type": "inject",
        "z": "91360b8afc23f470",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3160,
        "y": 1320,
        "wires": [
            [
                "ebf74ca4fc4edac2"
            ]
        ]
    },
    {
        "id": "fd314c0d57b4be32",
        "type": "debug",
        "z": "91360b8afc23f470",
        "name": "debug 134",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 3510,
        "y": 1320,
        "wires": []
    },
    {
        "id": "8ee16ce66f9d6d1b",
        "type": "DataOut",
        "z": "91360b8afc23f470",
        "collection": "48bf28233cdf1386",
        "name": "videomatrix_config ->",
        "path": "/",
        "error": false,
        "x": 3360,
        "y": 1360,
        "wires": [
            [
                "09d527de6422570a"
            ]
        ]
    },
    {
        "id": "68c97b6417ce5e52",
        "type": "inject",
        "z": "91360b8afc23f470",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3160,
        "y": 1360,
        "wires": [
            [
                "8ee16ce66f9d6d1b"
            ]
        ]
    },
    {
        "id": "09d527de6422570a",
        "type": "debug",
        "z": "91360b8afc23f470",
        "name": "debug 135",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 3550,
        "y": 1360,
        "wires": []
    },
    {
        "id": "eb35d86c34a04da9",
        "type": "inject",
        "z": "91360b8afc23f470",
        "name": "Refresh table with start flows",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4080,
        "y": 160,
        "wires": [
            [
                "c8dbaf5f467342e3"
            ]
        ]
    },
    {
        "id": "8182b06bb86365f9",
        "type": "link out",
        "z": "91360b8afc23f470",
        "name": "get data ins >",
        "mode": "link",
        "links": [
            "3dd36ff2711bcfe7"
        ],
        "x": 3705,
        "y": 360,
        "wires": []
    },
    {
        "id": "3dd36ff2711bcfe7",
        "type": "link in",
        "z": "91360b8afc23f470",
        "name": "> save",
        "links": [
            "0ad4262d4b83c8d6",
            "8182b06bb86365f9"
        ],
        "x": 3765,
        "y": 240,
        "wires": [
            [
                "eb9436f7121888b6"
            ]
        ]
    },
    {
        "id": "0ad4262d4b83c8d6",
        "type": "link out",
        "z": "91360b8afc23f470",
        "name": "get data outs >",
        "mode": "link",
        "links": [
            "3dd36ff2711bcfe7"
        ],
        "x": 3705,
        "y": 880,
        "wires": []
    },
    {
        "id": "18be2ddc82fc5059",
        "type": "link out",
        "z": "91360b8afc23f470",
        "name": "load >",
        "mode": "link",
        "links": [
            "f2a2e2d77c71bd30",
            "79e04282f9d25e65"
        ],
        "x": 4475,
        "y": 200,
        "wires": []
    },
    {
        "id": "f2a2e2d77c71bd30",
        "type": "link in",
        "z": "91360b8afc23f470",
        "name": "refresh outs",
        "links": [
            "18be2ddc82fc5059"
        ],
        "x": 3515,
        "y": 880,
        "wires": [
            [
                "710b61274690396d"
            ]
        ]
    },
    {
        "id": "79e04282f9d25e65",
        "type": "link in",
        "z": "91360b8afc23f470",
        "name": "refresh ins",
        "links": [
            "18be2ddc82fc5059"
        ],
        "x": 3515,
        "y": 360,
        "wires": [
            [
                "73d1414603be1ef1"
            ]
        ]
    },
    {
        "id": "5d2652127357b117",
        "type": "ui_table",
        "z": "91360b8afc23f470",
        "group": "e53775ce8cb1e6cc",
        "name": "Входы",
        "order": 4,
        "width": "8",
        "height": "3",
        "columns": [
            {
                "field": "inSoftware",
                "title": "Программный вход",
                "width": "50%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "inHardware",
                "title": "Физический вход",
                "width": "50%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 3850,
        "y": 400,
        "wires": [
            [
                "d86ed5fc7592619d",
                "a16fbce7d9eefab0"
            ]
        ]
    },
    {
        "id": "aa061368dbd78438",
        "type": "ui_table",
        "z": "91360b8afc23f470",
        "group": "4bb94b5820ddfcdb",
        "name": "Выходы",
        "order": 4,
        "width": "8",
        "height": "3",
        "columns": [
            {
                "field": "outSoftware",
                "title": "Программный выход",
                "width": "50%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "outHardware",
                "title": "Физический выход",
                "width": "50%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 3860,
        "y": 920,
        "wires": [
            [
                "91be4948ca64f5c5",
                "3c5e6499670cb012"
            ]
        ]
    },
    {
        "id": "7613ede4cba10b35",
        "type": "api-current-state",
        "z": "91360b8afc23f470",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1300,
        "y": 1220,
        "wires": [
            [
                "ca25f361b0b6a773"
            ]
        ]
    },
    {
        "id": "ca25f361b0b6a773",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "",
        "property": "device_statuses.attributes.videomatrix",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1490,
        "y": 1220,
        "wires": [
            [
                "017f3bdcc24f31e3"
            ]
        ]
    },
    {
        "id": "4e53cedadef2a0a5",
        "type": "api-current-state",
        "z": "91360b8afc23f470",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1300,
        "y": 1280,
        "wires": [
            [
                "1954a9b4e52cb56f"
            ]
        ]
    },
    {
        "id": "1954a9b4e52cb56f",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "",
        "property": "device_statuses.attributes.videomatrix",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1490,
        "y": 1280,
        "wires": [
            [
                "a09ef206a8d7b295"
            ]
        ]
    },
    {
        "id": "1e6678ff5588f64c",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "",
        "property": "device_statuses.attributes.videomatrix",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1490,
        "y": 1160,
        "wires": [
            [
                "2ab458c1e1bcd92d"
            ]
        ]
    },
    {
        "id": "29658e376a9f75e9",
        "type": "api-current-state",
        "z": "91360b8afc23f470",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1300,
        "y": 1160,
        "wires": [
            [
                "1e6678ff5588f64c"
            ]
        ]
    },
    {
        "id": "9177b194883abed9",
        "type": "api-current-state",
        "z": "91360b8afc23f470",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomatrix",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 420,
        "y": 500,
        "wires": [
            [
                "15c906345aeda0c7"
            ]
        ]
    },
    {
        "id": "2ab458c1e1bcd92d",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1660,
        "y": 1160,
        "wires": [
            [
                "bbb763e56237c106"
            ]
        ]
    },
    {
        "id": "15c906345aeda0c7",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 500,
        "wires": [
            [
                "98e60cdca8639ff6"
            ]
        ]
    },
    {
        "id": "017f3bdcc24f31e3",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1660,
        "y": 1220,
        "wires": [
            [
                "b199dad69270a125"
            ]
        ]
    },
    {
        "id": "a09ef206a8d7b295",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1660,
        "y": 1280,
        "wires": [
            [
                "78645cd57d316720"
            ]
        ]
    },
    {
        "id": "4d033172ea188ca2",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "good state?",
        "property": "device_statuses.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 750,
        "y": 1000,
        "wires": [
            [
                "8a3175881b7c1f3c"
            ]
        ]
    },
    {
        "id": "ce0086b4c24b4e94",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "fix",
        "info": "Чтобы в гонке записей статусов устройств никто не перебил изначально записываемый state от фронтенда",
        "x": 910,
        "y": 1000,
        "wires": []
    },
    {
        "id": "30dbf8f0f7750f95",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "fix",
        "info": "Enable connection keep-alive - off",
        "x": 1810,
        "y": 200,
        "wires": []
    },
    {
        "id": "2d78140d77c8d448",
        "type": "DataOut",
        "z": "91360b8afc23f470",
        "collection": "2bcab2171f3cb3b2",
        "name": "videomatrix ->",
        "path": "/",
        "error": false,
        "x": 960,
        "y": 700,
        "wires": [
            [
                "a8bfef5c20a7b13e",
                "604ad624f2f34b03",
                "b9b580a60bccb92e"
            ]
        ]
    },
    {
        "id": "0101b248332fef30",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "+ state, data",
        "func": "// var state = new Date()\n// state = state.getTime()\n\nvar data = msg.payload.attributes\ndata[\"entity_id\"] = msg.payload.entity_id\ndata[\"state\"] = Number(msg.state) + 1\ndata[\"isEnabledOut1\"] = 1\ndata[\"isEnabledOut2\"] = 1\ndata[\"isEnabledOut3\"] = 1\ndata[\"isEnabledOut4\"] = 1\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\": data\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 700,
        "wires": [
            [
                "404405b53b6db5b2"
            ]
        ]
    },
    {
        "id": "404405b53b6db5b2",
        "type": "api-call-service",
        "z": "91360b8afc23f470",
        "name": "videomatrix",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "all",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1490,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "a8bfef5c20a7b13e",
        "type": "api-current-state",
        "z": "91360b8afc23f470",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomatrix",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1140,
        "y": 700,
        "wires": [
            [
                "0101b248332fef30"
            ]
        ]
    },
    {
        "id": "6497e83707699a58",
        "type": "comment",
        "z": "91360b8afc23f470",
        "name": "fix",
        "info": "queue - all messages",
        "x": 1470,
        "y": 740,
        "wires": []
    },
    {
        "id": "d6a9918ac72d126f",
        "type": "server-state-changed",
        "z": "91360b8afc23f470",
        "d": true,
        "name": "vma",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomatrix",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": false,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 110,
        "y": 700,
        "wires": [
            [
                "3f649cc3d6906b67"
            ]
        ]
    },
    {
        "id": "9de46179fe9d4418",
        "type": "switch",
        "z": "91360b8afc23f470",
        "d": true,
        "name": "flag == checked",
        "property": "flag_vma",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "checked",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 600,
        "y": 700,
        "wires": [
            [],
            [
                "0fbabf96c3a2d8d5"
            ]
        ]
    },
    {
        "id": "3f649cc3d6906b67",
        "type": "function",
        "z": "91360b8afc23f470",
        "d": true,
        "name": "state",
        "func": "msg.state = Number(msg.state)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 700,
        "wires": [
            [
                "8cad07df31bed352"
            ]
        ]
    },
    {
        "id": "d720a45f9a11714c",
        "type": "comment",
        "z": "91360b8afc23f470",
        "d": true,
        "name": "fix",
        "info": "200 ms",
        "x": 110,
        "y": 660,
        "wires": []
    },
    {
        "id": "8cad07df31bed352",
        "type": "switch",
        "z": "91360b8afc23f470",
        "d": true,
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 410,
        "y": 700,
        "wires": [
            [
                "9de46179fe9d4418"
            ]
        ]
    },
    {
        "id": "0fbabf96c3a2d8d5",
        "type": "function",
        "z": "91360b8afc23f470",
        "d": true,
        "name": "flag = true",
        "func": "flow.set('flag_vma', 'checked')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 700,
        "wires": [
            [
                "2d78140d77c8d448"
            ]
        ]
    },
    {
        "id": "604ad624f2f34b03",
        "type": "debug",
        "z": "91360b8afc23f470",
        "name": "debug 210",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 640,
        "wires": []
    },
    {
        "id": "5a6505120a44a857",
        "type": "inject",
        "z": "91360b8afc23f470",
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 740,
        "wires": [
            [
                "0f79bf54c937c006"
            ]
        ]
    },
    {
        "id": "0f79bf54c937c006",
        "type": "api-current-state",
        "z": "91360b8afc23f470",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomatrix",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 280,
        "y": 740,
        "wires": [
            [
                "67407ea620cdb87f"
            ]
        ]
    },
    {
        "id": "3b38482e1629c6cf",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "attrs qty",
        "func": "if (Object.keys(msg.data.attributes).length <= 2)\n{\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 740,
        "wires": [
            [
                "2d78140d77c8d448"
            ]
        ]
    },
    {
        "id": "67407ea620cdb87f",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "state",
        "func": "msg.state = Number(msg.data.state)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 740,
        "wires": [
            [
                "9bc0c1de778940a0"
            ]
        ]
    },
    {
        "id": "9bc0c1de778940a0",
        "type": "switch",
        "z": "91360b8afc23f470",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 590,
        "y": 740,
        "wires": [
            [
                "3b38482e1629c6cf",
                "0ec8145fc933c826"
            ]
        ]
    },
    {
        "id": "0ec8145fc933c826",
        "type": "debug",
        "z": "91360b8afc23f470",
        "name": "debug 226",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 780,
        "wires": []
    },
    {
        "id": "c78e2539e0527840",
        "type": "function",
        "z": "91360b8afc23f470",
        "name": "+ state, data",
        "func": "// var state = new Date()\n// state = state.getTime()\n\nvar data = msg.payload.attributes\ndata[\"entity_id\"] = \"sensor.confsystem_getter\"\n// data[\"state\"] = Number(msg.state) + 1\ndata[\"mics\"] = [\n    \"unused\",\n    false,\n    false,\n    false,\n    false,\n    false\n]\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\": data\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 780,
        "wires": [
            [
                "f279498e38496f89"
            ]
        ]
    },
    {
        "id": "f279498e38496f89",
        "type": "api-call-service",
        "z": "91360b8afc23f470",
        "name": "conf_system",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "all",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1490,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "b9b580a60bccb92e",
        "type": "api-current-state",
        "z": "91360b8afc23f470",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.confsystem_getter",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1140,
        "y": 780,
        "wires": [
            [
                "c78e2539e0527840"
            ]
        ]
    },
    {
        "id": "1899ffe83cf3f166",
        "type": "debug",
        "z": "91360b8afc23f470",
        "name": "debug 244",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 260,
        "wires": []
    },
    {
        "id": "fd1f7ca150027b00",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "+ old_status, new_status, standby",
        "func": "msg.prev_status = msg.device_statuses.attributes.videomixer\n\nmsg.new_status = msg.payload\n\nmsg.standby = msg.standby.attributes.standby\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1220,
        "y": 2180,
        "wires": [
            [
                "f30d070bbfe2a8b4"
            ]
        ]
    },
    {
        "id": "fd244a706708fd96",
        "type": "api-current-state",
        "z": "4ab7a6698d04b636",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 840,
        "y": 2180,
        "wires": [
            [
                "1b9f1bec1ee4a032"
            ]
        ]
    },
    {
        "id": "796a4ee9ce4aa51e",
        "type": "api-call-service",
        "z": "4ab7a6698d04b636",
        "name": "device_statuses.videomixer = 0",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":\"{{state}}\",\"videomixer\":0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 2510,
        "y": 2160,
        "wires": [
            []
        ]
    },
    {
        "id": "1b9f1bec1ee4a032",
        "type": "api-current-state",
        "z": "4ab7a6698d04b636",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1000,
        "y": 2180,
        "wires": [
            [
                "fd1f7ca150027b00"
            ]
        ]
    },
    {
        "id": "bd4ad879f2560b41",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "payload",
        "func": "msg.payload = global.get(\"videomixer_ip\")\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 2180,
        "wires": [
            [
                "0e7a54dcf0f4b081"
            ]
        ]
    },
    {
        "id": "35fa7a20b11f0744",
        "type": "ping",
        "z": "4ab7a6698d04b636",
        "protocol": "IPv4",
        "mode": "triggered",
        "name": "",
        "host": "",
        "timer": "2",
        "inputs": 1,
        "x": 670,
        "y": 2160,
        "wires": [
            [
                "fd244a706708fd96"
            ]
        ]
    },
    {
        "id": "3c6e8b703bd06ec6",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "name": "ping >",
        "props": [],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 180,
        "y": 2180,
        "wires": [
            [
                "bd4ad879f2560b41"
            ]
        ]
    },
    {
        "id": "f99f6c4b09330a2c",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "switch msg.standby",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turning on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turning off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1710,
        "y": 2220,
        "wires": [
            [
                "01155ddb63857a4d"
            ],
            [
                "f1087291a7e62392"
            ],
            [
                "f1087291a7e62392"
            ],
            [
                "a13249d4b7db8a4d"
            ]
        ]
    },
    {
        "id": "b8f92c7fd0e1e67a",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "1. on",
        "info": "",
        "x": 1670,
        "y": 2280,
        "wires": []
    },
    {
        "id": "163824d0b28b2d09",
        "type": "api-call-service",
        "z": "4ab7a6698d04b636",
        "name": "device_statuses.videomixer = 1",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":\"{{state}}\",\"videomixer\":1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 2510,
        "y": 2220,
        "wires": [
            []
        ]
    },
    {
        "id": "612b522ba288c90b",
        "type": "api-call-service",
        "z": "4ab7a6698d04b636",
        "name": "device_statuses.videomixer = 2",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":\"{{state}}\",\"videomixer\":2}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 2510,
        "y": 2280,
        "wires": [
            []
        ]
    },
    {
        "id": "1bb94d3d685e6682",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "2. turning on",
        "info": "",
        "x": 1690,
        "y": 2320,
        "wires": []
    },
    {
        "id": "6a5c2069a8a8d584",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "3. turning off",
        "info": "",
        "x": 1690,
        "y": 2360,
        "wires": []
    },
    {
        "id": "a058f1a5aa4050ef",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "4. off",
        "info": "",
        "x": 1670,
        "y": 2400,
        "wires": []
    },
    {
        "id": "470c22d37ada56ca",
        "type": "api-current-state",
        "z": "4ab7a6698d04b636",
        "name": "custombuttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.custom_buttons",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "cbtns",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 340,
        "y": 540,
        "wires": [
            [
                "8ff37d0ee418ac83"
            ]
        ]
    },
    {
        "id": "8ff37d0ee418ac83",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "pres, state",
        "func": "// var state = new Date()\n// msg.state = state.getTime()\nmsg.state = Number(msg.cbtns.state)\n\nvar presentation = msg.cbtns.attributes.presentation;\nvar in1_for_presentation = flow.get(\"in1_for_presentation\")\nvar in2_for_presentation = flow.get(\"in2_for_presentation\")\nvar in1 = msg.data.new_state.attributes.out1;\nvar in2 = msg.data.new_state.attributes.out2;\nvar mode = msg.data.new_state.attributes.mode;\n\nvar answer = 0\n\nif (presentation == false)\n{\n    if (in1 == in1_for_presentation && in2 == in2_for_presentation && mode == \"pip\") {\n        answer = 2 // turn on\n    }\n}\nelse // i.e. presentation == true\n{\n    if (in1 != in1_for_presentation || in2 != in2_for_presentation || mode != \"pip\")\n    {\n        answer = 1 // turn off\n    }\n}\n\nreturn {\n        answer: answer,\n        state:msg.state\n    };",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 540,
        "wires": [
            [
                "919adabe74c451b8"
            ]
        ]
    },
    {
        "id": "919adabe74c451b8",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "turn pres",
        "property": "answer",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 680,
        "y": 540,
        "wires": [
            [
                "84916c34faad89fa"
            ],
            [
                "f57487d9cf5de5a9"
            ]
        ]
    },
    {
        "id": "84916c34faad89fa",
        "type": "api-call-service",
        "z": "4ab7a6698d04b636",
        "name": "custom_buttons set Pres False",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.custom_buttons\", \"state\":{{state}}, \"presentation\": false}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 910,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "f57487d9cf5de5a9",
        "type": "api-call-service",
        "z": "4ab7a6698d04b636",
        "name": "custom_buttons set Pres True",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.custom_buttons\",\"state\":{{state}}, \"presentation\": true}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 910,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "fcc49632420b95b5",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "Синхронизация состояния кнопки \"Presentation\"",
        "info": "",
        "x": 310,
        "y": 500,
        "wires": []
    },
    {
        "id": "0b868e6589693446",
        "type": "server-state-changed",
        "z": "4ab7a6698d04b636",
        "name": "custom_buttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.custom_buttons",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 200,
        "y": 700,
        "wires": [
            [
                "bf6c799586835bf8"
            ]
        ]
    },
    {
        "id": "71386971ca9d27fd",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "pres, state",
        "func": "// var state = new Date()\n// state = state.getTime()\n\nvar presentation = msg.payload.new_state.attributes.presentation;\nvar oldpresentation = msg.payload.old_state.attributes.presentation;\n\nif (presentation != oldpresentation) {\n    return {\n        presentation:presentation,\n        state: msg.state\n    };\n}\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 700,
        "wires": [
            [
                "d0381b568d943c97"
            ]
        ]
    },
    {
        "id": "d0381b568d943c97",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "",
        "property": "presentation",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 810,
        "y": 700,
        "wires": [
            [
                "a1c92facbea2eca3"
            ],
            [
                "64d8b4b1484cf483"
            ]
        ]
    },
    {
        "id": "5ba8f9de02022f2a",
        "type": "api-call-service",
        "z": "4ab7a6698d04b636",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomixer\",\"state\":{{state}}, \"out1\": {{in1_for_presentation}}, \"out2\": {{in2_for_presentation}}, \"mode\": \"pip\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1250,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "a9630eab465ed8b7",
        "type": "api-call-service",
        "z": "4ab7a6698d04b636",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomixer\",\"state\":{{state}}, \"out1\": {{in1_for_exit_presentation}}, \"mode\": \"normal\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1250,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "88f9f68f458eb138",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "Обработка нажатий кастомной кнопки \"Presentation\"",
        "info": "",
        "x": 320,
        "y": 660,
        "wires": []
    },
    {
        "id": "5877e974aaef58f5",
        "type": "server-state-changed",
        "z": "4ab7a6698d04b636",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomixer",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 180,
        "y": 540,
        "wires": [
            [
                "470c22d37ada56ca"
            ]
        ]
    },
    {
        "id": "150f70add3745a0e",
        "type": "udp out",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "AVMatrix",
        "addr": "",
        "iface": "",
        "port": "",
        "ipv": "udp4",
        "outport": "",
        "base64": false,
        "multicast": "false",
        "x": 560,
        "y": 2020,
        "wires": []
    },
    {
        "id": "ea588a1061febfa0",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "cmd",
        "func": "var cmd = [0x5a, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x02, 0xfe, 0x01, 0x66, 0xdd]\nmsg.payload = Buffer.from(cmd)\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 2020,
        "wires": [
            [
                "779d1ec16c81d8a3"
            ]
        ]
    },
    {
        "id": "18a551983cfa815e",
        "type": "udp in",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "",
        "iface": "",
        "port": "19522",
        "ipv": "udp4",
        "multicast": "false",
        "group": "",
        "datatype": "buffer",
        "x": 420,
        "y": 2060,
        "wires": [
            [
                "ab5539a9b6b9e1fa"
            ]
        ]
    },
    {
        "id": "ab5539a9b6b9e1fa",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "Статус FTB",
        "func": "if (msg.payload[6] == 0x03 && msg.payload[7] == 0x11 && msg.payload[8] == 0x03) {\n    return {'ftb': msg.payload[9]}\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 2060,
        "wires": [
            [
                "f43bf70496a9a3af"
            ]
        ]
    },
    {
        "id": "f43bf70496a9a3af",
        "type": "api-current-state",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "StandBy",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 720,
        "y": 2060,
        "wires": [
            [
                "51242218a8fe104d"
            ]
        ]
    },
    {
        "id": "51242218a8fe104d",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "standby",
        "func": "msg.standby = msg.standby.attributes.standby\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 2060,
        "wires": [
            [
                "180eeb9250f7c49f"
            ]
        ]
    },
    {
        "id": "180eeb9250f7c49f",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "switch msg.standby",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "turningoff",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turningon",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 2060,
        "wires": [
            [
                "a5f0f7385389d968"
            ],
            [
                "c57764a1f46413bc"
            ]
        ]
    },
    {
        "id": "15b3092b927de592",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "2. turning on",
        "info": "",
        "x": 1010,
        "y": 2020,
        "wires": []
    },
    {
        "id": "bb78aaa02f9fed8f",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "1. turning off",
        "info": "",
        "x": 1010,
        "y": 1980,
        "wires": []
    },
    {
        "id": "7d0be1853120d573",
        "type": "server-state-changed",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "Standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.standby",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "seconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 160,
        "y": 2020,
        "wires": [
            [
                "ea588a1061febfa0"
            ]
        ]
    },
    {
        "id": "a5f0f7385389d968",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "ftb=1",
        "property": "ftb",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1210,
        "y": 2040,
        "wires": [
            [
                "33b4a99cd451fa29"
            ]
        ]
    },
    {
        "id": "c57764a1f46413bc",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "ftb=0",
        "property": "ftb",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1210,
        "y": 2080,
        "wires": [
            [
                "33b4a99cd451fa29"
            ]
        ]
    },
    {
        "id": "779d1ec16c81d8a3",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "+IP+port",
        "func": "msg.ip = global.get(\"videomixer_ip\")\nmsg.port = global.get(\"videomixer_port\")\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 2020,
        "wires": [
            [
                "150f70add3745a0e"
            ]
        ]
    },
    {
        "id": "b650b26eb04970d1",
        "type": "udp out",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "AVMatrix",
        "addr": "",
        "iface": "",
        "port": "",
        "ipv": "udp4",
        "outport": "",
        "base64": false,
        "multicast": "false",
        "x": 1620,
        "y": 2060,
        "wires": []
    },
    {
        "id": "33b4a99cd451fa29",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "cmd",
        "func": "var cmd = [0x5a, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x03, 0x11, 0x03, 0x00, 0x7d, 0xdd]\nmsg.payload = Buffer.from(cmd)\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 2060,
        "wires": [
            [
                "7e7e7946ebc58211"
            ]
        ]
    },
    {
        "id": "7e7e7946ebc58211",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "+IP+port",
        "func": "msg.ip = global.get(\"videomixer_ip\")\nmsg.port = global.get(\"videomixer_port\")\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 2060,
        "wires": [
            [
                "b650b26eb04970d1"
            ]
        ]
    },
    {
        "id": "2830c82de054432c",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "Режим StandBy",
        "info": "",
        "x": 180,
        "y": 1980,
        "wires": []
    },
    {
        "id": "af9c985288dbd106",
        "type": "DataIn",
        "z": "4ab7a6698d04b636",
        "collection": "1ea01473c6ced4e1",
        "name": "-> videomixer",
        "update": false,
        "path": "/videomixer",
        "x": 500,
        "y": 160,
        "wires": []
    },
    {
        "id": "b444c05ed9ae831b",
        "type": "DataOut",
        "z": "4ab7a6698d04b636",
        "collection": "1ea01473c6ced4e1",
        "name": " videomixer ->",
        "path": "/videomixer",
        "error": false,
        "x": 880,
        "y": 280,
        "wires": [
            [
                "e6c1594b0d94aa4e"
            ]
        ]
    },
    {
        "id": "6b0a141b643ca681",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "+ attributes",
        "func": "if ((Object.keys(msg.data.new_state.attributes).length) > 4)\n{\n    msg.payload = msg.data.new_state\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 160,
        "wires": [
            [
                "af9c985288dbd106"
            ]
        ]
    },
    {
        "id": "54649db15c115767",
        "type": "api-call-service",
        "z": "4ab7a6698d04b636",
        "name": " videomixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1590,
        "y": 280,
        "wires": [
            [
                "a01c15cde39e2d87"
            ]
        ]
    },
    {
        "id": "b60ccfb920bbe60d",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "+ state, data",
        "func": "// var state = new Date()\n// state = state.getTime()\n\nvar data = msg.payload.attributes\ndata[\"entity_id\"] = msg.payload.entity_id\ndata[\"state\"] = msg.state\n\ndata[\"ftb\"] = false\ndata[\"smooth\"] = false\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\": data\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1390,
        "y": 280,
        "wires": [
            [
                "54649db15c115767",
                "a942fc823a375978"
            ]
        ]
    },
    {
        "id": "af2c5b0596d5e747",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "Запоминание состояния",
        "info": "",
        "x": 230,
        "y": 120,
        "wires": []
    },
    {
        "id": "95770429ecf00675",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "old != new",
        "property": "about.old_state.attributes.homeAssistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "about.new_state.attributes.homeAssistant",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 410,
        "y": 280,
        "wires": [
            [
                "f4a9167c92c7ebfb"
            ]
        ]
    },
    {
        "id": "f4a9167c92c7ebfb",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "new = true",
        "property": "about.new_state.attributes.homeAssistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 570,
        "y": 280,
        "wires": [
            [
                "7a6fc6eec0b52244"
            ]
        ]
    },
    {
        "id": "faeb92e886813eed",
        "type": "server-state-changed",
        "z": "4ab7a6698d04b636",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomixer",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": true,
        "ignorePrevStateUnknown": true,
        "ignorePrevStateUnavailable": true,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 180,
        "y": 160,
        "wires": [
            [
                "6b0a141b643ca681"
            ]
        ]
    },
    {
        "id": "15af9461e7dbbf2b",
        "type": "server-state-changed",
        "z": "4ab7a6698d04b636",
        "name": "about homeAssistant",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.about",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "150",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "about",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 220,
        "y": 280,
        "wires": [
            [
                "95770429ecf00675"
            ]
        ]
    },
    {
        "id": "842f4cf0d8fb8e72",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "Входы для режима \"Презентация\"",
        "info": "",
        "x": 940,
        "y": 120,
        "wires": []
    },
    {
        "id": "98d083582643ad5f",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "НАСТРОЙКА",
        "info": "",
        "x": 870,
        "y": 80,
        "wires": []
    },
    {
        "id": "a1c92facbea2eca3",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "case \"presentation ON\"",
        "func": "msg.in1_for_presentation = flow.get(\"in1_for_presentation\")\nmsg.in2_for_presentation = flow.get(\"in2_for_presentation\")\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 680,
        "wires": [
            [
                "5ba8f9de02022f2a",
                "19bc6b13512dc1b5"
            ]
        ]
    },
    {
        "id": "64d8b4b1484cf483",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "case \"presentation OFF\"",
        "func": "msg.in1_for_exit_presentation = flow.get(\"in1_for_exit_presentation\")\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 720,
        "wires": [
            [
                "a9630eab465ed8b7",
                "782e64a826a8c5cf"
            ]
        ]
    },
    {
        "id": "a942fc823a375978",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "case \"Presentation\"",
        "func": "// Custom:\nflow.set(\"in1_for_presentation\", 4) // - фон PIP при нажатии кнопки \"Презентация\"\nflow.set(\"in2_for_presentation\", 2) // - окошко PIP при нажатии кнопки \"Презентация\"\nflow.set(\"in1_for_exit_presentation\", 2) // - фон PIP при отжатии кнопки \"Презентация\"",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "7ef2ea18fbd0d8eb",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 700,
        "y": 160,
        "wires": [
            [
                "a942fc823a375978"
            ]
        ]
    },
    {
        "id": "a01c15cde39e2d87",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "inputs_cameras",
        "func": "// flow.set(\"inputs_cameras\", [1, 2, 3]) // - в какие входы подключены камеры\nflow.set(\"inputs_cameras\", Array.from({ length: global.get('cameras_qty') }, (_, i) => i + 1))\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1800,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "9e7ca6c37fcd7cbb",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "Входы от камер",
        "info": "",
        "x": 1800,
        "y": 240,
        "wires": []
    },
    {
        "id": "0b553eab71908684",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1110,
        "y": 160,
        "wires": [
            [
                "a01c15cde39e2d87"
            ]
        ]
    },
    {
        "id": "0b2c33fa574fab1e",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "Отслеживание статуса",
        "info": "",
        "x": 200,
        "y": 2140,
        "wires": []
    },
    {
        "id": "f30d070bbfe2a8b4",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "new_status == false",
        "property": "new_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "false",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1480,
        "y": 2180,
        "wires": [
            [
                "01155ddb63857a4d"
            ],
            [
                "f99f6c4b09330a2c"
            ]
        ]
    },
    {
        "id": "9aa283a2197a4ebb",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "Вызов состояния при включении хоста",
        "info": "",
        "x": 280,
        "y": 240,
        "wires": []
    },
    {
        "id": "9e492ffb22cead06",
        "type": "change",
        "z": "4ab7a6698d04b636",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"show\":[\"ВИДЕОМИКШЕР_Править_вход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4460,
        "y": 460,
        "wires": [
            [
                "160a0a8f14f9bb34"
            ]
        ]
    },
    {
        "id": "559d16fc343de498",
        "type": "ui_button",
        "z": "4ab7a6698d04b636",
        "name": "",
        "group": "85a5f6c9fcd283b6",
        "order": 4,
        "width": 8,
        "height": 1,
        "passthru": false,
        "label": "Вернуть к заводским настройкам",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "rotate_left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3420,
        "y": 460,
        "wires": [
            [
                "0d1111f02eadbbb8"
            ]
        ]
    },
    {
        "id": "12faba27dd02c539",
        "type": "ui_form",
        "z": "4ab7a6698d04b636",
        "name": "",
        "label": "",
        "group": "d881ce800073c6bf",
        "order": 1,
        "width": 6,
        "height": 1,
        "options": [
            {
                "label": "Программный вход",
                "value": "inSoftware",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Физический вход",
                "value": "inHardware",
                "type": "number",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "inSoftware": "",
            "inHardware": ""
        },
        "payload": "",
        "submit": "Подтвердить",
        "cancel": "",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "className": "",
        "x": 4670,
        "y": 500,
        "wires": [
            [
                "e54f8dc1aa317fc4"
            ]
        ]
    },
    {
        "id": "160a0a8f14f9bb34",
        "type": "ui_ui_control",
        "z": "4ab7a6698d04b636",
        "name": "",
        "events": "all",
        "x": 4680,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "d78d7a497950f68e",
        "type": "ui_button",
        "z": "4ab7a6698d04b636",
        "name": "",
        "group": "d881ce800073c6bf",
        "order": 2,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Закрыть",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 4240,
        "y": 420,
        "wires": [
            [
                "b075b4ef254a0f4d"
            ]
        ]
    },
    {
        "id": "7b378f09c96d503b",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "get data to refresh table",
        "func": "var inputs = flow.get('inputs')\n\nvar data = []\n\nfor (const key of inputs.keys()) {\n  data.push({'inSoftware': key, 'inHardware': inputs.get(key)})\n}\n\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3990,
        "y": 500,
        "wires": [
            [
                "661732a06ed44223",
                "1a676d271e88cec8",
                "062aa456a576b4b8"
            ]
        ]
    },
    {
        "id": "6be6ee8ebb7dee49",
        "type": "ui_button",
        "z": "4ab7a6698d04b636",
        "name": "",
        "group": "85a5f6c9fcd283b6",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-plus-square",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3330,
        "y": 500,
        "wires": [
            [
                "de6681c2252f9e2f"
            ]
        ]
    },
    {
        "id": "e54f8dc1aa317fc4",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "validation",
        "func": "if ((msg.payload.inHardware <= flow.get('inputs').size) && (msg.payload.inHardware >= 1) && (msg.payload.inSoftware <= flow.get('inputs').size) && (msg.payload.inSoftware >= 1))\n{\n    msg.log = 'ok'\n    var inputs = flow.get('inputs')\n    inputs.set(msg.payload.inSoftware, msg.payload.inHardware)\n    flow.set('inputs', inputs)\n}\nelse\n{\n    msg.log = 'incorrect'\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3940,
        "y": 560,
        "wires": [
            [
                "d5fe5ecbe60258aa"
            ]
        ]
    },
    {
        "id": "9663f80c5cf5e09b",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "VMI Inpits",
        "info": "",
        "x": 3340,
        "y": 280,
        "wires": []
    },
    {
        "id": "de6681c2252f9e2f",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "manage inputs (add)",
        "func": "if (flow.get('inputs') == undefined) {\n    flow.set('inputs', new Map())\n}\n\nvar inputs = flow.get('inputs')\ninputs.set(inputs.size + 1, inputs.size + 1)\n\nflow.set('inputs', inputs)\n\nmsg.inputs = inputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3660,
        "y": 500,
        "wires": [
            [
                "7b378f09c96d503b"
            ]
        ]
    },
    {
        "id": "d8892ec123f84503",
        "type": "ui_button",
        "z": "4ab7a6698d04b636",
        "name": "",
        "group": "85a5f6c9fcd283b6",
        "order": 2,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3330,
        "y": 540,
        "wires": [
            [
                "15bb69ca62133fd9"
            ]
        ]
    },
    {
        "id": "15bb69ca62133fd9",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "manage inputs (del)",
        "func": "var inputs = flow.get('inputs')\ninputs.delete(inputs.size)\n\nflow.set('inputs', inputs)\n\nmsg.inputs = inputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3660,
        "y": 540,
        "wires": [
            [
                "7b378f09c96d503b"
            ]
        ]
    },
    {
        "id": "b075b4ef254a0f4d",
        "type": "change",
        "z": "4ab7a6698d04b636",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"hide\":[\"ВИДЕОМИКШЕР_Править_вход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4460,
        "y": 420,
        "wires": [
            [
                "160a0a8f14f9bb34"
            ]
        ]
    },
    {
        "id": "c72ca707c6e82385",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "validation",
        "func": "var key = msg.row + 1\nvar val = flow.get('inputs').get(msg.row + 1)\n\nflow.set('selectedInput', {'inSoftware': key, 'inHardware': val})\n\nmsg.payload = flow.get('selectedInput')\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4440,
        "y": 500,
        "wires": [
            [
                "12faba27dd02c539"
            ]
        ]
    },
    {
        "id": "d5fe5ecbe60258aa",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "log",
        "property": "log",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "incorrect",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ok",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 4050,
        "y": 640,
        "wires": [
            [
                "f67977bc5f9e0162",
                "7eda5e27719b7a93"
            ],
            [
                "76bfec2c02c7da2d",
                "49e576a812057402"
            ]
        ]
    },
    {
        "id": "37e16e180f19c05c",
        "type": "ui_toast",
        "z": "4ab7a6698d04b636",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Вход назначен",
        "name": "Successful",
        "x": 4410,
        "y": 660,
        "wires": []
    },
    {
        "id": "1959362ef7baa391",
        "type": "ui_toast",
        "z": "4ab7a6698d04b636",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Укажите вход в пределах табличных значений",
        "name": "Incorrect",
        "x": 4420,
        "y": 620,
        "wires": []
    },
    {
        "id": "f67977bc5f9e0162",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4230,
        "y": 620,
        "wires": [
            [
                "1959362ef7baa391"
            ]
        ]
    },
    {
        "id": "76bfec2c02c7da2d",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4230,
        "y": 660,
        "wires": [
            [
                "37e16e180f19c05c"
            ]
        ]
    },
    {
        "id": "7eda5e27719b7a93",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "return last data",
        "func": "msg.payload = {'inSoftware': msg.payload.inSoftware, 'inHardware': flow.get('inputs').get(msg.payload.inSoftware) }\nmsg.event = {'bbox': [580, 221, 898, 173]}\nmsg.socketid = 'w0SaiBu-ePmh8nhNAABF'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4260,
        "y": 580,
        "wires": [
            [
                "12faba27dd02c539"
            ]
        ]
    },
    {
        "id": "0d1111f02eadbbb8",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "reset func",
        "func": "var inputs = flow.get('inputs')\n\nfor (const key of inputs.keys()) {\n  inputs.set(key, key)\n}\n\nflow.set('inputs', inputs)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3700,
        "y": 460,
        "wires": [
            [
                "7b378f09c96d503b"
            ]
        ]
    },
    {
        "id": "49e576a812057402",
        "type": "delay",
        "z": "4ab7a6698d04b636",
        "name": "-->",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 3710,
        "y": 640,
        "wires": [
            [
                "7b378f09c96d503b"
            ]
        ]
    },
    {
        "id": "a53d7ff0b9d958a3",
        "type": "DataOut",
        "z": "4ab7a6698d04b636",
        "collection": "d9adc42cfdfe7ee0",
        "name": "videomixer_config ->",
        "path": "/",
        "error": false,
        "x": 4480,
        "y": 280,
        "wires": [
            [
                "e50fda83658a0f5b"
            ]
        ]
    },
    {
        "id": "e50fda83658a0f5b",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "set all to flow",
        "func": "for (let el of msg.payload)\n{\n    if ((el['attr'] == 'inputs') || (el['attr'] == 'outputs')) {\n        const map = new Map(Object.entries(el['val']).map(([key, value]) => [Number(key), value]));\n        flow.set(el['attr'], map)\n    }\n    else\n    {\n        flow.set(el['attr'], el['val'])\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4690,
        "y": 280,
        "wires": [
            [
                "d1f7b7c19c918ec1"
            ]
        ]
    },
    {
        "id": "6576ddc58b2da045",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "Вызов сохраненного состояния при старте HomeAssistant",
        "info": "",
        "x": 3680,
        "y": 240,
        "wires": []
    },
    {
        "id": "0f512a285952728e",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "new about.home_assistant is true",
        "property": "about.new_state.attributes.home_assistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 4200,
        "y": 280,
        "wires": [
            [
                "a53d7ff0b9d958a3"
            ]
        ]
    },
    {
        "id": "5eceaa54926ad8d1",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "old about.home_assistant != new about.home_assistant",
        "property": "about.old_state.attributes.home_assistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "about.new_state.attributes.home_assistant",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 3810,
        "y": 280,
        "wires": [
            [
                "0f512a285952728e"
            ]
        ]
    },
    {
        "id": "5f27951cb9669408",
        "type": "change",
        "z": "4ab7a6698d04b636",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"tab\":\"КОНФИГУРАТОР\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4940,
        "y": 380,
        "wires": [
            [
                "160a0a8f14f9bb34"
            ]
        ]
    },
    {
        "id": "e65520e92fe06600",
        "type": "ui_button",
        "z": "4ab7a6698d04b636",
        "name": "",
        "group": "cdda5da914347f61",
        "order": 1,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "arrow_back",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 4750,
        "y": 380,
        "wires": [
            [
                "5f27951cb9669408"
            ]
        ]
    },
    {
        "id": "c4903a50717594d6",
        "type": "server-state-changed",
        "z": "4ab7a6698d04b636",
        "name": "about",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.about",
        "entityIdType": "exact",
        "outputInitially": false,
        "ifState": "",
        "ifStateType": "str",
        "outputOnlyOnStateChange": false,
        "for": "0",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "about",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.about",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "haltifstate": "",
        "halt_if_type": "str",
        "output_only_on_state_change": false,
        "x": 3510,
        "y": 280,
        "wires": [
            [
                "5eceaa54926ad8d1"
            ]
        ]
    },
    {
        "id": "4d69e1d6652ea2f5",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "clear all and fields",
        "func": "var keys = flow.keys()\n\nfor (let key of keys)\n{\n    flow.set(key, undefined);\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3520,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "8fb79f62edaf2ab6",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "name": "CLEAR",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3340,
        "y": 100,
        "wires": [
            [
                "4d69e1d6652ea2f5"
            ]
        ]
    },
    {
        "id": "1d71b7e9cb40b1fd",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "check all and fields",
        "func": "var keys = flow.keys()\nmsg.keys = keys\nfor (let key of keys)\n{\n    msg[key] = flow.get(key);\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3520,
        "y": 140,
        "wires": [
            [
                "9a9d08cc9084d0ea"
            ]
        ]
    },
    {
        "id": "466d4ea82669f545",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "name": "Check",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 3340,
        "y": 140,
        "wires": [
            [
                "1d71b7e9cb40b1fd"
            ]
        ]
    },
    {
        "id": "9a9d08cc9084d0ea",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "FLOW.KEYS",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 3710,
        "y": 140,
        "wires": []
    },
    {
        "id": "1a676d271e88cec8",
        "type": "link out",
        "z": "4ab7a6698d04b636",
        "name": "from INs",
        "mode": "link",
        "links": [
            "4f57301c9fc05aed",
            "88ea78c0f84ddb6e"
        ],
        "x": 4195,
        "y": 460,
        "wires": []
    },
    {
        "id": "805cbfa8e8d777b4",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "inputs",
        "func": "msg.options = Array.from(flow.get('inputs').keys())\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3490,
        "y": 900,
        "wires": [
            [
                "ca9d1feb68b24d60",
                "fc6b919551d1d3ee"
            ]
        ]
    },
    {
        "id": "37de2289f7d2afce",
        "type": "ui_dropdown",
        "z": "4ab7a6698d04b636",
        "name": "",
        "label": "1",
        "tooltip": "",
        "place": "",
        "group": "2659c0e4.6c014",
        "order": 9,
        "width": 2,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 3790,
        "y": 1080,
        "wires": [
            [
                "e3331a19aa53b343"
            ]
        ]
    },
    {
        "id": "427f9a88b3c81fa2",
        "type": "ui_dropdown",
        "z": "4ab7a6698d04b636",
        "name": "",
        "label": "2",
        "tooltip": "",
        "place": "",
        "group": "2659c0e4.6c014",
        "order": 5,
        "width": 2,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 3790,
        "y": 920,
        "wires": [
            [
                "fab5ec7c3bfd309a"
            ]
        ]
    },
    {
        "id": "812e99f1adf3066c",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 3370,
        "y": 840,
        "wires": [
            [
                "639fb4c7f5800c53"
            ]
        ]
    },
    {
        "id": "4f57301c9fc05aed",
        "type": "link in",
        "z": "4ab7a6698d04b636",
        "name": "to checkbox",
        "links": [
            "1a676d271e88cec8"
        ],
        "x": 3375,
        "y": 900,
        "wires": [
            [
                "805cbfa8e8d777b4"
            ]
        ]
    },
    {
        "id": "c86416ebe144b71e",
        "type": "ui_text",
        "z": "4ab7a6698d04b636",
        "group": "2659c0e4.6c014",
        "order": 2,
        "width": 5,
        "height": 1,
        "name": "Переход в режим \"Презентация\"",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 3720,
        "y": 840,
        "wires": []
    },
    {
        "id": "639fb4c7f5800c53",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "text",
        "func": "msg.payload = 'Переход в режим<br>\"Презентация\"'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3490,
        "y": 840,
        "wires": [
            [
                "c86416ebe144b71e"
            ]
        ]
    },
    {
        "id": "84f095479326ceef",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "inputs",
        "func": "msg.options = Array.from(flow.get('inputs').keys())\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3490,
        "y": 1080,
        "wires": [
            [
                "bb5ffb133644bdc9"
            ]
        ]
    },
    {
        "id": "8709592596208642",
        "type": "ui_dropdown",
        "z": "4ab7a6698d04b636",
        "name": "",
        "label": "1",
        "tooltip": "",
        "place": "",
        "group": "2659c0e4.6c014",
        "order": 3,
        "width": 2,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 3790,
        "y": 880,
        "wires": [
            [
                "dd06dfcadb443023"
            ]
        ]
    },
    {
        "id": "afb702d6b03626c8",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 3370,
        "y": 1040,
        "wires": [
            [
                "b547e9877585ba32"
            ]
        ]
    },
    {
        "id": "88ea78c0f84ddb6e",
        "type": "link in",
        "z": "4ab7a6698d04b636",
        "name": "to checkbox",
        "links": [
            "1a676d271e88cec8"
        ],
        "x": 3375,
        "y": 1080,
        "wires": [
            [
                "84f095479326ceef"
            ]
        ]
    },
    {
        "id": "06ab8de0b436d4e2",
        "type": "ui_text",
        "z": "4ab7a6698d04b636",
        "group": "2659c0e4.6c014",
        "order": 8,
        "width": 5,
        "height": 1,
        "name": "Выход из режима \"Презентация\"",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 3720,
        "y": 1040,
        "wires": []
    },
    {
        "id": "b547e9877585ba32",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "text",
        "func": "msg.payload = 'Выход из режима<br>\"Презентация\"'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3490,
        "y": 1040,
        "wires": [
            [
                "06ab8de0b436d4e2"
            ]
        ]
    },
    {
        "id": "b30421d29c1119b9",
        "type": "ui_template",
        "z": "4ab7a6698d04b636",
        "group": "2659c0e4.6c014",
        "name": "NORMAL",
        "order": 7,
        "width": 3,
        "height": 2,
        "format": "<style>\n    .normal-screen {\n        background-color: gray;\n        border-radius: 8px;\n        box-sizing: border-box;\n        color: white;\n        position: relative;\n    }\n\n    .screen {\n        height: 90px;\n        transition: all .3s ease;\n        width: 144px;\n    }\n\n    .normal-screen,\n    .pip-screen,\n    .pop-screen {\n        align-items: center;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n    }\n\n    .screen_border {\n        border: 2px solid white;\n        border-radius: 8px;\n        box-sizing: border-box;\n        height: 100%;\n        left: 0;\n        position: absolute;\n        top: 0;\n        width: 100%;\n    }\n</style>\n\n<body>\n    <div class=\"screen normal-screen\">\n        1\n        <div class=\"screen_border\">\n        </div>\n    </div>\n</body>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 3640,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "3275a6cccb4057a5",
        "type": "ui_template",
        "z": "4ab7a6698d04b636",
        "group": "2659c0e4.6c014",
        "name": "PIP",
        "order": 1,
        "width": 3,
        "height": 2,
        "format": "<style>\n    .normal-screen {\n        background-color: gray;\n        border-radius: 8px;\n        box-sizing: border-box;\n        color: white;\n        position: relative;\n    }\n\n    .screen {\n        height: 90px;\n        width: 144px;\n    }\n\n    .normal-screen,\n    .pip-screen {\n        align-items: center;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n    }\n\n    .pip-screen {\n        background-color: var(--main-separator);\n        position: absolute;\n        border-radius: 8px;\n        bottom: 6px;\n        height: 33px;\n        right: 6px;\n        width: 54px;\n    }\n\n    .screen_border {\n        border: 2px solid white;\n        border-radius: 8px;\n        box-sizing: border-box;\n        height: 100%;\n        left: 0;\n        position: absolute;\n        top: 0;\n        width: 100%;\n    }\n</style>\n\n\n<body>\n    <div class=\"screen normal-screen\">\n        1\n        <div class=\"pip-screen\">\n            2\n            <div class=\"screen_border\">\n            </div>\n        </div>\n        <div class=\"screen_border\">\n        </div>\n    </div>\n</body>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 3630,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "dd06dfcadb443023",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "in1 \"Presentation ON\"",
        "func": "flow.set(\"in1_for_presentation\", msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3980,
        "y": 880,
        "wires": [
            [
                "8802dc3e17f4028a"
            ]
        ]
    },
    {
        "id": "e3331a19aa53b343",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "in1 \"Presentation OFF\"",
        "func": "flow.set(\"in1_for_exit_presentation\", msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3980,
        "y": 1080,
        "wires": [
            [
                "8802dc3e17f4028a"
            ]
        ]
    },
    {
        "id": "fab5ec7c3bfd309a",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "in2 \"Presentation ON\"",
        "func": "flow.set(\"in2_for_presentation\", msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3980,
        "y": 920,
        "wires": [
            [
                "8802dc3e17f4028a"
            ]
        ]
    },
    {
        "id": "ca9d1feb68b24d60",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "payload",
        "func": "msg.payload = flow.get('in1_for_presentation')\nif (msg.payload > msg.options.length)\n{\n    msg.payload = msg.options.length\n    flow.set('in1_for_presentation', msg.payload)\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3640,
        "y": 880,
        "wires": [
            [
                "8709592596208642"
            ]
        ]
    },
    {
        "id": "fc6b919551d1d3ee",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "payload",
        "func": "msg.payload = flow.get('in2_for_presentation')\nif (msg.payload > msg.options.length) \n{\n    msg.payload = msg.options.length\n    flow.set('in2_for_presentation', msg.payload)\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3640,
        "y": 920,
        "wires": [
            [
                "427f9a88b3c81fa2"
            ]
        ]
    },
    {
        "id": "bb5ffb133644bdc9",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "payload",
        "func": "msg.payload = flow.get('in1_for_exit_presentation')\nif (msg.payload > msg.options.length) \n{\n    msg.payload = msg.options.length\n    flow.set('in1_for_exit_presentation', msg.payload)\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3640,
        "y": 1080,
        "wires": [
            [
                "37de2289f7d2afce"
            ]
        ]
    },
    {
        "id": "2df52bf1f6e8744f",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "false",
        "func": "msg.payload = false;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 2200,
        "wires": [
            [
                "fd244a706708fd96"
            ]
        ]
    },
    {
        "id": "0e7a54dcf0f4b081",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "is empty?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 520,
        "y": 2180,
        "wires": [
            [
                "35fa7a20b11f0744"
            ],
            [
                "2df52bf1f6e8744f"
            ]
        ]
    },
    {
        "id": "5925d49a1c2d5491",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "get all from flow",
        "func": "var keys = flow.keys()\nvar ans = []\nfor (let key of keys) {\n    ans.push({ 'attr': key, 'val': flow.get(key)})\n}\nmsg.payload = ans\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4840,
        "y": 780,
        "wires": [
            [
                "91f9584460717e38"
            ]
        ]
    },
    {
        "id": "35c4e264578e52b3",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4680,
        "y": 780,
        "wires": [
            [
                "5925d49a1c2d5491"
            ]
        ]
    },
    {
        "id": "91f9584460717e38",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "debug 132",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 5010,
        "y": 780,
        "wires": []
    },
    {
        "id": "3ec56cbbbc3836c9",
        "type": "DataOut",
        "z": "4ab7a6698d04b636",
        "collection": "d9adc42cfdfe7ee0",
        "name": "videomixer_config ->",
        "path": "/",
        "error": false,
        "x": 4860,
        "y": 820,
        "wires": [
            [
                "deb20ea4e419569a"
            ]
        ]
    },
    {
        "id": "397e928669dcc71a",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4680,
        "y": 820,
        "wires": [
            [
                "3ec56cbbbc3836c9"
            ]
        ]
    },
    {
        "id": "deb20ea4e419569a",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "debug 133",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 5050,
        "y": 820,
        "wires": []
    },
    {
        "id": "0563e8e4546e6a98",
        "type": "DataIn",
        "z": "4ab7a6698d04b636",
        "collection": "d9adc42cfdfe7ee0",
        "name": "-> videomixer_config",
        "update": false,
        "path": "/",
        "x": 4540,
        "y": 1000,
        "wires": []
    },
    {
        "id": "8802dc3e17f4028a",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "get all from flow",
        "func": "var keys = flow.keys()\nvar ans = []\nfor (let key of keys) {\n    if (Object.prototype.toString.call(flow.get(key)) == '[object Map]') {\n        ans.push({ 'attr': key, 'val': Object.fromEntries(flow.get(key))})\n    }\n    else\n    {\n        ans.push({ 'attr': key, 'val': flow.get(key)})\n    }\n}\nmsg.payload = ans\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4320,
        "y": 1000,
        "wires": [
            [
                "0563e8e4546e6a98"
            ]
        ]
    },
    {
        "id": "062aa456a576b4b8",
        "type": "link out",
        "z": "4ab7a6698d04b636",
        "name": "save >",
        "mode": "link",
        "links": [
            "8eda0454ac8414e5"
        ],
        "x": 4195,
        "y": 380,
        "wires": []
    },
    {
        "id": "8eda0454ac8414e5",
        "type": "link in",
        "z": "4ab7a6698d04b636",
        "name": "> save",
        "links": [
            "062aa456a576b4b8"
        ],
        "x": 4255,
        "y": 960,
        "wires": [
            [
                "8802dc3e17f4028a"
            ]
        ]
    },
    {
        "id": "500f7393c4899573",
        "type": "link in",
        "z": "4ab7a6698d04b636",
        "name": "> load",
        "links": [
            "d1f7b7c19c918ec1"
        ],
        "x": 3895,
        "y": 460,
        "wires": [
            [
                "7b378f09c96d503b"
            ]
        ]
    },
    {
        "id": "d1f7b7c19c918ec1",
        "type": "link out",
        "z": "4ab7a6698d04b636",
        "name": "load >",
        "mode": "link",
        "links": [
            "500f7393c4899573"
        ],
        "x": 4815,
        "y": 280,
        "wires": []
    },
    {
        "id": "bae9e44b4a4920af",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "name": "Refresh table with start flows",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4460,
        "y": 240,
        "wires": [
            [
                "a53d7ff0b9d958a3"
            ]
        ]
    },
    {
        "id": "09d44e004219e421",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4430,
        "y": 380,
        "wires": [
            [
                "b075b4ef254a0f4d"
            ]
        ]
    },
    {
        "id": "661732a06ed44223",
        "type": "ui_table",
        "z": "4ab7a6698d04b636",
        "group": "85a5f6c9fcd283b6",
        "name": "Входы",
        "order": 3,
        "width": 8,
        "height": 3,
        "columns": [
            {
                "field": "inSoftware",
                "title": "Программный вход",
                "width": "50%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "inHardware",
                "title": "Физический вход",
                "width": "50%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 4230,
        "y": 500,
        "wires": [
            [
                "9e492ffb22cead06",
                "c72ca707c6e82385"
            ]
        ]
    },
    {
        "id": "f1087291a7e62392",
        "type": "api-current-state",
        "z": "4ab7a6698d04b636",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1920,
        "y": 2220,
        "wires": [
            [
                "8e3fa0877f376d6b"
            ]
        ]
    },
    {
        "id": "8e3fa0877f376d6b",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "",
        "property": "device_statuses.attributes.videomixer",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2110,
        "y": 2220,
        "wires": [
            [
                "cf0688a514a0a704"
            ]
        ]
    },
    {
        "id": "a13249d4b7db8a4d",
        "type": "api-current-state",
        "z": "4ab7a6698d04b636",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1920,
        "y": 2280,
        "wires": [
            [
                "c88817e87227413e"
            ]
        ]
    },
    {
        "id": "c88817e87227413e",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "",
        "property": "device_statuses.attributes.videomixer",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2110,
        "y": 2280,
        "wires": [
            [
                "c2572a508b5509cc"
            ]
        ]
    },
    {
        "id": "08b3ac61a3c99ff9",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "",
        "property": "device_statuses.attributes.videomixer",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2110,
        "y": 2160,
        "wires": [
            [
                "f906719e5ed1d4cc"
            ]
        ]
    },
    {
        "id": "01155ddb63857a4d",
        "type": "api-current-state",
        "z": "4ab7a6698d04b636",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1920,
        "y": 2160,
        "wires": [
            [
                "08b3ac61a3c99ff9"
            ]
        ]
    },
    {
        "id": "b2ca3bf110755c81",
        "type": "server-state-changed",
        "z": "4ab7a6698d04b636",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomixer",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "vmi",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 180,
        "y": 920,
        "wires": [
            [
                "56058bce8ea825b0"
            ]
        ]
    },
    {
        "id": "6896c0d014072268",
        "type": "api-current-state",
        "z": "4ab7a6698d04b636",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 680,
        "y": 920,
        "wires": [
            [
                "8c0e8440eb76f8fe"
            ]
        ]
    },
    {
        "id": "427435b27fee37c0",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "hdmi_in = in1",
        "func": "msg.hdmi_in = msg.vmi.new_state.attributes.out1;\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 900,
        "wires": [
            [
                "6896c0d014072268"
            ]
        ]
    },
    {
        "id": "56058bce8ea825b0",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "mode",
        "property": "vmi.new_state.attributes.mode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "normal",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pip",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pop",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 310,
        "y": 920,
        "wires": [
            [
                "427435b27fee37c0"
            ],
            [
                "278b47ab4b125705"
            ],
            [
                "278b47ab4b125705"
            ]
        ]
    },
    {
        "id": "278b47ab4b125705",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "hdmi_in = in2",
        "func": "msg.hdmi_in = msg.vmi.new_state.attributes.out2;\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 940,
        "wires": [
            [
                "6896c0d014072268"
            ]
        ]
    },
    {
        "id": "8c0e8440eb76f8fe",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "cam",
        "func": "msg.camera = msg.data.attributes.camera\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 920,
        "wires": [
            [
                "5b5f8680765b8849"
            ]
        ]
    },
    {
        "id": "5b5f8680765b8849",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "hdmi_in != camera",
        "property": "hdmi_in",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "camera",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1030,
        "y": 920,
        "wires": [
            [
                "5558076c58ede495"
            ]
        ]
    },
    {
        "id": "b1c5c754668038aa",
        "type": "api-call-service",
        "z": "4ab7a6698d04b636",
        "name": "current_values set Camera",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.current_values\",\"state\":{{state}}, \"camera\":{{hdmi_in}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 2000,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "f58dd58d6419ec5c",
        "type": "server-state-changed",
        "z": "4ab7a6698d04b636",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.current_values",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 200,
        "y": 1120,
        "wires": [
            [
                "9f321e991bb9d724"
            ]
        ]
    },
    {
        "id": "9f321e991bb9d724",
        "type": "api-current-state",
        "z": "4ab7a6698d04b636",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomixer",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "vmi",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 370,
        "y": 1120,
        "wires": [
            [
                "8ed6e2f462037204"
            ]
        ]
    },
    {
        "id": "9f1f0fcaa604c388",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "mode",
        "property": "mode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "normal",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pip",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pop",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 690,
        "y": 1120,
        "wires": [
            [
                "90d2939a45139f68"
            ],
            [
                "41406bfb4cd02878"
            ],
            [
                "41406bfb4cd02878"
            ]
        ]
    },
    {
        "id": "90d2939a45139f68",
        "type": "api-call-service",
        "z": "4ab7a6698d04b636",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomixer\", \"state\":{{state}}, \"out1\": {{camera}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 850,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "8ed6e2f462037204",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "hdmi_in = cam",
        "func": "// var state = new Date()\n// msg.state = state.getTime()\nmsg.state = msg.vmi.state\n\nmsg.mode = msg.vmi.attributes.mode;\nmsg.camera = msg.data.new_state.attributes.camera;\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 1120,
        "wires": [
            [
                "9f1f0fcaa604c388"
            ]
        ]
    },
    {
        "id": "41406bfb4cd02878",
        "type": "api-call-service",
        "z": "4ab7a6698d04b636",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomixer\", \"state\":{{state}}, \"out2\": {{camera}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 850,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "4e8cf26b60748d70",
        "type": "api-call-service",
        "z": "4ab7a6698d04b636",
        "name": "current_values set Chair = -1",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.current_values\", \"chair\":-1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1680,
        "y": 900,
        "wires": [
            [
                "510960342cf5055d"
            ]
        ]
    },
    {
        "id": "0577c4b15892c795",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "hdmi_in is camera",
        "property": "is_camera",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1390,
        "y": 920,
        "wires": [
            [
                "4e8cf26b60748d70"
            ],
            [
                "510960342cf5055d"
            ]
        ]
    },
    {
        "id": "fab5a385391302dc",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "Синхронизация видеомикшера с активной камерой",
        "info": "",
        "x": 320,
        "y": 1080,
        "wires": []
    },
    {
        "id": "b20ac93c7872e8bb",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "Синхронизация активной камеры с видеомикшером",
        "info": "",
        "x": 320,
        "y": 860,
        "wires": []
    },
    {
        "id": "5558076c58ede495",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "is cam",
        "func": "var inputs_cameras = flow.get(\"inputs_cameras\")\nif (inputs_cameras.includes(msg.hdmi_in))\n{\n    msg.is_camera = true\n}\nelse\n{\n    msg.is_camera = false\n} \nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1210,
        "y": 920,
        "wires": [
            [
                "0577c4b15892c795"
            ]
        ]
    },
    {
        "id": "bf6c799586835bf8",
        "type": "api-current-state",
        "z": "4ab7a6698d04b636",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomixer",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 360,
        "y": 700,
        "wires": [
            [
                "90d5a07b172d3574"
            ]
        ]
    },
    {
        "id": "90d5a07b172d3574",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 700,
        "wires": [
            [
                "71386971ca9d27fd"
            ]
        ]
    },
    {
        "id": "510960342cf5055d",
        "type": "api-current-state",
        "z": "4ab7a6698d04b636",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1620,
        "y": 940,
        "wires": [
            [
                "ab21533f21385dba"
            ]
        ]
    },
    {
        "id": "ab21533f21385dba",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "state + 1",
        "func": "msg.state = msg.state\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1780,
        "y": 940,
        "wires": [
            [
                "b1c5c754668038aa"
            ]
        ]
    },
    {
        "id": "f906719e5ed1d4cc",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2280,
        "y": 2160,
        "wires": [
            [
                "796a4ee9ce4aa51e"
            ]
        ]
    },
    {
        "id": "cf0688a514a0a704",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2280,
        "y": 2220,
        "wires": [
            [
                "163824d0b28b2d09"
            ]
        ]
    },
    {
        "id": "c2572a508b5509cc",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2280,
        "y": 2280,
        "wires": [
            [
                "612b522ba288c90b"
            ]
        ]
    },
    {
        "id": "d0e95d03bffd2e5a",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1220,
        "y": 280,
        "wires": [
            [
                "b60ccfb920bbe60d"
            ]
        ]
    },
    {
        "id": "e6c1594b0d94aa4e",
        "type": "api-current-state",
        "z": "4ab7a6698d04b636",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomixer",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1060,
        "y": 280,
        "wires": [
            [
                "d0e95d03bffd2e5a"
            ]
        ]
    },
    {
        "id": "19bc6b13512dc1b5",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "debug 145",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 620,
        "wires": []
    },
    {
        "id": "782e64a826a8c5cf",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "debug 146",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 780,
        "wires": []
    },
    {
        "id": "7a6fc6eec0b52244",
        "type": "delay",
        "z": "4ab7a6698d04b636",
        "name": "150 ms",
        "pauseType": "delay",
        "timeout": "150",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 720,
        "y": 280,
        "wires": [
            [
                "b444c05ed9ae831b"
            ]
        ]
    },
    {
        "id": "7ab0e4b23d213916",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "",
        "method": "PUT",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [],
        "x": 2530,
        "y": 3020,
        "wires": [
            []
        ]
    },
    {
        "id": "20a76e86bb643eb3",
        "type": "delay",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "6 msg / 1 s",
        "pauseType": "rate",
        "timeout": "350",
        "timeoutUnits": "milliseconds",
        "rate": "6",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2530,
        "y": 2940,
        "wires": [
            [
                "a683fdbef454b654"
            ]
        ]
    },
    {
        "id": "a683fdbef454b654",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/event/contrl-menu\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2510,
        "y": 2980,
        "wires": [
            [
                "7ab0e4b23d213916",
                "43175b4ad28194a2"
            ]
        ]
    },
    {
        "id": "28e9c20dea81c768",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/system/login\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2070,
        "y": 2980,
        "wires": [
            [
                "5bbcf4e0d4e78e85"
            ]
        ]
    },
    {
        "id": "8614c936a2e5e45f",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "authorization",
        "func": "msg.payload = {sUserName: \"admin\", sPassword: \"YWRtaW4=\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2050,
        "y": 2940,
        "wires": [
            [
                "28e9c20dea81c768"
            ]
        ]
    },
    {
        "id": "5bbcf4e0d4e78e85",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "",
        "method": "PUT",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [],
        "x": 2050,
        "y": 3020,
        "wires": [
            [
                "4a2d7b5bb73a3ccb"
            ]
        ]
    },
    {
        "id": "6dd2e3f5d8151ff0",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": ">",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1830,
        "y": 2900,
        "wires": [
            [
                "116dd4701c64f356"
            ]
        ]
    },
    {
        "id": "fef1005e098d4aef",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "payload = cmd",
        "func": "msg.payload = msg.cmd\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2300,
        "y": 3040,
        "wires": [
            [
                "20a76e86bb643eb3"
            ]
        ]
    },
    {
        "id": "43175b4ad28194a2",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "debug 150",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2740,
        "y": 2980,
        "wires": []
    },
    {
        "id": "af4db199e0f007d4",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "headers",
        "func": "msg.headers = {\n    Authorization: \"Bearer \" + msg.token,\n    Cookie: \"token=\" + msg.token\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2060,
        "y": 3100,
        "wires": [
            [
                "fef1005e098d4aef"
            ]
        ]
    },
    {
        "id": "4a2d7b5bb73a3ccb",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "get token",
        "func": "msg.token = msg.responseCookies.token.value\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2060,
        "y": 3060,
        "wires": [
            [
                "af4db199e0f007d4"
            ]
        ]
    },
    {
        "id": "116dd4701c64f356",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "set CMD",
        "func": "msg.cmd = {\"LOGO_O\": \"1\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1840,
        "y": 2940,
        "wires": [
            [
                "8614c936a2e5e45f"
            ]
        ]
    },
    {
        "id": "687fe01231250f6f",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/event/contrl-menu-basic\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 1280,
        "wires": [
            [
                "8224fa649ab2a625"
            ]
        ]
    },
    {
        "id": "4114ec5fb4b1837d",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/system/login\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 1320,
        "wires": [
            [
                "95ed3ebcff8d29d5"
            ]
        ]
    },
    {
        "id": "c6174a1d75c59374",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "authorization",
        "func": "msg.payload = {sUserName: \"admin\", sPassword: \"YWRtaW4=\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 1280,
        "wires": [
            [
                "4114ec5fb4b1837d"
            ]
        ]
    },
    {
        "id": "65bdef8fa72afd19",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "headers",
        "func": "msg.headers = {\n    Authorization: \"Bearer \" + msg.token,\n    Cookie: \"token=\" + msg.token\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1440,
        "wires": [
            [
                "687fe01231250f6f"
            ]
        ]
    },
    {
        "id": "c56bae8907739312",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "get token",
        "func": "msg.token = msg.responseCookies.token.value\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1400,
        "wires": [
            [
                "65bdef8fa72afd19"
            ]
        ]
    },
    {
        "id": "88efe7c6e251a59f",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "parse JSON",
        "func": "msg.payload = JSON.parse(msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 1280,
        "wires": [
            [
                "4c41875728467227"
            ]
        ]
    },
    {
        "id": "afc1cde870eb308f",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "event parsing",
        "func": "// Предыдущее состояние\nvar old_mode = msg.data.old_state.attributes.mode;\nvar old_in1 = msg.data.old_state.attributes.out1;\nvar old_in2 = msg.data.old_state.attributes.out2;\nvar old_smooth = msg.data.old_state.attributes.smooth;\n\n// Новое состояние\nvar new_mode = msg.data.new_state.attributes.mode;\nvar new_in1 = msg.data.new_state.attributes.out1;\nvar new_in2 = msg.data.new_state.attributes.out2;\nvar new_smooth = msg.data.new_state.attributes.smooth;\n\n// Массив выходных сообщений\nvar messages = []\n\n// Смена режима:\nif (old_mode != new_mode) {\n    messages.push({\n        in1: new_in1,\n        in2: new_in2,\n        old_mode: old_mode,\n        new_mode: new_mode,\n        type: \"set mode\"\n    })\n}\n\n// Смена источника для 1 канала:\nif (old_in1 != new_in1) {\n    messages.push({\n        mode: new_mode,\n        in1: new_in1,\n        in2: new_in2,\n        smooth: new_smooth,\n        type: \"set in1\"\n    })\n}\n\n// Смена источника для 2 канала:\nif (old_in2 != new_in2) {\n    messages.push({\n        mode: new_mode,\n        in1: new_in1,\n        in2: new_in2,\n        type: \"set in2\"\n    })\n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 180,
        "y": 2660,
        "wires": [
            [
                "cff5fb22fcf49597"
            ]
        ]
    },
    {
        "id": "cc1557b924f6b8a9",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "switch msg.type",
        "property": "type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "set mode",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set in1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set in2",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 520,
        "y": 2940,
        "wires": [
            [
                "99c7d5ae1c291beb"
            ],
            [
                "653ccbf3c418eb4a"
            ],
            [
                "db631953393d185c",
                "1a17f024ec69316c"
            ]
        ]
    },
    {
        "id": "ac146fc56e84eb69",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "2. Смена источника для 1 канала",
        "info": "",
        "x": 500,
        "y": 2840,
        "wires": []
    },
    {
        "id": "4077f8f2fbd253ea",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "1. Смена режима",
        "info": "",
        "x": 450,
        "y": 2800,
        "wires": []
    },
    {
        "id": "d2dd944fbed1be5d",
        "type": "server-state-changed",
        "z": "4ab7a6698d04b636",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomixer",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 160,
        "y": 2580,
        "wires": [
            [
                "afc1cde870eb308f",
                "d6fd59585181d1da"
            ]
        ]
    },
    {
        "id": "11a8ad264b7272bd",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "3. Смена источника для 2 канала",
        "info": "",
        "x": 500,
        "y": 2880,
        "wires": []
    },
    {
        "id": "99c7d5ae1c291beb",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "new_mode",
        "property": "new_mode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "normal",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pip",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pop",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 730,
        "y": 2660,
        "wires": [
            [
                "c21314017355c258"
            ],
            [
                "5c937a7ba797a391"
            ],
            [
                "8e26de80eebade1a"
            ]
        ]
    },
    {
        "id": "eb48af9ff3249986",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "smooth",
        "property": "smooth",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 880,
        "y": 2980,
        "wires": [
            [
                "965d4b015cd1f8b4"
            ],
            [
                "14b6ec6ff2e885c3"
            ]
        ]
    },
    {
        "id": "653ccbf3c418eb4a",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "MODE",
        "property": "mode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "normal",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pip",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pop",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 870,
        "y": 3040,
        "wires": [
            [
                "eb48af9ff3249986"
            ],
            [
                "14b6ec6ff2e885c3"
            ],
            [
                "2a78086baa0b9e9c"
            ]
        ]
    },
    {
        "id": "ec9b6a1356601752",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "УПРАВЛЕНИЕ ОБОРУДОВАНИЕМ",
        "info": "",
        "x": 240,
        "y": 2540,
        "wires": []
    },
    {
        "id": "cff5fb22fcf49597",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "input commutation",
        "func": "try\n{\n    if (flow.get('inputs').has(msg.in1))\n    {\n        msg.in1 = flow.get('inputs').get(msg.in1)\n    }\n}\nfinally \n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 2720,
        "wires": [
            [
                "a215ce77730470c8",
                "fa23219eb2f6ee24"
            ]
        ]
    },
    {
        "id": "dd165d68432d6564",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "name": "",
        "method": "PUT",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [],
        "x": 1310,
        "y": 2840,
        "wires": [
            []
        ]
    },
    {
        "id": "e60a5810df4c6ac7",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "headers",
        "func": "msg.headers = {\n    Authorization: \"Bearer \" + msg.token,\n    Cookie: \"token=\" + msg.token\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 2940,
        "wires": [
            [
                "cc1557b924f6b8a9",
                "66d1b04309b85d99"
            ]
        ]
    },
    {
        "id": "fa23219eb2f6ee24",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "authorization",
        "func": "msg.payload = {sUserName: \"admin\", sPassword: \"YWRtaW4=\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 2780,
        "wires": [
            [
                "e93092506335270f"
            ]
        ]
    },
    {
        "id": "8157b38f330440aa",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "PIP2_O",
        "func": "msg.payload = {\"PIP2_O\":\"1\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 2520,
        "wires": [
            [
                "4678eb274da36b54"
            ]
        ]
    },
    {
        "id": "87126c689b1cbf31",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "POP_O",
        "func": "msg.payload = {\"POP_O\":\"1\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 2560,
        "wires": [
            [
                "4678eb274da36b54",
                "fa8d5c866d942167"
            ]
        ]
    },
    {
        "id": "c21314017355c258",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "old_mode",
        "property": "old_mode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "pip",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pop",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 920,
        "y": 2540,
        "wires": [
            [
                "8157b38f330440aa"
            ],
            [
                "87126c689b1cbf31"
            ]
        ]
    },
    {
        "id": "db631953393d185c",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "PIP2_Src",
        "func": "var in2 = msg.in2 - 1\nmsg.payload = {\"PIP2_Src\":in2.toString()}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 3140,
        "wires": [
            [
                "ce9924ee41e33a0a",
                "0269fb649b3c73f8"
            ]
        ]
    },
    {
        "id": "14b6ec6ff2e885c3",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "PGM",
        "func": "msg.payload = {\"PGM\":msg.in1.toString()}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 3020,
        "wires": [
            [
                "8c5691a0cb337b7d"
            ]
        ]
    },
    {
        "id": "2a78086baa0b9e9c",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "PIP1_Src",
        "func": "var in1 = msg.in1 - 1\nmsg.payload = {\"PIP1_Src\":in1.toString()}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 3060,
        "wires": [
            [
                "8c5691a0cb337b7d"
            ]
        ]
    },
    {
        "id": "965d4b015cd1f8b4",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "PVW",
        "func": "msg.payload = {\"PVW\":msg.in1.toString()}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 2980,
        "wires": [
            [
                "d001b781078aa3b8",
                "8c5691a0cb337b7d"
            ]
        ]
    },
    {
        "id": "d001b781078aa3b8",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "AUTO",
        "func": "msg.payload = {\"AUTO\":\"1\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 2940,
        "wires": [
            [
                "8c5691a0cb337b7d"
            ]
        ]
    },
    {
        "id": "03d531d0d3331ba3",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "PIP2_O",
        "func": "msg.payload = {\"PIP2_O\":\"1\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 960,
        "y": 2700,
        "wires": [
            [
                "8c5691a0cb337b7d"
            ]
        ]
    },
    {
        "id": "8e26de80eebade1a",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "POP_O",
        "func": "msg.payload = {\"POP_O\":\"1\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 2780,
        "wires": [
            [
                "42b1a450ce888887",
                "8c5691a0cb337b7d"
            ]
        ]
    },
    {
        "id": "5c937a7ba797a391",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "PGM",
        "func": "msg.payload = {\"PGM\":msg.in1.toString()}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 2660,
        "wires": [
            [
                "03d531d0d3331ba3",
                "8c5691a0cb337b7d"
            ]
        ]
    },
    {
        "id": "a215ce77730470c8",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "in + 3",
        "func": "msg.in1 = msg.in1 + 3\nmsg.in2 = msg.in2 + 3\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 2720,
        "wires": [
            [
                "fa23219eb2f6ee24"
            ]
        ]
    },
    {
        "id": "42b1a450ce888887",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "PIP1_Src",
        "func": "msg.payload = {\"PIP1_Src\":(msg.in1 - 1).toString()}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 2820,
        "wires": [
            [
                "c2ec50f21eca093b",
                "8c5691a0cb337b7d"
            ]
        ]
    },
    {
        "id": "c2ec50f21eca093b",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "PGM",
        "func": "msg.payload = {\"PGM\":\"7\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 2860,
        "wires": [
            [
                "8c5691a0cb337b7d"
            ]
        ]
    },
    {
        "id": "e947597301335afe",
        "type": "delay",
        "z": "4ab7a6698d04b636",
        "name": "6 msg / 1 s",
        "pauseType": "rate",
        "timeout": "350",
        "timeoutUnits": "milliseconds",
        "rate": "6",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1310,
        "y": 2760,
        "wires": [
            [
                "311bdec771bd68f8"
            ]
        ]
    },
    {
        "id": "fa8d5c866d942167",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "PGM",
        "func": "msg.payload = {\"PGM\":msg.in1.toString()}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 2600,
        "wires": [
            [
                "8c5691a0cb337b7d"
            ]
        ]
    },
    {
        "id": "deddab4013e549ba",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "name": "",
        "method": "PUT",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [],
        "x": 210,
        "y": 2860,
        "wires": [
            [
                "9ba98203c3ed4059"
            ]
        ]
    },
    {
        "id": "9ba98203c3ed4059",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "get token",
        "func": "msg.token = msg.responseCookies.token.value\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 2900,
        "wires": [
            [
                "e60a5810df4c6ac7"
            ]
        ]
    },
    {
        "id": "311bdec771bd68f8",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/event/contrl-menu\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 2800,
        "wires": [
            [
                "dd165d68432d6564"
            ]
        ]
    },
    {
        "id": "e93092506335270f",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/system/login\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 2820,
        "wires": [
            [
                "deddab4013e549ba"
            ]
        ]
    },
    {
        "id": "56f845c043ba9381",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "Удалить",
        "info": "",
        "x": 420,
        "y": 2680,
        "wires": []
    },
    {
        "id": "adbd2ad3b9faf483",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "Logo",
        "info": "",
        "x": 170,
        "y": 1240,
        "wires": []
    },
    {
        "id": "2e41c48b38b5977c",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "new_val_LOGO",
        "property": "data.new_state.attributes.logo",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "data.old_state.attributes.logo",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 360,
        "y": 1280,
        "wires": [
            [
                "c6174a1d75c59374"
            ]
        ]
    },
    {
        "id": "ca62ed5d50e2f314",
        "type": "server-state-changed",
        "z": "4ab7a6698d04b636",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomixer",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 180,
        "y": 1280,
        "wires": [
            [
                "2e41c48b38b5977c"
            ]
        ]
    },
    {
        "id": "0c75be1936e585f1",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [],
        "x": 2290,
        "y": 2640,
        "wires": [
            [
                "98bc0f05d5d60f21"
            ]
        ]
    },
    {
        "id": "b95043e540a9243a",
        "type": "delay",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "6 msg / 1 s",
        "pauseType": "rate",
        "timeout": "350",
        "timeoutUnits": "milliseconds",
        "rate": "6",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2290,
        "y": 2560,
        "wires": [
            [
                "b1bbd350969f6976"
            ]
        ]
    },
    {
        "id": "b1bbd350969f6976",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/event/contrl-menu-basic\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2270,
        "y": 2600,
        "wires": [
            [
                "0c75be1936e585f1"
            ]
        ]
    },
    {
        "id": "a172b87dee1d68d7",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/system/login\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2050,
        "y": 2600,
        "wires": [
            [
                "1595790d2c8e16a0"
            ]
        ]
    },
    {
        "id": "ca37dfaab870aaf1",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "authorization",
        "func": "msg.payload = {sUserName: \"admin\", sPassword: \"YWRtaW4=\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2030,
        "y": 2560,
        "wires": [
            [
                "a172b87dee1d68d7"
            ]
        ]
    },
    {
        "id": "1595790d2c8e16a0",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "",
        "method": "PUT",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [],
        "x": 2030,
        "y": 2640,
        "wires": [
            [
                "aa930741606e8bf3"
            ]
        ]
    },
    {
        "id": "c1a0a7bc687ec25e",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "get",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1830,
        "y": 2560,
        "wires": [
            [
                "ca37dfaab870aaf1"
            ]
        ]
    },
    {
        "id": "cecbf28db7eb0326",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "debug 152",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2510,
        "y": 2700,
        "wires": []
    },
    {
        "id": "c28e075cc1e35fba",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "headers",
        "func": "msg.headers = {\n    Authorization: \"Bearer \" + msg.token,\n    Cookie: \"token=\" + msg.token\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2040,
        "y": 2720,
        "wires": [
            [
                "b95043e540a9243a"
            ]
        ]
    },
    {
        "id": "aa930741606e8bf3",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "get token",
        "func": "msg.token = msg.responseCookies.token.value\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2040,
        "y": 2680,
        "wires": [
            [
                "c28e075cc1e35fba"
            ]
        ]
    },
    {
        "id": "98bc0f05d5d60f21",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "d": true,
        "name": "parse JSON",
        "func": "msg.payload = JSON.parse(msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2350,
        "y": 2700,
        "wires": [
            [
                "cecbf28db7eb0326"
            ]
        ]
    },
    {
        "id": "4c41875728467227",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "flip logo",
        "property": "data.new_state.attributes.logo",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "payload.LOGO_O",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1020,
        "y": 1320,
        "wires": [
            [
                "c6407e410a7afd41"
            ]
        ]
    },
    {
        "id": "1b1964bd70505252",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/event/contrl-menu\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 1460,
        "wires": [
            [
                "dcb97d53860a71bc"
            ]
        ]
    },
    {
        "id": "c6407e410a7afd41",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "\"LOGO_O\": \"1\"",
        "func": "msg.payload = {\"LOGO_O\": \"1\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 1360,
        "wires": [
            [
                "95eb4d0b2e489aab"
            ]
        ]
    },
    {
        "id": "95eb4d0b2e489aab",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "headers",
        "func": "msg.headers = {\n    Authorization: \"Bearer \" + msg.token,\n    Cookie: \"token=\" + msg.token\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 1420,
        "wires": [
            [
                "1b1964bd70505252"
            ]
        ]
    },
    {
        "id": "eab789aa53a4a9c1",
        "type": "server-state-changed",
        "z": "4ab7a6698d04b636",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomixer",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 180,
        "y": 1620,
        "wires": [
            [
                "266e60ca8529d189"
            ]
        ]
    },
    {
        "id": "d537bf6d11b4671e",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Basic YWRtaW46YWRtaW4="
            }
        ],
        "x": 810,
        "y": 1660,
        "wires": [
            [
                "e39328b7a1d7ad13"
            ]
        ]
    },
    {
        "id": "0961e22d987dc5ea",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/event/contrl-menu-basic\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 1620,
        "wires": [
            [
                "d537bf6d11b4671e"
            ]
        ]
    },
    {
        "id": "965c11e1c81df2e9",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/system/login\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 1660,
        "wires": [
            [
                "a2e165469b6cac49"
            ]
        ]
    },
    {
        "id": "8f5e3bb541340174",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "authorization",
        "func": "msg.payload = {sUserName: \"admin\", sPassword: \"YWRtaW4=\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 1620,
        "wires": [
            [
                "965c11e1c81df2e9"
            ]
        ]
    },
    {
        "id": "a2e165469b6cac49",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "name": "",
        "method": "PUT",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Basic YWRtaW46YWRtaW4="
            }
        ],
        "x": 550,
        "y": 1700,
        "wires": [
            [
                "de81a6239740b21a"
            ]
        ]
    },
    {
        "id": "1cbcacd6586cc967",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "headers",
        "func": "msg.headers = {\n    Authorization: \"Bearer \" + msg.token,\n    Cookie: \"token=\" + msg.token\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1780,
        "wires": [
            [
                "0961e22d987dc5ea"
            ]
        ]
    },
    {
        "id": "de81a6239740b21a",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "get token",
        "func": "msg.token = msg.responseCookies.token.value\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 1740,
        "wires": [
            [
                "1cbcacd6586cc967"
            ]
        ]
    },
    {
        "id": "e39328b7a1d7ad13",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "parse JSON",
        "func": "msg.payload = JSON.parse(msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 1620,
        "wires": [
            [
                "1f397b9b4c4c3c02"
            ]
        ]
    },
    {
        "id": "a91dbeecfb9f1012",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "FTB",
        "info": "",
        "x": 170,
        "y": 1580,
        "wires": []
    },
    {
        "id": "1f397b9b4c4c3c02",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "flip FTB",
        "property": "data.new_state.attributes.ftb",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "payload.FTB",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1020,
        "y": 1660,
        "wires": [
            [
                "9af28f478a5691c6"
            ]
        ]
    },
    {
        "id": "71b2168028cb3950",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/event/contrl-menu\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 1800,
        "wires": [
            [
                "fb9b69bdb772eba7"
            ]
        ]
    },
    {
        "id": "9af28f478a5691c6",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "\"FTB\": \"1\"",
        "func": "msg.payload = {\"FTB\": \"1\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 1700,
        "wires": [
            [
                "4e6fc0f91acb0f0f"
            ]
        ]
    },
    {
        "id": "4e6fc0f91acb0f0f",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "headers",
        "func": "msg.headers = {\n    Authorization: \"Bearer \" + msg.token,\n    Cookie: \"token=\" + msg.token\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 1760,
        "wires": [
            [
                "71b2168028cb3950"
            ]
        ]
    },
    {
        "id": "266e60ca8529d189",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "new_val_FTB",
        "property": "data.new_state.attributes.ftb",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "data.old_state.attributes.ftb",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 360,
        "y": 1620,
        "wires": [
            [
                "8f5e3bb541340174"
            ]
        ]
    },
    {
        "id": "42cf6cc056262286",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "Обратная связь",
        "info": "Какой вход на PGM\nКакой вход на PVW\nРежим (Normal, PiP, PoP)\n- Логотип (обратной связи нет, на вкл и выкл отдельная команда)\n+ Плавный переход - это фича бэкенда\n+ FTB (уже поддержан)",
        "x": 1420,
        "y": 1080,
        "wires": []
    },
    {
        "id": "4c114ee3d073b0d4",
        "type": "udp in",
        "z": "4ab7a6698d04b636",
        "name": "",
        "iface": "",
        "port": "19522",
        "ipv": "udp4",
        "multicast": "false",
        "group": "",
        "datatype": "buffer",
        "x": 2040,
        "y": 1120,
        "wires": [
            [
                "f4dba3dfc8b62cf8"
            ]
        ]
    },
    {
        "id": "f4dba3dfc8b62cf8",
        "type": "join",
        "z": "4ab7a6698d04b636",
        "name": "",
        "mode": "custom",
        "build": "array",
        "property": "payload",
        "propertyType": "msg",
        "key": "payload",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "2",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 2050,
        "y": 1180,
        "wires": [
            [
                "d348c9cb626b84eb",
                "15d9d342229d3682"
            ]
        ]
    },
    {
        "id": "d348c9cb626b84eb",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "payload",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2240,
        "y": 1180,
        "wires": []
    },
    {
        "id": "c284a0971d753501",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "search in2",
        "func": "const prefix = [90, 14, 0, 0, 0, 0, 5, 36];\n\nfor (var i = 0; i < msg.payload.length; i++) {\n    const element = msg.payload[i];\n\n    const startsWithPrefix = (element, prefix) => {\n        return prefix.every((value, index) => element[index] === value);\n    };\n\n    if (startsWithPrefix(element, prefix)) {\n        msg.in2 = element[8] - 3\n        return msg\n    }\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2830,
        "y": 1320,
        "wires": [
            [
                "71ac255269bbedb5"
            ]
        ]
    },
    {
        "id": "6eaf1fd7908e5fb6",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "search in1",
        "func": "const prefix = [90, 11, 0, 0, 0, 0, 2, 18];\n\nfor (var i = 0; i < msg.payload.length; i++) {\n    const element = msg.payload[i];\n\n    const startsWithPrefix = (element, prefix) => {\n        return prefix.every((value, index) => element[index] === value);\n    };\n\n    if (startsWithPrefix(element, prefix)) {\n        msg.in1 = element[8]\n        return msg\n    }\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2650,
        "y": 1360,
        "wires": [
            [
                "c284a0971d753501"
            ]
        ]
    },
    {
        "id": "33b73a684274ec78",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "search normal / pip",
        "func": "const prefix = [90,16,0,0,0,0,7,32,0,0];\n\nfor (var i = 0; i < msg.payload.length; i++) {\n    const element = msg.payload[i];\n\n    const startsWithPrefix = (element, prefix) => {\n        return prefix.every((value, index) => element[index] === value);\n    };\n\n    if (startsWithPrefix(element, prefix)) {\n        if (element[10] == 0) {\n            msg.mode = 'normal'\n        }\n        else if (element[10] == 2) {\n            msg.mode = 'pip'\n        }\n        return msg\n    }\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2610,
        "y": 1320,
        "wires": [
            [
                "6eaf1fd7908e5fb6"
            ]
        ]
    },
    {
        "id": "71ac255269bbedb5",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "search FTB",
        "func": "for (var i = 0; i < msg.payload.length; i++) {\n    const element = msg.payload[i];\n\n    if (element[6] == 0x03 && element[7] == 0x11 && element[8] == 0x03) {\n        msg.ftb = Boolean(element[9])\n        return msg\n    }\n}\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2870,
        "y": 1360,
        "wires": [
            [
                "987ffba0161f53dd"
            ]
        ]
    },
    {
        "id": "23ceec46b77ec023",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "search pop",
        "func": "const prefix = [90,11,0,0,0,0,2,18];\n\nfor (var i = 0; i < msg.payload.length; i++) {\n    const element = msg.payload[i];\n\n    const startsWithPrefix = (element, prefix) => {\n        return prefix.every((value, index) => element[index] === value);\n    };\n\n    if (startsWithPrefix(element, prefix)) {\n        // Возвращает элемент, если он начинается с префикса\n        // element[8]\n        // element[12]\n        msg.pop = element[8] == 5\n        msg.element = element; // Можно использовать node.send или другое, если это в Node-RED\n        return msg\n    }\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2230,
        "y": 1260,
        "wires": [
            [
                "893930348fa77431"
            ]
        ]
    },
    {
        "id": "893930348fa77431",
        "type": "switch",
        "z": "4ab7a6698d04b636",
        "name": "pop?",
        "property": "pop",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2390,
        "y": 1260,
        "wires": [
            [
                "f7702d056400a935"
            ],
            [
                "33b73a684274ec78"
            ]
        ]
    },
    {
        "id": "f7702d056400a935",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "set attr \"mode\"",
        "func": "msg.mode = 'pop'\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2600,
        "y": 1220,
        "wires": [
            [
                "7c31c499b9b2c8f8"
            ]
        ]
    },
    {
        "id": "1eda19281f9ac300",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "mode",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "mode",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 3250,
        "y": 1220,
        "wires": []
    },
    {
        "id": "7c31c499b9b2c8f8",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "search in1",
        "func": "const prefix = [90,13,0,0,0,0,4,38,2];\n\nfor (var i = 0; i < msg.payload.length; i++) {\n    const element = msg.payload[i];\n\n    const startsWithPrefix = (element, prefix) => {\n        return prefix.every((value, index) => element[index] === value);\n    };\n\n    if (startsWithPrefix(element, prefix)) {\n        msg.in1 = element[9] - 3\n        return msg\n    }\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2650,
        "y": 1260,
        "wires": [
            [
                "615cfd8a1a34f27d"
            ]
        ]
    },
    {
        "id": "98735c51603e23a5",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "in1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "in1",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 3250,
        "y": 1260,
        "wires": []
    },
    {
        "id": "615cfd8a1a34f27d",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "search in2",
        "func": "const prefix = [90, 13, 0, 0, 0, 0, 4, 38, 2];\n\nfor (var i = 0; i < msg.payload.length; i++) {\n    const element = msg.payload[i];\n\n    const startsWithPrefix = (element, prefix) => {\n        return prefix.every((value, index) => element[index] === value);\n    };\n\n    if (startsWithPrefix(element, prefix)) {\n        msg.in2 = element[10] - 3\n        return msg\n    }\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2830,
        "y": 1220,
        "wires": [
            [
                "4f2e48db6ff9c8a1"
            ]
        ]
    },
    {
        "id": "72a3768c6f5e019f",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "in2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "in2",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 3250,
        "y": 1300,
        "wires": []
    },
    {
        "id": "4f2e48db6ff9c8a1",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "search FTB",
        "func": "const prefix = [90, 12, 0, 0, 0, 0, 3, 17, 3];\n\nfor (var i = 0; i < msg.payload.length; i++) {\n    const element = msg.payload[i];\n\n    const startsWithPrefix = (element, prefix) => {\n        return prefix.every((value, index) => element[index] === value);\n    };\n\n    if (startsWithPrefix(element, prefix)) {\n        msg.ftb = Boolean(element[9])\n        return msg\n    }\n}\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2870,
        "y": 1260,
        "wires": [
            [
                "987ffba0161f53dd"
            ]
        ]
    },
    {
        "id": "da53a313b6ddd22f",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "ftb",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "ftb",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 3250,
        "y": 1340,
        "wires": []
    },
    {
        "id": "15d9d342229d3682",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "search logo",
        "func": "const prefix = [90,16,0,0,0,0,7,32,0,0];\n\nfor (var i = 0; i < msg.payload.length; i++) {\n    const element = msg.payload[i];\n\n    const startsWithPrefix = (element, prefix) => {\n        return prefix.every((value, index) => element[index] === value);\n    };\n\n    if (startsWithPrefix(element, prefix)) {\n        msg.logo = element[13] == 2\n        return msg\n    }\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2050,
        "y": 1260,
        "wires": [
            [
                "23ceec46b77ec023"
            ]
        ]
    },
    {
        "id": "ff3489f6af636d3e",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "logo",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "logo",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 3250,
        "y": 1380,
        "wires": []
    },
    {
        "id": "987ffba0161f53dd",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "return msg",
        "func": "return msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3050,
        "y": 1300,
        "wires": [
            [
                "1eda19281f9ac300",
                "98735c51603e23a5",
                "72a3768c6f5e019f",
                "da53a313b6ddd22f",
                "ff3489f6af636d3e"
            ]
        ]
    },
    {
        "id": "f46b1b0297aae9e4",
        "type": "udp out",
        "z": "4ab7a6698d04b636",
        "name": "AVMatrix",
        "addr": "",
        "iface": "",
        "port": "",
        "ipv": "udp4",
        "outport": "",
        "base64": false,
        "multicast": "false",
        "x": 1880,
        "y": 1140,
        "wires": []
    },
    {
        "id": "f7c93a42f6aec1b8",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "cmd \"Check state\"",
        "func": "var cmd = [0x5a, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x02, 0xfe, 0x01, 0x66, 0xdd]\nmsg.payload = Buffer.from(cmd)\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1570,
        "y": 1140,
        "wires": [
            [
                "3926abafcecd46bc"
            ]
        ]
    },
    {
        "id": "3926abafcecd46bc",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "+IP+port",
        "func": "msg.ip = global.get(\"videomixer_ip\")\nmsg.port = global.get(\"videomixer_port\")\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1740,
        "y": 1140,
        "wires": [
            [
                "f46b1b0297aae9e4"
            ]
        ]
    },
    {
        "id": "4a705030fdbaa0d1",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "name": "ping >",
        "props": [],
        "repeat": "4",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 1400,
        "y": 1140,
        "wires": [
            [
                "f7c93a42f6aec1b8"
            ]
        ]
    },
    {
        "id": "d6fd59585181d1da",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "debug 221",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 390,
        "y": 2580,
        "wires": []
    },
    {
        "id": "66d1b04309b85d99",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "debug 222",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 410,
        "y": 3020,
        "wires": []
    },
    {
        "id": "0269fb649b3c73f8",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "debug 223",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1190,
        "y": 3180,
        "wires": []
    },
    {
        "id": "1a17f024ec69316c",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "debug 224",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 3200,
        "wires": []
    },
    {
        "id": "9d9a8ba79f8a7498",
        "type": "inject",
        "z": "4ab7a6698d04b636",
        "name": "ping >",
        "props": [],
        "repeat": "4",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 1400,
        "y": 1560,
        "wires": [
            [
                "6431f5579b7fddb8"
            ]
        ]
    },
    {
        "id": "f27f5d852b85f645",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Basic YWRtaW46YWRtaW4="
            }
        ],
        "x": 1850,
        "y": 1600,
        "wires": [
            [
                "654c3e83e15adc57"
            ]
        ]
    },
    {
        "id": "16d0f4860302458e",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/event/contrl-menu-basic\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1830,
        "y": 1560,
        "wires": [
            [
                "f27f5d852b85f645"
            ]
        ]
    },
    {
        "id": "3c7786e7e12b4c0c",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "URL",
        "func": "msg.url = \"http://\" + global.get(\"videomixer_ip\") + \"/cgi-bin/entry.cgi/system/login\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1610,
        "y": 1600,
        "wires": [
            [
                "737de9c44aa94f80"
            ]
        ]
    },
    {
        "id": "6431f5579b7fddb8",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "authorization",
        "func": "msg.payload = {sUserName: \"admin\", sPassword: \"YWRtaW4=\"}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1590,
        "y": 1560,
        "wires": [
            [
                "3c7786e7e12b4c0c"
            ]
        ]
    },
    {
        "id": "737de9c44aa94f80",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "name": "",
        "method": "PUT",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Basic YWRtaW46YWRtaW4="
            }
        ],
        "x": 1590,
        "y": 1640,
        "wires": [
            [
                "edd39c00ec095bec",
                "e48ff02fdb9a99b9"
            ]
        ]
    },
    {
        "id": "54f4518a22fbac25",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "headers",
        "func": "msg.headers = {\n    Authorization: \"Bearer \" + msg.token,\n    Cookie: \"token=\" + msg.token\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 1720,
        "wires": [
            [
                "16d0f4860302458e"
            ]
        ]
    },
    {
        "id": "edd39c00ec095bec",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "get token",
        "func": "msg.token = msg.responseCookies.token.value\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 1680,
        "wires": [
            [
                "54f4518a22fbac25"
            ]
        ]
    },
    {
        "id": "654c3e83e15adc57",
        "type": "function",
        "z": "4ab7a6698d04b636",
        "name": "parse JSON",
        "func": "msg.payload = JSON.parse(msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2030,
        "y": 1600,
        "wires": [
            [
                "f1fd281ee1442c33"
            ]
        ]
    },
    {
        "id": "f1fd281ee1442c33",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "debug 225",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2210,
        "y": 1600,
        "wires": []
    },
    {
        "id": "56ab55e338a9fd88",
        "type": "comment",
        "z": "4ab7a6698d04b636",
        "name": "Приходящие данные",
        "info": "AUTO: \"0\"\nAUTO_TIME: \"0.2\"\nAUTO_TYPE: \"MIX\"\nCHROMA: \"0\"\nCHROMA_O: \"0\"\nCUT: \"0\"\nDSK: \"0\"\nDSK_O: \"0\"\nFTB: \"0\"\nFTB_TIME: \"0.5\"\nFTB_with_MUTE: \"1\"\nLOGO: \"0\"\nLOGO_O: \"0\"\nMUTE: \"0\"\nPGM: \"1\"\nPIP1: \"0\"\nPIP1_O: \"0\"\nPIP2: \"0\"\nPIP2_O: \"1\"\nPOP: \"0\"\nPOP_O: \"0\"\nPVW: \"3\"\nSTILL: \"0\"\nTBAR: \"0\"",
        "x": 2060,
        "y": 1560,
        "wires": []
    },
    {
        "id": "e48ff02fdb9a99b9",
        "type": "debug",
        "z": "4ab7a6698d04b636",
        "name": "debug 226",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1830,
        "y": 1640,
        "wires": []
    },
    {
        "id": "fb9b69bdb772eba7",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Basic YWRtaW46YWRtaW4="
            }
        ],
        "x": 1030,
        "y": 1840,
        "wires": [
            []
        ]
    },
    {
        "id": "dcb97d53860a71bc",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Basic YWRtaW46YWRtaW4="
            }
        ],
        "x": 1030,
        "y": 1500,
        "wires": [
            []
        ]
    },
    {
        "id": "95ed3ebcff8d29d5",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Basic YWRtaW46YWRtaW4="
            }
        ],
        "x": 570,
        "y": 1360,
        "wires": [
            [
                "c56bae8907739312"
            ]
        ]
    },
    {
        "id": "8224fa649ab2a625",
        "type": "http request",
        "z": "4ab7a6698d04b636",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Basic YWRtaW46YWRtaW4="
            }
        ],
        "x": 810,
        "y": 1320,
        "wires": [
            [
                "88efe7c6e251a59f"
            ]
        ]
    },
    {
        "id": "c1dd8285565d61bc",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "event parsing",
        "func": "// Предыдущее состояние\nvar old_mode = msg.data.old_state.attributes.mode;\nvar old_in1 = msg.data.old_state.attributes.out1;\nvar old_in2 = msg.data.old_state.attributes.out2;\n\n// Новое состояние\nvar new_mode = msg.data.new_state.attributes.mode;\nvar new_in1 = msg.data.new_state.attributes.out1;\nvar new_in2 = msg.data.new_state.attributes.out2;\n\n\nvar new_smooth = msg.data.new_state.attributes.smooth;\nvar new_logo = msg.data.new_state.attributes.logo;\n\nif (typeof new_smooth == \"undefined\") {\n    new_smooth = false\n}\n\nif (typeof new_logo == \"undefined\") {\n    new_logo = false\n}\n\nif (typeof new_mode == \"undefined\") {\n    new_mode = \"normal\"\n}\n\n// Массив выходных сообщений\nvar messages = []\n\n// Смена режима:\nif (old_mode != new_mode) {\n    messages.push({\n        mode: new_mode,\n        in1: new_in1, // для режима POP и Normal\n        in2: new_in2, // для режима POP\n        type: \"set mode\",\n        logo: new_logo // для режима PIP, чтобы логотип не сломался\n    })\n}\n\n// Смена источника для 1 канала:\nif (old_in1 != new_in1) {\n    messages.push({\n        mode: new_mode,\n        in1: new_in1,\n        in2: new_in2, // для режима POP\n        smooth: new_smooth, // для режима Normal\n        type: \"set in1\"\n    })\n}\n\n// Смена источника для 2 канала:\nif (old_in2 != new_in2) {\n    messages.push({\n        mode: new_mode,\n        in1: new_in1, // для режима POP\n        in2: new_in2,\n        type: \"set in2\"\n    })\n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 220,
        "wires": [
            [
                "3a607bebefce0e65"
            ]
        ]
    },
    {
        "id": "e404fe59a57623d4",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "switch msg.type",
        "property": "type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "set mode",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set in1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set in2",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 200,
        "y": 580,
        "wires": [
            [
                "7d41d60ceb999213",
                "19c7514ad7168018"
            ],
            [
                "e8341a3ad5968dd2",
                "19c7514ad7168018"
            ],
            [
                "dbf094fd8b6d3375",
                "19c7514ad7168018"
            ]
        ]
    },
    {
        "id": "ad9da181f79d15d9",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "2. Смена источника для 1 канала",
        "info": "",
        "x": 260,
        "y": 480,
        "wires": []
    },
    {
        "id": "e93ac68ef472e24b",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "1. Смена режима",
        "info": "",
        "x": 210,
        "y": 440,
        "wires": []
    },
    {
        "id": "f9eb610c56ad4525",
        "type": "server-state-changed",
        "z": "f6992051cb6c0c5c",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomixer",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 180,
        "y": 140,
        "wires": [
            [
                "c1dd8285565d61bc"
            ]
        ]
    },
    {
        "id": "3b53f43b9b2d0c65",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "3. Смена источника для 2 канала",
        "info": "",
        "x": 260,
        "y": 520,
        "wires": []
    },
    {
        "id": "7d41d60ceb999213",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "MODE",
        "property": "mode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "normal",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pip",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pop",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 490,
        "y": 240,
        "wires": [
            [
                "29c863a358e3bec4"
            ],
            [
                "69a387ed51b48657"
            ],
            [
                "b91b2e6d0d1e6e31"
            ]
        ]
    },
    {
        "id": "b91b2e6d0d1e6e31",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "clear_PIP",
        "func": "var cmd = [0x5a, 0x10, 0x00, 0x00, 0x00, 0x00, 0x07, 0x20, 0x00, 0x00, 0x00, 0x00, 0x91, 0xdd]\n\nmsg.payload = Buffer.from(cmd)\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 400,
        "wires": [
            [
                "db34609d192952d6",
                "12f369644fc2014a"
            ]
        ]
    },
    {
        "id": "29c863a358e3bec4",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "Clear_POP",
        "func": "var data = Buffer.from([0x5a, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x04, 0x26, 0x00, 0x00, 0x00, 0x91, 0xdd])\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 80,
        "wires": [
            [
                "f26d400286365737",
                "be4c422170018da7"
            ]
        ]
    },
    {
        "id": "69a387ed51b48657",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "Clear_POP",
        "func": "var data = Buffer.from([0x5a, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x04, 0x26, 0x00, 0x00, 0x00, 0x91, 0xdd])\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 220,
        "wires": [
            [
                "ae4d1353c55e8682",
                "a098680b90d21059"
            ]
        ]
    },
    {
        "id": "131bc0d5f258fbb0",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "set_mode_PIP1",
        "func": "var PIP_1_state = 2\nvar PIP_2_state = 0  \nvar cmd = [0x5a, 0x10, 0x00, 0x00, 0x00, 0x00, 0x07, 0x20, 0x00, 0x00, PIP_1_state, PIP_2_state, 0x00, Number(msg.logo) * 2, 0x91 + PIP_1_state + PIP_2_state + Number(msg.logo) * 2, 0xdd]\nmsg.payload = Buffer.from(cmd)\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 340,
        "wires": [
            [
                "734e86bc47ba1aaf"
            ]
        ]
    },
    {
        "id": "5a9a6ac134880ea9",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "set_mode_NORMAL",
        "func": "var PIP_1_state = 0\nvar PIP_2_state = 0\n\nvar cmd = [0x5a, 0x10, 0x00, 0x00, 0x00, 0x00, 0x07, 0x20, 0x00, 0x00, PIP_1_state, PIP_2_state, 0x00, Number(msg.logo) * 2, 0x91 + PIP_1_state + PIP_2_state + Number(msg.logo) * 2, 0xdd]\n\nmsg.payload = Buffer.from(cmd)\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 160,
        "wires": [
            [
                "13e295e7723279c7"
            ]
        ]
    },
    {
        "id": "0f0724bb18a71e90",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "set_mode_POP_set_In1_set_In2",
        "func": "var POP_state = 0x02 // to PGM\nvar POP_source_1 = 3 + msg.in1\nvar POP_source_2 = 3 + msg.in2\n\nvar cmd_start = [0x5a, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x04, 0x26]\nvar cmd_end = [0xdd] \nvar check_sum = 0x91 + POP_state + POP_source_1 + POP_source_2\n// cmd_start + [POP_state] + [POP_source_1] + [POP_source_2] + [check_sum] + cmd_end\nvar cmd = cmd_start.concat([POP_state]).concat([POP_source_1]).concat(POP_source_2).concat([check_sum]).concat(cmd_end)\nmsg.payload = Buffer.from(cmd)\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 480,
        "wires": [
            [
                "e7144847978b2f5b"
            ]
        ]
    },
    {
        "id": "1d5c17a711ccc0ee",
        "type": "udp out",
        "z": "f6992051cb6c0c5c",
        "name": "AVMatrix",
        "addr": "",
        "iface": "",
        "port": "",
        "ipv": "udp4",
        "outport": "",
        "base64": false,
        "multicast": "false",
        "x": 1700,
        "y": 500,
        "wires": []
    },
    {
        "id": "5a0955dac8789edb",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "6 msg / 1 s",
        "pauseType": "rate",
        "timeout": "350",
        "timeoutUnits": "milliseconds",
        "rate": "6",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1390,
        "y": 500,
        "wires": [
            [
                "c072d0246e2f1dc9"
            ]
        ]
    },
    {
        "id": "c072d0246e2f1dc9",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "VMI",
        "func": "msg.ip = global.get(\"videomixer_ip\")\nmsg.port = global.get(\"videomixer_port\")\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1550,
        "y": 500,
        "wires": [
            [
                "1d5c17a711ccc0ee"
            ]
        ]
    },
    {
        "id": "db34609d192952d6",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "PGM_Setup_BANNER",
        "func": "var video_in = 5\nvar check_sum = 121 + video_in\nvar cmd = [90, 11, 0, 0, 0, 0, 2, 18, video_in, check_sum, 221]\nmsg.payload = Buffer.from(cmd)\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 440,
        "wires": [
            [
                "0f0724bb18a71e90",
                "7b53952437b31b23"
            ]
        ]
    },
    {
        "id": "fc28f258e422c84c",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "PGM_Setup_In1",
        "func": "var video_in = msg.in1\nvar check_sum = 121 + video_in\nvar data = Buffer.from([90, 11, 0, 0, 0, 0, 2, 18, video_in, check_sum, 221])\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 560,
        "wires": [
            [
                "0f949ec857bc3b09"
            ]
        ]
    },
    {
        "id": "6f45ee4fdd87da81",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "PVW_Source_In1",
        "func": "var video_in = msg.in1\nvar check_sum = 122 + video_in\nvar cmd = [90, 11, 0, 0, 0, 0, 2, 19, video_in, check_sum, 221]\nmsg.payload = Buffer.from(cmd)\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 600,
        "wires": [
            [
                "e4cb273298f6eb07",
                "7ff523966960224f"
            ]
        ]
    },
    {
        "id": "e4cb273298f6eb07",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "call_transition",
        "func": "var cmd = [0x5a, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x03, 0x11, 0x01, 0xfe, 0x79, 0xdd]\nmsg.payload = Buffer.from(cmd)\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 640,
        "wires": [
            [
                "905c808dec80a389"
            ]
        ]
    },
    {
        "id": "5f82be03c49a1141",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "smooth",
        "property": "smooth",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 500,
        "y": 580,
        "wires": [
            [
                "fc28f258e422c84c"
            ],
            [
                "6f45ee4fdd87da81"
            ]
        ]
    },
    {
        "id": "e8341a3ad5968dd2",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "MODE",
        "property": "mode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "normal",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pip",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pop",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 490,
        "y": 680,
        "wires": [
            [
                "5f82be03c49a1141"
            ],
            [
                "b290a3b873e451e7"
            ],
            [
                "79182e4b0a658e2b"
            ]
        ]
    },
    {
        "id": "b290a3b873e451e7",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "PGM_Setup_In1",
        "func": "var video_in = msg.in1\nvar check_sum = 121 + video_in\nvar data = Buffer.from([90, 11, 0, 0, 0, 0, 2, 18, video_in, check_sum, 221])\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 700,
        "wires": [
            [
                "8bab75943984ea53"
            ]
        ]
    },
    {
        "id": "79182e4b0a658e2b",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "set_mode_POP_set_In1_set_In2",
        "func": "var POP_state = 0x02 // to PGM\nvar POP_source_1 = 3 + msg.in1\nvar POP_source_2 = 3 + msg.in2\n\nvar cmd_start = [0x5a, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x04, 0x26]\nvar cmd_end = [0xdd] \nvar check_sum = 0x91 + POP_state + POP_source_1 + POP_source_2\n// cmd_start + [POP_state] + [POP_source_1] + [POP_source_2] + [check_sum] + cmd_end\nvar cmd = cmd_start.concat([POP_state]).concat([POP_source_1]).concat(POP_source_2).concat([check_sum]).concat(cmd_end)\nmsg.payload = Buffer.from(cmd)\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 760,
        "wires": [
            [
                "d95d35302c515a0d"
            ]
        ]
    },
    {
        "id": "2bc22cf1622852fb",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "PIP_source_In2",
        "func": "var in2 = 3 + msg.in2\nvar PIP_size = 1 // {0: 1/2, 1: 1/4, 2: 1/8}\nvar x = 100\nvar y = 100\n\nvar cmd_start = [0x5a, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x05, 0x24]\nvar cmd_end = [0xdd]\nvar check_sum = (1 + x + y + 144 + in2 + PIP_size) % 256\nvar cmd_middle = [PIP_size, x, y, check_sum]\nvar cmd = cmd_start.concat([in2]).concat(cmd_middle).concat(cmd_end)\n\nmsg.payload = Buffer.from(cmd)\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 840,
        "wires": [
            [
                "e77c2da2667d3009"
            ]
        ]
    },
    {
        "id": "dbf094fd8b6d3375",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "MODE",
        "property": "mode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "normal",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pip",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pop",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 490,
        "y": 840,
        "wires": [
            [
                "2bc22cf1622852fb"
            ],
            [
                "2bc22cf1622852fb"
            ],
            [
                "f0523c5b3d08a801"
            ]
        ]
    },
    {
        "id": "f0523c5b3d08a801",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "set_mode_POP_set_In1_set_In2",
        "func": "var POP_state = 0x02 // to PGM\nvar POP_source_1 = 3 + msg.in1\nvar POP_source_2 = 3 + msg.in2\n\nvar cmd_start = [0x5a, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x04, 0x26]\nvar cmd_end = [0xdd] \nvar check_sum = 0x91 + POP_state + POP_source_1 + POP_source_2\n// cmd_start + [POP_state] + [POP_source_1] + [POP_source_2] + [check_sum] + cmd_end\nvar cmd = cmd_start.concat([POP_state]).concat([POP_source_1]).concat(POP_source_2).concat([check_sum]).concat(cmd_end)\nmsg.payload = Buffer.from(cmd)\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 880,
        "wires": [
            [
                "d08975ac239ef499"
            ]
        ]
    },
    {
        "id": "f26d400286365737",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "PGM_Setup_In1",
        "func": "var video_in = msg.in1\nvar check_sum = 121 + video_in\nvar data = Buffer.from([90, 11, 0, 0, 0, 0, 2, 18, video_in, check_sum, 221])\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 120,
        "wires": [
            [
                "5a9a6ac134880ea9",
                "1c5b6c6d451b66ea"
            ]
        ]
    },
    {
        "id": "4913b34b31db0fc7",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "PIP_source_In2",
        "func": "var in2 = 3 + msg.in2\nvar PIP_size = 1 // {0: 1/2, 1: 1/4, 2: 1/8}\nvar x = 100\nvar y = 100\n\nvar cmd_start = [0x5a, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x05, 0x24]\nvar cmd_end = [0xdd]\nvar check_sum = (1 + x + y + 144 + in2 + PIP_size) % 256\nvar cmd_middle = [PIP_size, x, y, check_sum]\nvar cmd = cmd_start.concat([in2]).concat(cmd_middle).concat(cmd_end)\n\nmsg.payload = Buffer.from(cmd)\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 300,
        "wires": [
            [
                "131bc0d5f258fbb0",
                "77b136a1bfdc18fe"
            ]
        ]
    },
    {
        "id": "ae4d1353c55e8682",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "PGM_Setup_In1",
        "func": "var video_in = msg.in1\nvar check_sum = 121 + video_in\nvar data = Buffer.from([90, 11, 0, 0, 0, 0, 2, 18, video_in, check_sum, 221])\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 260,
        "wires": [
            [
                "4913b34b31db0fc7",
                "390dcd64c628e0ea"
            ]
        ]
    },
    {
        "id": "9a2b1b676e0dcf4b",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "+ old_status, new_status, standby",
        "func": "msg.prev_status = msg.device_statuses.attributes.videomixer\n\nmsg.new_status = msg.payload\n\nmsg.standby = msg.standby.attributes.standby\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 3160,
        "wires": [
            [
                "7e761d8c3b4c8ea9"
            ]
        ]
    },
    {
        "id": "404e3f594621c4fe",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 860,
        "y": 2980,
        "wires": [
            [
                "af0d802c72fe683c"
            ]
        ]
    },
    {
        "id": "5c8d91d3d37f6857",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": "device_statuses.videomixer = 0",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"videomixer\":0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1990,
        "y": 3200,
        "wires": [
            []
        ]
    },
    {
        "id": "fc3835494e4287f9",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 840,
        "y": 3100,
        "wires": [
            [
                "9a2b1b676e0dcf4b"
            ]
        ]
    },
    {
        "id": "64c9bcf106681ac4",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "payload",
        "func": "msg.payload = global.get(\"videomixer_ip\")\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 2980,
        "wires": [
            [
                "02d17dde8e47cc1b"
            ]
        ]
    },
    {
        "id": "ce33cd4c8d4ca490",
        "type": "ping",
        "z": "f6992051cb6c0c5c",
        "protocol": "IPv4",
        "mode": "triggered",
        "name": "",
        "host": "",
        "timer": "2",
        "inputs": 1,
        "x": 690,
        "y": 2960,
        "wires": [
            [
                "404e3f594621c4fe",
                "79525fcd1d510a6c",
                "de3a6768905b8565"
            ]
        ]
    },
    {
        "id": "df97d2cc474a7311",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "name": "ping >",
        "props": [],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 200,
        "y": 2980,
        "wires": [
            [
                "64c9bcf106681ac4"
            ]
        ]
    },
    {
        "id": "baf6317042693590",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "switch msg.standby",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turning on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turning off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1190,
        "y": 3260,
        "wires": [
            [
                "192095f3ddb0c33d"
            ],
            [
                "7724fb6efde33f1d"
            ],
            [
                "7724fb6efde33f1d"
            ],
            [
                "b2ac7519487b8486"
            ]
        ]
    },
    {
        "id": "126bb934e512d5e1",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "1. on",
        "info": "",
        "x": 1150,
        "y": 3320,
        "wires": []
    },
    {
        "id": "1b5ccecc28292946",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": "device_statuses.videomixer = 1",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"videomixer\":1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1990,
        "y": 3260,
        "wires": [
            []
        ]
    },
    {
        "id": "57f1312557343680",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": "device_statuses.videomixer = 2",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"videomixer\":2}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1990,
        "y": 3320,
        "wires": [
            []
        ]
    },
    {
        "id": "0b9a3ab670836f40",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "2. turning on",
        "info": "",
        "x": 1170,
        "y": 3360,
        "wires": []
    },
    {
        "id": "0ef7ac5b0fb467ce",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "3. turning off",
        "info": "",
        "x": 1170,
        "y": 3400,
        "wires": []
    },
    {
        "id": "680d847f06156123",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "4. off",
        "info": "",
        "x": 1150,
        "y": 3440,
        "wires": []
    },
    {
        "id": "be4c422170018da7",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 80,
        "wires": [
            [
                "6d95ea8ea803cda5"
            ]
        ]
    },
    {
        "id": "1c5b6c6d451b66ea",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 120,
        "wires": [
            [
                "6d95ea8ea803cda5"
            ]
        ]
    },
    {
        "id": "13e295e7723279c7",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 160,
        "wires": [
            [
                "6d95ea8ea803cda5"
            ]
        ]
    },
    {
        "id": "12f369644fc2014a",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 400,
        "wires": [
            [
                "6d95ea8ea803cda5"
            ]
        ]
    },
    {
        "id": "7b53952437b31b23",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 440,
        "wires": [
            [
                "6d95ea8ea803cda5"
            ]
        ]
    },
    {
        "id": "e7144847978b2f5b",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 480,
        "wires": [
            [
                "6d95ea8ea803cda5"
            ]
        ]
    },
    {
        "id": "390dcd64c628e0ea",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 260,
        "wires": [
            [
                "6d95ea8ea803cda5"
            ]
        ]
    },
    {
        "id": "77b136a1bfdc18fe",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 300,
        "wires": [
            [
                "6d95ea8ea803cda5"
            ]
        ]
    },
    {
        "id": "734e86bc47ba1aaf",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 340,
        "wires": [
            [
                "6d95ea8ea803cda5"
            ]
        ]
    },
    {
        "id": "a098680b90d21059",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 220,
        "wires": [
            [
                "6d95ea8ea803cda5"
            ]
        ]
    },
    {
        "id": "6d95ea8ea803cda5",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1170,
        "y": 280,
        "wires": [
            [
                "5a0955dac8789edb"
            ]
        ]
    },
    {
        "id": "0f949ec857bc3b09",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 560,
        "wires": [
            [
                "73ba576e6b4b9559"
            ]
        ]
    },
    {
        "id": "7ff523966960224f",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 600,
        "wires": [
            [
                "73ba576e6b4b9559"
            ]
        ]
    },
    {
        "id": "905c808dec80a389",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 640,
        "wires": [
            [
                "73ba576e6b4b9559"
            ]
        ]
    },
    {
        "id": "8bab75943984ea53",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 700,
        "wires": [
            [
                "73ba576e6b4b9559"
            ]
        ]
    },
    {
        "id": "d95d35302c515a0d",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 760,
        "wires": [
            [
                "73ba576e6b4b9559"
            ]
        ]
    },
    {
        "id": "e77c2da2667d3009",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 840,
        "wires": [
            [
                "c48908a60af1ca64"
            ]
        ]
    },
    {
        "id": "d08975ac239ef499",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 990,
        "y": 880,
        "wires": [
            [
                "c48908a60af1ca64"
            ]
        ]
    },
    {
        "id": "73ba576e6b4b9559",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1170,
        "y": 660,
        "wires": [
            [
                "5a0955dac8789edb"
            ]
        ]
    },
    {
        "id": "c48908a60af1ca64",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1170,
        "y": 860,
        "wires": [
            [
                "5a0955dac8789edb"
            ]
        ]
    },
    {
        "id": "d10950be6f0bedde",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "custombuttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.custom_buttons",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "cbtns",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 340,
        "y": 1440,
        "wires": [
            [
                "a5da2cb4293773a8"
            ]
        ]
    },
    {
        "id": "a5da2cb4293773a8",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "pres, state",
        "func": "// var state = new Date()\n// msg.state = state.getTime()\nmsg.state = Number(msg.cbtns.state)\n\nvar presentation = msg.cbtns.attributes.presentation;\nvar in1_for_presentation = flow.get(\"in1_for_presentation\")\nvar in2_for_presentation = flow.get(\"in2_for_presentation\")\nvar in1 = msg.data.new_state.attributes.out1;\nvar in2 = msg.data.new_state.attributes.out2;\nvar mode = msg.data.new_state.attributes.mode;\n\nvar answer = 0\n\nif (presentation == false)\n{\n    if (in1 == in1_for_presentation && in2 == in2_for_presentation && mode == \"pip\") {\n        answer = 2 // turn on\n    }\n}\n// else // i.e. presentation == true\nelse if (presentation == true)\n{\n    if (in1 != in1_for_presentation || in2 != in2_for_presentation || mode != \"pip\")\n    {\n        answer = 1 // turn off\n    }\n}\n\nreturn {\n        answer: answer,\n        state:msg.state\n    };",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 1440,
        "wires": [
            [
                "02096ffa59cf1faf"
            ]
        ]
    },
    {
        "id": "02096ffa59cf1faf",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "turn pres",
        "property": "answer",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 680,
        "y": 1440,
        "wires": [
            [
                "d9050467eaf4e3bd"
            ],
            [
                "01d9ce125a4912a1"
            ]
        ]
    },
    {
        "id": "d9050467eaf4e3bd",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": "custom_buttons set Pres False",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.custom_buttons\", \"state\":{{state}}, \"presentation\": false}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 910,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "01d9ce125a4912a1",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": "custom_buttons set Pres True",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.custom_buttons\",\"state\":{{state}}, \"presentation\": true}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 910,
        "y": 1460,
        "wires": [
            []
        ]
    },
    {
        "id": "d7c08ab5a83aa68f",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "Синхронизация состояния кнопки \"Presentation\"",
        "info": "",
        "x": 310,
        "y": 1400,
        "wires": []
    },
    {
        "id": "5855e37701204788",
        "type": "server-state-changed",
        "z": "f6992051cb6c0c5c",
        "name": "custom_buttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.custom_buttons",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 200,
        "y": 1600,
        "wires": [
            [
                "6bc1266145cd08bb"
            ]
        ]
    },
    {
        "id": "45ec3ceb0e2aad23",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "pres, state",
        "func": "// var state = new Date()\n// state = state.getTime()\n\nvar presentation = msg.payload.new_state.attributes.presentation;\nvar oldpresentation = msg.payload.old_state.attributes.presentation;\n\nif (presentation != oldpresentation) {\n    return {\n        presentation:presentation,\n        state: msg.state\n    };\n}\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 1600,
        "wires": [
            [
                "6a47e3d57af9cfb5"
            ]
        ]
    },
    {
        "id": "6a47e3d57af9cfb5",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "property": "presentation",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 810,
        "y": 1600,
        "wires": [
            [
                "3dfa8d969b986d7b"
            ],
            [
                "92c89954cf7f4955"
            ]
        ]
    },
    {
        "id": "64033bb59d86ce1e",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomixer\",\"state\":{{state}}, \"out1\": {{in1_for_presentation}}, \"out2\": {{in2_for_presentation}}, \"mode\": \"pip\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1250,
        "y": 1580,
        "wires": [
            []
        ]
    },
    {
        "id": "51a14335bfcc068a",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomixer\",\"state\":{{state}}, \"out1\": {{in1_for_exit_presentation}}, \"mode\": \"normal\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1250,
        "y": 1620,
        "wires": [
            []
        ]
    },
    {
        "id": "e10d79e026cbd81e",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "Обработка нажатий кастомной кнопки \"Presentation\"",
        "info": "",
        "x": 320,
        "y": 1560,
        "wires": []
    },
    {
        "id": "4381dc1d68eb7cdc",
        "type": "server-state-changed",
        "z": "f6992051cb6c0c5c",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomixer",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 180,
        "y": 1440,
        "wires": [
            [
                "d10950be6f0bedde"
            ]
        ]
    },
    {
        "id": "78c9140f25a1edb0",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "УПРАВЛЕНИЕ ОБОРУДОВАНИЕМ",
        "info": "",
        "x": 260,
        "y": 100,
        "wires": []
    },
    {
        "id": "677e761230f5806c",
        "type": "udp out",
        "z": "f6992051cb6c0c5c",
        "name": "AVMatrix",
        "addr": "",
        "iface": "",
        "port": "",
        "ipv": "udp4",
        "outport": "",
        "base64": false,
        "multicast": "false",
        "x": 580,
        "y": 2740,
        "wires": []
    },
    {
        "id": "5ef19505f2523572",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "cmd",
        "func": "var cmd = [0x5a, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x02, 0xfe, 0x01, 0x66, 0xdd]\nmsg.payload = Buffer.from(cmd)\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 2740,
        "wires": [
            [
                "50c9b3133ccfc587"
            ]
        ]
    },
    {
        "id": "924b84403bfd94e9",
        "type": "udp in",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "iface": "",
        "port": "19522",
        "ipv": "udp4",
        "multicast": "false",
        "group": "",
        "datatype": "buffer",
        "x": 440,
        "y": 2780,
        "wires": [
            [
                "1aa767a3683d9812"
            ]
        ]
    },
    {
        "id": "1aa767a3683d9812",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "Статус FTB",
        "func": "if (msg.payload[6] == 0x03 && msg.payload[7] == 0x11 && msg.payload[8] == 0x03) {\n    return {'ftb': msg.payload[9]}\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 2780,
        "wires": [
            [
                "1d4e6883376d63c1"
            ]
        ]
    },
    {
        "id": "1d4e6883376d63c1",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "StandBy",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 740,
        "y": 2780,
        "wires": [
            [
                "c0e590ada72e5b9e"
            ]
        ]
    },
    {
        "id": "c0e590ada72e5b9e",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "standby",
        "func": "msg.standby = msg.standby.attributes.standby\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 2780,
        "wires": [
            [
                "19661c091e7e330f"
            ]
        ]
    },
    {
        "id": "19661c091e7e330f",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "switch msg.standby",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "turningoff",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turningon",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1050,
        "y": 2780,
        "wires": [
            [
                "7a10f5ca98541c16"
            ],
            [
                "be9faa5a64179477"
            ]
        ]
    },
    {
        "id": "1c5920f5784769ae",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "2. turning on",
        "info": "",
        "x": 1030,
        "y": 2740,
        "wires": []
    },
    {
        "id": "5eb1d571625916fd",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "1. turning off",
        "info": "",
        "x": 1030,
        "y": 2700,
        "wires": []
    },
    {
        "id": "6be617826ffcc35d",
        "type": "server-state-changed",
        "z": "f6992051cb6c0c5c",
        "name": "Standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.standby",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "seconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 180,
        "y": 2740,
        "wires": [
            [
                "5ef19505f2523572"
            ]
        ]
    },
    {
        "id": "7a10f5ca98541c16",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "ftb=1",
        "property": "ftb",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1230,
        "y": 2760,
        "wires": [
            [
                "fa09ebabc958cb68",
                "738f4860406f25d2"
            ]
        ]
    },
    {
        "id": "be9faa5a64179477",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "ftb=0",
        "property": "ftb",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1230,
        "y": 2800,
        "wires": [
            [
                "fa09ebabc958cb68",
                "90b0a5d297036657"
            ]
        ]
    },
    {
        "id": "50c9b3133ccfc587",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "+IP+port",
        "func": "msg.ip = global.get(\"videomixer_ip\")\nmsg.port = global.get(\"videomixer_port\")\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 2740,
        "wires": [
            [
                "677e761230f5806c"
            ]
        ]
    },
    {
        "id": "dcef4b5a2a4bb26f",
        "type": "udp out",
        "z": "f6992051cb6c0c5c",
        "name": "AVMatrix",
        "addr": "",
        "iface": "",
        "port": "",
        "ipv": "udp4",
        "outport": "",
        "base64": false,
        "multicast": "false",
        "x": 1640,
        "y": 2780,
        "wires": []
    },
    {
        "id": "fa09ebabc958cb68",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "cmd",
        "func": "var cmd = [0x5a, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x03, 0x11, 0x03, 0x00, 0x7d, 0xdd]\nmsg.payload = Buffer.from(cmd)\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1370,
        "y": 2780,
        "wires": [
            [
                "ed6956069e9f067d"
            ]
        ]
    },
    {
        "id": "ed6956069e9f067d",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "+IP+port",
        "func": "msg.ip = global.get(\"videomixer_ip\")\nmsg.port = global.get(\"videomixer_port\")\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 2780,
        "wires": [
            [
                "dcef4b5a2a4bb26f"
            ]
        ]
    },
    {
        "id": "3889b5fd3eaa14ba",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "Режим StandBy",
        "info": "",
        "x": 200,
        "y": 2700,
        "wires": []
    },
    {
        "id": "5ed70f1f6bc8e4c5",
        "type": "DataIn",
        "z": "f6992051cb6c0c5c",
        "collection": "1ea01473c6ced4e1",
        "name": "-> videomixer",
        "update": false,
        "path": "/",
        "x": 520,
        "y": 1120,
        "wires": []
    },
    {
        "id": "cb28ee8848fd2662",
        "type": "DataOut",
        "z": "f6992051cb6c0c5c",
        "collection": "1ea01473c6ced4e1",
        "name": " videomixer ->",
        "path": "/",
        "error": false,
        "x": 1060,
        "y": 1240,
        "wires": [
            [
                "384e055fd718d2b8"
            ]
        ]
    },
    {
        "id": "bbbdabaf68906b6e",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "+ attributes",
        "func": "if ((Object.keys(msg.data.new_state.attributes).length) > 5)\n{\n    msg.payload = msg.data.new_state\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 1120,
        "wires": [
            [
                "5ed70f1f6bc8e4c5"
            ]
        ]
    },
    {
        "id": "5c10bd30d0cead77",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": " videomixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "all",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1590,
        "y": 1240,
        "wires": [
            [
                "c49a8dd2a81df645",
                "4812c80dd6a1b6f1"
            ]
        ]
    },
    {
        "id": "5c5f99d720c342b1",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "+ state, data",
        "func": "var data = msg.payload.attributes\ndata[\"entity_id\"] = msg.payload.entity_id\ndata[\"state\"] = Number(msg.state) + 1\n\n// data[\"ftb\"] = false\n// data[\"smooth\"] = false\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\": data\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1410,
        "y": 1240,
        "wires": [
            [
                "5c10bd30d0cead77",
                "aedffdf8d5fb98e8",
                "371d48c278d48dea"
            ]
        ]
    },
    {
        "id": "f666fdd5e4765567",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "Запоминание состояния",
        "info": "",
        "x": 230,
        "y": 1080,
        "wires": []
    },
    {
        "id": "f5c4281b5a416bc2",
        "type": "server-state-changed",
        "z": "f6992051cb6c0c5c",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomixer",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": true,
        "ignorePrevStateUnknown": true,
        "ignorePrevStateUnavailable": true,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 180,
        "y": 1120,
        "wires": [
            [
                "bbbdabaf68906b6e"
            ]
        ]
    },
    {
        "id": "ae9c371538184277",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "d": true,
        "name": "Входы для режима \"Презентация\"",
        "info": "",
        "x": 940,
        "y": 1080,
        "wires": []
    },
    {
        "id": "2bff43237ac06f6e",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "d": true,
        "name": "НАСТРОЙКА",
        "info": "",
        "x": 870,
        "y": 1040,
        "wires": []
    },
    {
        "id": "3dfa8d969b986d7b",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "case \"presentation ON\"",
        "func": "msg.in1_for_presentation = flow.get(\"in1_for_presentation\")\nmsg.in2_for_presentation = flow.get(\"in2_for_presentation\")\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 1580,
        "wires": [
            [
                "64033bb59d86ce1e"
            ]
        ]
    },
    {
        "id": "92c89954cf7f4955",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "case \"presentation OFF\"",
        "func": "msg.in1_for_exit_presentation = flow.get(\"in1_for_exit_presentation\")\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 1620,
        "wires": [
            [
                "51a14335bfcc068a"
            ]
        ]
    },
    {
        "id": "aedffdf8d5fb98e8",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "d": true,
        "name": "case \"Presentation\"",
        "func": "// Custom:\nflow.set(\"in1_for_presentation\", 4) // - фон PIP при нажатии кнопки \"Презентация\"\nflow.set(\"in2_for_presentation\", 2) // - окошко PIP при нажатии кнопки \"Презентация\"\nflow.set(\"in1_for_exit_presentation\", 2) // - фон PIP при отжатии кнопки \"Презентация\"",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "344945dac2fa0f68",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "d": true,
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 700,
        "y": 1120,
        "wires": [
            [
                "aedffdf8d5fb98e8"
            ]
        ]
    },
    {
        "id": "c49a8dd2a81df645",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "inputs_cameras",
        "func": "// flow.set(\"inputs_cameras\", [1, 2, 3]) // - в какие входы подключены камеры\nflow.set(\"inputs_cameras\", Array.from({ length: global.get('cameras_qty') }, (_, i) => i + 1))\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1880,
        "y": 1240,
        "wires": [
            []
        ]
    },
    {
        "id": "78d2991ddc50c00f",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "Входы от камер",
        "info": "",
        "x": 1880,
        "y": 1200,
        "wires": []
    },
    {
        "id": "c19030299471b69d",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "d": true,
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1110,
        "y": 1120,
        "wires": [
            [
                "c49a8dd2a81df645"
            ]
        ]
    },
    {
        "id": "6b4292ed3c46813d",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "FTB",
        "info": "",
        "x": 170,
        "y": 2200,
        "wires": []
    },
    {
        "id": "56429c68ac79bc5a",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "new_val_FTB",
        "property": "data.new_state.attributes.ftb",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "data.old_state.attributes.ftb",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 540,
        "y": 2240,
        "wires": [
            [
                "cd0d1ca5ede36199"
            ]
        ]
    },
    {
        "id": "de9a301019f38c59",
        "type": "udp out",
        "z": "f6992051cb6c0c5c",
        "name": "AVMatrix",
        "addr": "",
        "iface": "",
        "port": "",
        "ipv": "udp4",
        "outport": "",
        "base64": false,
        "multicast": "false",
        "x": 660,
        "y": 2360,
        "wires": []
    },
    {
        "id": "031853be22f189ed",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "cmd \"Check state\"",
        "func": "var cmd = [0x5a, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x02, 0xfe, 0x01, 0x66, 0xdd]\nmsg.payload = Buffer.from(cmd)\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 2360,
        "wires": [
            [
                "920e04d316f2aa68"
            ]
        ]
    },
    {
        "id": "396bdb9225b3a955",
        "type": "udp in",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "iface": "",
        "port": "19522",
        "ipv": "udp4",
        "multicast": "false",
        "group": "",
        "datatype": "buffer",
        "x": 660,
        "y": 2400,
        "wires": [
            [
                "89b28faa2d647c69"
            ]
        ]
    },
    {
        "id": "920e04d316f2aa68",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "+IP+port",
        "func": "msg.ip = global.get(\"videomixer_ip\")\nmsg.port = global.get(\"videomixer_port\")\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 2360,
        "wires": [
            [
                "de9a301019f38c59",
                "1505649f3636f117"
            ]
        ]
    },
    {
        "id": "3bbd5e2bc62bcde5",
        "type": "server-state-changed",
        "z": "f6992051cb6c0c5c",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomixer",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 180,
        "y": 2240,
        "wires": [
            [
                "645000bd238dd911"
            ]
        ]
    },
    {
        "id": "cfb384d1134999a6",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "VMI",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomixer",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "vmi",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 970,
        "y": 2400,
        "wires": [
            [
                "156e8ab41bc8c742"
            ]
        ]
    },
    {
        "id": "156e8ab41bc8c742",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "status FTB",
        "property": "vmi.attributes.ftb",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "ftb",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1110,
        "y": 2400,
        "wires": [
            [
                "16437ec891d3cb8a"
            ]
        ]
    },
    {
        "id": "84451440a981b2c0",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1390,
        "y": 2400,
        "wires": [
            []
        ]
    },
    {
        "id": "16437ec891d3cb8a",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "func",
        "func": "// var state = new Date()\n// state = state.getTime()\n\nvar data = {\n    \"entity_id\": \"sensor.videomixer\",\n    // \"state\": Number(msg.vmi.state),\n    \"ftb\": Boolean(msg.ftb)\n};\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    data\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 2400,
        "wires": [
            [
                "84451440a981b2c0"
            ]
        ]
    },
    {
        "id": "0c6394b57b32c1f0",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "Отслеживание FTB",
        "info": "",
        "x": 210,
        "y": 2320,
        "wires": []
    },
    {
        "id": "7981c0074450ce88",
        "type": "udp out",
        "z": "f6992051cb6c0c5c",
        "name": "AVMatrix",
        "addr": "",
        "iface": "",
        "port": "",
        "ipv": "udp4",
        "outport": "",
        "base64": false,
        "multicast": "false",
        "x": 1070,
        "y": 2240,
        "wires": []
    },
    {
        "id": "cd0d1ca5ede36199",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "cmd \"Change FTB\"",
        "func": "var cmd = [0x5a, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x03, 0x11, 0x03, 0x00, 0x7d, 0xdd]\nmsg.payload = Buffer.from(cmd)\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 2240,
        "wires": [
            [
                "9be27abef86fe1fb"
            ]
        ]
    },
    {
        "id": "9be27abef86fe1fb",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "+IP+port",
        "func": "msg.ip = global.get(\"videomixer_ip\")\nmsg.port = global.get(\"videomixer_port\")\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 2240,
        "wires": [
            [
                "7981c0074450ce88"
            ]
        ]
    },
    {
        "id": "1ebcd896ddaea50b",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "name": "Change FTB -->",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 750,
        "y": 2200,
        "wires": [
            [
                "cd0d1ca5ede36199"
            ]
        ]
    },
    {
        "id": "3f5ed003720fdb13",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "name": "ping >",
        "props": [],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 180,
        "y": 2360,
        "wires": [
            [
                "031853be22f189ed"
            ]
        ]
    },
    {
        "id": "f3f37a9967870c8d",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "Отслеживание статуса",
        "info": "",
        "x": 220,
        "y": 2940,
        "wires": []
    },
    {
        "id": "7e761d8c3b4c8ea9",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "new_status == false",
        "property": "new_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "false",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 960,
        "y": 3220,
        "wires": [
            [
                "192095f3ddb0c33d"
            ],
            [
                "baf6317042693590"
            ]
        ]
    },
    {
        "id": "8fca4bea326e6d24",
        "type": "change",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"show\":[\"ВИДЕОМИКШЕР_Править_вход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3520,
        "y": 380,
        "wires": [
            [
                "f1f52cd16ed727ad"
            ]
        ]
    },
    {
        "id": "9d340ed66795d223",
        "type": "ui_button",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "group": "85a5f6c9fcd283b6",
        "order": 4,
        "width": 8,
        "height": 1,
        "passthru": false,
        "label": "Вернуть к заводским настройкам",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "rotate_left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 2480,
        "y": 380,
        "wires": [
            [
                "9083ba647eed1fda"
            ]
        ]
    },
    {
        "id": "ae2e0ce50e7c6e74",
        "type": "ui_form",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "label": "",
        "group": "d881ce800073c6bf",
        "order": 1,
        "width": 6,
        "height": 1,
        "options": [
            {
                "label": "Программный вход",
                "value": "inSoftware",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Физический вход",
                "value": "inHardware",
                "type": "number",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "inSoftware": "",
            "inHardware": ""
        },
        "payload": "",
        "submit": "Подтвердить",
        "cancel": "",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "className": "",
        "x": 3730,
        "y": 420,
        "wires": [
            [
                "93e222292bb90aa3"
            ]
        ]
    },
    {
        "id": "f1f52cd16ed727ad",
        "type": "ui_ui_control",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "events": "all",
        "x": 3740,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "4c4197e60344a34e",
        "type": "ui_button",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "group": "d881ce800073c6bf",
        "order": 2,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Закрыть",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3300,
        "y": 340,
        "wires": [
            [
                "44d257ccfb339ae4"
            ]
        ]
    },
    {
        "id": "273aaf1cf55212c8",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "get data to refresh table",
        "func": "var inputs = flow.get('inputs')\n\nvar data = []\n\nfor (const key of inputs.keys()) {\n  data.push({'inSoftware': key, 'inHardware': inputs.get(key)})\n}\n\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3050,
        "y": 420,
        "wires": [
            [
                "232ea1d60c307a83",
                "dc734cebfb63220e",
                "3c547dafb16415a1"
            ]
        ]
    },
    {
        "id": "4bfd0e8a5b35b9e7",
        "type": "ui_button",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "group": "85a5f6c9fcd283b6",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-plus-square",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 2390,
        "y": 420,
        "wires": [
            [
                "45ea7ff5d6632691"
            ]
        ]
    },
    {
        "id": "93e222292bb90aa3",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "validation",
        "func": "if ((msg.payload.inHardware <= flow.get('inputs').size) && (msg.payload.inHardware >= 1) && (msg.payload.inSoftware <= flow.get('inputs').size) && (msg.payload.inSoftware >= 1))\n{\n    msg.log = 'ok'\n    var inputs = flow.get('inputs')\n    inputs.set(msg.payload.inSoftware, msg.payload.inHardware)\n    flow.set('inputs', inputs)\n}\nelse\n{\n    msg.log = 'incorrect'\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3000,
        "y": 480,
        "wires": [
            [
                "c39034064f22bb8b"
            ]
        ]
    },
    {
        "id": "7d860fed090573db",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "VMI Inpits",
        "info": "",
        "x": 2400,
        "y": 200,
        "wires": []
    },
    {
        "id": "45ea7ff5d6632691",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "manage inputs (add)",
        "func": "if (flow.get('inputs') == undefined) {\n    flow.set('inputs', new Map())\n}\n\nvar inputs = flow.get('inputs')\ninputs.set(inputs.size + 1, inputs.size + 1)\n\nflow.set('inputs', inputs)\n\nmsg.inputs = inputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2720,
        "y": 420,
        "wires": [
            [
                "273aaf1cf55212c8"
            ]
        ]
    },
    {
        "id": "1c0aed558943902d",
        "type": "ui_button",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "group": "85a5f6c9fcd283b6",
        "order": 2,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 2390,
        "y": 460,
        "wires": [
            [
                "c94d96bea48547e1"
            ]
        ]
    },
    {
        "id": "c94d96bea48547e1",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "manage inputs (del)",
        "func": "var inputs = flow.get('inputs')\ninputs.delete(inputs.size)\n\nflow.set('inputs', inputs)\n\nmsg.inputs = inputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2720,
        "y": 460,
        "wires": [
            [
                "273aaf1cf55212c8"
            ]
        ]
    },
    {
        "id": "44d257ccfb339ae4",
        "type": "change",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"hide\":[\"ВИДЕОМИКШЕР_Править_вход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3520,
        "y": 340,
        "wires": [
            [
                "f1f52cd16ed727ad"
            ]
        ]
    },
    {
        "id": "6fc9afa50798adfc",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "validation",
        "func": "var key = msg.row + 1\nvar val = flow.get('inputs').get(msg.row + 1)\n\nflow.set('selectedInput', {'inSoftware': key, 'inHardware': val})\n\nmsg.payload = flow.get('selectedInput')\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3500,
        "y": 420,
        "wires": [
            [
                "ae2e0ce50e7c6e74"
            ]
        ]
    },
    {
        "id": "c39034064f22bb8b",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "log",
        "property": "log",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "incorrect",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ok",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 3110,
        "y": 560,
        "wires": [
            [
                "087f858a45ac6eb6",
                "e38a015aa7c719b8"
            ],
            [
                "54a85a249f293e39",
                "78199a39b9c11654"
            ]
        ]
    },
    {
        "id": "ac362d18a7be2445",
        "type": "ui_toast",
        "z": "f6992051cb6c0c5c",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Вход назначен",
        "name": "Successful",
        "x": 3470,
        "y": 580,
        "wires": []
    },
    {
        "id": "b081a42feeef682c",
        "type": "ui_toast",
        "z": "f6992051cb6c0c5c",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Укажите вход в пределах табличных значений",
        "name": "Incorrect",
        "x": 3480,
        "y": 540,
        "wires": []
    },
    {
        "id": "087f858a45ac6eb6",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3290,
        "y": 540,
        "wires": [
            [
                "b081a42feeef682c"
            ]
        ]
    },
    {
        "id": "54a85a249f293e39",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3290,
        "y": 580,
        "wires": [
            [
                "ac362d18a7be2445"
            ]
        ]
    },
    {
        "id": "e38a015aa7c719b8",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "return last data",
        "func": "msg.payload = {'inSoftware': msg.payload.inSoftware, 'inHardware': flow.get('inputs').get(msg.payload.inSoftware) }\nmsg.event = {'bbox': [580, 221, 898, 173]}\nmsg.socketid = 'w0SaiBu-ePmh8nhNAABF'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3320,
        "y": 500,
        "wires": [
            [
                "ae2e0ce50e7c6e74"
            ]
        ]
    },
    {
        "id": "9083ba647eed1fda",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "reset func",
        "func": "var inputs = flow.get('inputs')\n\nfor (const key of inputs.keys()) {\n  inputs.set(key, key)\n}\n\nflow.set('inputs', inputs)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2760,
        "y": 380,
        "wires": [
            [
                "273aaf1cf55212c8"
            ]
        ]
    },
    {
        "id": "78199a39b9c11654",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "-->",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2770,
        "y": 560,
        "wires": [
            [
                "273aaf1cf55212c8"
            ]
        ]
    },
    {
        "id": "69a0c95f6ed45cac",
        "type": "DataOut",
        "z": "f6992051cb6c0c5c",
        "collection": "d9adc42cfdfe7ee0",
        "name": "videomixer_config ->",
        "path": "/",
        "error": false,
        "x": 3540,
        "y": 200,
        "wires": [
            [
                "7831c7f4f138f62a"
            ]
        ]
    },
    {
        "id": "7831c7f4f138f62a",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "set all to flow",
        "func": "for (let el of msg.payload)\n{\n    if ((el['attr'] == 'inputs') || (el['attr'] == 'outputs')) {\n        const map = new Map(Object.entries(el['val']).map(([key, value]) => [Number(key), value]));\n        flow.set(el['attr'], map)\n    }\n    else\n    {\n        flow.set(el['attr'], el['val'])\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3750,
        "y": 200,
        "wires": [
            [
                "8fe1244ca6c09510"
            ]
        ]
    },
    {
        "id": "e203bb060f229f5d",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "Вызов сохраненного состояния при старте HomeAssistant",
        "info": "",
        "x": 2740,
        "y": 160,
        "wires": []
    },
    {
        "id": "2819893ae421498d",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "new about.home_assistant is true",
        "property": "about.new_state.attributes.home_assistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 3260,
        "y": 200,
        "wires": [
            [
                "69a0c95f6ed45cac"
            ]
        ]
    },
    {
        "id": "5c1c18e4eb0b7a9d",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "old about.home_assistant != new about.home_assistant",
        "property": "about.old_state.attributes.home_assistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "about.new_state.attributes.home_assistant",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2870,
        "y": 200,
        "wires": [
            [
                "2819893ae421498d"
            ]
        ]
    },
    {
        "id": "d4d8d1685b9b873f",
        "type": "change",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"tab\":\"КОНФИГУРАТОР\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4000,
        "y": 300,
        "wires": [
            [
                "f1f52cd16ed727ad"
            ]
        ]
    },
    {
        "id": "df5b64f877924d1a",
        "type": "ui_button",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "group": "cdda5da914347f61",
        "order": 1,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "arrow_back",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3810,
        "y": 300,
        "wires": [
            [
                "d4d8d1685b9b873f"
            ]
        ]
    },
    {
        "id": "b9a4dae09eefb047",
        "type": "server-state-changed",
        "z": "f6992051cb6c0c5c",
        "name": "about",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.about",
        "entityIdType": "exact",
        "outputInitially": false,
        "ifState": "",
        "ifStateType": "str",
        "outputOnlyOnStateChange": false,
        "for": "0",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "about",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.about",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "haltifstate": "",
        "halt_if_type": "str",
        "output_only_on_state_change": false,
        "x": 2570,
        "y": 200,
        "wires": [
            [
                "5c1c18e4eb0b7a9d"
            ]
        ]
    },
    {
        "id": "a4bd89e8b4a08ca1",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "clear all and fields",
        "func": "var keys = flow.keys()\n\nfor (let key of keys)\n{\n    flow.set(key, undefined);\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2580,
        "y": 20,
        "wires": [
            []
        ]
    },
    {
        "id": "654dba5165d04adf",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "name": "CLEAR",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 2400,
        "y": 20,
        "wires": [
            [
                "a4bd89e8b4a08ca1"
            ]
        ]
    },
    {
        "id": "8fe5911c623533a1",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "check all and fields",
        "func": "var keys = flow.keys()\nmsg.keys = keys\nfor (let key of keys)\n{\n    msg[key] = flow.get(key);\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2580,
        "y": 60,
        "wires": [
            [
                "86d1be3bb56b88b2"
            ]
        ]
    },
    {
        "id": "bc8a3059e25a97fd",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "name": "Check",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2400,
        "y": 60,
        "wires": [
            [
                "8fe5911c623533a1"
            ]
        ]
    },
    {
        "id": "86d1be3bb56b88b2",
        "type": "debug",
        "z": "f6992051cb6c0c5c",
        "name": "FLOW.KEYS",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2770,
        "y": 60,
        "wires": []
    },
    {
        "id": "dc734cebfb63220e",
        "type": "link out",
        "z": "f6992051cb6c0c5c",
        "name": "from INs",
        "mode": "link",
        "links": [
            "683c996c450bfd9c",
            "d64d48dff7b746a7"
        ],
        "x": 3255,
        "y": 380,
        "wires": []
    },
    {
        "id": "6e1d653a87d18d46",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "inputs",
        "func": "msg.options = Array.from(flow.get('inputs').keys())\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2550,
        "y": 820,
        "wires": [
            [
                "ac59d62a5193e089",
                "b65835edaafd1cc2"
            ]
        ]
    },
    {
        "id": "de9f43df3c436c35",
        "type": "ui_dropdown",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "label": "1",
        "tooltip": "",
        "place": "",
        "group": "2659c0e4.6c014",
        "order": 9,
        "width": 2,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 2850,
        "y": 1000,
        "wires": [
            [
                "09c2830f2fa9a9f8"
            ]
        ]
    },
    {
        "id": "2f73a0863d23f198",
        "type": "ui_dropdown",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "label": "2",
        "tooltip": "",
        "place": "",
        "group": "2659c0e4.6c014",
        "order": 5,
        "width": 2,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 2850,
        "y": 840,
        "wires": [
            [
                "1640116270d1d031"
            ]
        ]
    },
    {
        "id": "f721d003048c9b31",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2430,
        "y": 760,
        "wires": [
            [
                "d30b281697676fb2"
            ]
        ]
    },
    {
        "id": "683c996c450bfd9c",
        "type": "link in",
        "z": "f6992051cb6c0c5c",
        "name": "to checkbox",
        "links": [
            "dc734cebfb63220e"
        ],
        "x": 2435,
        "y": 820,
        "wires": [
            [
                "6e1d653a87d18d46"
            ]
        ]
    },
    {
        "id": "48b9c369d71f09ea",
        "type": "ui_text",
        "z": "f6992051cb6c0c5c",
        "group": "2659c0e4.6c014",
        "order": 2,
        "width": 5,
        "height": 1,
        "name": "Переход в режим \"Презентация\"",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 2780,
        "y": 760,
        "wires": []
    },
    {
        "id": "d30b281697676fb2",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "text",
        "func": "msg.payload = 'Переход в режим<br>\"Презентация\"'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2550,
        "y": 760,
        "wires": [
            [
                "48b9c369d71f09ea"
            ]
        ]
    },
    {
        "id": "a979f653ae7643ce",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "inputs",
        "func": "msg.options = Array.from(flow.get('inputs').keys())\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2550,
        "y": 1000,
        "wires": [
            [
                "a45a5fe5f876ba2b"
            ]
        ]
    },
    {
        "id": "4eade5292b1bdc03",
        "type": "ui_dropdown",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "label": "1",
        "tooltip": "",
        "place": "",
        "group": "2659c0e4.6c014",
        "order": 3,
        "width": 2,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 2850,
        "y": 800,
        "wires": [
            [
                "acbf3d81b24b6254"
            ]
        ]
    },
    {
        "id": "79b0dc7d28c4bf1b",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2430,
        "y": 960,
        "wires": [
            [
                "bc7bfc492acefe6b"
            ]
        ]
    },
    {
        "id": "d64d48dff7b746a7",
        "type": "link in",
        "z": "f6992051cb6c0c5c",
        "name": "to checkbox",
        "links": [
            "dc734cebfb63220e"
        ],
        "x": 2435,
        "y": 1000,
        "wires": [
            [
                "a979f653ae7643ce"
            ]
        ]
    },
    {
        "id": "9aba4bba8ad7f859",
        "type": "ui_text",
        "z": "f6992051cb6c0c5c",
        "group": "2659c0e4.6c014",
        "order": 8,
        "width": 5,
        "height": 1,
        "name": "Выход из режима \"Презентация\"",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 2780,
        "y": 960,
        "wires": []
    },
    {
        "id": "bc7bfc492acefe6b",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "text",
        "func": "msg.payload = 'Выход из режима<br>\"Презентация\"'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2550,
        "y": 960,
        "wires": [
            [
                "9aba4bba8ad7f859"
            ]
        ]
    },
    {
        "id": "121aebfdc1f76f42",
        "type": "ui_template",
        "z": "f6992051cb6c0c5c",
        "group": "2659c0e4.6c014",
        "name": "NORMAL",
        "order": 7,
        "width": 3,
        "height": 2,
        "format": "<style>\n    .normal-screen {\n        background-color: gray;\n        border-radius: 8px;\n        box-sizing: border-box;\n        color: white;\n        position: relative;\n    }\n\n    .screen {\n        height: 90px;\n        transition: all .3s ease;\n        width: 144px;\n    }\n\n    .normal-screen,\n    .pip-screen,\n    .pop-screen {\n        align-items: center;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n    }\n\n    .screen_border {\n        border: 2px solid white;\n        border-radius: 8px;\n        box-sizing: border-box;\n        height: 100%;\n        left: 0;\n        position: absolute;\n        top: 0;\n        width: 100%;\n    }\n</style>\n\n<body>\n    <div class=\"screen normal-screen\">\n        1\n        <div class=\"screen_border\">\n        </div>\n    </div>\n</body>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 2700,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "56e65bc5f56af8a1",
        "type": "ui_template",
        "z": "f6992051cb6c0c5c",
        "group": "2659c0e4.6c014",
        "name": "PIP",
        "order": 1,
        "width": 3,
        "height": 2,
        "format": "<style>\n    .normal-screen {\n        background-color: gray;\n        border-radius: 8px;\n        box-sizing: border-box;\n        color: white;\n        position: relative;\n    }\n\n    .screen {\n        height: 90px;\n        width: 144px;\n    }\n\n    .normal-screen,\n    .pip-screen {\n        align-items: center;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n    }\n\n    .pip-screen {\n        background-color: var(--main-separator);\n        position: absolute;\n        border-radius: 8px;\n        bottom: 6px;\n        height: 33px;\n        right: 6px;\n        width: 54px;\n    }\n\n    .screen_border {\n        border: 2px solid white;\n        border-radius: 8px;\n        box-sizing: border-box;\n        height: 100%;\n        left: 0;\n        position: absolute;\n        top: 0;\n        width: 100%;\n    }\n</style>\n\n\n<body>\n    <div class=\"screen normal-screen\">\n        1\n        <div class=\"pip-screen\">\n            2\n            <div class=\"screen_border\">\n            </div>\n        </div>\n        <div class=\"screen_border\">\n        </div>\n    </div>\n</body>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 2690,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "acbf3d81b24b6254",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "in1 \"Presentation ON\"",
        "func": "flow.set(\"in1_for_presentation\", msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3040,
        "y": 800,
        "wires": [
            [
                "9f1d48af88b9bc18"
            ]
        ]
    },
    {
        "id": "09c2830f2fa9a9f8",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "in1 \"Presentation OFF\"",
        "func": "flow.set(\"in1_for_exit_presentation\", msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3040,
        "y": 1000,
        "wires": [
            [
                "9f1d48af88b9bc18"
            ]
        ]
    },
    {
        "id": "1640116270d1d031",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "in2 \"Presentation ON\"",
        "func": "flow.set(\"in2_for_presentation\", msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3040,
        "y": 840,
        "wires": [
            [
                "9f1d48af88b9bc18"
            ]
        ]
    },
    {
        "id": "3a607bebefce0e65",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "input commutation",
        "func": "try\n{\n    if (flow.get('inputs').has(msg.in1))\n    {\n        msg.in1 = flow.get('inputs').get(msg.in1)\n    }\n    if (flow.get('inputs').has(msg.in2))\n    {\n        msg.in2 = flow.get('inputs').get(msg.in2)\n    }\n}\nfinally \n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 360,
        "wires": [
            [
                "e404fe59a57623d4"
            ]
        ]
    },
    {
        "id": "ac59d62a5193e089",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "payload",
        "func": "msg.payload = flow.get('in1_for_presentation')\nif (msg.payload > msg.options.length)\n{\n    msg.payload = msg.options.length\n    flow.set('in1_for_presentation', msg.payload)\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2700,
        "y": 800,
        "wires": [
            [
                "4eade5292b1bdc03"
            ]
        ]
    },
    {
        "id": "b65835edaafd1cc2",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "payload",
        "func": "msg.payload = flow.get('in2_for_presentation')\nif (msg.payload > msg.options.length) \n{\n    msg.payload = msg.options.length\n    flow.set('in2_for_presentation', msg.payload)\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2700,
        "y": 840,
        "wires": [
            [
                "2f73a0863d23f198"
            ]
        ]
    },
    {
        "id": "a45a5fe5f876ba2b",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "payload",
        "func": "msg.payload = flow.get('in1_for_exit_presentation')\nif (msg.payload > msg.options.length) \n{\n    msg.payload = msg.options.length\n    flow.set('in1_for_exit_presentation', msg.payload)\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2700,
        "y": 1000,
        "wires": [
            [
                "de9f43df3c436c35"
            ]
        ]
    },
    {
        "id": "7b09cc7130e14697",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "false",
        "func": "msg.payload = false;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 3000,
        "wires": [
            [
                "404e3f594621c4fe",
                "79525fcd1d510a6c"
            ]
        ]
    },
    {
        "id": "02d17dde8e47cc1b",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "is empty?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 540,
        "y": 2980,
        "wires": [
            [
                "ce33cd4c8d4ca490"
            ],
            [
                "7b09cc7130e14697"
            ]
        ]
    },
    {
        "id": "3b6241e870782140",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "get all from flow",
        "func": "var keys = flow.keys()\nvar ans = []\nfor (let key of keys) {\n    ans.push({ 'attr': key, 'val': flow.get(key)})\n}\nmsg.payload = ans\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3900,
        "y": 700,
        "wires": [
            [
                "d524059f127bc767"
            ]
        ]
    },
    {
        "id": "1871960ad2586fef",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3740,
        "y": 700,
        "wires": [
            [
                "3b6241e870782140"
            ]
        ]
    },
    {
        "id": "d524059f127bc767",
        "type": "debug",
        "z": "f6992051cb6c0c5c",
        "name": "debug 132",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 4070,
        "y": 700,
        "wires": []
    },
    {
        "id": "b9b08213acf4f25a",
        "type": "DataOut",
        "z": "f6992051cb6c0c5c",
        "collection": "d9adc42cfdfe7ee0",
        "name": "videomixer_config ->",
        "path": "/",
        "error": false,
        "x": 3920,
        "y": 740,
        "wires": [
            [
                "ef5387acac16fb3c"
            ]
        ]
    },
    {
        "id": "5507493d95164cf9",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3740,
        "y": 740,
        "wires": [
            [
                "b9b08213acf4f25a"
            ]
        ]
    },
    {
        "id": "ef5387acac16fb3c",
        "type": "debug",
        "z": "f6992051cb6c0c5c",
        "name": "debug 133",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 4110,
        "y": 740,
        "wires": []
    },
    {
        "id": "fd484e428e884622",
        "type": "DataIn",
        "z": "f6992051cb6c0c5c",
        "collection": "d9adc42cfdfe7ee0",
        "name": "-> videomixer_config",
        "update": false,
        "path": "/",
        "x": 3600,
        "y": 920,
        "wires": []
    },
    {
        "id": "9f1d48af88b9bc18",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "get all from flow",
        "func": "var keys = flow.keys()\nvar ans = []\nfor (let key of keys) {\n    if (Object.prototype.toString.call(flow.get(key)) == '[object Map]') {\n        ans.push({ 'attr': key, 'val': Object.fromEntries(flow.get(key))})\n    }\n    else\n    {\n        ans.push({ 'attr': key, 'val': flow.get(key)})\n    }\n}\nmsg.payload = ans\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3380,
        "y": 920,
        "wires": [
            [
                "fd484e428e884622"
            ]
        ]
    },
    {
        "id": "3c547dafb16415a1",
        "type": "link out",
        "z": "f6992051cb6c0c5c",
        "name": "save >",
        "mode": "link",
        "links": [
            "4484d337bfc68b3b"
        ],
        "x": 3255,
        "y": 300,
        "wires": []
    },
    {
        "id": "4484d337bfc68b3b",
        "type": "link in",
        "z": "f6992051cb6c0c5c",
        "name": "> save",
        "links": [
            "3c547dafb16415a1"
        ],
        "x": 3315,
        "y": 880,
        "wires": [
            [
                "9f1d48af88b9bc18"
            ]
        ]
    },
    {
        "id": "542d6cb5886c61e7",
        "type": "link in",
        "z": "f6992051cb6c0c5c",
        "name": "> load",
        "links": [
            "8fe1244ca6c09510"
        ],
        "x": 2955,
        "y": 380,
        "wires": [
            [
                "273aaf1cf55212c8"
            ]
        ]
    },
    {
        "id": "8fe1244ca6c09510",
        "type": "link out",
        "z": "f6992051cb6c0c5c",
        "name": "load >",
        "mode": "link",
        "links": [
            "542d6cb5886c61e7"
        ],
        "x": 3875,
        "y": 200,
        "wires": []
    },
    {
        "id": "b5958c4bc909bc59",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "name": "Refresh table with start flows",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3520,
        "y": 160,
        "wires": [
            [
                "69a0c95f6ed45cac"
            ]
        ]
    },
    {
        "id": "42fdf9d43dab8b41",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3490,
        "y": 300,
        "wires": [
            [
                "44d257ccfb339ae4"
            ]
        ]
    },
    {
        "id": "232ea1d60c307a83",
        "type": "ui_table",
        "z": "f6992051cb6c0c5c",
        "group": "85a5f6c9fcd283b6",
        "name": "Входы",
        "order": 3,
        "width": 8,
        "height": 3,
        "columns": [
            {
                "field": "inSoftware",
                "title": "Программный вход",
                "width": "50%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "inHardware",
                "title": "Физический вход",
                "width": "50%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 3290,
        "y": 420,
        "wires": [
            [
                "8fca4bea326e6d24",
                "6fc9afa50798adfc"
            ]
        ]
    },
    {
        "id": "7724fb6efde33f1d",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1400,
        "y": 3260,
        "wires": [
            [
                "ea9160ddc7bef4c8"
            ]
        ]
    },
    {
        "id": "ea9160ddc7bef4c8",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "property": "device_statuses.attributes.videomixer",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1590,
        "y": 3260,
        "wires": [
            [
                "3e3278faf7c681b5"
            ]
        ]
    },
    {
        "id": "b2ac7519487b8486",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1400,
        "y": 3320,
        "wires": [
            [
                "a1e02731cea5bacb"
            ]
        ]
    },
    {
        "id": "a1e02731cea5bacb",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "property": "device_statuses.attributes.videomixer",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1590,
        "y": 3320,
        "wires": [
            [
                "9daefa409936ae45"
            ]
        ]
    },
    {
        "id": "f9015d8ea8974c1a",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "property": "device_statuses.attributes.videomixer",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1590,
        "y": 3200,
        "wires": [
            [
                "b2ec6e9b981c1f44"
            ]
        ]
    },
    {
        "id": "192095f3ddb0c33d",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1400,
        "y": 3200,
        "wires": [
            [
                "f9015d8ea8974c1a"
            ]
        ]
    },
    {
        "id": "f83f6d615b49c50d",
        "type": "server-state-changed",
        "z": "f6992051cb6c0c5c",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomixer",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "vmi",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 180,
        "y": 1820,
        "wires": [
            [
                "ffbbdc1a12a1f683"
            ]
        ]
    },
    {
        "id": "779796a40c24a024",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 680,
        "y": 1820,
        "wires": [
            [
                "13923b099a8a99e3"
            ]
        ]
    },
    {
        "id": "02567ab8dd6d75df",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "hdmi_in = in1",
        "func": "msg.hdmi_in = msg.vmi.new_state.attributes.out1;\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 1800,
        "wires": [
            [
                "779796a40c24a024"
            ]
        ]
    },
    {
        "id": "ffbbdc1a12a1f683",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "mode",
        "property": "vmi.new_state.attributes.mode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "normal",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pip",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pop",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 310,
        "y": 1820,
        "wires": [
            [
                "02567ab8dd6d75df"
            ],
            [
                "59f7c09f7a90b96d"
            ],
            [
                "59f7c09f7a90b96d"
            ]
        ]
    },
    {
        "id": "59f7c09f7a90b96d",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "hdmi_in = in2",
        "func": "msg.hdmi_in = msg.vmi.new_state.attributes.out2;\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 1840,
        "wires": [
            [
                "779796a40c24a024"
            ]
        ]
    },
    {
        "id": "13923b099a8a99e3",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "cam",
        "func": "msg.camera = msg.data.attributes.camera\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 1820,
        "wires": [
            [
                "f79ad102e59ddbd1"
            ]
        ]
    },
    {
        "id": "f79ad102e59ddbd1",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "hdmi_in != camera",
        "property": "hdmi_in",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "camera",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1030,
        "y": 1820,
        "wires": [
            [
                "2915e66afc3375ab"
            ]
        ]
    },
    {
        "id": "0d6c5e8cbcd185f2",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": "current_values set Camera",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.current_values\",\"state\":{{state}}, \"camera\":{{hdmi_in}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 2000,
        "y": 1840,
        "wires": [
            []
        ]
    },
    {
        "id": "a9498be000ca95a4",
        "type": "server-state-changed",
        "z": "f6992051cb6c0c5c",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.current_values",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 200,
        "y": 2020,
        "wires": [
            [
                "5802d9358728e926"
            ]
        ]
    },
    {
        "id": "5802d9358728e926",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomixer",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "vmi",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 370,
        "y": 2020,
        "wires": [
            [
                "7e7b79d7f0010b98"
            ]
        ]
    },
    {
        "id": "7d097ee8a4554410",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "mode",
        "property": "mode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "normal",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pip",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pop",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 690,
        "y": 2020,
        "wires": [
            [
                "ba5f8e3f0b83e205"
            ],
            [
                "ab047813750a7fbc"
            ],
            [
                "ab047813750a7fbc"
            ]
        ]
    },
    {
        "id": "ba5f8e3f0b83e205",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomixer\", \"state\":{{state}}, \"out1\": {{camera}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 850,
        "y": 2000,
        "wires": [
            []
        ]
    },
    {
        "id": "7e7b79d7f0010b98",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "hdmi_in = cam",
        "func": "// var state = new Date()\n// msg.state = state.getTime()\nmsg.state = Number(msg.vmi.state) + 1\n\nmsg.mode = msg.vmi.attributes.mode;\nmsg.camera = msg.data.new_state.attributes.camera;\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 2020,
        "wires": [
            [
                "7d097ee8a4554410"
            ]
        ]
    },
    {
        "id": "ab047813750a7fbc",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomixer\", \"state\":{{state}}, \"out2\": {{camera}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 850,
        "y": 2040,
        "wires": [
            []
        ]
    },
    {
        "id": "93f6705a92d88d3f",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": "current_values set Chair = -1",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.current_values\", \"chair\":-1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1680,
        "y": 1800,
        "wires": [
            [
                "3d3f04347560f21c"
            ]
        ]
    },
    {
        "id": "2b11f87b7e3979fb",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "hdmi_in is camera",
        "property": "is_camera",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1390,
        "y": 1820,
        "wires": [
            [
                "93f6705a92d88d3f"
            ],
            [
                "3d3f04347560f21c"
            ]
        ]
    },
    {
        "id": "6f05b7c7fab338dc",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "Синхронизация видеомикшера с активной камерой",
        "info": "",
        "x": 320,
        "y": 1980,
        "wires": []
    },
    {
        "id": "017969788ff49a37",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "Синхронизация активной камеры с видеомикшером",
        "info": "",
        "x": 320,
        "y": 1760,
        "wires": []
    },
    {
        "id": "2915e66afc3375ab",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "is cam",
        "func": "var inputs_cameras = flow.get(\"inputs_cameras\")\nif (inputs_cameras.includes(msg.hdmi_in))\n{\n    msg.is_camera = true\n}\nelse\n{\n    msg.is_camera = false\n} \nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1210,
        "y": 1820,
        "wires": [
            [
                "2b11f87b7e3979fb"
            ]
        ]
    },
    {
        "id": "6bc1266145cd08bb",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomixer",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 360,
        "y": 1600,
        "wires": [
            [
                "c487b5cf38d7d365"
            ]
        ]
    },
    {
        "id": "c487b5cf38d7d365",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 1600,
        "wires": [
            [
                "45ec3ceb0e2aad23"
            ]
        ]
    },
    {
        "id": "3d3f04347560f21c",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1620,
        "y": 1840,
        "wires": [
            [
                "75395cf247cbe417"
            ]
        ]
    },
    {
        "id": "75395cf247cbe417",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "state + 1",
        "func": "msg.state = msg.state\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1780,
        "y": 1840,
        "wires": [
            [
                "0d6c5e8cbcd185f2",
                "d1594cb68bb59e40"
            ]
        ]
    },
    {
        "id": "b2ec6e9b981c1f44",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 3200,
        "wires": [
            [
                "5c8d91d3d37f6857"
            ]
        ]
    },
    {
        "id": "3e3278faf7c681b5",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 3260,
        "wires": [
            [
                "1b5ccecc28292946"
            ]
        ]
    },
    {
        "id": "9daefa409936ae45",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 3320,
        "wires": [
            [
                "57f1312557343680"
            ]
        ]
    },
    {
        "id": "851927ed1d801ceb",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "Logo",
        "info": "",
        "x": 170,
        "y": 2540,
        "wires": []
    },
    {
        "id": "eb426eb881d4658f",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "new_val_LOGO",
        "property": "data.new_state.attributes.logo",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "data.old_state.attributes.logo",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 360,
        "y": 2580,
        "wires": [
            [
                "e6f43566d19d6b88"
            ]
        ]
    },
    {
        "id": "8a079e07fd121f86",
        "type": "server-state-changed",
        "z": "f6992051cb6c0c5c",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomixer",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 180,
        "y": 2580,
        "wires": [
            [
                "eb426eb881d4658f"
            ]
        ]
    },
    {
        "id": "552cf44b2fb1c04a",
        "type": "udp out",
        "z": "f6992051cb6c0c5c",
        "name": "AVMatrix",
        "addr": "",
        "iface": "",
        "port": "",
        "ipv": "udp4",
        "outport": "",
        "base64": false,
        "multicast": "false",
        "x": 880,
        "y": 2580,
        "wires": []
    },
    {
        "id": "1d08d13320fbe251",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "+IP+port",
        "func": "msg.ip = global.get(\"videomixer_ip\")\nmsg.port = global.get(\"videomixer_port\")\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 2580,
        "wires": [
            [
                "552cf44b2fb1c04a"
            ]
        ]
    },
    {
        "id": "e6f43566d19d6b88",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "function 16",
        "func": "var pip_state = false\nif (msg.data.new_state.attributes.mode == 'pip')\n{\n    var pip_state = true\n}\n\nvar logo_state = msg.data.new_state.attributes.logo\n\nvar checksum = 0x91 + Number(pip_state) * 2 + Number(logo_state) * 2\nvar cmd = [0x5a, 0x10, 0x00, 0x00, 0x00, 0x00, 0x07, 0x20, 0x00, 0x00, Number(pip_state) * 2].concat([0x00, 0x00]).concat([Number(logo_state) * 2, checksum, 0xdd])\n\nmsg.payload = Buffer.from(cmd)\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 2580,
        "wires": [
            [
                "1d08d13320fbe251"
            ]
        ]
    },
    {
        "id": "384e055fd718d2b8",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomixer",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1240,
        "y": 1240,
        "wires": [
            [
                "5c5f99d720c342b1"
            ]
        ]
    },
    {
        "id": "af0d802c72fe683c",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "good state?",
        "property": "device_statuses.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 850,
        "y": 3040,
        "wires": [
            [
                "fc3835494e4287f9"
            ]
        ]
    },
    {
        "id": "112d867965c74e05",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "fix",
        "info": "Чтобы в гонке записей статусов устройств никто не перебил изначально записываемый state от фронтенда",
        "x": 1030,
        "y": 3040,
        "wires": []
    },
    {
        "id": "738f4860406f25d2",
        "type": "debug",
        "z": "f6992051cb6c0c5c",
        "name": "debug 170",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1370,
        "y": 2720,
        "wires": []
    },
    {
        "id": "90b0a5d297036657",
        "type": "debug",
        "z": "f6992051cb6c0c5c",
        "name": "debug 171",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1370,
        "y": 2840,
        "wires": []
    },
    {
        "id": "645000bd238dd911",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "good state?",
        "property": "data.new_state.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 350,
        "y": 2240,
        "wires": [
            [
                "56429c68ac79bc5a"
            ]
        ]
    },
    {
        "id": "06bc054e47a53496",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": " videomixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "all",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1830,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "2f089aaf41711524",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "+ state, FTB=false",
        "func": "var data = {}\ndata[\"entity_id\"] = 'sensor.videomixer'\ndata[\"state\"] = Number(msg.state) + 1\ndata[\"ftb\"] = false\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\": data\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1630,
        "y": 1300,
        "wires": [
            [
                "06bc054e47a53496"
            ]
        ]
    },
    {
        "id": "4812c80dd6a1b6f1",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1280,
        "y": 1300,
        "wires": [
            [
                "b4ad709d714fc531"
            ]
        ]
    },
    {
        "id": "b4ad709d714fc531",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomixer",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1440,
        "y": 1300,
        "wires": [
            [
                "2f089aaf41711524"
            ]
        ]
    },
    {
        "id": "8744a6a899d39dc4",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "fix",
        "info": "Задержка, чтобы после записи state в VMI успел произойти \nопрос FTB и записаться в сенсор VMI, \nпосле чего ставлю FTB = false",
        "x": 1270,
        "y": 1340,
        "wires": []
    },
    {
        "id": "7302a1c8db18bfed",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "name": "fix #264753",
        "info": "_Было так:_\nelse // i.e. presentation == true\n\n_Теперь так:_\nelse if (presentation == true)",
        "x": 560,
        "y": 1480,
        "wires": []
    },
    {
        "id": "79525fcd1d510a6c",
        "type": "debug",
        "z": "f6992051cb6c0c5c",
        "name": "debug 208",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 580,
        "y": 3080,
        "wires": []
    },
    {
        "id": "1505649f3636f117",
        "type": "debug",
        "z": "f6992051cb6c0c5c",
        "name": "debug 209",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 670,
        "y": 2320,
        "wires": []
    },
    {
        "id": "5a52feb810348d39",
        "type": "debug",
        "z": "f6992051cb6c0c5c",
        "name": "debug 207",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 890,
        "y": 2460,
        "wires": []
    },
    {
        "id": "73ed4be84bdc99ec",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "Статус FTB",
        "func": "if (msg.payload[6] == 0x03 && msg.payload[7] == 0x11 && msg.payload[8] == 0x03) {\n    return {'ftb': Boolean(msg.payload[9])}\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 2400,
        "wires": [
            [
                "cfb384d1134999a6",
                "5a52feb810348d39"
            ]
        ]
    },
    {
        "id": "878730c428b9948e",
        "type": "server-state-changed",
        "z": "f6992051cb6c0c5c",
        "d": true,
        "name": "vmi",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.videomixer",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": false,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 170,
        "y": 1240,
        "wires": [
            [
                "7ff324a7916567a4"
            ]
        ]
    },
    {
        "id": "4dcedba61186ee14",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "d": true,
        "name": "flag == checked",
        "property": "flag_vmi",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "checked",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 660,
        "y": 1240,
        "wires": [
            [],
            [
                "436c07e4776b76f4"
            ]
        ]
    },
    {
        "id": "7ff324a7916567a4",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "d": true,
        "name": "state",
        "func": "msg.state = Number(msg.state)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 1240,
        "wires": [
            [
                "3f37482bc9570c25"
            ]
        ]
    },
    {
        "id": "50f2247427777e1e",
        "type": "comment",
        "z": "f6992051cb6c0c5c",
        "d": true,
        "name": "fix",
        "info": "200 ms",
        "x": 170,
        "y": 1200,
        "wires": []
    },
    {
        "id": "3f37482bc9570c25",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "d": true,
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 470,
        "y": 1240,
        "wires": [
            [
                "4dcedba61186ee14"
            ]
        ]
    },
    {
        "id": "436c07e4776b76f4",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "d": true,
        "name": "flag = true",
        "func": "flow.set('flag_vmi', 'checked')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 1240,
        "wires": [
            [
                "cb28ee8848fd2662"
            ]
        ]
    },
    {
        "id": "88087b33fbd58d5c",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 1280,
        "wires": [
            [
                "895813d1cbcf62e3"
            ]
        ]
    },
    {
        "id": "895813d1cbcf62e3",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomixer",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 320,
        "y": 1280,
        "wires": [
            [
                "32ed21024cf9bc70"
            ]
        ]
    },
    {
        "id": "3511a1eaac0ca910",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "attrs qty",
        "func": "if (Object.keys(msg.data.attributes).length <= 2)\n{\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 1280,
        "wires": [
            [
                "a86a17758f37877e"
            ]
        ]
    },
    {
        "id": "32ed21024cf9bc70",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "state",
        "func": "msg.state = Number(msg.data.state)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 1280,
        "wires": [
            [
                "016c47fb91daf048"
            ]
        ]
    },
    {
        "id": "016c47fb91daf048",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 650,
        "y": 1280,
        "wires": [
            [
                "3511a1eaac0ca910"
            ]
        ]
    },
    {
        "id": "de3a6768905b8565",
        "type": "debug",
        "z": "f6992051cb6c0c5c",
        "name": "debug 224",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 2860,
        "wires": []
    },
    {
        "id": "19c7514ad7168018",
        "type": "debug",
        "z": "f6992051cb6c0c5c",
        "name": "debug 225",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 400,
        "wires": []
    },
    {
        "id": "d1594cb68bb59e40",
        "type": "debug",
        "z": "f6992051cb6c0c5c",
        "name": "debug 227",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1900,
        "y": 1880,
        "wires": []
    },
    {
        "id": "e9ef15e294ec6370",
        "type": "api-call-service",
        "z": "f6992051cb6c0c5c",
        "name": " videomixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "all",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1050,
        "y": 1340,
        "wires": [
            [
                "632804324eef4b72"
            ]
        ]
    },
    {
        "id": "d17ce047b09f8ee3",
        "type": "function",
        "z": "f6992051cb6c0c5c",
        "name": "ftb, logo, smooth = false",
        "func": "var data = {}\ndata[\"entity_id\"] = 'sensor.videomixer'\ndata[\"ftb\"] = false\ndata[\"logo\"] = false\ndata[\"smooth\"] = false\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\": data\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 1340,
        "wires": [
            [
                "e9ef15e294ec6370"
            ]
        ]
    },
    {
        "id": "a86a17758f37877e",
        "type": "api-current-state",
        "z": "f6992051cb6c0c5c",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomixer",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 580,
        "y": 1340,
        "wires": [
            [
                "d17ce047b09f8ee3"
            ]
        ]
    },
    {
        "id": "632804324eef4b72",
        "type": "delay",
        "z": "f6992051cb6c0c5c",
        "name": "1 s",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1030,
        "y": 1300,
        "wires": [
            [
                "cb28ee8848fd2662"
            ]
        ]
    },
    {
        "id": "30cf959c7125f0d4",
        "type": "inject",
        "z": "f6992051cb6c0c5c",
        "name": ">",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 980,
        "y": 1200,
        "wires": [
            [
                "cb28ee8848fd2662"
            ]
        ]
    },
    {
        "id": "371d48c278d48dea",
        "type": "debug",
        "z": "f6992051cb6c0c5c",
        "name": "debug 230",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1570,
        "y": 1160,
        "wires": []
    },
    {
        "id": "89b28faa2d647c69",
        "type": "switch",
        "z": "f6992051cb6c0c5c",
        "name": "",
        "property": "fromip",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "10.111.32.12:19523",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 550,
        "y": 2480,
        "wires": [
            [
                "73ed4be84bdc99ec"
            ]
        ]
    },
    {
        "id": "8453f4689a848df8",
        "type": "function",
        "z": "92703c264104932a",
        "name": "+ old_status, new_status, standby",
        "func": "msg.prev_status = msg.device_statuses.attributes.audioprocessor\n\nmsg.new_status = msg.payload\n\nmsg.standby = msg.standby.attributes.standby\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 2080,
        "wires": [
            [
                "b413fcbefa693a92"
            ]
        ]
    },
    {
        "id": "d3f32fba50445360",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 860,
        "y": 1960,
        "wires": [
            [
                "5b50b6fe0d9dd0cb"
            ]
        ]
    },
    {
        "id": "95d7f3ae52e9427f",
        "type": "api-call-service",
        "z": "92703c264104932a",
        "name": "device_statuses.audioprocessor = 0",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"audioprocessor\":0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 2010,
        "y": 2080,
        "wires": [
            []
        ]
    },
    {
        "id": "8929bac962a984f7",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 840,
        "y": 2040,
        "wires": [
            [
                "8453f4689a848df8"
            ]
        ]
    },
    {
        "id": "d4d3554add8fbcef",
        "type": "function",
        "z": "92703c264104932a",
        "name": "payload",
        "func": "msg.payload = global.get(\"audioprocessor_ip\")\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 1960,
        "wires": [
            [
                "6ce0f2f70c18929a"
            ]
        ]
    },
    {
        "id": "4981e12121902843",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 190,
        "y": 1960,
        "wires": [
            [
                "d4d3554add8fbcef"
            ]
        ]
    },
    {
        "id": "11620a44f8705a71",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "switch msg.standby",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turning on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turning off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1190,
        "y": 2160,
        "wires": [
            [
                "d7aa8c6e36c02871"
            ],
            [
                "f9755bd028449f35"
            ],
            [
                "f9755bd028449f35"
            ],
            [
                "18fcccd5d61ee485"
            ]
        ]
    },
    {
        "id": "61c3bc6ab4f98667",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "1. on",
        "info": "",
        "x": 1170,
        "y": 2220,
        "wires": []
    },
    {
        "id": "4183fd93a2088450",
        "type": "api-call-service",
        "z": "92703c264104932a",
        "name": "device_statuses.audioprocessor = 1",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"audioprocessor\":1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 2010,
        "y": 2160,
        "wires": [
            []
        ]
    },
    {
        "id": "30a11a0e2f2656e2",
        "type": "api-call-service",
        "z": "92703c264104932a",
        "name": "device_statuses.audioprocessor = 2",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"audioprocessor\":2}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 2010,
        "y": 2240,
        "wires": [
            []
        ]
    },
    {
        "id": "427b3143c07a1c7d",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "2. turning on",
        "info": "",
        "x": 1190,
        "y": 2260,
        "wires": []
    },
    {
        "id": "1920c9c4b8d1a4ce",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "3. turning off",
        "info": "",
        "x": 1190,
        "y": 2300,
        "wires": []
    },
    {
        "id": "72ec237b005d7462",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "4. off",
        "info": "",
        "x": 1170,
        "y": 2340,
        "wires": []
    },
    {
        "id": "b326f4fceb1ee370",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "switch msg.type",
        "property": "type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "set input power",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set output power",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set input to output",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "remove input from output",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set input gain",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set output gain",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set aec gain",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 7,
        "x": 1060,
        "y": 400,
        "wires": [
            [
                "e30932bda9194c28"
            ],
            [
                "0701b40991edeb26"
            ],
            [
                "aa8aa266b6d9a905"
            ],
            [
                "88381ed4cf6e99fb"
            ],
            [
                "bf8d4c3472ebb819"
            ],
            [
                "1269b705352ec788"
            ],
            [
                "d29c0530a7acadaa"
            ]
        ]
    },
    {
        "id": "4a6ab1d9a9329057",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "2. Вкл/выкл выхода",
        "info": "",
        "x": 1070,
        "y": 120,
        "wires": []
    },
    {
        "id": "094c752c667a5e68",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "1. Вкл/выкл входа",
        "info": "",
        "x": 1070,
        "y": 80,
        "wires": []
    },
    {
        "id": "5069fdaff784cbdf",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "3. Включить вход на выход",
        "info": "",
        "x": 1100,
        "y": 160,
        "wires": []
    },
    {
        "id": "aee8b9252877e965",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "4. Отключить вход от выхода",
        "info": "",
        "x": 1100,
        "y": 200,
        "wires": []
    },
    {
        "id": "ded3dab98f1600c6",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "5. Изменение gain входа",
        "info": "",
        "x": 1090,
        "y": 240,
        "wires": []
    },
    {
        "id": "7d32f9f2887bb2c6",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "6. Изменение gain выхода",
        "info": "",
        "x": 1090,
        "y": 280,
        "wires": []
    },
    {
        "id": "d52076522b681216",
        "type": "function",
        "z": "92703c264104932a",
        "name": "set input power",
        "func": "// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Input = 299 (0x012B)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0x2B\nmsg.module_type_low = 0x01\n\n// Тип параметра Mute для модуля Input = 2\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x02\nmsg.parameter_type_low = 0x00\n\n// value1 = (номер входа - 1)\n// в формате двух байтов c обратным порядком\nmsg.value1_high = msg.input - 1\nmsg.value1_low = 0x00\n\n// value2 = 1 для отключения входа\n// value2 = 0 для включения входа\n// в формате двух байтов c обратным порядком\nif (msg.power == 0) {\n    msg.value2_high = 0x01\n} else {\n    msg.value2_high = 0x00\n}\nmsg.value2_low = 0x00\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1520,
        "y": 100,
        "wires": [
            [
                "94155b94b06acb6f"
            ]
        ]
    },
    {
        "id": "94155b94b06acb6f",
        "type": "function",
        "z": "92703c264104932a",
        "name": "checksum",
        "func": "// Стартовый байт\nmsg.start_byte = 0xB3\n\nif (msg.start_byte > 255) {msg.start_byte = 255} \nif (msg.message_type > 255) {msg.message_type = 255} \nif (msg.module_type_high > 255) {msg.module_type_high = 255} \nif (msg.module_type_low > 255) {msg.module_type_low = 255} \nif (msg.parameter_type_high > 255) {msg.parameter_type_high = 255} \nif (msg.parameter_type_low > 255) {msg.parameter_type_low = 255} \nif (msg.value1_high > 255) {msg.value1_high = 255} \nif (msg.value1_low > 255) {msg.value1_low = 255} \nif (msg.value2_high > 255) {msg.value2_high = 255} \nif (msg.value2_low > 255) {msg.value2_low = 255} \n\n\nmsg.checksum = msg.start_byte + \n    msg.message_type + \n    msg.module_type_high +\n    msg.module_type_low +\n    msg.parameter_type_high +\n    msg.parameter_type_low +\n    msg.value1_high +\n    msg.value1_low +\n    msg.value2_high +\n    msg.value2_low\n\n// Контрольная сумма = младший байт числа, являющегося суммой всех остальных 11 байтов команды\nif (msg.checksum > 255) {\n    msg.checksum = msg.checksum % 256\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1720,
        "y": 480,
        "wires": [
            [
                "761aeb5b3da17df9"
            ]
        ]
    },
    {
        "id": "a7ed38a3e6e05edb",
        "type": "udp out",
        "z": "92703c264104932a",
        "name": "",
        "addr": "",
        "iface": "",
        "port": "",
        "ipv": "udp4",
        "outport": "50001",
        "base64": false,
        "multicast": "false",
        "x": 2350,
        "y": 540,
        "wires": []
    },
    {
        "id": "8657ed96f0657619",
        "type": "function",
        "z": "92703c264104932a",
        "name": "+ audioprocessor_ip, audioprocessor_port",
        "func": "msg.ip = global.get(\"audioprocessor_ip\")\nmsg.port = global.get(\"audioprocessor_port\")\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1840,
        "y": 540,
        "wires": [
            [
                "ee4051332bee3023"
            ]
        ]
    },
    {
        "id": "761aeb5b3da17df9",
        "type": "buffer-maker",
        "z": "92703c264104932a",
        "name": "",
        "specification": "spec",
        "specificationType": "ui",
        "items": [
            {
                "name": "item1",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "start_byte"
            },
            {
                "name": "item2",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "message_type"
            },
            {
                "name": "item3",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "checksum"
            },
            {
                "name": "item4",
                "type": "byte",
                "length": 1,
                "dataType": "num",
                "data": "0"
            },
            {
                "name": "item5",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "module_type_high"
            },
            {
                "name": "item6",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "module_type_low"
            },
            {
                "name": "item7",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "parameter_type_high"
            },
            {
                "name": "item8",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "parameter_type_low"
            },
            {
                "name": "item9",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "value1_high"
            },
            {
                "name": "item10",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "value1_low"
            },
            {
                "name": "item11",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "value2_high"
            },
            {
                "name": "item12",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "value2_low"
            }
        ],
        "swap1": "",
        "swap2": "",
        "swap3": "",
        "swap1Type": "swap",
        "swap2Type": "swap",
        "swap3Type": "swap",
        "msgProperty": "payload",
        "msgPropertyType": "str",
        "x": 1890,
        "y": 480,
        "wires": [
            [
                "8657ed96f0657619"
            ]
        ]
    },
    {
        "id": "0d984a3281952357",
        "type": "function",
        "z": "92703c264104932a",
        "name": "set output power",
        "func": "// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Output = 295 (0x0127)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0x27\nmsg.module_type_low = 0x01\n\n// Тип параметра Mute для модуля Output = 2\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x02\nmsg.parameter_type_low = 0x00\n\n// value1 = (номер выхода - 1)\n// в формате двух байтов c обратным порядком\nmsg.value1_high = msg.output - 1\nmsg.value1_low = 0x00\n\n// value2 = 1 для отключения выхода\n// value2 = 0 для включения выхода\n// в формате двух байтов c обратным порядком\nif (msg.power == 0) {\n    msg.value2_high = 0x01\n} else {\n    msg.value2_high = 0x00\n}\nmsg.value2_low = 0x00\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1510,
        "y": 200,
        "wires": [
            [
                "94155b94b06acb6f"
            ]
        ]
    },
    {
        "id": "aa8aa266b6d9a905",
        "type": "function",
        "z": "92703c264104932a",
        "name": "set input to output",
        "func": "// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Sound mixer = 166 (0x00A6)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0xA6\nmsg.module_type_low = 0x00\n\n// Тип параметра Mixing switch для модуля Sound mixer = 1\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x01\nmsg.parameter_type_low = 0x00\n\n// Старший байт value1 = номер входа - 1\n// Старший байт value1 = номер выхода - 1\nmsg.value1_high = msg.input - 1\nmsg.value1_low = msg.output - 1\n\n// value2 = 1 для назначения входа на выход\n// в формате двух байтов c обратным порядком\nmsg.value2_high = 0x01\n\nmsg.value2_low = 0x00\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1510,
        "y": 260,
        "wires": [
            [
                "94155b94b06acb6f"
            ]
        ]
    },
    {
        "id": "88381ed4cf6e99fb",
        "type": "function",
        "z": "92703c264104932a",
        "name": "remove input from output",
        "func": "// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Sound mixer = 166 (0x00A6)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0xA6\nmsg.module_type_low = 0x00\n\n// Тип параметра Mixing switch для модуля Sound mixer = 1\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x01\nmsg.parameter_type_low = 0x00\n\n// Старший байт value1 = номер входа - 1\n// Старший байт value1 = номер выхода - 1\nmsg.value1_high = msg.input - 1\nmsg.value1_low = msg.output - 1\n\n// value2 = 0 для отмены назначения входа на выход\n// в формате двух байтов c обратным порядком\nmsg.value2_high = 0x00\n\nmsg.value2_low = 0x00\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1490,
        "y": 300,
        "wires": [
            [
                "94155b94b06acb6f"
            ]
        ]
    },
    {
        "id": "36c98e2dfa0ffb4f",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "switch msg.standby",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "turningoff",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turningon",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 830,
        "y": 1680,
        "wires": [
            [
                "3b67932a2c18b45e"
            ],
            [
                "f9d59074b3b88220"
            ]
        ]
    },
    {
        "id": "3e9712f730e5df27",
        "type": "server-state-changed",
        "z": "92703c264104932a",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.standby",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 170,
        "y": 1680,
        "wires": [
            [
                "7becf591e9591974"
            ]
        ]
    },
    {
        "id": "f9d59074b3b88220",
        "type": "api-call-service",
        "z": "92703c264104932a",
        "name": "audioprocessor OFF",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.audioprocessor\",\"state\":\"{{state}}\",\"isEnabledOut1\":0,\"isEnabledOut2\":0,\"isEnabledOut3\":0,\"isEnabledOut4\":0,\"isEnabledOut5\":0,\"isEnabledOut6\":0,\"isEnabledOut7\":0,\"isEnabledOut8\":0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1060,
        "y": 1700,
        "wires": [
            []
        ]
    },
    {
        "id": "3b67932a2c18b45e",
        "type": "api-call-service",
        "z": "92703c264104932a",
        "name": "audioprocessor ON",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.audioprocessor\",\"state\":\"{{state}}\",\"isEnabledOut1\":1,\"isEnabledOut2\":1,\"isEnabledOut3\":1,\"isEnabledOut4\":1,\"isEnabledOut5\":1,\"isEnabledOut6\":1,\"isEnabledOut7\":1,\"isEnabledOut8\":1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1050,
        "y": 1660,
        "wires": [
            []
        ]
    },
    {
        "id": "7becf591e9591974",
        "type": "function",
        "z": "92703c264104932a",
        "name": "standby",
        "func": "msg.standby = msg.standby.new_state.attributes.standby\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 1680,
        "wires": [
            [
                "2f301f84b887013a"
            ]
        ]
    },
    {
        "id": "b7bd0a3b0571d842",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "2. turning on",
        "info": "",
        "x": 810,
        "y": 1640,
        "wires": []
    },
    {
        "id": "89dc2fab787108b5",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "1. turning off",
        "info": "",
        "x": 810,
        "y": 1600,
        "wires": []
    },
    {
        "id": "93ce72d42c797f88",
        "type": "function",
        "z": "92703c264104932a",
        "name": "event parsing",
        "func": "var old_micmute = msg.data.old_state.attributes.micmute\nvar new_micmute = msg.data.new_state.attributes.micmute\n\nvar old_audiomute = msg.data.old_state.attributes.audiomute\nvar new_audiomute = msg.data.new_state.attributes.audiomute\n\n\n// Отключение всех входов аудиоматрицы\nif (new_micmute == true && old_micmute == false) {\n    msg.micmute = \"on\"\n    // Включение всех входов аудиоматрицы\n} else if (new_micmute == false && old_micmute == true) {\n    msg.micmute = \"off\"\n}\n\n// Отключение всех выходов аудиоматрицы\nif (new_audiomute == true && old_audiomute == false) {\n    msg.audiomute = \"on\"\n    // Включение всех выходов аудиоматрицы\n} else if (new_audiomute == false && old_audiomute == true) {\n    msg.audiomute = \"off\"\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 1200,
        "wires": [
            [
                "a8ef62d64068d223",
                "88c672ecc68ef1ab"
            ]
        ]
    },
    {
        "id": "4d141f22d599ec3e",
        "type": "api-call-service",
        "z": "92703c264104932a",
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1420,
        "y": 1240,
        "wires": [
            []
        ]
    },
    {
        "id": "712b1d17e38e4cc3",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "Обработка нажатий кнопок audiomute и micmute",
        "info": "",
        "x": 310,
        "y": 1160,
        "wires": []
    },
    {
        "id": "0ae5302c9889826e",
        "type": "server-state-changed",
        "z": "92703c264104932a",
        "name": "custom_buttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.custom_buttons",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 200,
        "y": 1200,
        "wires": [
            [
                "93ce72d42c797f88"
            ]
        ]
    },
    {
        "id": "6ebccb865f3fcbab",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "Отслеживание состояния кнопок audiomute и micmute",
        "info": "",
        "x": 330,
        "y": 1380,
        "wires": []
    },
    {
        "id": "98a414b5f73d3c67",
        "type": "api-call-service",
        "z": "92703c264104932a",
        "name": "custom_buttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1480,
        "y": 1440,
        "wires": [
            []
        ]
    },
    {
        "id": "a8ef62d64068d223",
        "type": "function",
        "z": "92703c264104932a",
        "name": "+ inputs_for_mute",
        "func": "msg.inputs_for_mute = flow.get(\"trackable_inputs\")\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 1200,
        "wires": [
            [
                "2591c21d74230429"
            ]
        ]
    },
    {
        "id": "2591c21d74230429",
        "type": "function",
        "z": "92703c264104932a",
        "name": "+ outputs_for_mute",
        "func": "msg.outputs_for_mute = flow.get(\"trackable_outputs\")\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 1240,
        "wires": [
            [
                "c5594da9e3653954"
            ]
        ]
    },
    {
        "id": "d82b89765baf6549",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 190,
        "y": 1100,
        "wires": [
            [
                "a052abd66b174ac2"
            ]
        ]
    },
    {
        "id": "9fb8ba6273f4e4cb",
        "type": "udp in",
        "z": "92703c264104932a",
        "d": true,
        "name": "",
        "iface": "",
        "port": "50001",
        "ipv": "udp4",
        "multicast": "false",
        "group": "",
        "datatype": "buffer",
        "x": 2820,
        "y": 2380,
        "wires": [
            [
                "27b170a8818e3aec",
                "4c7f4342e7da7d65"
            ]
        ]
    },
    {
        "id": "6e79b1b528269da0",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "get volume level",
        "func": "// Массив выходных сообщений\nvar messages = []\n\n\nfor (let i = 0; i < msg.inputs.length; i++) {\n    messages.push({\n        message_type: 0x22,\n        module_type_high: 0x2B,\n        module_type_low: 0x01,\n        parameter_type_high: 0x0c,\n        parameter_type_low: 0x00,\n        value1_low: 0x00,\n        value1_high: msg.inputs[i] - 1,\n        value2_high: 0x00,\n        value2_low: 0x00\n        })\n}\n\nfor (let i = 0; i < msg.outputs.length; i++) {\n    messages.push({\n        message_type: 0x22,\n        module_type_high: 0x27,\n        module_type_low: 0x01,\n        parameter_type_high: 0x08,\n        parameter_type_low: 0x00,\n        value1_low: 0x00,\n        value1_high: msg.outputs[i] - 1,\n        value2_high: 0x00,\n        value2_low: 0x00\n    })\n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3360,
        "y": 2040,
        "wires": [
            [
                "94155b94b06acb6f"
            ]
        ]
    },
    {
        "id": "e29a7fa41bf42350",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "+ msg.type",
        "func": "if (msg.payload[4] == 0x2b &&\n    msg.payload[5] == 0x01 &&\n    msg.payload[6] == 0x0c &&\n    msg.payload[7] == 0x00) {\n        msg.type = \"input level\"\n        return msg\n} else if (msg.payload[4] == 0x27 &&\n           msg.payload[5] == 0x01 &&\n           msg.payload[6] == 0x08 &&\n           msg.payload[7] == 0x00) {\n                msg.type = \"output level\"\n        return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3070,
        "y": 2180,
        "wires": [
            [
                "c05bed5640b9b35a"
            ]
        ]
    },
    {
        "id": "b1be8c5e97cf22af",
        "type": "switch",
        "z": "92703c264104932a",
        "d": true,
        "name": "switch msg.type",
        "property": "type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "input level",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "output level",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 3560,
        "y": 2180,
        "wires": [
            [
                "16d306a721bd4ecb"
            ],
            [
                "a964b84a9dd6ad96"
            ]
        ]
    },
    {
        "id": "16d306a721bd4ecb",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "+ input_level",
        "func": "msg.input = msg.payload[8] + 1\n\nmsg.input_level = msg.payload[10] + msg.payload[11] * 256\n\nif (msg.input_level < 53536) {\n    msg.input_level = 53536\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3790,
        "y": 2160,
        "wires": [
            [
                "f44fbb0fa589c8f4"
            ]
        ]
    },
    {
        "id": "a964b84a9dd6ad96",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "+ output_level",
        "func": "msg.output = msg.payload[8] + 1\n\nmsg.output_level = msg.payload[10] + msg.payload[11] * 256\n\nif (msg.output_level < 53536) {\n    msg.output_level = 53536\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3780,
        "y": 2200,
        "wires": [
            [
                "a7fa904315acdf28"
            ]
        ]
    },
    {
        "id": "ee00243e868c7dfb",
        "type": "function",
        "z": "92703c264104932a",
        "name": "+ type, state",
        "func": "var old_isEnabledIn = [\n    msg.data.old_state.attributes.isEnabledIn1,\n    msg.data.old_state.attributes.isEnabledIn2,\n    msg.data.old_state.attributes.isEnabledIn3,\n    msg.data.old_state.attributes.isEnabledIn4,\n    msg.data.old_state.attributes.isEnabledIn5,\n    msg.data.old_state.attributes.isEnabledIn6,\n    msg.data.old_state.attributes.isEnabledIn7,\n    msg.data.old_state.attributes.isEnabledIn8,\n]\n\nvar new_isEnabledIn = [\n    msg.data.new_state.attributes.isEnabledIn1,\n    msg.data.new_state.attributes.isEnabledIn2,\n    msg.data.new_state.attributes.isEnabledIn3,\n    msg.data.new_state.attributes.isEnabledIn4,\n    msg.data.new_state.attributes.isEnabledIn5,\n    msg.data.new_state.attributes.isEnabledIn6,\n    msg.data.new_state.attributes.isEnabledIn7,\n    msg.data.new_state.attributes.isEnabledIn8,\n]\n\nvar old_isEnabledOut = [\n    msg.data.old_state.attributes.isEnabledOut1,\n    msg.data.old_state.attributes.isEnabledOut2,\n    msg.data.old_state.attributes.isEnabledOut3,\n    msg.data.old_state.attributes.isEnabledOut4,\n    msg.data.old_state.attributes.isEnabledOut5,\n    msg.data.old_state.attributes.isEnabledOut6,\n    msg.data.old_state.attributes.isEnabledOut7,\n    msg.data.old_state.attributes.isEnabledOut8,\n]\n\nvar new_isEnabledOut = [\n    msg.data.new_state.attributes.isEnabledOut1,\n    msg.data.new_state.attributes.isEnabledOut2,\n    msg.data.new_state.attributes.isEnabledOut3,\n    msg.data.new_state.attributes.isEnabledOut4,\n    msg.data.new_state.attributes.isEnabledOut5,\n    msg.data.new_state.attributes.isEnabledOut6,\n    msg.data.new_state.attributes.isEnabledOut7,\n    msg.data.new_state.attributes.isEnabledOut8,\n]\n\n// Массив выходных сообщений\nvar messages = []\n\nfor (let i = 0; i < 8; i++) {\n    if (old_isEnabledIn[i] != new_isEnabledIn[i]) {\n        msg.type = \"micmute\"\n    }\n}\n\nif (msg.type == 'micmute')\n{\n    messages.push({\n        type: 'micmute',\n        data: msg.data\n        })\n}\n\nfor (let i = 0; i < 8; i++) {\n    if (old_isEnabledOut[i] != new_isEnabledOut[i]) {\n        msg.type = \"audiomute\"\n    }\n} \n\nif (msg.type == 'audiomute') {\n    messages.push({\n        type: 'audiomute',\n        data: msg.data\n    })\n}\n\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 1440,
        "wires": [
            [
                "6beb8724801bca66"
            ]
        ]
    },
    {
        "id": "3c102904e5ad7a69",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "switch msg.type",
        "property": "type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "micmute",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "audiomute",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1100,
        "y": 1440,
        "wires": [
            [
                "38bd887c3f998c64"
            ],
            [
                "7f7291cedec741b5"
            ]
        ]
    },
    {
        "id": "baa28417c4e8ce70",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "2. audiomute",
        "info": "",
        "x": 1090,
        "y": 1520,
        "wires": []
    },
    {
        "id": "f3ac85205f24eae6",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "1. micmute",
        "info": "",
        "x": 1080,
        "y": 1480,
        "wires": []
    },
    {
        "id": "38bd887c3f998c64",
        "type": "function",
        "z": "92703c264104932a",
        "name": "micmute",
        "func": "var new_isEnabledIn = [\n    msg.data.new_state.attributes.isEnabledIn1,\n    msg.data.new_state.attributes.isEnabledIn2,\n    msg.data.new_state.attributes.isEnabledIn3,\n    msg.data.new_state.attributes.isEnabledIn4,\n    msg.data.new_state.attributes.isEnabledIn5,\n    msg.data.new_state.attributes.isEnabledIn6,\n    msg.data.new_state.attributes.isEnabledIn7,\n    msg.data.new_state.attributes.isEnabledIn8,\n]\n\nmsg.payload = {}\nmsg.payload[\"domain\"] = \"python_script\"\nmsg.payload[\"service\"] = \"set_state\"\nmsg.payload[\"data\"] = {}\nmsg.payload[\"data\"][\"entity_id\"] = \"sensor.custom_buttons\"\n// msg.payload[\"data\"][\"state\"] = msg.state\n\nvar inputs_for_mute = flow.get(\"trackable_inputs\")\nvar sum = 0\n\nfor (let i = 0; i < inputs_for_mute.length; i++) {\n    sum = sum + Number(new_isEnabledIn[inputs_for_mute[i] - 1])\n}\n\n// Определение состояния кнопки micmute\nif (sum == 0) {\n    msg.payload[\"data\"][\"micmute\"] = true\n} else {\n    msg.payload[\"data\"][\"micmute\"] = false\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1280,
        "y": 1420,
        "wires": [
            [
                "98a414b5f73d3c67",
                "798b1e99b7e4e5dd"
            ]
        ]
    },
    {
        "id": "7f7291cedec741b5",
        "type": "function",
        "z": "92703c264104932a",
        "name": "audiomute",
        "func": "var old_isEnabledOut = [\n    msg.data.old_state.attributes.isEnabledOut1,\n    msg.data.old_state.attributes.isEnabledOut2,\n    msg.data.old_state.attributes.isEnabledOut3,\n    msg.data.old_state.attributes.isEnabledOut4,\n    msg.data.old_state.attributes.isEnabledOut5,\n    msg.data.old_state.attributes.isEnabledOut6,\n    msg.data.old_state.attributes.isEnabledOut7,\n    msg.data.old_state.attributes.isEnabledOut8,\n]\n\nvar new_isEnabledOut = [\n    msg.data.new_state.attributes.isEnabledOut1,\n    msg.data.new_state.attributes.isEnabledOut2,\n    msg.data.new_state.attributes.isEnabledOut3,\n    msg.data.new_state.attributes.isEnabledOut4,\n    msg.data.new_state.attributes.isEnabledOut5,\n    msg.data.new_state.attributes.isEnabledOut6,\n    msg.data.new_state.attributes.isEnabledOut7,\n    msg.data.new_state.attributes.isEnabledOut8,\n]\n\nmsg.payload = {}\nmsg.payload[\"domain\"] = \"python_script\"\nmsg.payload[\"service\"] = \"set_state\"\nmsg.payload[\"data\"] = {}\nmsg.payload[\"data\"][\"entity_id\"] = \"sensor.custom_buttons\"\n// msg.payload[\"data\"][\"state\"] = msg.state\n\nvar outputs_for_mute = flow.get(\"trackable_outputs\")\nvar sum = 0\n\nfor (let i = 0; i < outputs_for_mute.length; i++) {\n    sum = sum + Number(new_isEnabledOut[outputs_for_mute[i] - 1])\n}\n\n// Определение состояния кнопки audiomute\nif (sum == 0) {\n    msg.payload[\"data\"][\"audiomute\"] = true\n\n} else {\n    msg.payload[\"data\"][\"audiomute\"] = false\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 1460,
        "wires": [
            [
                "98a414b5f73d3c67"
            ]
        ]
    },
    {
        "id": "663b40f2069115a2",
        "type": "function",
        "z": "92703c264104932a",
        "name": "payload for audioprocessor",
        "func": "// var state = new Date()\n// state = state.getTime()\n// state = msg.data.new_state.state\n\nmsg.payload = {}\nmsg.payload[\"domain\"] = \"python_script\"\nmsg.payload[\"service\"] = \"set_state\"\nmsg.payload[\"data\"] = {}\nmsg.payload[\"data\"][\"entity_id\"] = \"sensor.audioprocessor\"\nmsg.payload[\"data\"][\"state\"] = msg.state\n\nif (msg.audiomute == \"on\") {\n    for (let i = 0; i < msg.outputs_for_mute.length; i++) {\n        msg.payload[\"data\"][\"isEnabledOut\" + msg.outputs_for_mute[i]] = 0\n    }\n} else if (msg.audiomute == \"off\") {\n    for (let i = 0; i < msg.outputs_for_mute.length; i++) {\n        msg.payload[\"data\"][\"isEnabledOut\" + msg.outputs_for_mute[i]] = 1\n    }\n}\n\nif (msg.micmute == \"on\") {\n    node.warn(\"HERE\")\n    for (let i = 0; i < msg.inputs_for_mute.length; i++) {\n        msg.payload[\"data\"][\"isEnabledIn\" + msg.inputs_for_mute[i]] = 0\n    }\n} else if (msg.micmute == \"off\") {\n    for (let i = 0; i < msg.inputs_for_mute.length; i++) {\n        msg.payload[\"data\"][\"isEnabledIn\" + msg.inputs_for_mute[i]] = 1\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1180,
        "y": 1240,
        "wires": [
            [
                "4d141f22d599ec3e",
                "d285e24ec186eff0"
            ]
        ]
    },
    {
        "id": "b413fcbefa693a92",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "new_status == false",
        "property": "new_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "false",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 960,
        "y": 2120,
        "wires": [
            [
                "d7aa8c6e36c02871"
            ],
            [
                "11620a44f8705a71"
            ]
        ]
    },
    {
        "id": "80c9bd104474f171",
        "type": "server-state-changed",
        "z": "92703c264104932a",
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.audioprocessor",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 120,
        "y": 400,
        "wires": [
            [
                "ff0c380f8bf9878b",
                "20449f24990ecf98"
            ]
        ]
    },
    {
        "id": "ff0c380f8bf9878b",
        "type": "function",
        "z": "92703c264104932a",
        "name": "event parsing",
        "func": "// Предыдущее состояние входов\nvar old_isEnabledIn = [\n    msg.data.old_state.attributes.isEnabledIn1,\n    msg.data.old_state.attributes.isEnabledIn2,\n    msg.data.old_state.attributes.isEnabledIn3,\n    msg.data.old_state.attributes.isEnabledIn4,\n    msg.data.old_state.attributes.isEnabledIn5,\n    msg.data.old_state.attributes.isEnabledIn6,\n    msg.data.old_state.attributes.isEnabledIn7,\n    msg.data.old_state.attributes.isEnabledIn8\n]\n\n// Новое состояние входов\nvar new_isEnabledIn = [\n    msg.data.new_state.attributes.isEnabledIn1,\n    msg.data.new_state.attributes.isEnabledIn2,\n    msg.data.new_state.attributes.isEnabledIn3,\n    msg.data.new_state.attributes.isEnabledIn4,\n    msg.data.new_state.attributes.isEnabledIn5,\n    msg.data.new_state.attributes.isEnabledIn6,\n    msg.data.new_state.attributes.isEnabledIn7,\n    msg.data.new_state.attributes.isEnabledIn8\n]\n\n// Предыдущее состояние выходов\nvar old_isEnabledOut = [\n    msg.data.old_state.attributes.isEnabledOut1,\n    msg.data.old_state.attributes.isEnabledOut2,\n    msg.data.old_state.attributes.isEnabledOut3,\n    msg.data.old_state.attributes.isEnabledOut4,\n    msg.data.old_state.attributes.isEnabledOut5,\n    msg.data.old_state.attributes.isEnabledOut6,\n    msg.data.old_state.attributes.isEnabledOut7,\n    msg.data.old_state.attributes.isEnabledOut8\n]\n\n// Новое состояние выходов\nvar new_isEnabledOut = [\n    msg.data.new_state.attributes.isEnabledOut1,\n    msg.data.new_state.attributes.isEnabledOut2,\n    msg.data.new_state.attributes.isEnabledOut3,\n    msg.data.new_state.attributes.isEnabledOut4,\n    msg.data.new_state.attributes.isEnabledOut5,\n    msg.data.new_state.attributes.isEnabledOut6,\n    msg.data.new_state.attributes.isEnabledOut7,\n    msg.data.new_state.attributes.isEnabledOut8\n]\n\n// Предыдущее состояние AEC\nvar old_isEnabledAec = msg.data.old_state.attributes.isEnabledAec\n\n// Новое состояние AEC\nvar new_isEnabledAec = msg.data.new_state.attributes.isEnabledAec\n\n// Предыдущее состояние матрицы\nvar old_matrix = [\n    msg.data.old_state.attributes.out1,\n    msg.data.old_state.attributes.out2,\n    msg.data.old_state.attributes.out3,\n    msg.data.old_state.attributes.out4,\n    msg.data.old_state.attributes.out5,\n    msg.data.old_state.attributes.out6,\n    msg.data.old_state.attributes.out7,\n    msg.data.old_state.attributes.out8\n]\n\n// Новое состояние матрицы\nvar new_matrix = [\n    msg.data.new_state.attributes.out1,\n    msg.data.new_state.attributes.out2,\n    msg.data.new_state.attributes.out3,\n    msg.data.new_state.attributes.out4,\n    msg.data.new_state.attributes.out5,\n    msg.data.new_state.attributes.out6,\n    msg.data.new_state.attributes.out7,\n    msg.data.new_state.attributes.out8\n]\n\n\n// Предыдущие чувствительности входов\nvar old_ingain = [\n    msg.data.old_state.attributes.in1Gain,\n    msg.data.old_state.attributes.in2Gain,\n    msg.data.old_state.attributes.in3Gain,\n    msg.data.old_state.attributes.in4Gain,\n    msg.data.old_state.attributes.in5Gain,\n    msg.data.old_state.attributes.in6Gain,\n    msg.data.old_state.attributes.in7Gain,\n    msg.data.old_state.attributes.in8Gain\n]\n\n// Новые чувствительности входов\nvar new_ingain = [\n    msg.data.new_state.attributes.in1Gain,\n    msg.data.new_state.attributes.in2Gain,\n    msg.data.new_state.attributes.in3Gain,\n    msg.data.new_state.attributes.in4Gain,\n    msg.data.new_state.attributes.in5Gain,\n    msg.data.new_state.attributes.in6Gain,\n    msg.data.new_state.attributes.in7Gain,\n    msg.data.new_state.attributes.in8Gain\n]\n\n// Предыдущие чувствительности выходов\nvar old_outgain = [\n    msg.data.old_state.attributes.out1Gain,\n    msg.data.old_state.attributes.out2Gain,\n    msg.data.old_state.attributes.out3Gain,\n    msg.data.old_state.attributes.out4Gain,\n    msg.data.old_state.attributes.out5Gain,\n    msg.data.old_state.attributes.out6Gain,\n    msg.data.old_state.attributes.out7Gain,\n    msg.data.old_state.attributes.out8Gain\n]\n\n// Новые чувствительности выходов\nvar new_outgain = [\n    msg.data.new_state.attributes.out1Gain,\n    msg.data.new_state.attributes.out2Gain,\n    msg.data.new_state.attributes.out3Gain,\n    msg.data.new_state.attributes.out4Gain,\n    msg.data.new_state.attributes.out5Gain,\n    msg.data.new_state.attributes.out6Gain,\n    msg.data.new_state.attributes.out7Gain,\n    msg.data.new_state.attributes.out8Gain\n]\n\n// Предыдущее чувствительность AEC\nvar old_aecGain = msg.data.old_state.attributes.aecGain\n\n// Новое чувствительность AEC\nvar new_aecGain = msg.data.new_state.attributes.aecGain\n\n\n// Массив выходных сообщений\nvar messages = []\n\n\nfor (let i = 0; i < 5; i++) {\n\n    // Включение/выключение входа\n    if (old_isEnabledIn[i] != new_isEnabledIn[i] && typeof new_isEnabledIn[i] != \"undefined\") {\n\n        var input = Number(i + 1)\n\n        if (Number(new_isEnabledIn[i]) == 1) {\n            var power = true\n        } else if (Number(new_isEnabledIn[i]) == 0) {\n            var power = false\n        }\n\n        messages.push({\n            input: input,\n            power: power,\n            type: \"set input power\",\n            new_isEnabledIn: new_isEnabledIn,\n            new_isEnabledOut: new_isEnabledOut,\n            new_isEnabledAEC: new_isEnabledAec,\n            new_matrix: new_matrix\n        })\n    }\n\n    // Включение/выключение выхода\n    if (old_isEnabledOut[i] != new_isEnabledOut[i] && typeof new_isEnabledOut[i] != \"undefined\") {\n        var output = Number(i + 1)\n\n        if (Number(new_isEnabledOut[i]) == 1) {\n            var power = true\n        } else if (Number(new_isEnabledOut[i]) == 0) {\n            var power = false\n        }\n\n        messages.push({\n            output: output,\n            power: power,\n            type: \"set output power\",\n            new_isEnabledIn: new_isEnabledIn,\n            new_isEnabledOut: new_isEnabledOut,\n            new_isEnabledAEC: new_isEnabledAec,\n            new_matrix: new_matrix\n        })\n    }\n\n    // Переключения матрицы\n    if (old_matrix[i] != new_matrix[i]) {\n\n        if (typeof old_matrix[i] == \"undefined\") {\n            old_matrix[i] = []\n        }\n\n\n\n        // Подключение входа к выходу\n        if (typeof new_matrix[i] != \"undefined\") {\n\n            for (let j = 0; j < new_matrix[i].length; j++) {\n\n                if (!(old_matrix[i].includes(new_matrix[i][j]))) {\n\n                    var output = Number(i + 1)\n\n                    var input = Number(new_matrix[i][j])\n\n                    messages.push({\n                        output: output,\n                        input: input,\n                        type: \"set input to output\",\n                        new_isEnabledIn: new_isEnabledIn,\n                        new_isEnabledOut: new_isEnabledOut,\n                        new_isEnabledAEC: new_isEnabledAec,\n                        new_matrix: new_matrix\n                    })\n                }\n\n            }\n\n        }\n\n\n        // Отключение входа от выхода\n        for (let j = 0; j < old_matrix[i].length; j++) {\n\n            if (typeof new_matrix[i] != \"undefined\") {\n\n                if (!(new_matrix[i].includes(old_matrix[i][j]))) {\n\n                    var output = Number(i + 1)\n\n                    var input = Number(old_matrix[i][j])\n\n                    messages.push({\n                        output: output,\n                        input: input,\n                        type: \"remove input from output\",\n                        new_isEnabledIn: new_isEnabledIn,\n                        new_isEnabledOut: new_isEnabledOut,\n                        new_isEnabledAEC: new_isEnabledAec,\n                        new_matrix: new_matrix\n                    })\n                }\n\n            }\n            \n        }\n\n    }\n\n\n    // Изменение чувствительности входа\n    if (old_ingain[i] != new_ingain[i] && typeof new_ingain[i] != \"undefined\") {\n\n        var input = Number(i + 1)\n\n        var input_gain = Number(new_ingain[i])\n\n        messages.push({\n            input: input,\n            input_gain: input_gain + flow.get(\"inputOffsets\").get(input),\n            type: \"set input gain\",\n            new_isEnabledIn: new_isEnabledIn,\n            new_isEnabledOut: new_isEnabledOut,\n            new_isEnabledAEC: new_isEnabledAec,\n            new_matrix: new_matrix\n        })\n    }\n\n    // Изменение чувствительности выхода\n    if (old_outgain[i] != new_outgain[i] && typeof new_outgain[i] != \"undefined\") {\n\n        var output = Number(i + 1)\n\n        var output_gain = Number(new_outgain[i])\n\n        messages.push({\n            output: output,\n            output_gain: output_gain + flow.get(\"outputOffsets\").get(output),\n            type: \"set output gain\",\n            new_isEnabledIn: new_isEnabledIn,\n            new_isEnabledOut: new_isEnabledOut,\n            new_isEnabledAEC: new_isEnabledAec,\n            new_matrix: new_matrix\n        })\n    }\n\n}\n\n\n// Включение/выключение AEC\nif (old_isEnabledAec != new_isEnabledAec && typeof new_isEnabledAec != \"undefined\") {\n\n    var outputs_for_aec = flow.get(\"outputs_for_aec\")\n\n    for (let i = 0; i < outputs_for_aec.length; i++) {\n\n        if (new_isEnabledAec == 1) {\n            messages.push({\n                output: outputs_for_aec[i],\n                input: new_matrix.length + 3,\n                type: \"set input to output\",\n                new_isEnabledIn: new_isEnabledIn,\n                new_isEnabledOut: new_isEnabledOut,\n                new_isEnabledAEC: new_isEnabledAec,\n                new_matrix: new_matrix\n            })\n        } else if (new_isEnabledAec == 0) {\n            messages.push({\n                output: outputs_for_aec[i],\n                input: new_matrix.length + 3,\n                type: \"remove input from output\",\n                new_isEnabledIn: new_isEnabledIn,\n                new_isEnabledOut: new_isEnabledOut,\n                new_isEnabledAEC: new_isEnabledAec,\n                new_matrix: new_matrix\n            })\n        }\n    }\n}\n\n// Изменение чувствительности AEC\nif (old_aecGain != new_aecGain && typeof new_aecGain != \"undefined\") {\n\n    var outputs_for_aec = flow.get(\"outputs_for_aec\")\n\n    for (let i = 0; i < outputs_for_aec.length; i++) {\n\n        messages.push({\n            aec: new_ingain.length + 2,\n            output: outputs_for_aec[i],\n            aec_gain: new_aecGain + flow.get(\"aecOffset\"),\n            type: \"set aec gain\",\n            new_isEnabledIn: new_isEnabledIn,\n            new_isEnabledOut: new_isEnabledOut,\n            new_isEnabledAEC: new_isEnabledAec,\n            new_matrix: new_matrix\n        })\n    }\n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 400,
        "wires": [
            [
                "0bab846e751881b0",
                "1070d0a2df0ce200"
            ]
        ]
    },
    {
        "id": "20d3850458a92c4d",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "7. Изменение gain AEC",
        "info": "",
        "x": 1090,
        "y": 320,
        "wires": []
    },
    {
        "id": "a052abd66b174ac2",
        "type": "function",
        "z": "92703c264104932a",
        "name": "outputs for aec",
        "func": "// var outputs_for_aec = [2, 3]\n// flow.set(\"outputs_for_aec\", outputs_for_aec)\n\nflow.set(\"outputs_for_aec\", flow.get('trackable_outputs_aec'))\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "434f4b67f433bc4a",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "Выходы, отслеживаемые для aec",
        "info": "",
        "x": 440,
        "y": 1060,
        "wires": []
    },
    {
        "id": "c5f62b7437264e9d",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "НАСТРОЙКА",
        "info": "",
        "x": 370,
        "y": 1020,
        "wires": []
    },
    {
        "id": "e6d180b8a185bc34",
        "type": "inject",
        "z": "92703c264104932a",
        "d": true,
        "name": "",
        "props": [],
        "repeat": "0.075",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2890,
        "y": 1880,
        "wires": [
            [
                "69216cebf6c3870a"
            ]
        ]
    },
    {
        "id": "69216cebf6c3870a",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "d": true,
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 3060,
        "y": 1880,
        "wires": [
            [
                "698322bcab09058f"
            ]
        ]
    },
    {
        "id": "698322bcab09058f",
        "type": "switch",
        "z": "92703c264104932a",
        "d": true,
        "name": "if device_statuses.attributes.audioprocessor == 2",
        "property": "device_statuses.attributes.audioprocessor",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 3370,
        "y": 1880,
        "wires": [
            [
                "06a14491c11b187b"
            ]
        ]
    },
    {
        "id": "9e1eedae0d12b742",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "inputs, outputs",
        "func": "msg.inputs = [1]\n\nmsg.outputs = [1]\n\nflow.set(\"volume_first_input\", msg.inputs[0])\nflow.set(\"volume_last_output\", msg.outputs[msg.outputs.length - 1])\n\nmsg.rate = 1000 / (msg.inputs.length + msg.outputs.length)\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2900,
        "y": 2040,
        "wires": [
            [
                "38ca96cddb68837d"
            ]
        ]
    },
    {
        "id": "a381bde69e0c2ca8",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "Отслеживаемые для \"градусника\" входы и выходы",
        "info": "",
        "x": 1100,
        "y": 1940,
        "wires": []
    },
    {
        "id": "b8196e27aef61326",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "НАСТРОЙКА",
        "info": "",
        "x": 970,
        "y": 1900,
        "wires": []
    },
    {
        "id": "06a14491c11b187b",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "d": true,
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "audioprocessor",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 2900,
        "y": 1960,
        "wires": [
            [
                "bc1fb206681c79fc"
            ]
        ]
    },
    {
        "id": "bc1fb206681c79fc",
        "type": "switch",
        "z": "92703c264104932a",
        "d": true,
        "name": "if audioprocessor.attributes.volumeIndicator is true",
        "property": "audioprocessor.attributes.volumeIndicator",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 3210,
        "y": 1960,
        "wires": [
            [
                "9e1eedae0d12b742"
            ]
        ]
    },
    {
        "id": "8449cb85cd592315",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "+ state",
        "func": "msg.state = msg.volume.state\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3390,
        "y": 2180,
        "wires": [
            [
                "b1be8c5e97cf22af"
            ]
        ]
    },
    {
        "id": "134f4ffe5b986e8a",
        "type": "comment",
        "z": "92703c264104932a",
        "d": true,
        "name": "Отслеживание уровня сигнала на входах и выходах",
        "info": "",
        "x": 3020,
        "y": 1840,
        "wires": []
    },
    {
        "id": "f44fbb0fa589c8f4",
        "type": "range",
        "z": "92703c264104932a",
        "d": true,
        "minin": "57800",
        "maxin": "65535",
        "minout": "-6",
        "maxout": "6",
        "action": "clamp",
        "round": true,
        "property": "msg.input_level",
        "name": "",
        "x": 3970,
        "y": 2160,
        "wires": [
            [
                "2338b4b9dbc2526b"
            ]
        ]
    },
    {
        "id": "a7fa904315acdf28",
        "type": "range",
        "z": "92703c264104932a",
        "d": true,
        "minin": "57800",
        "maxin": "65535",
        "minout": "-6",
        "maxout": "6",
        "action": "clamp",
        "round": true,
        "property": "msg.output_level",
        "name": "",
        "x": 3970,
        "y": 2200,
        "wires": [
            [
                "cacf9ba30f17e37e"
            ]
        ]
    },
    {
        "id": "9c58cf3230deadec",
        "type": "api-call-service",
        "z": "92703c264104932a",
        "d": true,
        "name": "volume",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "",
        "service": "",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 5300,
        "y": 2200,
        "wires": [
            []
        ]
    },
    {
        "id": "c05bed5640b9b35a",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "d": true,
        "name": "volume",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.volume",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "volume",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 3240,
        "y": 2180,
        "wires": [
            [
                "8449cb85cd592315"
            ]
        ]
    },
    {
        "id": "6a82e2b08ad2e68e",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "all input levels",
        "func": "var volume_first_input = flow.get(\"volume_first_input\")\nvar all_levels = flow.get(\"all_levels\")\n\nif (msg.input == volume_first_input) {\n    all_levels = {}\n    all_levels[\"in\" + msg.input + \"Vol\"] = msg.input_level\n} else {\n    all_levels[\"in\" + msg.input + \"Vol\"] = msg.input_level\n}\n\nflow.set(\"all_levels\", all_levels)\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4380,
        "y": 2160,
        "wires": [
            []
        ]
    },
    {
        "id": "12f64291d3f51ae8",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "all output levels",
        "func": "var volume_last_output = flow.get(\"volume_last_output\")\nvar all_levels = flow.get(\"all_levels\")\n\nif (msg.output == volume_last_output) {\n    all_levels[\"out\" + msg.output + \"Vol\"] = msg.output_level\n    msg.all_levels_complete = true\n} else {\n    all_levels[\"out\" + msg.output + \"Vol\"] = msg.output_level\n}\n\nflow.set(\"all_levels\", all_levels)\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4380,
        "y": 2200,
        "wires": [
            [
                "2fca71d430ea7acd"
            ]
        ]
    },
    {
        "id": "7a5cd83584947c03",
        "type": "inject",
        "z": "92703c264104932a",
        "d": true,
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 2890,
        "y": 2140,
        "wires": [
            [
                "a806dddf41490e8c"
            ]
        ]
    },
    {
        "id": "a806dddf41490e8c",
        "type": "change",
        "z": "92703c264104932a",
        "d": true,
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "all_levels",
                "pt": "flow",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3110,
        "y": 2140,
        "wires": [
            []
        ]
    },
    {
        "id": "ddcec7eaf16a43ba",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "+ all_levels",
        "func": "msg.all_levels = flow.get(\"all_levels\")\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4890,
        "y": 2200,
        "wires": [
            [
                "be16a968cf4911b6"
            ]
        ]
    },
    {
        "id": "2fca71d430ea7acd",
        "type": "switch",
        "z": "92703c264104932a",
        "d": true,
        "name": "if msg.all_levels_complete is true",
        "property": "all_levels_complete",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 4640,
        "y": 2200,
        "wires": [
            [
                "ddcec7eaf16a43ba"
            ]
        ]
    },
    {
        "id": "be16a968cf4911b6",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "payload for volume",
        "func": "msg.payload = {}\nmsg.payload[\"domain\"] = \"python_script\"\nmsg.payload[\"service\"] = \"set_state\"\nmsg.payload[\"data\"] = msg.all_levels\nmsg.payload[\"data\"][\"entity_id\"] = \"sensor.volume\"\nmsg.payload[\"data\"][\"state\"] = msg.state\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5090,
        "y": 2200,
        "wires": [
            [
                "9c58cf3230deadec"
            ]
        ]
    },
    {
        "id": "65147be66977ae69",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "Коммутация входов",
        "info": "",
        "x": 1390,
        "y": 2100,
        "wires": []
    },
    {
        "id": "2338b4b9dbc2526b",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "input commutation",
        "func": "let inputs = new Map();\n\n// inputs.set(номер физического входа, номер входа от интерфейса):\ninputs.set(1, 1)\ninputs.set(2, 2)\ninputs.set(3, 3)\ninputs.set(4, 4)\ninputs.set(5, 2)\ninputs.set(6, 3)\ninputs.set(7, 7)\ninputs.set(8, 8)\n\nif (inputs.has(msg.input))\n{\n    msg.input = inputs.get(msg.input)\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4170,
        "y": 2160,
        "wires": [
            [
                "6a82e2b08ad2e68e"
            ]
        ]
    },
    {
        "id": "f0a4a7308f756d7e",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "НАСТРОЙКА",
        "info": "",
        "x": 1370,
        "y": 2060,
        "wires": []
    },
    {
        "id": "8c73e468b34d6f51",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "Коммутация выходов",
        "info": "",
        "x": 1400,
        "y": 2220,
        "wires": []
    },
    {
        "id": "cacf9ba30f17e37e",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "output commutation",
        "func": "let outputs = new Map();\n\n// outputs.set(номер физического выхода, номер выхода от интерфейса):\noutputs.set(1, 1)\noutputs.set(2, 2)\noutputs.set(3, 3)\noutputs.set(4, 4)\noutputs.set(5, 5)\noutputs.set(6, 6)\noutputs.set(7, 7)\noutputs.set(8, 8)\n\nif (outputs.has(msg.output))\n{\n    msg.output = outputs.get(msg.output)\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4170,
        "y": 2200,
        "wires": [
            [
                "12f64291d3f51ae8"
            ]
        ]
    },
    {
        "id": "ed2fbc27070abf0e",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "audiomute = false && micmute = false",
        "func": "msg.payload = {}\nmsg.payload[\"domain\"] = \"python_script\"\nmsg.payload[\"service\"] = \"set_state\"\nmsg.payload[\"data\"] = {}\n\n// var state = new Date()\n// state = state.getTime()\n\nmsg.payload[\"data\"][\"entity_id\"] = \"sensor.custom_buttons\"\nmsg.payload[\"data\"][\"state\"] = msg.state\nmsg.payload[\"data\"][\"audiomute\"] = false\nmsg.payload[\"data\"][\"micmute\"] = false\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1430,
        "y": 880,
        "wires": [
            [
                "724965cdc697f7d1"
            ]
        ]
    },
    {
        "id": "3f1b3d4202116ea9",
        "type": "function",
        "z": "92703c264104932a",
        "name": "data_to_save",
        "func": "if ((Object.keys(msg.data.new_state.attributes).length) > 4)\n{\n    msg.payload = msg.data.new_state\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 780,
        "wires": [
            [
                "b45a532fe107c0e1"
            ]
        ]
    },
    {
        "id": "b45a532fe107c0e1",
        "type": "DataIn",
        "z": "92703c264104932a",
        "collection": "d6688dbfdb474a0f",
        "name": "-> audioprocessor",
        "update": false,
        "path": "/",
        "x": 610,
        "y": 780,
        "wires": []
    },
    {
        "id": "86d54426566e9e54",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "Запоминание состояния",
        "info": "",
        "x": 230,
        "y": 740,
        "wires": []
    },
    {
        "id": "968681271ed9b6d7",
        "type": "server-state-changed",
        "z": "92703c264104932a",
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.audioprocessor",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": true,
        "ignorePrevStateUnknown": true,
        "ignorePrevStateUnavailable": true,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 200,
        "y": 780,
        "wires": [
            [
                "3f1b3d4202116ea9"
            ]
        ]
    },
    {
        "id": "724965cdc697f7d1",
        "type": "api-call-service",
        "z": "92703c264104932a",
        "d": true,
        "name": "custom_buttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1700,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "bdf199215b6e3280",
        "type": "server-state-changed",
        "z": "92703c264104932a",
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.audioprocessor",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 200,
        "y": 1440,
        "wires": [
            [
                "ee00243e868c7dfb"
            ]
        ]
    },
    {
        "id": "1070d0a2df0ce200",
        "type": "function",
        "z": "92703c264104932a",
        "name": "input commutation",
        "func": "try\n{\n    if (flow.get('inputs').has(msg.input))\n    {\n        msg.input = flow.get('inputs').get(msg.input)\n    }\n}\nfinally \n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 400,
        "wires": [
            [
                "919b56687eb838ed",
                "15d48ee3e358dd92"
            ]
        ]
    },
    {
        "id": "15d48ee3e358dd92",
        "type": "function",
        "z": "92703c264104932a",
        "name": "output commutation",
        "func": "try\n{\n    if (flow.get('outputs').has(msg.output))\n    {\n        msg.output = flow.get('outputs').get(msg.output)\n    }\n}\nfinally \n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 400,
        "wires": [
            [
                "2fd50cf5574f9928",
                "dedfd3c0f59c3288",
                "80fa5f24bd23986d",
                "47b897f1beb2e2ad"
            ]
        ]
    },
    {
        "id": "a6315f214b00bae1",
        "type": "change",
        "z": "92703c264104932a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"show\":[\"АУДИОПРОЦЕССОР_Править_вход\"], \"hide\":[\"АУДИОПРОЦЕССОР_Править_выход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4220,
        "y": 580,
        "wires": [
            [
                "eda3652b93c9132e"
            ]
        ]
    },
    {
        "id": "32d5ab503e827834",
        "type": "ui_button",
        "z": "92703c264104932a",
        "name": "",
        "group": "b52da2819ad1aaab",
        "order": 4,
        "width": 8,
        "height": 1,
        "passthru": false,
        "label": "Вернуть к заводским настройкам",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "rotate_left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3180,
        "y": 580,
        "wires": [
            [
                "cb4043f51378a7ba"
            ]
        ]
    },
    {
        "id": "1b25569a5be008a1",
        "type": "ui_form",
        "z": "92703c264104932a",
        "name": "",
        "label": "",
        "group": "4baa93912120146e",
        "order": 2,
        "width": 6,
        "height": 1,
        "options": [
            {
                "label": "Программный вход",
                "value": "inSoftware",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Физический вход",
                "value": "inHardware",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Уставка",
                "value": "inOffset",
                "type": "number",
                "required": false,
                "rows": null
            }
        ],
        "formValue": {
            "inSoftware": "",
            "inHardware": "",
            "inOffset": ""
        },
        "payload": "",
        "submit": "Подтвердить",
        "cancel": "",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "className": "",
        "x": 4430,
        "y": 620,
        "wires": [
            [
                "269c8d5001756fb4"
            ]
        ]
    },
    {
        "id": "07a30e97cd29363d",
        "type": "ui_button",
        "z": "92703c264104932a",
        "name": "",
        "group": "4baa93912120146e",
        "order": 1,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Закрыть",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 4000,
        "y": 540,
        "wires": [
            [
                "a759fa65921d33e1"
            ]
        ]
    },
    {
        "id": "cce7dd227da12102",
        "type": "function",
        "z": "92703c264104932a",
        "name": "get data to refresh table",
        "func": "var inputs = flow.get('inputs')\nvar inputOffsets = flow.get('inputOffsets')\nvar data = []\nnode.warn(inputOffsets)\nfor (const key of inputs.keys()) {\n  node.warn(key)\n  data.push({'inSoftware': key, 'inHardware': inputs.get(key), 'inOffset': inputOffsets.get(key)})\n}\n\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3750,
        "y": 620,
        "wires": [
            [
                "3d2b74a309f81125",
                "428a747fa91e1a5c"
            ]
        ]
    },
    {
        "id": "4f85bc852fe2afac",
        "type": "ui_button",
        "z": "92703c264104932a",
        "name": "",
        "group": "b52da2819ad1aaab",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-plus-square",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3090,
        "y": 620,
        "wires": [
            [
                "696fe5b5fa65361c"
            ]
        ]
    },
    {
        "id": "269c8d5001756fb4",
        "type": "function",
        "z": "92703c264104932a",
        "name": "validation",
        "func": "if ((msg.payload.inHardware >= 0) && (msg.payload.inSoftware <= flow.get('inputs').size) && (msg.payload.inSoftware >= 1))\n{\n    msg.log = 'ok'\n    var inputs = flow.get('inputs')\n    inputs.set(msg.payload.inSoftware, msg.payload.inHardware)\n    flow.set('inputs', inputs)\n\n    var inputOffsets = flow.get('inputOffsets')\n    inputOffsets.set(msg.payload.inSoftware, msg.payload.inOffset)\n    flow.set('inputOffsets', inputOffsets)\n}\nelse\n{\n    msg.log = 'incorrect'\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3700,
        "y": 680,
        "wires": [
            [
                "669b91f498f37a62"
            ]
        ]
    },
    {
        "id": "7c6fad5592ed9d25",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "AMA Inpits",
        "info": "",
        "x": 3100,
        "y": 540,
        "wires": []
    },
    {
        "id": "85e498357b241484",
        "type": "inject",
        "z": "92703c264104932a",
        "d": true,
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 5590,
        "y": 660,
        "wires": [
            [
                "7f1ada5725eabf8a"
            ]
        ]
    },
    {
        "id": "c6d889d27432777c",
        "type": "debug",
        "z": "92703c264104932a",
        "d": true,
        "name": "debug 115",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 6200,
        "y": 660,
        "wires": []
    },
    {
        "id": "9417c4d94680a973",
        "type": "comment",
        "z": "92703c264104932a",
        "d": true,
        "name": "Коммутация входов",
        "info": "",
        "x": 5790,
        "y": 620,
        "wires": []
    },
    {
        "id": "19992b8d73e0e72d",
        "type": "comment",
        "z": "92703c264104932a",
        "d": true,
        "name": "Коммутация выходов",
        "info": "",
        "x": 6020,
        "y": 620,
        "wires": []
    },
    {
        "id": "7f1ada5725eabf8a",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "input commutation",
        "func": "if (flow.get('inputs').has(msg.input))\n{\n    msg.input = flow.get('inputs').get(msg.input)\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5790,
        "y": 660,
        "wires": [
            [
                "3f519d51dfcd19b1"
            ]
        ]
    },
    {
        "id": "3f519d51dfcd19b1",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "output commutation",
        "func": "if (flow.get('outputs').has(msg.output))\n{\n    msg.output = flow.get('outputs').get(msg.output)\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 6010,
        "y": 660,
        "wires": [
            [
                "c6d889d27432777c"
            ]
        ]
    },
    {
        "id": "bcce7bed18b628bb",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "get inputs",
        "func": "msg.inputs = flow.get('inputs')\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5760,
        "y": 740,
        "wires": [
            [
                "6d4f4892fdc51b01"
            ]
        ]
    },
    {
        "id": "6d4f4892fdc51b01",
        "type": "debug",
        "z": "92703c264104932a",
        "d": true,
        "name": "debug 116",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "inputs",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 5980,
        "y": 740,
        "wires": []
    },
    {
        "id": "48f4ee878c39beab",
        "type": "inject",
        "z": "92703c264104932a",
        "d": true,
        "name": "Check >>",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 5600,
        "y": 740,
        "wires": [
            [
                "bcce7bed18b628bb"
            ]
        ]
    },
    {
        "id": "696fe5b5fa65361c",
        "type": "function",
        "z": "92703c264104932a",
        "name": "manage inputs (add)",
        "func": "if (flow.get('inputs') == undefined) \n{\n    flow.set('inputs', new Map())\n    flow.set('trackable_inputs', [])\n}\n/*\nif (flow.get('outputs') == undefined)\n{\n    flow.set('outputs', new Map())\n    flow.set('trackable_outputs', [])\n    flow.set('trackable_outputs_aec', [])\n}\n*/\nif (flow.get('inputOffsets') == undefined) \n{\n    flow.set('inputOffsets', new Map())\n}\n\nvar inputs = flow.get('inputs')\ninputs.set(inputs.size + 1, inputs.size + 1)\nflow.set('inputs', inputs)\n\nvar inputOffsets = flow.get('inputOffsets')\ninputOffsets.set(inputOffsets.size + 1, -15) // Default\nflow.set('inputOffsets', inputOffsets)\n\nmsg.inputs = inputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3420,
        "y": 620,
        "wires": [
            [
                "cce7dd227da12102"
            ]
        ]
    },
    {
        "id": "03b6e38248f22f2b",
        "type": "ui_button",
        "z": "92703c264104932a",
        "name": "",
        "group": "b52da2819ad1aaab",
        "order": 2,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3090,
        "y": 660,
        "wires": [
            [
                "b0b102d2549dadfa"
            ]
        ]
    },
    {
        "id": "b0b102d2549dadfa",
        "type": "function",
        "z": "92703c264104932a",
        "name": "manage inputs (del)",
        "func": "var inputs = flow.get('inputs')\nvar trackable_inputs = flow.get('trackable_inputs')\n\nvar index = trackable_inputs.indexOf(inputs.size.toString())\nif (index != -1)\n{\n    trackable_inputs.splice(index, 1)\n    flow.set('trackable_inputs', trackable_inputs)\n}\n\ninputs.delete(inputs.size)\nflow.set('inputs', inputs)\n\nvar inputOffsets = flow.get('inputOffsets')\ninputOffsets.delete(inputOffsets.size)\nflow.set('inputOffsets', inputOffsets)\n\nmsg.inputs = inputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3420,
        "y": 660,
        "wires": [
            [
                "cce7dd227da12102"
            ]
        ]
    },
    {
        "id": "a759fa65921d33e1",
        "type": "change",
        "z": "92703c264104932a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"hide\":[\"АУДИОПРОЦЕССОР_Править_вход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4220,
        "y": 540,
        "wires": [
            [
                "eda3652b93c9132e"
            ]
        ]
    },
    {
        "id": "e15c113dbe260f64",
        "type": "function",
        "z": "92703c264104932a",
        "name": "to form",
        "func": "var key = msg.row + 1\nvar val = flow.get('inputs').get(msg.row + 1)\nvar offset = flow.get('inputOffsets').get(msg.row + 1)\n\nflow.set('selectedInput', {'inSoftware': key, 'inHardware': val, 'inOffset': offset})\n\nmsg.payload = flow.get('selectedInput')\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4200,
        "y": 620,
        "wires": [
            [
                "1b25569a5be008a1"
            ]
        ]
    },
    {
        "id": "669b91f498f37a62",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "log",
        "property": "log",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "incorrect",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ok",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 3810,
        "y": 760,
        "wires": [
            [
                "62c6fcdc88ab312a",
                "d28f941137340327"
            ],
            [
                "a31741489d09022a",
                "85a8874ca2f0dd5b"
            ]
        ]
    },
    {
        "id": "4f85d60079faeb10",
        "type": "ui_toast",
        "z": "92703c264104932a",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Вход назначен",
        "name": "Successful",
        "x": 4170,
        "y": 780,
        "wires": []
    },
    {
        "id": "ef3c8d962ad534ce",
        "type": "ui_toast",
        "z": "92703c264104932a",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Укажите вход в пределах табличных значений",
        "name": "Incorrect",
        "x": 4180,
        "y": 740,
        "wires": []
    },
    {
        "id": "62c6fcdc88ab312a",
        "type": "function",
        "z": "92703c264104932a",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3990,
        "y": 740,
        "wires": [
            [
                "ef3c8d962ad534ce"
            ]
        ]
    },
    {
        "id": "a31741489d09022a",
        "type": "function",
        "z": "92703c264104932a",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3990,
        "y": 780,
        "wires": [
            [
                "4f85d60079faeb10"
            ]
        ]
    },
    {
        "id": "d28f941137340327",
        "type": "function",
        "z": "92703c264104932a",
        "name": "return last data",
        "func": "msg.payload = { 'inSoftware': msg.payload.inSoftware, 'inHardware': flow.get('inputs').get(msg.payload.inSoftware), 'inOffset': flow.get('inputOffsets').get(msg.payload.inSoftware) }\nmsg.event = {'bbox': [580, 221, 898, 173]}\nmsg.socketid = 'w0SaiBu-ePmh8nhNAABF'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4020,
        "y": 700,
        "wires": [
            [
                "1b25569a5be008a1"
            ]
        ]
    },
    {
        "id": "cb4043f51378a7ba",
        "type": "function",
        "z": "92703c264104932a",
        "name": "reset func",
        "func": "var inputs = flow.get('inputs')\n\nfor (const key of inputs.keys()) {\n  inputs.set(key, key)\n}\n\nflow.set('inputs', inputs)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3460,
        "y": 580,
        "wires": [
            [
                "cce7dd227da12102"
            ]
        ]
    },
    {
        "id": "85a8874ca2f0dd5b",
        "type": "delay",
        "z": "92703c264104932a",
        "name": "-->",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 3470,
        "y": 760,
        "wires": [
            [
                "cce7dd227da12102"
            ]
        ]
    },
    {
        "id": "029042e6c0675476",
        "type": "DataIn",
        "z": "92703c264104932a",
        "collection": "685e1e326592eb00",
        "name": "-> audioprocessor_config",
        "update": false,
        "path": "/",
        "x": 4450,
        "y": 440,
        "wires": []
    },
    {
        "id": "15c4c95ccf568167",
        "type": "DataOut",
        "z": "92703c264104932a",
        "collection": "685e1e326592eb00",
        "name": "audioprocessor_config ->",
        "path": "/",
        "error": false,
        "x": 4450,
        "y": 400,
        "wires": [
            [
                "801ffea5162838b4"
            ]
        ]
    },
    {
        "id": "801ffea5162838b4",
        "type": "function",
        "z": "92703c264104932a",
        "name": "set all to flow",
        "func": "for (let el of msg.payload)\n{\n    if ((el['attr'] == 'inputs') || (el['attr'] == 'outputs') || (el['attr'] == 'inputOffsets') || (el['attr'] == 'outputOffsets')) {\n        const map = new Map(Object.entries(el['val']).map(([key, value]) => [Number(key), value]));\n        flow.set(el['attr'], map)\n    }\n    else\n    {\n        flow.set(el['attr'], el['val'])\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4670,
        "y": 400,
        "wires": [
            [
                "914cc1a4b24fc1dd"
            ]
        ]
    },
    {
        "id": "dba86b5697404251",
        "type": "server-state-changed",
        "z": "92703c264104932a",
        "name": "about",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.about",
        "entityIdType": "exact",
        "outputInitially": false,
        "ifState": "",
        "ifStateType": "str",
        "outputOnlyOnStateChange": false,
        "for": "0",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "about",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.about",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "haltifstate": "",
        "halt_if_type": "str",
        "output_only_on_state_change": false,
        "x": 3270,
        "y": 400,
        "wires": [
            [
                "969b1592b6022339"
            ]
        ]
    },
    {
        "id": "1d174d7b24a5098d",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "Вызов сохраненного состояния при старте HomeAssistant",
        "info": "",
        "x": 3440,
        "y": 360,
        "wires": []
    },
    {
        "id": "d4207ded5701eebb",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "new about.home_assistant is true",
        "property": "about.new_state.attributes.home_assistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 3960,
        "y": 400,
        "wires": [
            [
                "bb4fa452feb927ad"
            ]
        ]
    },
    {
        "id": "969b1592b6022339",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "old about.home_assistant != new about.home_assistant",
        "property": "about.old_state.attributes.home_assistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "about.new_state.attributes.home_assistant",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 3570,
        "y": 400,
        "wires": [
            [
                "d4207ded5701eebb"
            ]
        ]
    },
    {
        "id": "88ea5f1c9df20d23",
        "type": "function",
        "z": "92703c264104932a",
        "name": "get all from flow",
        "func": "var keys = flow.keys()\nvar ans = []\nfor (let key of keys) {\n    if (Object.prototype.toString.call(flow.get(key)) == '[object Map]') {\n        ans.push({ 'attr': key, 'val': Object.fromEntries(flow.get(key))})\n    }\n    else\n    {\n        ans.push({ 'attr': key, 'val': flow.get(key)})\n    }\n}\nmsg.payload = ans\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4220,
        "y": 440,
        "wires": [
            [
                "029042e6c0675476"
            ]
        ]
    },
    {
        "id": "361237a6c04ba14c",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "get outputs",
        "func": "msg.outputs = flow.get('outputs')\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5770,
        "y": 780,
        "wires": [
            [
                "c797a04091a7330b"
            ]
        ]
    },
    {
        "id": "c797a04091a7330b",
        "type": "debug",
        "z": "92703c264104932a",
        "d": true,
        "name": "debug 117",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "outputs",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 5980,
        "y": 780,
        "wires": []
    },
    {
        "id": "0972b0613332f0fb",
        "type": "inject",
        "z": "92703c264104932a",
        "d": true,
        "name": "Check >>",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 5600,
        "y": 780,
        "wires": [
            [
                "361237a6c04ba14c"
            ]
        ]
    },
    {
        "id": "f5af31cf0d4fa458",
        "type": "change",
        "z": "92703c264104932a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"show\":[\"АУДИОПРОЦЕССОР_Править_выход\"], \"hide\":[\"АУДИОПРОЦЕССОР_Править_вход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4220,
        "y": 1100,
        "wires": [
            [
                "af78f4ea83c1efcc"
            ]
        ]
    },
    {
        "id": "0f4c3577ec51385f",
        "type": "ui_button",
        "z": "92703c264104932a",
        "name": "",
        "group": "e75c15142175c3bc",
        "order": 4,
        "width": 8,
        "height": 1,
        "passthru": false,
        "label": "Вернуть к заводским настройкам",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "rotate_left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3180,
        "y": 1100,
        "wires": [
            [
                "cfb879f6ca845f67"
            ]
        ]
    },
    {
        "id": "c682eda5e9c5379b",
        "type": "ui_form",
        "z": "92703c264104932a",
        "name": "",
        "label": "",
        "group": "a00da0272f194b50",
        "order": 2,
        "width": 6,
        "height": 1,
        "options": [
            {
                "label": "Программный выход",
                "value": "outSoftware",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Физический выход",
                "value": "outHardware",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Уставка",
                "value": "outOffset",
                "type": "number",
                "required": false,
                "rows": null
            }
        ],
        "formValue": {
            "outSoftware": "",
            "outHardware": "",
            "outOffset": ""
        },
        "payload": "",
        "submit": "Подтвердить",
        "cancel": "",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "className": "",
        "x": 4430,
        "y": 1140,
        "wires": [
            [
                "31ba28f6ebf9fb82",
                "0072170903a56f1c"
            ]
        ]
    },
    {
        "id": "67177d068a0f928e",
        "type": "ui_button",
        "z": "92703c264104932a",
        "name": "",
        "group": "a00da0272f194b50",
        "order": 1,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Закрыть",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 4000,
        "y": 1060,
        "wires": [
            [
                "53baafb9463eb7f7"
            ]
        ]
    },
    {
        "id": "a640723bbaa4e3d8",
        "type": "function",
        "z": "92703c264104932a",
        "name": "get data to refresh table",
        "func": "var outputs = flow.get('outputs')\nvar outputOffsets = flow.get('outputOffsets')\nvar data = []\nnode.warn(outputOffsets)\nfor (const key of outputs.keys()) {\n  node.warn(key)\n  data.push({ 'outSoftware': key, 'outHardware': outputs.get(key), 'outOffset': outputOffsets.get(key) })\n}\n\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3750,
        "y": 1140,
        "wires": [
            [
                "df30ebf45f04ebd4",
                "61706c69bbd5e2f9"
            ]
        ]
    },
    {
        "id": "80364e7f38ee6f13",
        "type": "ui_button",
        "z": "92703c264104932a",
        "name": "",
        "group": "e75c15142175c3bc",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-plus-square",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3090,
        "y": 1140,
        "wires": [
            [
                "68b9daac959c98d2"
            ]
        ]
    },
    {
        "id": "31ba28f6ebf9fb82",
        "type": "function",
        "z": "92703c264104932a",
        "name": "validation",
        "func": "if ((msg.payload.outHardware >= 0) && (msg.payload.outSoftware <= flow.get('outputs').size) && (msg.payload.outSoftware >= 1))\n{\n    msg.log = 'ok'\n    var outputs = flow.get('outputs')\n    outputs.set(msg.payload.outSoftware, msg.payload.outHardware)\n    flow.set('outputs', outputs)\n\n    var outputOffsets = flow.get('outputOffsets')\n    outputOffsets.set(msg.payload.outSoftware, msg.payload.outOffset)\n    flow.set('outputOffsets', outputOffsets)\n}\nelse\n{\n    msg.log = 'incorrect'\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3700,
        "y": 1200,
        "wires": [
            [
                "596778a8a0020c55"
            ]
        ]
    },
    {
        "id": "b7e779e239a2580c",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "AMA Outputs",
        "info": "",
        "x": 3110,
        "y": 1060,
        "wires": []
    },
    {
        "id": "68b9daac959c98d2",
        "type": "function",
        "z": "92703c264104932a",
        "name": "manage outputs (add)",
        "func": "/*\nif (flow.get('inputs') == undefined) {\n    flow.set('inputs', new Map())\n    flow.set('trackable_inputs', [])\n}\n*/\nif (flow.get('outputs') == undefined)\n{\n    flow.set('outputs', new Map())\n    flow.set('trackable_outputs', [])\n}\n\nif (flow.get('outputOffsets') == undefined) {\n    flow.set('outputOffsets', new Map())\n}\n\nvar outputs = flow.get('outputs')\noutputs.set(outputs.size + 1, outputs.size + 1)\nflow.set('outputs', outputs)\n\nvar outputOffsets = flow.get('outputOffsets')\noutputOffsets.set(outputOffsets.size + 1, -15) // Default\nflow.set('outputOffsets', outputOffsets)\n\nmsg.outputs = outputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3420,
        "y": 1140,
        "wires": [
            [
                "a640723bbaa4e3d8"
            ]
        ]
    },
    {
        "id": "4171bf42116bc4e2",
        "type": "ui_button",
        "z": "92703c264104932a",
        "name": "",
        "group": "e75c15142175c3bc",
        "order": 2,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3090,
        "y": 1180,
        "wires": [
            [
                "428fedfd302584b4"
            ]
        ]
    },
    {
        "id": "428fedfd302584b4",
        "type": "function",
        "z": "92703c264104932a",
        "name": "manage outputs (del)",
        "func": "var outputs = flow.get('outputs')\nvar trackable_outputs = flow.get('trackable_outputs')\nvar trackable_outputs_aec = flow.get('trackable_outputs_aec')\n\nvar index = trackable_outputs.indexOf(outputs.size.toString())\nif (index != -1)\n{\n    trackable_outputs.splice(index, 1)\n    flow.set('trackable_outputs', trackable_outputs)\n}\n\nvar index_aec = trackable_outputs_aec.indexOf(outputs.size.toString())\nif (index_aec != -1)\n{\n    trackable_outputs_aec.splice(index_aec, 1)\n    flow.set('trackable_outputs_aec', trackable_outputs_aec)\n}\n\noutputs.delete(outputs.size)\nflow.set('outputs', outputs)\n\nvar outputOffsets = flow.get('outputOffsets')\noutputOffsets.delete(outputOffsets.size)\nflow.set('outputOffsets', outputOffsets)\n\nmsg.outputs = outputs\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3420,
        "y": 1180,
        "wires": [
            [
                "a640723bbaa4e3d8"
            ]
        ]
    },
    {
        "id": "53baafb9463eb7f7",
        "type": "change",
        "z": "92703c264104932a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"hide\":[\"АУДИОПРОЦЕССОР_Править_выход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4220,
        "y": 1060,
        "wires": [
            [
                "af78f4ea83c1efcc"
            ]
        ]
    },
    {
        "id": "e11a54f35d6546ac",
        "type": "function",
        "z": "92703c264104932a",
        "name": "to form",
        "func": "var key = msg.row + 1\nvar val = flow.get('outputs').get(msg.row + 1)\nvar offset = flow.get('outputOffsets').get(msg.row + 1)\n\nflow.set('selectedOutput', {'outSoftware': key, 'outHardware': val, 'outOffset': offset})\n\nmsg.payload = flow.get('selectedOutput')\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4200,
        "y": 1140,
        "wires": [
            [
                "c682eda5e9c5379b"
            ]
        ]
    },
    {
        "id": "596778a8a0020c55",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "log",
        "property": "log",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "incorrect",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ok",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 3810,
        "y": 1280,
        "wires": [
            [
                "3118563ec5839bab",
                "26199b92c027d07f"
            ],
            [
                "0cd571c95e6be9bc",
                "1fdc231354dac23a"
            ]
        ]
    },
    {
        "id": "a979e41026354b92",
        "type": "ui_toast",
        "z": "92703c264104932a",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Вход назначен",
        "name": "Successful",
        "x": 4170,
        "y": 1300,
        "wires": []
    },
    {
        "id": "a256d1aceb8ed542",
        "type": "ui_toast",
        "z": "92703c264104932a",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Укажите вход в пределах табличных значений",
        "name": "Incorrect",
        "x": 4180,
        "y": 1260,
        "wires": []
    },
    {
        "id": "3118563ec5839bab",
        "type": "function",
        "z": "92703c264104932a",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3990,
        "y": 1260,
        "wires": [
            [
                "a256d1aceb8ed542"
            ]
        ]
    },
    {
        "id": "0cd571c95e6be9bc",
        "type": "function",
        "z": "92703c264104932a",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3990,
        "y": 1300,
        "wires": [
            [
                "a979e41026354b92"
            ]
        ]
    },
    {
        "id": "26199b92c027d07f",
        "type": "function",
        "z": "92703c264104932a",
        "name": "return last data",
        "func": "msg.payload = {'outSoftware': msg.payload.outSoftware, 'outHardware': flow.get('outputs').get(msg.payload.outSoftware), 'outOffset': flow.get('outputOffsets').get(msg.payload.outSoftware) }\nmsg.event = {'bbox': [580, 221, 898, 173]}\nmsg.socketid = 'w0SaiBu-ePmh8nhNAABF'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4020,
        "y": 1220,
        "wires": [
            [
                "c682eda5e9c5379b"
            ]
        ]
    },
    {
        "id": "cfb879f6ca845f67",
        "type": "function",
        "z": "92703c264104932a",
        "name": "reset func",
        "func": "var outputs = flow.get('outputs')\n\nfor (const key of outputs.keys()) {\n  outputs.set(key, key)\n}\n\nflow.set('outputs', outputs)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3460,
        "y": 1100,
        "wires": [
            [
                "a640723bbaa4e3d8"
            ]
        ]
    },
    {
        "id": "1fdc231354dac23a",
        "type": "delay",
        "z": "92703c264104932a",
        "name": "-->",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 3470,
        "y": 1280,
        "wires": [
            [
                "a640723bbaa4e3d8"
            ]
        ]
    },
    {
        "id": "4fcbc996df1778e8",
        "type": "ui_template",
        "z": "92703c264104932a",
        "group": "631fc494a4cc4190",
        "name": "checkbox",
        "order": 1,
        "width": 2,
        "height": 6,
        "format": "<script>\n(function($scope) {\n $scope.sendRow = function(obj) {\n    $scope.send({ \"checkbox\":  obj});\n };\n})(scope);\n</script>\n<form>\n    <fieldset style=\"width:68%\">\n    <legend>Входы</legend>\n        <div ng-repeat=\"x in msg.inputs\">\n            <label>{{x.NAME}}\n                <input  type=\"checkbox\"\n                        style=\"float:left; position: relative; top: 5px;\"\n                        ng-model=\"x.STATE\"\n                        ng-change=\"sendRow({var:x.NAME, state: x.STATE})\">\n            </label>\n        </div>\n    </fieldset>\n    <fieldset style=\"width:50%\">\n        <legend>Выходы</legend>\n        <div ng-repeat=\"x in msg.outputs\">\n            <label>{{x.NAME}}\n                    <input  type=\"checkbox\" \n                            style=\"float:left; position: relative; top: 5px;\"\n                            ng-model=\"x.STATE\"\n                            ng-change=\"sendRow({var:x.NAME, state: x.STATE})\">\n                </label>\n        </div>\n    </fieldset>\n</form>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 4820,
        "y": 1280,
        "wires": [
            [
                "89ff85c067833bba"
            ]
        ]
    },
    {
        "id": "01139d7acbc72b97",
        "type": "function",
        "z": "92703c264104932a",
        "name": "get ins & outs",
        "func": "let inputs = [];\nfor (let i = 1; i <= flow.get('inputs').size; i++) {\n    let state = false\n    if (flow.get('trackable_inputs').includes(i.toString()))\n    {\n        state = true\n    }\n    inputs.push({ 'NAME': i.toString() + ' ', 'STATE': state}); // Пробел, чтобы названия не совпадали с выходами\n}\n\n\nlet outputs = [];\nfor (let i = 1; i <= flow.get('outputs').size; i++) {\n    let state = false\n    if (flow.get('trackable_outputs').includes(i.toString())) {\n        state = true\n    }\n    outputs.push({'NAME': i.toString(), 'STATE': state});\n}\n\nmsg.inputs = inputs\nmsg.outputs = outputs\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4640,
        "y": 1280,
        "wires": [
            [
                "4fcbc996df1778e8"
            ]
        ]
    },
    {
        "id": "56adbbf29dabbf3d",
        "type": "link in",
        "z": "92703c264104932a",
        "name": "to checkbox",
        "links": [
            "d627cccd7336f5c3",
            "61706c69bbd5e2f9",
            "428a747fa91e1a5c"
        ],
        "x": 4505,
        "y": 1300,
        "wires": [
            [
                "01139d7acbc72b97",
                "9c3a6c151b552f1a",
                "b9b66e8a0144ead3"
            ]
        ]
    },
    {
        "id": "d645fed71f7f04e9",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "AMA Buttons",
        "info": "",
        "x": 4630,
        "y": 1240,
        "wires": []
    },
    {
        "id": "89ff85c067833bba",
        "type": "function",
        "z": "92703c264104932a",
        "name": "manage trackable",
        "func": "let trackable_inputs = flow.get('trackable_inputs')\nif (trackable_inputs == undefined)\n{\n    trackable_inputs = []\n}\n\nlet trackable_outputs = flow.get('trackable_outputs')\nif (trackable_outputs == undefined)\n{\n    trackable_outputs = []\n}\nif (msg.checkbox.var.slice(-1) == ' ')\n{\n    let name = msg.checkbox.var.slice(0, -1)\n    let state = msg.checkbox.state\n    if (state)\n    {\n        trackable_inputs.push(name)\n    }\n    else\n    {\n        trackable_inputs.splice(trackable_inputs.indexOf(name), 1)\n    }\n    flow.set('trackable_inputs', trackable_inputs)\n}\nelse\n{   \n    let name = msg.checkbox.var\n    let state = msg.checkbox.state\n    if (state)\n    {\n        trackable_outputs.push(name)\n    }\n    else\n    {\n        trackable_outputs.splice(trackable_outputs.indexOf(name), 1)\n    }\n    flow.set('trackable_outputs', trackable_outputs)\n}\n\nmsg.trackable_inputs = trackable_inputs\nmsg.trackable_outputs = trackable_outputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5010,
        "y": 1280,
        "wires": [
            []
        ]
    },
    {
        "id": "c1fc15d151211e2f",
        "type": "function",
        "z": "92703c264104932a",
        "name": "clear all and fields",
        "func": "var keys = flow.keys()\n\nfor (let key of keys)\n{\n    flow.set(key, undefined);\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 6610,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "2db5cd7e726a890a",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "CLEAR",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 6430,
        "y": 740,
        "wires": [
            [
                "c1fc15d151211e2f"
            ]
        ]
    },
    {
        "id": "90d56663e3b4859e",
        "type": "function",
        "z": "92703c264104932a",
        "name": "check all and fields",
        "func": "var keys = flow.keys()\nmsg.keys = keys\nfor (let key of keys)\n{\n    msg[key] = flow.get(key);\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 6610,
        "y": 780,
        "wires": [
            [
                "a9c5b5d77c4c9081"
            ]
        ]
    },
    {
        "id": "5f69aa02afcbc882",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "Check",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 6430,
        "y": 780,
        "wires": [
            [
                "90d56663e3b4859e"
            ]
        ]
    },
    {
        "id": "a9c5b5d77c4c9081",
        "type": "debug",
        "z": "92703c264104932a",
        "name": "FLOW.KEYS",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 6800,
        "y": 780,
        "wires": []
    },
    {
        "id": "4f7106fb4a22274e",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "readme.txt",
        "info": "trackable_inputs - массив отслеживаемых входов\ntrackable_outputs - массив отслеживаемых выходов\n\nЭтот элемент будет работать в потоке аудиопроцессора в механизме кнопок общего мьюта",
        "x": 4980,
        "y": 1240,
        "wires": []
    },
    {
        "id": "d0896c713f9bc870",
        "type": "ui_ui_control",
        "z": "92703c264104932a",
        "name": "",
        "events": "all",
        "x": 4800,
        "y": 820,
        "wires": [
            [
                "8c780ce1bfefad4d"
            ]
        ]
    },
    {
        "id": "f211646b27e44d4b",
        "type": "change",
        "z": "92703c264104932a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"tab\":\"КОНФИГУРАТОР\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4580,
        "y": 820,
        "wires": [
            [
                "d0896c713f9bc870"
            ]
        ]
    },
    {
        "id": "9ff642d4c93925f1",
        "type": "ui_button",
        "z": "92703c264104932a",
        "name": "",
        "group": "a7308f94ab8d29d3",
        "order": 1,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "arrow_back",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 4390,
        "y": 820,
        "wires": [
            [
                "f211646b27e44d4b"
            ]
        ]
    },
    {
        "id": "d627cccd7336f5c3",
        "type": "link out",
        "z": "92703c264104932a",
        "name": "from INs",
        "mode": "link",
        "links": [
            "56adbbf29dabbf3d",
            "8f3800393b995933"
        ],
        "x": 5155,
        "y": 820,
        "wires": []
    },
    {
        "id": "8c780ce1bfefad4d",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "payload == 'connect'",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "connect",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 5000,
        "y": 820,
        "wires": [
            [
                "d627cccd7336f5c3"
            ]
        ]
    },
    {
        "id": "9c3a6c151b552f1a",
        "type": "function",
        "z": "92703c264104932a",
        "name": "get outs_aec",
        "func": "let outputs_aec = [];\nfor (let i = 1; i <= flow.get('outputs').size; i++) {\n    let state = false\n    if (flow.get('trackable_outputs_aec').includes(i.toString()))\n    {\n        state = true\n    }\n    outputs_aec.push({ 'NAME': i.toString(), 'STATE': state}); // Пробел, чтобы названия не совпадали с выходами\n}\n\nmsg.outputs_aec = outputs_aec\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4630,
        "y": 1320,
        "wires": [
            [
                "dfe9f9b58589047a"
            ]
        ]
    },
    {
        "id": "b55d632ff79705c7",
        "type": "function",
        "z": "92703c264104932a",
        "name": "manage trackable_aec",
        "func": "let trackable_outputs_aec = flow.get('trackable_outputs_aec')\nif (trackable_outputs_aec == undefined)\n{\n    trackable_outputs_aec = []\n}\n\nlet name = msg.checkbox.var\nlet state = msg.checkbox.state\nif (state)\n{\n    trackable_outputs_aec.push(name)\n}\nelse\n{\n    trackable_outputs_aec.splice(trackable_outputs_aec.indexOf(name), 1)\n}\nflow.set('trackable_outputs_aec', trackable_outputs_aec)\n\nmsg.trackable_outputs_aec = trackable_outputs_aec\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5020,
        "y": 1320,
        "wires": [
            [
                "3f4d5935a6bf83ee"
            ]
        ]
    },
    {
        "id": "3f4d5935a6bf83ee",
        "type": "function",
        "z": "92703c264104932a",
        "name": "outputs for aec",
        "func": "// var outputs_for_aec = [2, 3]\n// flow.set(\"outputs_for_aec\", outputs_for_aec)\n\nflow.set(\"outputs_for_aec\", flow.get('trackable_outputs_aec'))\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5240,
        "y": 1320,
        "wires": [
            []
        ]
    },
    {
        "id": "67df75112b69015b",
        "type": "ping",
        "z": "92703c264104932a",
        "protocol": "IPv4",
        "mode": "triggered",
        "name": "",
        "host": "",
        "timer": "2",
        "inputs": 1,
        "x": 690,
        "y": 1940,
        "wires": [
            [
                "d3f32fba50445360"
            ]
        ]
    },
    {
        "id": "5bbc90fb49f43c28",
        "type": "function",
        "z": "92703c264104932a",
        "name": "false",
        "func": "msg.payload = false;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 1980,
        "wires": [
            [
                "d3f32fba50445360"
            ]
        ]
    },
    {
        "id": "6ce0f2f70c18929a",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "is empty?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 540,
        "y": 1960,
        "wires": [
            [
                "67df75112b69015b"
            ],
            [
                "5bbc90fb49f43c28"
            ]
        ]
    },
    {
        "id": "61d59e04453c9347",
        "type": "inject",
        "z": "92703c264104932a",
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4190,
        "y": 500,
        "wires": [
            [
                "a759fa65921d33e1"
            ]
        ]
    },
    {
        "id": "4d5a2e131295dde5",
        "type": "inject",
        "z": "92703c264104932a",
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4190,
        "y": 1020,
        "wires": [
            [
                "53baafb9463eb7f7"
            ]
        ]
    },
    {
        "id": "01288edc5fb56438",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "Refresh table with start flows",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4440,
        "y": 360,
        "wires": [
            [
                "15c4c95ccf568167"
            ]
        ]
    },
    {
        "id": "108b90a1257af972",
        "type": "link in",
        "z": "92703c264104932a",
        "name": "> save",
        "links": [
            "428a747fa91e1a5c",
            "61706c69bbd5e2f9",
            "48d9211adcba160f"
        ],
        "x": 4105,
        "y": 440,
        "wires": [
            [
                "88ea5f1c9df20d23"
            ]
        ]
    },
    {
        "id": "914cc1a4b24fc1dd",
        "type": "link out",
        "z": "92703c264104932a",
        "name": "load >",
        "mode": "link",
        "links": [
            "441a8f07e7aa09bc",
            "c32b5f38fb4bb9f3",
            "8fcdac187ac674c5"
        ],
        "x": 4815,
        "y": 400,
        "wires": []
    },
    {
        "id": "441a8f07e7aa09bc",
        "type": "link in",
        "z": "92703c264104932a",
        "name": "refresh ins",
        "links": [
            "914cc1a4b24fc1dd"
        ],
        "x": 3655,
        "y": 580,
        "wires": [
            [
                "cce7dd227da12102"
            ]
        ]
    },
    {
        "id": "428a747fa91e1a5c",
        "type": "link out",
        "z": "92703c264104932a",
        "name": "get data ins >",
        "mode": "link",
        "links": [
            "56adbbf29dabbf3d",
            "108b90a1257af972",
            "8f3800393b995933"
        ],
        "x": 3845,
        "y": 580,
        "wires": []
    },
    {
        "id": "c32b5f38fb4bb9f3",
        "type": "link in",
        "z": "92703c264104932a",
        "name": "refresh outs",
        "links": [
            "914cc1a4b24fc1dd"
        ],
        "x": 3655,
        "y": 1100,
        "wires": [
            [
                "a640723bbaa4e3d8"
            ]
        ]
    },
    {
        "id": "61706c69bbd5e2f9",
        "type": "link out",
        "z": "92703c264104932a",
        "name": "get data outs >",
        "mode": "link",
        "links": [
            "56adbbf29dabbf3d",
            "108b90a1257af972",
            "8f3800393b995933"
        ],
        "x": 3845,
        "y": 1100,
        "wires": []
    },
    {
        "id": "3d2b74a309f81125",
        "type": "ui_table",
        "z": "92703c264104932a",
        "group": "b52da2819ad1aaab",
        "name": "Входы",
        "order": 3,
        "width": 8,
        "height": 3,
        "columns": [
            {
                "field": "inSoftware",
                "title": "Программный",
                "width": "33%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "inHardware",
                "title": "Физический",
                "width": "33%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "inOffset",
                "title": "Уставка",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 3990,
        "y": 620,
        "wires": [
            [
                "a6315f214b00bae1",
                "e15c113dbe260f64"
            ]
        ]
    },
    {
        "id": "df30ebf45f04ebd4",
        "type": "ui_table",
        "z": "92703c264104932a",
        "group": "e75c15142175c3bc",
        "name": "Выходы",
        "order": 3,
        "width": 8,
        "height": 3,
        "columns": [
            {
                "field": "outSoftware",
                "title": "Программный",
                "width": "33%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "outHardware",
                "title": "Физический",
                "width": "33%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "outOffset",
                "title": "Уставка",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 4000,
        "y": 1140,
        "wires": [
            [
                "f5af31cf0d4fa458",
                "e11a54f35d6546ac"
            ]
        ]
    },
    {
        "id": "f9755bd028449f35",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1400,
        "y": 2160,
        "wires": [
            [
                "151852580b07c2a3"
            ]
        ]
    },
    {
        "id": "151852580b07c2a3",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "",
        "property": "device_statuses.attributes.audioprocessor",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1590,
        "y": 2160,
        "wires": [
            [
                "26ce6384ee9fe887"
            ]
        ]
    },
    {
        "id": "18fcccd5d61ee485",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1400,
        "y": 2240,
        "wires": [
            [
                "ca9aa6889dd191aa"
            ]
        ]
    },
    {
        "id": "ca9aa6889dd191aa",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "",
        "property": "device_statuses.attributes.audioprocessor",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1590,
        "y": 2240,
        "wires": [
            [
                "a1a28c099d0e7024"
            ]
        ]
    },
    {
        "id": "345824693a6cc999",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "",
        "property": "device_statuses.attributes.audioprocessor",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1590,
        "y": 2080,
        "wires": [
            [
                "9ff4e676cc1d28ba"
            ]
        ]
    },
    {
        "id": "d7aa8c6e36c02871",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1400,
        "y": 2080,
        "wires": [
            [
                "345824693a6cc999"
            ]
        ]
    },
    {
        "id": "d49e5b520db839d1",
        "type": "function",
        "z": "92703c264104932a",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 1680,
        "wires": [
            [
                "36c98e2dfa0ffb4f"
            ]
        ]
    },
    {
        "id": "2f301f84b887013a",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 480,
        "y": 1680,
        "wires": [
            [
                "d49e5b520db839d1"
            ]
        ]
    },
    {
        "id": "9ff4e676cc1d28ba",
        "type": "function",
        "z": "92703c264104932a",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 2080,
        "wires": [
            [
                "95d7f3ae52e9427f"
            ]
        ]
    },
    {
        "id": "26ce6384ee9fe887",
        "type": "function",
        "z": "92703c264104932a",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 2160,
        "wires": [
            [
                "4183fd93a2088450"
            ]
        ]
    },
    {
        "id": "a1a28c099d0e7024",
        "type": "function",
        "z": "92703c264104932a",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 2240,
        "wires": [
            [
                "30a11a0e2f2656e2"
            ]
        ]
    },
    {
        "id": "6190b70414dce17b",
        "type": "function",
        "z": "92703c264104932a",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 960,
        "y": 1240,
        "wires": [
            [
                "663b40f2069115a2"
            ]
        ]
    },
    {
        "id": "c5594da9e3653954",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 800,
        "y": 1240,
        "wires": [
            [
                "6190b70414dce17b"
            ]
        ]
    },
    {
        "id": "02a94765de629fa1",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1180,
        "y": 880,
        "wires": [
            [
                "ed2fbc27070abf0e"
            ]
        ]
    },
    {
        "id": "35a94996ea0a9cfe",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "d": true,
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.custom_buttons",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1020,
        "y": 880,
        "wires": [
            [
                "02a94765de629fa1"
            ]
        ]
    },
    {
        "id": "c553db3ba191c6c0",
        "type": "function",
        "z": "92703c264104932a",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 1440,
        "wires": [
            [
                "3c102904e5ad7a69"
            ]
        ]
    },
    {
        "id": "93ae3004029348c9",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "STATE?",
        "info": "",
        "x": 1280,
        "y": 1380,
        "wires": []
    },
    {
        "id": "929d33107647c00d",
        "type": "function",
        "z": "92703c264104932a",
        "name": "event parsing",
        "func": "// Предыдущее состояние выходов\nvar old_isEnabledOut = [\n    msg.data.old_state.attributes.isEnabledOut1,\n    msg.data.old_state.attributes.isEnabledOut2,\n    msg.data.old_state.attributes.isEnabledOut3,\n    msg.data.old_state.attributes.isEnabledOut4\n]\n\n// Новое состояние выходов\nvar new_isEnabledOut = [\n    msg.data.new_state.attributes.isEnabledOut1,\n    msg.data.new_state.attributes.isEnabledOut2,\n    msg.data.new_state.attributes.isEnabledOut3,\n    msg.data.new_state.attributes.isEnabledOut4\n]\n\n// Предыдущее состояние матрицы\nvar old_out = [\n    msg.data.old_state.attributes.out1,\n    msg.data.old_state.attributes.out2,\n    msg.data.old_state.attributes.out3,\n    msg.data.old_state.attributes.out4\n]\n\n// Новое состояние матрицы\nvar new_out = [\n    msg.data.new_state.attributes.out1,\n    msg.data.new_state.attributes.out2,\n    msg.data.new_state.attributes.out3,\n    msg.data.new_state.attributes.out4\n]\n\n// Массив выходных сообщений\nvar messages = []\n\n   \nfor (let i = 0; i < new_out.length; i++) {\n    \n    // Включение/выключение выхода\n    if (old_isEnabledOut[i] != new_isEnabledOut[i] && typeof new_isEnabledOut[i] != \"undefined\") {\n\n        var output = Number(i + 1)\n\n        if (Number(new_isEnabledOut[i]) == 1) {\n            var power = true\n        } else if (Number(new_isEnabledOut[i]) == 0) {\n            var power = false\n        }\n\n        messages.push({\n            output: output,\n            power: power,\n            type: \"set output power\",\n            new_isEnabledOut: new_isEnabledOut,\n            new_out: new_out\n        })\n    }\n\n    // Переключение матрицы\n    if (old_out[i] != new_out[i] && typeof new_out[i] != \"undefined\") {\n\n        var output = Number(i + 1)\n\n        var input = Number(new_out[i])\n\n        messages.push({\n            output: output,\n            input: input,\n            type: \"set input to output\",\n            new_isEnabledOut: new_isEnabledOut,\n            new_out: new_out\n        })\n    }\n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 1500,
        "wires": [
            []
        ]
    },
    {
        "id": "bb4fa452feb927ad",
        "type": "delay",
        "z": "92703c264104932a",
        "name": "150 ms",
        "pauseType": "delay",
        "timeout": "150",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 4200,
        "y": 400,
        "wires": [
            [
                "15c4c95ccf568167"
            ]
        ]
    },
    {
        "id": "5b50b6fe0d9dd0cb",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "good state?",
        "property": "device_statuses.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 850,
        "y": 2000,
        "wires": [
            [
                "8929bac962a984f7"
            ]
        ]
    },
    {
        "id": "ab5b6fbadf9b464a",
        "type": "comment",
        "z": "92703c264104932a",
        "d": true,
        "name": "fix (не проверяли)",
        "info": "Тут надо брать state с custom buttons, а не с ama?",
        "x": 1050,
        "y": 840,
        "wires": []
    },
    {
        "id": "91daca95c30c8964",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "fix",
        "info": "Чтобы в гонке записей статусов устройств никто не перебил изначально записываемый state от фронтенда",
        "x": 1010,
        "y": 2000,
        "wires": []
    },
    {
        "id": "026d597816faf036",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "Для стерео",
        "info": "то, что назначается на 1 выход, назначается и на 2\nт.к. у колонки есть L и R каналы",
        "x": 850,
        "y": 280,
        "wires": []
    },
    {
        "id": "c56222e897e3c6e9",
        "type": "api-call-service",
        "z": "92703c264104932a",
        "d": true,
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "all",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1560,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "5e6a6f6d658dcb64",
        "type": "comment",
        "z": "92703c264104932a",
        "d": true,
        "name": "fix",
        "info": "queue - all messages",
        "x": 1530,
        "y": 980,
        "wires": []
    },
    {
        "id": "0ea68f22dad58d90",
        "type": "DataOut",
        "z": "92703c264104932a",
        "d": true,
        "collection": "d6688dbfdb474a0f",
        "name": "audioprocessor ->",
        "path": "/",
        "error": false,
        "x": 1030,
        "y": 940,
        "wires": [
            [
                "7c576ecc206dd865"
            ]
        ]
    },
    {
        "id": "f0ebb19cc8bda655",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "+ state, data",
        "func": "// var state = new Date()\n// state = state.getTime()\n\nvar data = msg.payload.attributes\ndata[\"entity_id\"] = msg.payload.entity_id\ndata[\"state\"] = Number(msg.state) + 1\ndata[\"isEnabledOut1\"] = 1\ndata[\"isEnabledOut2\"] = 1\ndata[\"isEnabledOut3\"] = 1\ndata[\"isEnabledOut4\"] = 1\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\": data\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1370,
        "y": 940,
        "wires": [
            [
                "c56222e897e3c6e9"
            ]
        ]
    },
    {
        "id": "7c576ecc206dd865",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "d": true,
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomatrix",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1200,
        "y": 940,
        "wires": [
            [
                "f0ebb19cc8bda655"
            ]
        ]
    },
    {
        "id": "316b979a3e10b4c8",
        "type": "function",
        "z": "92703c264104932a",
        "name": "input gain",
        "func": "// ВХОДНЫЕ ПАРАМЕТРЫ:\n// msg.input: int - Номер входа\n// msg.input_gain: float - Уровень чувствительности входа от -72.0 до 12.0\n\n\n// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Input = 299 (0x012B)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0x2B\nmsg.module_type_low = 0x01\n\n// Тип параметра Gain для модуля Input = 1\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x01\nmsg.parameter_type_low = 0x00\n\n// value1 = (номер входа - 1)\n// в формате двух байтов c обратным порядком\nmsg.value1_high = msg.input - 1\nmsg.value1_low = 0x00\n\n// value2 = (Уровень чувствительности * 100), если Уровень чувствительности >= 0\n// value2 = (65536 + Уровень чувствительности * 100), если Уровень чувствительности < 0\n// в формате двух байтов c обратным порядком\nif (msg.input_gain >= 0) {\n    var value2_raw = msg.input_gain * 100\n} else {\n    var value2_raw = 65536 + (msg.input_gain * 100)\n}\nmsg.value2_high = value2_raw % 256\nmsg.value2_low = ~~(value2_raw / 256)\n\nif (msg.value2_low > 255)\n{\n    msg.value2_low = 255\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1540,
        "y": 420,
        "wires": [
            [
                "94155b94b06acb6f"
            ]
        ]
    },
    {
        "id": "6d7de7154ec650b8",
        "type": "function",
        "z": "92703c264104932a",
        "name": "output gain",
        "func": "// ВХОДНЫЕ ПАРАМЕТРЫ:\n// msg.output: int - Номер входа\n// msg.output_gain: float - Уровень чувствительности выхода от -72.0 до 12.0\n\n\n// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Output = 295 (0x0127)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0x27\nmsg.module_type_low = 0x01\n\n// Тип параметра Gain для модуля Output = 1\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x01\nmsg.parameter_type_low = 0x00\n\n// value1 = (номер входа - 1)\n// в формате двух байтов c обратным порядком\nmsg.value1_high = msg.output - 1\nmsg.value1_low = 0x00\n\n// value2 = (Уровень чувствительности * 100), если Уровень чувствительности >= 0\n// value2 = (65536 + Уровень чувствительности * 100), если Уровень чувствительности < 0\n// в формате двух байтов c обратным порядком\nif (msg.output_gain >= 0) {\n    var value2_raw = msg.output_gain * 100\n} else {\n    var value2_raw = 65536 + (msg.output_gain * 100)\n}\nmsg.value2_high = value2_raw % 256\nmsg.value2_low = ~~(value2_raw / 256)\n\nif (msg.value2_low > 255)\n{\n    msg.value2_low = 255\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 520,
        "wires": [
            [
                "94155b94b06acb6f"
            ]
        ]
    },
    {
        "id": "d29c0530a7acadaa",
        "type": "function",
        "z": "92703c264104932a",
        "name": "set aec gain",
        "func": "// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Sound mixer = 166 (0x00A6)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0xA6\nmsg.module_type_low = 0x00\n\n// Тип параметра Mixing gain для модуля Mixer = 2\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x02\nmsg.parameter_type_low = 0x00\n\n// Старший байт value1 = номер AEC\n// Старший байт value1 = номер выхода - 1\nmsg.value1_high = msg.aec\nmsg.value1_low = msg.output - 1\n\n// value2 = (Уровень чувствительности * 100), если Уровень чувствительности >= 0\n// value2 = (65535 + Уровень чувствительности * 100), если Уровень чувствительности < 0\n// в формате двух байтов c обратным порядком\nif (msg.aec_gain >= 0) {\n    var value2_raw = msg.aec_gain * 100\n} else {\n    var value2_raw = 65535 + (msg.aec_gain * 100)\n}\nmsg.value2_high = value2_raw % 256\nmsg.value2_low = value2_raw / 256\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 640,
        "wires": [
            [
                "94155b94b06acb6f"
            ]
        ]
    },
    {
        "id": "cef9dcfc702b6de5",
        "type": "inject",
        "z": "92703c264104932a",
        "d": true,
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 900,
        "wires": [
            [
                "f1b18496d88c8258"
            ]
        ]
    },
    {
        "id": "f1b18496d88c8258",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "d": true,
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 340,
        "y": 900,
        "wires": [
            [
                "588becb04b5dcc41"
            ]
        ]
    },
    {
        "id": "3ab75e8df7a7d49f",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "attrs qty",
        "func": "if (Object.keys(msg.data.attributes).length <= 2)\n{\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 900,
        "wires": [
            [
                "0ea68f22dad58d90",
                "35a94996ea0a9cfe"
            ]
        ]
    },
    {
        "id": "b3f02a8599f74694",
        "type": "link out",
        "z": "92703c264104932a",
        "name": "from button to mute",
        "mode": "link",
        "links": [],
        "x": 1075,
        "y": 1300,
        "wires": []
    },
    {
        "id": "588becb04b5dcc41",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "state",
        "func": "msg.state = Number(msg.data.state)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 900,
        "wires": [
            [
                "c0cab176e9975065"
            ]
        ]
    },
    {
        "id": "c0cab176e9975065",
        "type": "switch",
        "z": "92703c264104932a",
        "d": true,
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 650,
        "y": 900,
        "wires": [
            [
                "3ab75e8df7a7d49f"
            ]
        ]
    },
    {
        "id": "112c40c44472ceef",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "inputs",
        "payloadType": "flow",
        "x": 220,
        "y": 40,
        "wires": [
            [
                "85220004a9ca8588"
            ]
        ]
    },
    {
        "id": "85220004a9ca8588",
        "type": "debug",
        "z": "92703c264104932a",
        "name": "debug 215",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 410,
        "y": 180,
        "wires": []
    },
    {
        "id": "04924793a4cb09b1",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "outputs",
        "payloadType": "flow",
        "x": 210,
        "y": 80,
        "wires": [
            [
                "85220004a9ca8588"
            ]
        ]
    },
    {
        "id": "95bde1d8d3c8bb8d",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "outputsToUsb",
        "payloadType": "flow",
        "x": 190,
        "y": 160,
        "wires": [
            [
                "85220004a9ca8588"
            ]
        ]
    },
    {
        "id": "62dfc34bdebbade2",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "inputsToUsb",
        "payloadType": "flow",
        "x": 200,
        "y": 120,
        "wires": [
            [
                "85220004a9ca8588"
            ]
        ]
    },
    {
        "id": "1a29acd5cca78a9f",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "audioprocessorModel",
        "payloadType": "flow",
        "x": 170,
        "y": 200,
        "wires": [
            [
                "85220004a9ca8588"
            ]
        ]
    },
    {
        "id": "7c5aa93fcd18511c",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 160,
        "wires": [
            [
                "2397a6746d464510"
            ]
        ]
    },
    {
        "id": "da41d386296e2985",
        "type": "change",
        "z": "92703c264104932a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "inputs",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2200,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "f4dafb63c2165901",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 60,
        "wires": [
            [
                "a31d22914c769571"
            ]
        ]
    },
    {
        "id": "b3a59b9cb574425c",
        "type": "change",
        "z": "92703c264104932a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "outputs",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2210,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "9821e7b5a25b1575",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 100,
        "wires": [
            [
                "229f77e4552be310"
            ]
        ]
    },
    {
        "id": "229f77e4552be310",
        "type": "change",
        "z": "92703c264104932a",
        "name": "inputsToUsb = [1, 4]",
        "rules": [
            {
                "t": "set",
                "p": "inputsToUsb",
                "pt": "flow",
                "to": "[1, 4]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "3aab904680458b75",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 200,
        "wires": [
            [
                "1696f9aeeee61f22"
            ]
        ]
    },
    {
        "id": "1696f9aeeee61f22",
        "type": "change",
        "z": "92703c264104932a",
        "name": "outputsToUsb = [8]",
        "rules": [
            {
                "t": "set",
                "p": "outputsToUsb",
                "pt": "flow",
                "to": "[8]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2010,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "12bd1f9ae969699f",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 260,
        "wires": [
            [
                "38c7dea756a082da"
            ]
        ]
    },
    {
        "id": "38c7dea756a082da",
        "type": "change",
        "z": "92703c264104932a",
        "name": "audioprocessorModel = clevermic88",
        "rules": [
            {
                "t": "set",
                "p": "audioprocessorModel",
                "pt": "flow",
                "to": "clevermic88",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2070,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "2397a6746d464510",
        "type": "function",
        "z": "92703c264104932a",
        "name": "1 = \"usb\"",
        "func": "msg.payload = new Map();\n\nmsg.payload.set(1, \"usb\");\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1980,
        "y": 160,
        "wires": [
            [
                "da41d386296e2985"
            ]
        ]
    },
    {
        "id": "a31d22914c769571",
        "type": "function",
        "z": "92703c264104932a",
        "name": "1 = \"usb\"",
        "func": "msg.payload = new Map();\n\nmsg.payload.set(1, \"usb\");\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1980,
        "y": 60,
        "wires": [
            [
                "b3a59b9cb574425c"
            ]
        ]
    },
    {
        "id": "0701b40991edeb26",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "usb?",
        "property": "output",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1330,
        "y": 180,
        "wires": [
            [
                "b54db317867b84b4"
            ],
            [
                "0d984a3281952357"
            ]
        ]
    },
    {
        "id": "b54db317867b84b4",
        "type": "function",
        "z": "92703c264104932a",
        "name": "inputs to usb",
        "func": "var messages = []\n\nfor (var i in flow.get(\"inputsToUsb\")) {\n    if (flow.get(\"audioprocessorModel\") == 'clevermic44') {\n        msg.value1_low = 4\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic88') {\n        msg.value1_low = 8\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic1616') {\n        msg.value1_low = 16\n    }\n\n    if (msg.power == true) {\n        msg.value2_high = 0x01\n    } else {\n        msg.value2_high = 0x00\n    }\n\n    messages.push({\n        \"message_type\": 0x21,\n        \"module_type_high\": 0xA6,\n        \"module_type_low\": 0x00,\n        \"parameter_type_high\": 0x01,\n        \"parameter_type_low\": 0x00,\n        \"value1_high\": flow.get(\"inputsToUsb\")[i] - 1,\n        \"value1_low\": msg.value1_low,\n        \"value2_high\": msg.value2_high,\n        \"value2_low\": 0x00\n    })\n\n    \n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 160,
        "wires": [
            [
                "94155b94b06acb6f"
            ]
        ]
    },
    {
        "id": "1269b705352ec788",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "usb?",
        "property": "output",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1370,
        "y": 500,
        "wires": [
            [
                "9ee475f40f5c9f92"
            ],
            [
                "6d7de7154ec650b8"
            ]
        ]
    },
    {
        "id": "9ee475f40f5c9f92",
        "type": "function",
        "z": "92703c264104932a",
        "name": "usb out gain",
        "func": "var messages = []\n\nfor (var i in flow.get(\"inputsToUsb\")) {\n    if (flow.get(\"audioprocessorModel\") == 'clevermic44') {\n        msg.value1_low = 4\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic88') {\n        msg.value1_low = 8\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic1616') {\n        msg.value1_low = 16\n    }\n\n    if (msg.output_gain >= 0) {\n        var value2_raw = msg.output_gain * 100\n    } else {\n        var value2_raw = 65535 + (msg.output_gain * 100)\n    }\n    msg.value2_high = value2_raw % 256\n    msg.value2_low = value2_raw / 256\n\n    messages.push({\n        \"message_type\": 0x21,\n        \"module_type_high\": 0xA6,\n        \"module_type_low\": 0x00,\n        \"parameter_type_high\": 0x02,\n        \"parameter_type_low\": 0x00,\n        \"value1_high\": flow.get(\"inputsToUsb\")[i] - 1,\n        \"value1_low\": msg.value1_low,\n        \"value2_high\": msg.value2_high,\n        \"value2_low\": msg.value2_low\n    })\n\n    \n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 480,
        "wires": [
            [
                "94155b94b06acb6f"
            ]
        ]
    },
    {
        "id": "e30932bda9194c28",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "usb?",
        "property": "input",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1330,
        "y": 80,
        "wires": [
            [
                "425ee89f646fd5a3"
            ],
            [
                "d52076522b681216"
            ]
        ]
    },
    {
        "id": "425ee89f646fd5a3",
        "type": "function",
        "z": "92703c264104932a",
        "name": "usb to outputs",
        "func": "var messages = []\n\nfor (var i in flow.get(\"outputsToUsb\")) {\n    if (flow.get(\"audioprocessorModel\") == 'clevermic44') {\n        msg.value1_high = 5\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic88') {\n        msg.value1_high = 9\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic1616') {\n        msg.value1_high = 17\n    }\n    if (msg.power == true) {\n        msg.value2_high = 0x01\n    } else {\n        msg.value2_high = 0x00\n    }\n\n    messages.push({\n        \"message_type\": 0x21,\n        \"module_type_high\": 0xA6,\n        \"module_type_low\": 0x00,\n        \"parameter_type_high\": 0x01,\n        \"parameter_type_low\": 0x00,\n        \"value1_high\": msg.value1_high,\n        \"value1_low\": flow.get(\"outputsToUsb\")[i] - 1,\n        \"value2_high\": msg.value2_high,\n        \"value2_low\": 0x00\n    })\n\n    \n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1520,
        "y": 60,
        "wires": [
            [
                "94155b94b06acb6f"
            ]
        ]
    },
    {
        "id": "bf8d4c3472ebb819",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "usb?",
        "property": "input",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1370,
        "y": 400,
        "wires": [
            [
                "ac30fcdf7305e7ce"
            ],
            [
                "316b979a3e10b4c8"
            ]
        ]
    },
    {
        "id": "ac30fcdf7305e7ce",
        "type": "function",
        "z": "92703c264104932a",
        "name": "usb in gain",
        "func": "var messages = []\n\nfor (var i in flow.get(\"outputsToUsb\")) {\n    if (flow.get(\"audioprocessorModel\") == 'clevermic44') {\n        msg.value1_high = 5\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic88') {\n        msg.value1_high = 9\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic1616') {\n        msg.value1_high = 17\n    }\n\n    if (msg.input_gain >= 0) {\n        var value2_raw = msg.input_gain * 100\n    } else {\n        var value2_raw = 65535 + (msg.input_gain * 100)\n    }\n    msg.value2_high = value2_raw % 256\n    msg.value2_low = value2_raw / 256\n\n    messages.push({\n        \"message_type\": 0x21,\n        \"module_type_high\": 0xA6,\n        \"module_type_low\": 0x00,\n        \"parameter_type_high\": 0x02,\n        \"parameter_type_low\": 0x00,\n        \"value1_high\": msg.value1_high,\n        \"value1_low\": flow.get(\"outputsToUsb\")[i] - 1,\n        \"value2_high\": msg.value2_high,\n        \"value2_low\": msg.value2_low\n    })\n\n    \n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 380,
        "wires": [
            [
                "94155b94b06acb6f"
            ]
        ]
    },
    {
        "id": "e6f1380f27ef2783",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "inputOffsets",
        "payloadType": "flow",
        "x": 200,
        "y": 240,
        "wires": [
            [
                "85220004a9ca8588"
            ]
        ]
    },
    {
        "id": "e69e64652a65350b",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "outputOffsets",
        "payloadType": "flow",
        "x": 190,
        "y": 280,
        "wires": [
            [
                "85220004a9ca8588"
            ]
        ]
    },
    {
        "id": "430985072cb20ff6",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 300,
        "wires": [
            [
                "c042b1808d2686c5"
            ]
        ]
    },
    {
        "id": "7b3f6128cb255f10",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 340,
        "wires": [
            [
                "a5f21eb5b7094fd8"
            ]
        ]
    },
    {
        "id": "a5f21eb5b7094fd8",
        "type": "function",
        "z": "92703c264104932a",
        "name": "1: -19",
        "func": "msg.payload = new Map();\n\nmsg.payload.set(1, -19);\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1970,
        "y": 340,
        "wires": [
            [
                "f5fc3fc56c8de13a"
            ]
        ]
    },
    {
        "id": "c042b1808d2686c5",
        "type": "function",
        "z": "92703c264104932a",
        "name": "1: -20",
        "func": "msg.payload = new Map();\n\nmsg.payload.set(1, -20);\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1970,
        "y": 300,
        "wires": [
            [
                "83de0a08d6e6fa0b"
            ]
        ]
    },
    {
        "id": "f5fc3fc56c8de13a",
        "type": "change",
        "z": "92703c264104932a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "outputOffsets",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2230,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "83de0a08d6e6fa0b",
        "type": "change",
        "z": "92703c264104932a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "inputOffsets",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2220,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "24f6588df41a664b",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 380,
        "wires": [
            [
                "f8e3a576199dab7c"
            ]
        ]
    },
    {
        "id": "f8e3a576199dab7c",
        "type": "change",
        "z": "92703c264104932a",
        "name": "aecOffset = -15",
        "rules": [
            {
                "t": "set",
                "p": "aecOffset",
                "pt": "flow",
                "to": "-15",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2000,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "a7be3edb94d84dd9",
        "type": "inject",
        "z": "92703c264104932a",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "aecOffset",
        "payloadType": "flow",
        "x": 210,
        "y": 320,
        "wires": [
            [
                "85220004a9ca8588"
            ]
        ]
    },
    {
        "id": "ed599952c3099959",
        "type": "ui_template",
        "z": "92703c264104932a",
        "group": "fc2772e34f6ee2c7",
        "name": "checkbox",
        "order": 1,
        "width": 2,
        "height": 6,
        "format": "<script>\n    (function($scope) {\n $scope.sendRow = function(obj) {\n    $scope.send({ \"checkbox\":  obj});\n };\n})(scope);\n</script>\n<form>\n    <fieldset style=\"width:50%\">\n        <legend>Выходы</legend>\n        <div ng-repeat=\"x in msg.outputsToUsb\">\n            <label>{{x.NAME}}\n                    <input  type=\"checkbox\" \n                            style=\"float:left; position: relative; top: 5px;\"\n                            ng-model=\"x.STATE\"\n                            ng-change=\"sendRow({var:x.NAME, state: x.STATE})\">\n                </label>\n        </div>\n    </fieldset>\n</form>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 5140,
        "y": 1480,
        "wires": [
            [
                "df5e13fd964a5cd8"
            ]
        ]
    },
    {
        "id": "a4f8021f0498e4ed",
        "type": "function",
        "z": "92703c264104932a",
        "name": "get outs",
        "func": "let outputsToUsb = [];\nfor (let i = 1; i <= flow.get('outputs').size; i++) {\n    let state = false\n    if (flow.get('outputsToUsb').includes(i))\n    {\n        state = true\n    }\n    outputsToUsb.push({ 'NAME': i.toString(), 'STATE': state}); // Пробел, чтобы названия не совпадали с выходами\n}\n\nmsg.outputsToUsb = outputsToUsb\nmsg.inputs = flow.get(\"inputs\")\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4300,
        "y": 1620,
        "wires": [
            []
        ]
    },
    {
        "id": "8f3800393b995933",
        "type": "link in",
        "z": "92703c264104932a",
        "name": "to checkbox",
        "links": [
            "d627cccd7336f5c3",
            "61706c69bbd5e2f9",
            "428a747fa91e1a5c"
        ],
        "x": 4175,
        "y": 1640,
        "wires": [
            [
                "a4f8021f0498e4ed",
                "a3cb9b5f2b9ec9fa"
            ]
        ]
    },
    {
        "id": "db0505b1f8b0c96b",
        "type": "comment",
        "z": "92703c264104932a",
        "name": "AMA Buttons",
        "info": "",
        "x": 4310,
        "y": 1580,
        "wires": []
    },
    {
        "id": "df5e13fd964a5cd8",
        "type": "function",
        "z": "92703c264104932a",
        "name": "manage USB_in",
        "func": "let outputsToUsb = flow.get('outputsToUsb')\nif (outputsToUsb == undefined)\n{\n    outputsToUsb = []\n}\n\nlet name = Number(msg.checkbox.var)\nlet state = msg.checkbox.state\nif (state)\n{\n    outputsToUsb.push(name)\n}\nelse\n{\n    outputsToUsb.splice(outputsToUsb.indexOf(name), 1)\n}\nflow.set('outputsToUsb', outputsToUsb)\n\nmsg.outputsToUsb = outputsToUsb\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5320,
        "y": 1480,
        "wires": [
            []
        ]
    },
    {
        "id": "2e373edb30badc34",
        "type": "ui_template",
        "z": "92703c264104932a",
        "group": "ebbc8772c1f553eb",
        "name": "checkbox",
        "order": 1,
        "width": 2,
        "height": 6,
        "format": "<script>\n    (function($scope) {\n $scope.sendRow = function(obj) {\n    $scope.send({ \"checkbox\":  obj});\n };\n})(scope);\n</script>\n<form>\n    <fieldset style=\"width:68%\">\n        <legend>Входы</legend>\n        <div ng-repeat=\"x in msg.inputsToUsb\">\n            <label>{{x.NAME}}\n                <input  type=\"checkbox\"\n                        style=\"float:left; position: relative; top: 5px;\"\n                        ng-model=\"x.STATE\"\n                        ng-change=\"sendRow({var:x.NAME, state: x.STATE})\">\n            </label>\n        </div>\n    </fieldset>\n</form>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 5140,
        "y": 1520,
        "wires": [
            [
                "76c33f86928266ca"
            ]
        ]
    },
    {
        "id": "a3cb9b5f2b9ec9fa",
        "type": "function",
        "z": "92703c264104932a",
        "name": "get ins",
        "func": "let inputsToUsb = [];\nfor (let i = 1; i <= flow.get('inputs').size; i++) {\n    let state = false\n    if (flow.get('inputsToUsb').includes(i))\n    {\n        state = true\n    }\n    inputsToUsb.push({ 'NAME': i.toString(), 'STATE': state}); // Пробел, чтобы названия не совпадали с выходами\n}\n\nmsg.inputsToUsb = inputsToUsb\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4290,
        "y": 1660,
        "wires": [
            []
        ]
    },
    {
        "id": "76c33f86928266ca",
        "type": "function",
        "z": "92703c264104932a",
        "name": "manage USB_out",
        "func": "let inputsToUsb = flow.get('inputsToUsb')\nif (inputsToUsb == undefined)\n{\n    inputsToUsb = []\n}\n\nlet name = Number(msg.checkbox.var)\nlet state = msg.checkbox.state\nif (state)\n{\n    inputsToUsb.push(name)\n}\nelse\n{\n    inputsToUsb.splice(inputsToUsb.indexOf(name), 1)\n}\nflow.set('inputsToUsb', inputsToUsb)\n\nmsg.inputsToUsb = inputsToUsb\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5330,
        "y": 1520,
        "wires": [
            []
        ]
    },
    {
        "id": "0101d97c34c5bbcc",
        "type": "function",
        "z": "92703c264104932a",
        "name": "set Model",
        "func": "flow.set(\"audioprocessorModel\", msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4620,
        "y": 1520,
        "wires": [
            [
                "cfe5c53fd63dd104",
                "d2934a6e4d86b75a"
            ]
        ]
    },
    {
        "id": "da8063a47690d768",
        "type": "function",
        "z": "92703c264104932a",
        "name": "get outs",
        "func": "let outputsToUsb = [];\nfor (let i = 1; i <= msg.size; i++) {\n    let state = false\n    if (flow.get('outputsToUsb').includes(i))\n    {\n        state = true\n    }\n    outputsToUsb.push({ 'NAME': i.toString(), 'STATE': state}); // Пробел, чтобы названия не совпадали с выходами\n}\n\nmsg.outputsToUsb = outputsToUsb\nmsg.inputs = flow.get(\"inputs\")\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4960,
        "y": 1480,
        "wires": [
            [
                "ed599952c3099959"
            ]
        ]
    },
    {
        "id": "b8ee1250987c98f7",
        "type": "function",
        "z": "92703c264104932a",
        "name": "get ins",
        "func": "let inputsToUsb = [];\nfor (let i = 1; i <= msg.size; i++) {\n    let state = false\n    if (flow.get('inputsToUsb').includes(i))\n    {\n        state = true\n    }\n    inputsToUsb.push({ 'NAME': i.toString(), 'STATE': state}); // Пробел, чтобы названия не совпадали с выходами\n}\n\nmsg.inputsToUsb = inputsToUsb\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4950,
        "y": 1520,
        "wires": [
            [
                "2e373edb30badc34"
            ]
        ]
    },
    {
        "id": "8fcdac187ac674c5",
        "type": "link in",
        "z": "92703c264104932a",
        "name": "> set model",
        "links": [
            "914cc1a4b24fc1dd"
        ],
        "x": 4505,
        "y": 1480,
        "wires": [
            [
                "5ea394b1081fe902"
            ]
        ]
    },
    {
        "id": "5ea394b1081fe902",
        "type": "function",
        "z": "92703c264104932a",
        "name": "get Model",
        "func": "msg.payload = flow.get(\"audioprocessorModel\")\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4620,
        "y": 1480,
        "wires": [
            [
                "cfe5c53fd63dd104",
                "f7125574330c4689",
                "d2934a6e4d86b75a"
            ]
        ]
    },
    {
        "id": "cfe5c53fd63dd104",
        "type": "function",
        "z": "92703c264104932a",
        "name": "set size",
        "func": "if (msg.payload == 'clevermic44') {\n    msg.size = 4\n} else if (msg.payload == 'clevermic88') {\n    msg.size = 8\n} else if (msg.payload == 'clevermic1616') {\n    msg.size = 16\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4800,
        "y": 1500,
        "wires": [
            [
                "da8063a47690d768",
                "b8ee1250987c98f7"
            ]
        ]
    },
    {
        "id": "f7125574330c4689",
        "type": "ui_dropdown",
        "z": "92703c264104932a",
        "name": "APr model",
        "label": "",
        "tooltip": "",
        "place": "Выберите модель",
        "group": "e1b3f68bc0754e54",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "Clevermic 44D",
                "value": "clevermic44",
                "type": "str"
            },
            {
                "label": "Clevermic 88D",
                "value": "clevermic88",
                "type": "str"
            },
            {
                "label": "Clevermic 1616D",
                "value": "clevermic1616",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 4450,
        "y": 1520,
        "wires": [
            [
                "0101d97c34c5bbcc",
                "48d9211adcba160f"
            ]
        ]
    },
    {
        "id": "48d9211adcba160f",
        "type": "link out",
        "z": "92703c264104932a",
        "name": "from Apr Model",
        "mode": "link",
        "links": [
            "108b90a1257af972"
        ],
        "x": 4505,
        "y": 1560,
        "wires": []
    },
    {
        "id": "0072170903a56f1c",
        "type": "debug",
        "z": "92703c264104932a",
        "name": "debug 219",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 4630,
        "y": 1140,
        "wires": []
    },
    {
        "id": "dfe9f9b58589047a",
        "type": "ui_template",
        "z": "92703c264104932a",
        "group": "70a61739c2079d6d",
        "name": "checkbox",
        "order": 2,
        "width": 2,
        "height": 5,
        "format": "<script>\n(function($scope) {\n $scope.sendRow = function(obj) {\n    $scope.send({ \"checkbox\":  obj});\n };\n})(scope);\n</script>\n<form>\n    <fieldset style=\"width:68%\">\n    <legend>Выходы</legend>\n        <div ng-repeat=\"x in msg.outputs_aec\">\n            <label>{{x.NAME}}\n                <input  type=\"checkbox\"\n                        style=\"float:left; position: relative; top: 5px;\"\n                        ng-model=\"x.STATE\"\n                        ng-change=\"sendRow({var:x.NAME, state: x.STATE})\">\n            </label>\n        </div>\n    </fieldset>\n</form>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 4820,
        "y": 1320,
        "wires": [
            [
                "b55d632ff79705c7"
            ]
        ]
    },
    {
        "id": "8a4e9efdb490879c",
        "type": "ui_text_input",
        "z": "92703c264104932a",
        "name": "AEC level",
        "label": "Уставка",
        "tooltip": "[-72,12]",
        "group": "70a61739c2079d6d",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 4820,
        "y": 1360,
        "wires": [
            [
                "e6324022a6d8b05b"
            ]
        ]
    },
    {
        "id": "b9b66e8a0144ead3",
        "type": "function",
        "z": "92703c264104932a",
        "name": "get aecOffset",
        "func": "msg.payload = flow.get('aecOffset')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4630,
        "y": 1360,
        "wires": [
            [
                "8a4e9efdb490879c"
            ]
        ]
    },
    {
        "id": "e6324022a6d8b05b",
        "type": "function",
        "z": "92703c264104932a",
        "name": "set aecOffset",
        "func": "flow.set('aecOffset', msg.payload)\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4990,
        "y": 1360,
        "wires": [
            []
        ]
    },
    {
        "id": "aad4847050ee4885",
        "type": "switch",
        "z": "92703c264104932a",
        "d": true,
        "name": "if audioprocessor.attributes.volumeIndicator is true",
        "property": "audioprocessor.attributes.volumeIndicator",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 3230,
        "y": 2360,
        "wires": [
            [
                "e29a7fa41bf42350"
            ]
        ]
    },
    {
        "id": "27b170a8818e3aec",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "d": true,
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "audioprocessor",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 3260,
        "y": 2440,
        "wires": [
            [
                "aad4847050ee4885"
            ]
        ]
    },
    {
        "id": "38ca96cddb68837d",
        "type": "delay",
        "z": "92703c264104932a",
        "d": true,
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "2",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": true,
        "outputs": 1,
        "x": 3140,
        "y": 2040,
        "wires": [
            [
                "6e79b1b528269da0"
            ]
        ]
    },
    {
        "id": "4c7f4342e7da7d65",
        "type": "debug",
        "z": "92703c264104932a",
        "d": true,
        "name": "debug 231",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2910,
        "y": 2480,
        "wires": []
    },
    {
        "id": "798b1e99b7e4e5dd",
        "type": "function",
        "z": "92703c264104932a",
        "name": "set micmute",
        "func": "if (msg.payload.data.micmute) {\n    msg.micmute = \"on\"\n    return msg;\n}\nelse {\n    msg.micmute = \"off\"\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 1400,
        "wires": [
            [
                "b3f02a8599f74694",
                "6858029d82732845"
            ]
        ]
    },
    {
        "id": "799ca341be4ca599",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "Stereo",
        "func": "msg.output = 10\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 500,
        "wires": [
            [
                "ac7b5fcf1adbbf45",
                "b326f4fceb1ee370"
            ]
        ]
    },
    {
        "id": "ac7b5fcf1adbbf45",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "Stereo",
        "func": "msg.output = 11\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 540,
        "wires": [
            [
                "b326f4fceb1ee370",
                "3ed524ccf1287b5f"
            ]
        ]
    },
    {
        "id": "3ed524ccf1287b5f",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "Stereo",
        "func": "msg.output = 12\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 580,
        "wires": [
            [
                "b326f4fceb1ee370"
            ]
        ]
    },
    {
        "id": "2fd50cf5574f9928",
        "type": "switch",
        "z": "92703c264104932a",
        "d": true,
        "name": "output == 9",
        "property": "output",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "9",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 730,
        "y": 460,
        "wires": [
            [
                "799ca341be4ca599"
            ]
        ]
    },
    {
        "id": "d2934a6e4d86b75a",
        "type": "debug",
        "z": "92703c264104932a",
        "name": "debug 243",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 4800,
        "y": 1420,
        "wires": []
    },
    {
        "id": "919b56687eb838ed",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "Подзвучка",
        "func": "if (msg.input  == 19) {\n    msg.input = 1\n}\nif (msg.aec  == 18) {\n    msg.aec = 0\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 460,
        "wires": [
            [
                "15d48ee3e358dd92"
            ]
        ]
    },
    {
        "id": "6488f1a1bc4086b2",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "set input to output",
        "func": "// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Sound mixer = 166 (0x00A6)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0xA6\nmsg.module_type_low = 0x00\n\n// Тип параметра Mixing switch для модуля Sound mixer = 1\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x01\nmsg.parameter_type_low = 0x00\n\n// Старший байт value1 = номер входа - 1\n// Старший байт value1 = номер выхода - 1\nmsg.value1_high = msg.input - 1\nmsg.value1_low = msg.output - 1\n\n// value2 = 1 для назначения входа на выход\n// в формате двух байтов c обратным порядком\nmsg.value2_high = 0x01\n\nmsg.value2_low = 0x00\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3030,
        "y": 1480,
        "wires": [
            [
                "335fd9a6a89cd00d",
                "0976f14cb47aae9e"
            ]
        ]
    },
    {
        "id": "159b667ed8689fef",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "remove input from output",
        "func": "// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Sound mixer = 166 (0x00A6)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0xA6\nmsg.module_type_low = 0x00\n\n// Тип параметра Mixing switch для модуля Sound mixer = 1\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x01\nmsg.parameter_type_low = 0x00\n\n// Старший байт value1 = номер входа - 1\n// Старший байт value1 = номер выхода - 1\nmsg.value1_high = msg.input - 1\nmsg.value1_low = msg.output - 1\n\n// value2 = 0 для отмены назначения входа на выход\n// в формате двух байтов c обратным порядком\nmsg.value2_high = 0x00\n\nmsg.value2_low = 0x00\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3010,
        "y": 1520,
        "wires": [
            [
                "a2ec200e5d663521",
                "0976f14cb47aae9e"
            ]
        ]
    },
    {
        "id": "0bab846e751881b0",
        "type": "switch",
        "z": "92703c264104932a",
        "d": true,
        "name": "input == 3, 4, 5",
        "property": "input",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "3",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "4",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "5",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 2060,
        "y": 1560,
        "wires": [
            [
                "eab74148c8c91d13"
            ],
            [
                "e0568801dc24bfaf"
            ],
            [
                "56c8d9ee1c314b71"
            ],
            [
                "1070d0a2df0ce200"
            ]
        ]
    },
    {
        "id": "3b8089463e377258",
        "type": "switch",
        "z": "92703c264104932a",
        "d": true,
        "name": "switch msg.type",
        "property": "type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "set input power",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set output power",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set input to output",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "remove input from output",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set input gain",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set output gain",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set aec gain",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 7,
        "x": 2620,
        "y": 1540,
        "wires": [
            [
                "2a9e16e5a3265353"
            ],
            [],
            [],
            [],
            [
                "5e7f057ed3099a8c"
            ],
            [],
            []
        ]
    },
    {
        "id": "2a9e16e5a3265353",
        "type": "switch",
        "z": "92703c264104932a",
        "d": true,
        "name": "msg.power",
        "property": "power",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2790,
        "y": 1500,
        "wires": [
            [
                "6488f1a1bc4086b2"
            ],
            [
                "159b667ed8689fef"
            ]
        ]
    },
    {
        "id": "335fd9a6a89cd00d",
        "type": "debug",
        "z": "92703c264104932a",
        "d": true,
        "name": "debug 249",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 3250,
        "y": 1480,
        "wires": []
    },
    {
        "id": "a2ec200e5d663521",
        "type": "debug",
        "z": "92703c264104932a",
        "d": true,
        "name": "debug 250",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 3250,
        "y": 1520,
        "wires": []
    },
    {
        "id": "0976f14cb47aae9e",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "checksum",
        "func": "// Стартовый байт\nmsg.start_byte = 0xB3\n\nif (msg.start_byte > 255) {msg.start_byte = 255} \nif (msg.message_type > 255) {msg.message_type = 255} \nif (msg.module_type_high > 255) {msg.module_type_high = 255} \nif (msg.module_type_low > 255) {msg.module_type_low = 255} \nif (msg.parameter_type_high > 255) {msg.parameter_type_high = 255} \nif (msg.parameter_type_low > 255) {msg.parameter_type_low = 255} \nif (msg.value1_high > 255) {msg.value1_high = 255} \nif (msg.value1_low > 255) {msg.value1_low = 255} \nif (msg.value2_high > 255) {msg.value2_high = 255} \nif (msg.value2_low > 255) {msg.value2_low = 255} \n\n\nmsg.checksum = msg.start_byte + \n    msg.message_type + \n    msg.module_type_high +\n    msg.module_type_low +\n    msg.parameter_type_high +\n    msg.parameter_type_low +\n    msg.value1_high +\n    msg.value1_low +\n    msg.value2_high +\n    msg.value2_low\n\n// Контрольная сумма = младший байт числа, являющегося суммой всех остальных 11 байтов команды\nif (msg.checksum > 255) {\n    msg.checksum = msg.checksum % 256\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3280,
        "y": 1600,
        "wires": [
            [
                "71a6b538aec65d74"
            ]
        ]
    },
    {
        "id": "71a6b538aec65d74",
        "type": "buffer-maker",
        "z": "92703c264104932a",
        "d": true,
        "name": "",
        "specification": "spec",
        "specificationType": "ui",
        "items": [
            {
                "name": "item1",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "start_byte"
            },
            {
                "name": "item2",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "message_type"
            },
            {
                "name": "item3",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "checksum"
            },
            {
                "name": "item4",
                "type": "byte",
                "length": 1,
                "dataType": "num",
                "data": "0"
            },
            {
                "name": "item5",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "module_type_high"
            },
            {
                "name": "item6",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "module_type_low"
            },
            {
                "name": "item7",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "parameter_type_high"
            },
            {
                "name": "item8",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "parameter_type_low"
            },
            {
                "name": "item9",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "value1_high"
            },
            {
                "name": "item10",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "value1_low"
            },
            {
                "name": "item11",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "value2_high"
            },
            {
                "name": "item12",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "value2_low"
            }
        ],
        "swap1": "",
        "swap2": "",
        "swap3": "",
        "swap1Type": "swap",
        "swap2Type": "swap",
        "swap3Type": "swap",
        "msgProperty": "payload",
        "msgPropertyType": "str",
        "x": 3450,
        "y": 1600,
        "wires": [
            [
                "8657ed96f0657619"
            ]
        ]
    },
    {
        "id": "eab74148c8c91d13",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "2, 10",
        "func": "msg.input = 2\nmsg.output = 10\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2370,
        "y": 1300,
        "wires": [
            [
                "3b8089463e377258",
                "b64268f55d904b05"
            ]
        ]
    },
    {
        "id": "b64268f55d904b05",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "2, 11",
        "func": "msg.input = 2\nmsg.output = 11\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2370,
        "y": 1340,
        "wires": [
            [
                "3b8089463e377258",
                "acd19b91b21a5b9f"
            ]
        ]
    },
    {
        "id": "acd19b91b21a5b9f",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "3, 9",
        "func": "msg.input = 3\nmsg.output = 9\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2370,
        "y": 1380,
        "wires": [
            [
                "a25e5ed38116a49f",
                "3b8089463e377258"
            ]
        ]
    },
    {
        "id": "a25e5ed38116a49f",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "3, 12",
        "func": "msg.input = 3\nmsg.output = 12\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2370,
        "y": 1420,
        "wires": [
            [
                "3b8089463e377258"
            ]
        ]
    },
    {
        "id": "e0568801dc24bfaf",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "5, 10",
        "func": "msg.input = 5\nmsg.output = 10\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2370,
        "y": 1480,
        "wires": [
            [
                "b00ad01e3948d7bd",
                "3b8089463e377258"
            ]
        ]
    },
    {
        "id": "b00ad01e3948d7bd",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "5, 11",
        "func": "msg.input = 5\nmsg.output = 11\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2370,
        "y": 1520,
        "wires": [
            [
                "77fb95ad32c73d0b",
                "3b8089463e377258"
            ]
        ]
    },
    {
        "id": "77fb95ad32c73d0b",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "6, 9",
        "func": "msg.input = 6\nmsg.output = 9\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2370,
        "y": 1560,
        "wires": [
            [
                "f03421f1eeca7c4c",
                "3b8089463e377258"
            ]
        ]
    },
    {
        "id": "f03421f1eeca7c4c",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "6, 12",
        "func": "msg.input = 6\nmsg.output = 12\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2370,
        "y": 1600,
        "wires": [
            [
                "3b8089463e377258"
            ]
        ]
    },
    {
        "id": "5e7f057ed3099a8c",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "usb in gain",
        "func": "var messages = []\n\nmsg.value1_high = msg.input - 1\nmsg.value1_low = msg.output - 1\n\nif (msg.input_gain >= 0) {\n    var value2_raw = msg.input_gain * 100\n} else {\n    var value2_raw = 65535 + (msg.input_gain * 100)\n}\nmsg.value2_high = value2_raw % 256\nmsg.value2_low = value2_raw / 256\n\nmessages.push({\n    \"message_type\": 0x21,\n    \"module_type_high\": 0xA6,\n    \"module_type_low\": 0x00,\n    \"parameter_type_high\": 0x02,\n    \"parameter_type_low\": 0x00,\n    \"value1_high\": msg.value1_high,\n    \"value1_low\": msg.value1_low,\n    \"value2_high\": msg.value2_high,\n    \"value2_low\": msg.value2_low\n})\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2990,
        "y": 1580,
        "wires": [
            [
                "0976f14cb47aae9e"
            ]
        ]
    },
    {
        "id": "56c8d9ee1c314b71",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "7, 10",
        "func": "msg.input = 7\nmsg.output = 10\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2370,
        "y": 1660,
        "wires": [
            [
                "1502858950ec3cbc",
                "3b8089463e377258"
            ]
        ]
    },
    {
        "id": "1502858950ec3cbc",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "7, 11",
        "func": "msg.input = 7\nmsg.output = 11\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2370,
        "y": 1700,
        "wires": [
            [
                "7e3ee5f76c932bc5",
                "3b8089463e377258"
            ]
        ]
    },
    {
        "id": "7e3ee5f76c932bc5",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "8, 9",
        "func": "msg.input = 8\nmsg.output = 9\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2370,
        "y": 1740,
        "wires": [
            [
                "38297a69a9965a78",
                "3b8089463e377258"
            ]
        ]
    },
    {
        "id": "38297a69a9965a78",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "8, 12",
        "func": "msg.input = 8\nmsg.output = 12\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2370,
        "y": 1780,
        "wires": [
            [
                "3b8089463e377258"
            ]
        ]
    },
    {
        "id": "dedfd3c0f59c3288",
        "type": "switch",
        "z": "92703c264104932a",
        "d": true,
        "name": "input == 2",
        "property": "input",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 720,
        "y": 340,
        "wires": [
            [
                "410ca1db01a2ec7f"
            ]
        ]
    },
    {
        "id": "410ca1db01a2ec7f",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "Stereo",
        "func": "msg.input = 3\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 300,
        "wires": [
            [
                "b326f4fceb1ee370"
            ]
        ]
    },
    {
        "id": "80fa5f24bd23986d",
        "type": "switch",
        "z": "92703c264104932a",
        "d": true,
        "name": "input == 5",
        "property": "input",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "5",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 720,
        "y": 240,
        "wires": [
            [
                "def515793e92e555"
            ]
        ]
    },
    {
        "id": "def515793e92e555",
        "type": "function",
        "z": "92703c264104932a",
        "d": true,
        "name": "Stereo",
        "func": "msg.input = 6\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 200,
        "wires": [
            [
                "b326f4fceb1ee370"
            ]
        ]
    },
    {
        "id": "6858029d82732845",
        "type": "debug",
        "z": "92703c264104932a",
        "name": "debug 253",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1460,
        "y": 1340,
        "wires": []
    },
    {
        "id": "ee4051332bee3023",
        "type": "delay",
        "z": "92703c264104932a",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "5",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2160,
        "y": 540,
        "wires": [
            [
                "a7ed38a3e6e05edb"
            ]
        ]
    },
    {
        "id": "d285e24ec186eff0",
        "type": "debug",
        "z": "92703c264104932a",
        "name": "debug 256",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1310,
        "y": 1160,
        "wires": []
    },
    {
        "id": "6beb8724801bca66",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "name": "stage",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.custom_scenes",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "custom_scenes",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 530,
        "y": 1440,
        "wires": [
            [
                "cce3bde5b435898c"
            ]
        ]
    },
    {
        "id": "b427d7b5920c8ae9",
        "type": "switch",
        "z": "92703c264104932a",
        "name": "stagescene",
        "property": "custom_scenes.attributes.stagescene",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 630,
        "y": 1520,
        "wires": [
            [
                "c553db3ba191c6c0"
            ],
            [
                "fb3285efaf0e51cb"
            ]
        ]
    },
    {
        "id": "cce3bde5b435898c",
        "type": "api-current-state",
        "z": "92703c264104932a",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.custom_buttons",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 560,
        "y": 1480,
        "wires": [
            [
                "b427d7b5920c8ae9"
            ]
        ]
    },
    {
        "id": "fb3285efaf0e51cb",
        "type": "function",
        "z": "92703c264104932a",
        "name": "state",
        "func": "msg.state = Number(msg.state)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 1540,
        "wires": [
            [
                "3c102904e5ad7a69"
            ]
        ]
    },
    {
        "id": "88c672ecc68ef1ab",
        "type": "debug",
        "z": "92703c264104932a",
        "name": "debug 258",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 1160,
        "wires": []
    },
    {
        "id": "20449f24990ecf98",
        "type": "debug",
        "z": "92703c264104932a",
        "name": "debug 259",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 370,
        "y": 360,
        "wires": []
    },
    {
        "id": "47b897f1beb2e2ad",
        "type": "function",
        "z": "92703c264104932a",
        "name": "aec to ans",
        "func": "if (msg.input == 11) {\n    msg.input = 12\n}\nif (msg.aec == 10) {\n    msg.aec = 11\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 440,
        "wires": [
            [
                "b326f4fceb1ee370"
            ]
        ]
    },
    {
        "id": "1158ef140e2709d0",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "+ old_status, new_status, standby",
        "func": "msg.prev_status = msg.device_statuses.attributes.audioprocessor\n\nmsg.new_status = msg.payload\n\nmsg.standby = msg.standby.attributes.standby\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 2140,
        "wires": [
            [
                "af43a462c57ead7b"
            ]
        ]
    },
    {
        "id": "586f80d33bb8cb12",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 820,
        "y": 2020,
        "wires": [
            [
                "49f7f08df22ca509"
            ]
        ]
    },
    {
        "id": "7622317968ca161c",
        "type": "api-call-service",
        "z": "455bfc6c2c30aeae",
        "name": "device_statuses.audioprocessor = 0",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"audioprocessor\":0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1970,
        "y": 2140,
        "wires": [
            []
        ]
    },
    {
        "id": "de2d11183d5ff4c3",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 800,
        "y": 2100,
        "wires": [
            [
                "1158ef140e2709d0"
            ]
        ]
    },
    {
        "id": "dfa106dff5f6cb7d",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "payload",
        "func": "msg.payload = global.get(\"audioprocessor_ip\")\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 2020,
        "wires": [
            [
                "7af687b528e42d1c"
            ]
        ]
    },
    {
        "id": "8575d51ea3772724",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 150,
        "y": 2020,
        "wires": [
            [
                "dfa106dff5f6cb7d"
            ]
        ]
    },
    {
        "id": "0189c659ecd1af66",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "switch msg.standby",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turning on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turning off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1150,
        "y": 2220,
        "wires": [
            [
                "2e1ad9fc41d04cca"
            ],
            [
                "b46b8e6742b271fa"
            ],
            [
                "b46b8e6742b271fa"
            ],
            [
                "1bc29dfd86aab680"
            ]
        ]
    },
    {
        "id": "f1d03a4805990d14",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "1. on",
        "info": "",
        "x": 1130,
        "y": 2280,
        "wires": []
    },
    {
        "id": "e38e0c2d0c6731da",
        "type": "api-call-service",
        "z": "455bfc6c2c30aeae",
        "name": "device_statuses.audioprocessor = 1",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"audioprocessor\":1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1970,
        "y": 2220,
        "wires": [
            []
        ]
    },
    {
        "id": "ef8ed995b4489292",
        "type": "api-call-service",
        "z": "455bfc6c2c30aeae",
        "name": "device_statuses.audioprocessor = 2",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"audioprocessor\":2}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1970,
        "y": 2300,
        "wires": [
            []
        ]
    },
    {
        "id": "ae9739a502c7cbc2",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "2. turning on",
        "info": "",
        "x": 1150,
        "y": 2320,
        "wires": []
    },
    {
        "id": "eefad3c6222163cd",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "3. turning off",
        "info": "",
        "x": 1150,
        "y": 2360,
        "wires": []
    },
    {
        "id": "42ce4426467bdc5e",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "4. off",
        "info": "",
        "x": 1130,
        "y": 2400,
        "wires": []
    },
    {
        "id": "f40ee1b5d82a87ff",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "switch msg.type",
        "property": "type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "set input power",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set output power",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set input to output",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "remove input from output",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set input gain",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set output gain",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set aec gain",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 7,
        "x": 1060,
        "y": 400,
        "wires": [
            [
                "c090747b17a21abd"
            ],
            [
                "c097144d321174bc"
            ],
            [
                "389af713af38c28d"
            ],
            [
                "9b670782629105d5"
            ],
            [
                "f4687e7243774dba"
            ],
            [
                "904cc2dc3f022c03"
            ],
            [
                "4d0e8d4d55ee400f"
            ]
        ]
    },
    {
        "id": "81b9bdac9ca3c6de",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "2. Вкл/выкл выхода",
        "info": "",
        "x": 1070,
        "y": 120,
        "wires": []
    },
    {
        "id": "bb6afaab63477ca6",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "1. Вкл/выкл входа",
        "info": "",
        "x": 1070,
        "y": 80,
        "wires": []
    },
    {
        "id": "a31ad0164ee8dabf",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "3. Включить вход на выход",
        "info": "",
        "x": 1100,
        "y": 160,
        "wires": []
    },
    {
        "id": "c38180d844db9714",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "4. Отключить вход от выхода",
        "info": "",
        "x": 1100,
        "y": 200,
        "wires": []
    },
    {
        "id": "86ae346dbe89939d",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "5. Изменение gain входа",
        "info": "",
        "x": 1090,
        "y": 240,
        "wires": []
    },
    {
        "id": "4b818fadd1c10401",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "6. Изменение gain выхода",
        "info": "",
        "x": 1090,
        "y": 280,
        "wires": []
    },
    {
        "id": "35463285ede61798",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "set input power",
        "func": "// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Input = 299 (0x012B)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0x2B\nmsg.module_type_low = 0x01\n\n// Тип параметра Mute для модуля Input = 2\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x02\nmsg.parameter_type_low = 0x00\n\n// value1 = (номер входа - 1)\n// в формате двух байтов c обратным порядком\nmsg.value1_high = msg.input - 1\nmsg.value1_low = 0x00\n\n// value2 = 1 для отключения входа\n// value2 = 0 для включения входа\n// в формате двух байтов c обратным порядком\nif (msg.power == 0) {\n    msg.value2_high = 0x01\n} else {\n    msg.value2_high = 0x00\n}\nmsg.value2_low = 0x00\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1520,
        "y": 100,
        "wires": [
            [
                "73c446ccd9abed0b"
            ]
        ]
    },
    {
        "id": "73c446ccd9abed0b",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "checksum",
        "func": "// Стартовый байт\nmsg.start_byte = 0xB3\n\nmsg.checksum = msg.start_byte + \n    msg.message_type + \n    msg.module_type_high +\n    msg.module_type_low +\n    msg.parameter_type_high +\n    msg.parameter_type_low +\n    msg.value1_high +\n    msg.value1_low +\n    msg.value2_high +\n    msg.value2_low\n\n// Контрольная сумма = младший байт числа, являющегося суммой всех остальных 11 байтов команды\nif (msg.checksum > 255) {\n    msg.checksum = msg.checksum % 256\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1720,
        "y": 480,
        "wires": [
            [
                "94c6560fd3b76958"
            ]
        ]
    },
    {
        "id": "582bc3e43662af5a",
        "type": "udp out",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "addr": "",
        "iface": "",
        "port": "",
        "ipv": "udp4",
        "outport": "50001",
        "base64": false,
        "multicast": "false",
        "x": 2310,
        "y": 540,
        "wires": []
    },
    {
        "id": "b415f2a2d8d9db28",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "+ audioprocessor_ip, audioprocessor_port",
        "func": "msg.ip = global.get(\"audioprocessor_ip\")\nmsg.port = global.get(\"audioprocessor_port\")\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1840,
        "y": 540,
        "wires": [
            [
                "629e57bcd494539c"
            ]
        ]
    },
    {
        "id": "94c6560fd3b76958",
        "type": "buffer-maker",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "specification": "spec",
        "specificationType": "ui",
        "items": [
            {
                "name": "item1",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "start_byte"
            },
            {
                "name": "item2",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "message_type"
            },
            {
                "name": "item3",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "checksum"
            },
            {
                "name": "item4",
                "type": "byte",
                "length": 1,
                "dataType": "num",
                "data": "0"
            },
            {
                "name": "item5",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "module_type_high"
            },
            {
                "name": "item6",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "module_type_low"
            },
            {
                "name": "item7",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "parameter_type_high"
            },
            {
                "name": "item8",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "parameter_type_low"
            },
            {
                "name": "item9",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "value1_high"
            },
            {
                "name": "item10",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "value1_low"
            },
            {
                "name": "item11",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "value2_high"
            },
            {
                "name": "item12",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "value2_low"
            }
        ],
        "swap1": "",
        "swap2": "",
        "swap3": "",
        "swap1Type": "swap",
        "swap2Type": "swap",
        "swap3Type": "swap",
        "msgProperty": "payload",
        "msgPropertyType": "str",
        "x": 1890,
        "y": 480,
        "wires": [
            [
                "b415f2a2d8d9db28"
            ]
        ]
    },
    {
        "id": "90013be72d5922df",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "set output power",
        "func": "// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Output = 295 (0x0127)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0x27\nmsg.module_type_low = 0x01\n\n// Тип параметра Mute для модуля Output = 2\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x02\nmsg.parameter_type_low = 0x00\n\n// value1 = (номер выхода - 1)\n// в формате двух байтов c обратным порядком\nmsg.value1_high = msg.output - 1\nmsg.value1_low = 0x00\n\n// value2 = 1 для отключения выхода\n// value2 = 0 для включения выхода\n// в формате двух байтов c обратным порядком\nif (msg.power == 0) {\n    msg.value2_high = 0x01\n} else {\n    msg.value2_high = 0x00\n}\nmsg.value2_low = 0x00\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1510,
        "y": 200,
        "wires": [
            [
                "73c446ccd9abed0b"
            ]
        ]
    },
    {
        "id": "389af713af38c28d",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "set input to output",
        "func": "// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Sound mixer = 166 (0x00A6)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0xA6\nmsg.module_type_low = 0x00\n\n// Тип параметра Mixing switch для модуля Sound mixer = 1\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x01\nmsg.parameter_type_low = 0x00\n\n// Старший байт value1 = номер входа - 1\n// Старший байт value1 = номер выхода - 1\nmsg.value1_high = msg.input - 1\nmsg.value1_low = msg.output - 1\n\n// value2 = 1 для назначения входа на выход\n// в формате двух байтов c обратным порядком\nmsg.value2_high = 0x01\n\nmsg.value2_low = 0x00\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1510,
        "y": 260,
        "wires": [
            [
                "73c446ccd9abed0b"
            ]
        ]
    },
    {
        "id": "9b670782629105d5",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "remove input from output",
        "func": "// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Sound mixer = 166 (0x00A6)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0xA6\nmsg.module_type_low = 0x00\n\n// Тип параметра Mixing switch для модуля Sound mixer = 1\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x01\nmsg.parameter_type_low = 0x00\n\n// Старший байт value1 = номер входа - 1\n// Старший байт value1 = номер выхода - 1\nmsg.value1_high = msg.input - 1\nmsg.value1_low = msg.output - 1\n\n// value2 = 0 для отмены назначения входа на выход\n// в формате двух байтов c обратным порядком\nmsg.value2_high = 0x00\n\nmsg.value2_low = 0x00\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1490,
        "y": 300,
        "wires": [
            [
                "73c446ccd9abed0b"
            ]
        ]
    },
    {
        "id": "2b3b1c9579711c7f",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "switch msg.standby",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "turningoff",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turningon",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 790,
        "y": 1740,
        "wires": [
            [
                "6602c18ffd7e5f6d"
            ],
            [
                "30585a5642d48cfe"
            ]
        ]
    },
    {
        "id": "be8d249942547196",
        "type": "server-state-changed",
        "z": "455bfc6c2c30aeae",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.standby",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 130,
        "y": 1740,
        "wires": [
            [
                "a91b2aeddbd339ea"
            ]
        ]
    },
    {
        "id": "30585a5642d48cfe",
        "type": "api-call-service",
        "z": "455bfc6c2c30aeae",
        "name": "audioprocessor OFF",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.audioprocessor\",\"state\":\"{{state}}\",\"isEnabledOut1\":0,\"isEnabledOut2\":0,\"isEnabledOut3\":0,\"isEnabledOut4\":0,\"isEnabledOut5\":0,\"isEnabledOut6\":0,\"isEnabledOut7\":0,\"isEnabledOut8\":0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1020,
        "y": 1760,
        "wires": [
            []
        ]
    },
    {
        "id": "6602c18ffd7e5f6d",
        "type": "api-call-service",
        "z": "455bfc6c2c30aeae",
        "name": "audioprocessor ON",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.audioprocessor\",\"state\":\"{{state}}\",\"isEnabledOut1\":1,\"isEnabledOut2\":1,\"isEnabledOut3\":1,\"isEnabledOut4\":1,\"isEnabledOut5\":1,\"isEnabledOut6\":1,\"isEnabledOut7\":1,\"isEnabledOut8\":1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1010,
        "y": 1720,
        "wires": [
            []
        ]
    },
    {
        "id": "a91b2aeddbd339ea",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "standby",
        "func": "msg.standby = msg.standby.new_state.attributes.standby\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 1740,
        "wires": [
            [
                "86b2170cfb5c7e13"
            ]
        ]
    },
    {
        "id": "9dfae3f18d47447b",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "2. turning on",
        "info": "",
        "x": 770,
        "y": 1700,
        "wires": []
    },
    {
        "id": "e2ff60fe80f43ab4",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "1. turning off",
        "info": "",
        "x": 770,
        "y": 1660,
        "wires": []
    },
    {
        "id": "7aeb93821659f9c7",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "event parsing",
        "func": "var old_micmute = msg.data.old_state.attributes.micmute\nvar new_micmute = msg.data.new_state.attributes.micmute\n\nvar old_audiomute = msg.data.old_state.attributes.audiomute\nvar new_audiomute = msg.data.new_state.attributes.audiomute\n\n\n// Отключение всех входов аудиоматрицы\nif (new_micmute == true && old_micmute == false) {\n    msg.micmute = \"on\"\n    // Включение всех входов аудиоматрицы\n} else if (new_micmute == false && old_micmute == true) {\n    msg.micmute = \"off\"\n}\n\n// Отключение всех выходов аудиоматрицы\nif (new_audiomute == true && old_audiomute == false) {\n    msg.audiomute = \"on\"\n    // Включение всех выходов аудиоматрицы\n} else if (new_audiomute == false && old_audiomute == true) {\n    msg.audiomute = \"off\"\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 1260,
        "wires": [
            [
                "0605358ac89c65e2"
            ]
        ]
    },
    {
        "id": "078a64707ea2510b",
        "type": "api-call-service",
        "z": "455bfc6c2c30aeae",
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1380,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "59e8a59e40ab65cc",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "Обработка нажатий кнопок audiomute и micmute",
        "info": "",
        "x": 270,
        "y": 1220,
        "wires": []
    },
    {
        "id": "921065639bb10406",
        "type": "server-state-changed",
        "z": "455bfc6c2c30aeae",
        "name": "custom_buttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.custom_buttons",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 160,
        "y": 1260,
        "wires": [
            [
                "7aeb93821659f9c7"
            ]
        ]
    },
    {
        "id": "912a68c6edf0c3a2",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "Отслеживание состояния кнопок audiomute и micmute",
        "info": "",
        "x": 290,
        "y": 1440,
        "wires": []
    },
    {
        "id": "c2526cf11d17c92c",
        "type": "api-call-service",
        "z": "455bfc6c2c30aeae",
        "name": "custom_buttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1240,
        "y": 1500,
        "wires": [
            []
        ]
    },
    {
        "id": "0605358ac89c65e2",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "+ inputs_for_mute",
        "func": "msg.inputs_for_mute = flow.get(\"trackable_inputs\")\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 1260,
        "wires": [
            [
                "d353e635d3754dfc"
            ]
        ]
    },
    {
        "id": "d353e635d3754dfc",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "+ outputs_for_mute",
        "func": "msg.outputs_for_mute = flow.get(\"trackable_outputs\")\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 1300,
        "wires": [
            [
                "9acfa20595297dab"
            ]
        ]
    },
    {
        "id": "5db3db4780a05755",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 150,
        "y": 1160,
        "wires": [
            [
                "9ac68ccd2e9751a1"
            ]
        ]
    },
    {
        "id": "cc98026f1c21a2a1",
        "type": "udp in",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "",
        "iface": "",
        "port": "50001",
        "ipv": "udp4",
        "multicast": "false",
        "group": "",
        "datatype": "buffer",
        "x": 80,
        "y": 3340,
        "wires": [
            [
                "ca1d2b929f47fbb0",
                "8f0ae2c87f72b9df"
            ]
        ]
    },
    {
        "id": "4d4c41d98ec4b409",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "get volume level",
        "func": "// Массив выходных сообщений\nvar messages = []\n\n\nfor (let i = 0; i < msg.inputs.length; i++) {\n    messages.push({\n        message_type: 0x22,\n        module_type_high: 0x2B,\n        module_type_low: 0x01,\n        parameter_type_high: 0x0c,\n        parameter_type_low: 0x00,\n        value1_low: 0x00,\n        value1_high: msg.inputs[i] - 1,\n        value2_high: 0x00,\n        value2_low: 0x00\n        })\n}\n\nfor (let i = 0; i < msg.outputs.length; i++) {\n    messages.push({\n        message_type: 0x22,\n        module_type_high: 0x27,\n        module_type_low: 0x01,\n        parameter_type_high: 0x08,\n        parameter_type_low: 0x00,\n        value1_low: 0x00,\n        value1_high: msg.outputs[i] - 1,\n        value2_high: 0x00,\n        value2_low: 0x00\n    })\n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1400,
        "y": 2960,
        "wires": [
            [
                "73c446ccd9abed0b",
                "c2e23d017ee3fa22"
            ]
        ]
    },
    {
        "id": "9d61750b78f6ab56",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "+ msg.type",
        "func": "if (msg.payload[4] == 0x2b &&\n    msg.payload[5] == 0x01 &&\n    msg.payload[6] == 0x0c &&\n    msg.payload[7] == 0x00) {\n        msg.type = \"input level\"\n        return msg\n} else if (msg.payload[4] == 0x27 &&\n           msg.payload[5] == 0x01 &&\n           msg.payload[6] == 0x08 &&\n           msg.payload[7] == 0x00) {\n                msg.type = \"output level\"\n        return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 3140,
        "wires": [
            [
                "2b2bbbf12faf48bf"
            ]
        ]
    },
    {
        "id": "75a688652e79edaf",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "switch msg.type",
        "property": "type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "input level",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "output level",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 820,
        "y": 3140,
        "wires": [
            [
                "df4520f9b6a262f1"
            ],
            [
                "a05c7e8bdad5d2c5"
            ]
        ]
    },
    {
        "id": "df4520f9b6a262f1",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "+ input_level",
        "func": "msg.input = msg.payload[8] + 1\n\nmsg.input_level = msg.payload[10] + msg.payload[11] * 256\n\nif (msg.input_level < 53536) {\n    msg.input_level = 53536\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 3120,
        "wires": [
            [
                "aa2e2d1e619e45a4"
            ]
        ]
    },
    {
        "id": "a05c7e8bdad5d2c5",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "+ output_level",
        "func": "msg.output = msg.payload[8] + 1\n\nmsg.output_level = msg.payload[10] + msg.payload[11] * 256\n\nif (msg.output_level < 53536) {\n    msg.output_level = 53536\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 3160,
        "wires": [
            [
                "917be49b5486cd2f",
                "1319888d7a313f4c"
            ]
        ]
    },
    {
        "id": "d4d077696c270988",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "+ type, state",
        "func": "var old_isEnabledIn = [\n    msg.data.old_state.attributes.isEnabledIn1,\n    msg.data.old_state.attributes.isEnabledIn2,\n    msg.data.old_state.attributes.isEnabledIn3,\n    msg.data.old_state.attributes.isEnabledIn4,\n    msg.data.old_state.attributes.isEnabledIn5,\n    msg.data.old_state.attributes.isEnabledIn6,\n    msg.data.old_state.attributes.isEnabledIn7,\n    msg.data.old_state.attributes.isEnabledIn8,\n]\n\nvar new_isEnabledIn = [\n    msg.data.new_state.attributes.isEnabledIn1,\n    msg.data.new_state.attributes.isEnabledIn2,\n    msg.data.new_state.attributes.isEnabledIn3,\n    msg.data.new_state.attributes.isEnabledIn4,\n    msg.data.new_state.attributes.isEnabledIn5,\n    msg.data.new_state.attributes.isEnabledIn6,\n    msg.data.new_state.attributes.isEnabledIn7,\n    msg.data.new_state.attributes.isEnabledIn8,\n]\n\nvar old_isEnabledOut = [\n    msg.data.old_state.attributes.isEnabledOut1,\n    msg.data.old_state.attributes.isEnabledOut2,\n    msg.data.old_state.attributes.isEnabledOut3,\n    msg.data.old_state.attributes.isEnabledOut4,\n    msg.data.old_state.attributes.isEnabledOut5,\n    msg.data.old_state.attributes.isEnabledOut6,\n    msg.data.old_state.attributes.isEnabledOut7,\n    msg.data.old_state.attributes.isEnabledOut8,\n]\n\nvar new_isEnabledOut = [\n    msg.data.new_state.attributes.isEnabledOut1,\n    msg.data.new_state.attributes.isEnabledOut2,\n    msg.data.new_state.attributes.isEnabledOut3,\n    msg.data.new_state.attributes.isEnabledOut4,\n    msg.data.new_state.attributes.isEnabledOut5,\n    msg.data.new_state.attributes.isEnabledOut6,\n    msg.data.new_state.attributes.isEnabledOut7,\n    msg.data.new_state.attributes.isEnabledOut8,\n]\n\n// Массив выходных сообщений\nvar messages = []\n\nfor (let i = 0; i < 8; i++) {\n    if (old_isEnabledIn[i] != new_isEnabledIn[i]) {\n        msg.type = \"micmute\"\n    }\n}\n\nif (msg.type == 'micmute')\n{\n    messages.push({\n        type: 'micmute',\n        data: msg.data\n        })\n}\n\nfor (let i = 0; i < 8; i++) {\n    if (old_isEnabledOut[i] != new_isEnabledOut[i]) {\n        msg.type = \"audiomute\"\n    }\n} \n\nif (msg.type == 'audiomute') {\n    messages.push({\n        type: 'audiomute',\n        data: msg.data\n    })\n}\n\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 1500,
        "wires": [
            [
                "a4f739ac344d5832"
            ]
        ]
    },
    {
        "id": "35a9c8d97c85246b",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "switch msg.type",
        "property": "type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "micmute",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "audiomute",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 860,
        "y": 1500,
        "wires": [
            [
                "ef4a60d24dff6e37"
            ],
            [
                "affd5d2c18efd2fe"
            ]
        ]
    },
    {
        "id": "bed8b7f3e9c26c31",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "2. audiomute",
        "info": "",
        "x": 850,
        "y": 1580,
        "wires": []
    },
    {
        "id": "c69ca5d6bde1717b",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "1. micmute",
        "info": "",
        "x": 840,
        "y": 1540,
        "wires": []
    },
    {
        "id": "ef4a60d24dff6e37",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "micmute",
        "func": "var new_isEnabledIn = [\n    msg.data.new_state.attributes.isEnabledIn1,\n    msg.data.new_state.attributes.isEnabledIn2,\n    msg.data.new_state.attributes.isEnabledIn3,\n    msg.data.new_state.attributes.isEnabledIn4,\n    msg.data.new_state.attributes.isEnabledIn5,\n    msg.data.new_state.attributes.isEnabledIn6,\n    msg.data.new_state.attributes.isEnabledIn7,\n    msg.data.new_state.attributes.isEnabledIn8,\n]\n\nmsg.payload = {}\nmsg.payload[\"domain\"] = \"python_script\"\nmsg.payload[\"service\"] = \"set_state\"\nmsg.payload[\"data\"] = {}\nmsg.payload[\"data\"][\"entity_id\"] = \"sensor.custom_buttons\"\n// msg.payload[\"data\"][\"state\"] = msg.state\n\nvar inputs_for_mute = flow.get(\"trackable_inputs\")\nvar sum = 0\n\nfor (let i = 0; i < inputs_for_mute.length; i++) {\n    sum = sum + Number(new_isEnabledIn[inputs_for_mute[i] - 1])\n}\n\n// Определение состояния кнопки micmute\nif (sum == 0) {\n    msg.payload[\"data\"][\"micmute\"] = true\n} else {\n    msg.payload[\"data\"][\"micmute\"] = false\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 1480,
        "wires": [
            [
                "c2526cf11d17c92c",
                "eecd0fa43ee2b601"
            ]
        ]
    },
    {
        "id": "affd5d2c18efd2fe",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "audiomute",
        "func": "var old_isEnabledOut = [\n    msg.data.old_state.attributes.isEnabledOut1,\n    msg.data.old_state.attributes.isEnabledOut2,\n    msg.data.old_state.attributes.isEnabledOut3,\n    msg.data.old_state.attributes.isEnabledOut4,\n    msg.data.old_state.attributes.isEnabledOut5,\n    msg.data.old_state.attributes.isEnabledOut6,\n    msg.data.old_state.attributes.isEnabledOut7,\n    msg.data.old_state.attributes.isEnabledOut8,\n]\n\nvar new_isEnabledOut = [\n    msg.data.new_state.attributes.isEnabledOut1,\n    msg.data.new_state.attributes.isEnabledOut2,\n    msg.data.new_state.attributes.isEnabledOut3,\n    msg.data.new_state.attributes.isEnabledOut4,\n    msg.data.new_state.attributes.isEnabledOut5,\n    msg.data.new_state.attributes.isEnabledOut6,\n    msg.data.new_state.attributes.isEnabledOut7,\n    msg.data.new_state.attributes.isEnabledOut8,\n]\n\nmsg.payload = {}\nmsg.payload[\"domain\"] = \"python_script\"\nmsg.payload[\"service\"] = \"set_state\"\nmsg.payload[\"data\"] = {}\nmsg.payload[\"data\"][\"entity_id\"] = \"sensor.custom_buttons\"\n// msg.payload[\"data\"][\"state\"] = msg.state\n\nvar outputs_for_mute = flow.get(\"trackable_outputs\")\nvar sum = 0\n\nfor (let i = 0; i < outputs_for_mute.length; i++) {\n    sum = sum + Number(new_isEnabledOut[outputs_for_mute[i] - 1])\n}\n\n// Определение состояния кнопки audiomute\nif (sum == 0) {\n    msg.payload[\"data\"][\"audiomute\"] = true\n\n} else {\n    msg.payload[\"data\"][\"audiomute\"] = false\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 1520,
        "wires": [
            [
                "c2526cf11d17c92c"
            ]
        ]
    },
    {
        "id": "11a51041b985cd75",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "payload for audioprocessor",
        "func": "// var state = new Date()\n// state = state.getTime()\n// state = msg.data.new_state.state\n\nmsg.payload = {}\nmsg.payload[\"domain\"] = \"python_script\"\nmsg.payload[\"service\"] = \"set_state\"\nmsg.payload[\"data\"] = {}\nmsg.payload[\"data\"][\"entity_id\"] = \"sensor.audioprocessor\"\nmsg.payload[\"data\"][\"state\"] = msg.state\n\nif (msg.audiomute == \"on\") {\n    for (let i = 0; i < msg.outputs_for_mute.length; i++) {\n        msg.payload[\"data\"][\"isEnabledOut\" + msg.outputs_for_mute[i]] = 0\n    }\n} else if (msg.audiomute == \"off\") {\n    for (let i = 0; i < msg.outputs_for_mute.length; i++) {\n        msg.payload[\"data\"][\"isEnabledOut\" + msg.outputs_for_mute[i]] = 1\n    }\n}\n\nif (msg.micmute == \"on\") {\n    for (let i = 0; i < msg.inputs_for_mute.length; i++) {\n        msg.payload[\"data\"][\"isEnabledIn\" + msg.inputs_for_mute[i]] = 0\n    }\n} else if (msg.micmute == \"off\") {\n    for (let i = 0; i < msg.inputs_for_mute.length; i++) {\n        msg.payload[\"data\"][\"isEnabledIn\" + msg.inputs_for_mute[i]] = 1\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 1300,
        "wires": [
            [
                "078a64707ea2510b"
            ]
        ]
    },
    {
        "id": "af43a462c57ead7b",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "new_status == false",
        "property": "new_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "false",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 920,
        "y": 2180,
        "wires": [
            [
                "2e1ad9fc41d04cca"
            ],
            [
                "0189c659ecd1af66"
            ]
        ]
    },
    {
        "id": "4a11eadaa332722c",
        "type": "server-state-changed",
        "z": "455bfc6c2c30aeae",
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.audioprocessor",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 120,
        "y": 400,
        "wires": [
            [
                "dc53f5b7f403f225"
            ]
        ]
    },
    {
        "id": "dc53f5b7f403f225",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "event parsing",
        "func": "// Предыдущее состояние входов\nvar old_isEnabledIn = [\n    msg.data.old_state.attributes.isEnabledIn1,\n    msg.data.old_state.attributes.isEnabledIn2,\n    msg.data.old_state.attributes.isEnabledIn3,\n    msg.data.old_state.attributes.isEnabledIn4,\n    msg.data.old_state.attributes.isEnabledIn5,\n    msg.data.old_state.attributes.isEnabledIn6,\n    // msg.data.old_state.attributes.isEnabledIn7,\n    // msg.data.old_state.attributes.isEnabledIn8,\n]\n\n// Новое состояние входов\nvar new_isEnabledIn = [\n    msg.data.new_state.attributes.isEnabledIn1,\n    msg.data.new_state.attributes.isEnabledIn2,\n    msg.data.new_state.attributes.isEnabledIn3,\n    msg.data.new_state.attributes.isEnabledIn4,\n    msg.data.new_state.attributes.isEnabledIn5,\n    msg.data.new_state.attributes.isEnabledIn6,\n    // msg.data.new_state.attributes.isEnabledIn7,\n    // msg.data.new_state.attributes.isEnabledIn8,\n]\n\n// Предыдущее состояние выходов\nvar old_isEnabledOut = [\n    msg.data.old_state.attributes.isEnabledOut1,\n    msg.data.old_state.attributes.isEnabledOut2,\n    msg.data.old_state.attributes.isEnabledOut3,\n    // msg.data.old_state.attributes.isEnabledOut4,\n    // msg.data.old_state.attributes.isEnabledOut5,\n    // msg.data.old_state.attributes.isEnabledOut6,\n    // msg.data.old_state.attributes.isEnabledOut7,\n    // msg.data.old_state.attributes.isEnabledOut8,\n]\n\n// Новое состояние выходов\nvar new_isEnabledOut = [\n    msg.data.new_state.attributes.isEnabledOut1,\n    msg.data.new_state.attributes.isEnabledOut2,\n    msg.data.new_state.attributes.isEnabledOut3,\n    // msg.data.new_state.attributes.isEnabledOut4,\n    // msg.data.new_state.attributes.isEnabledOut5,\n    // msg.data.new_state.attributes.isEnabledOut6,\n    // msg.data.new_state.attributes.isEnabledOut7,\n    // msg.data.new_state.attributes.isEnabledOut8,\n]\n\n// Предыдущее состояние AEC\nvar old_isEnabledAec = msg.data.old_state.attributes.isEnabledAec\n\n// Новое состояние AEC\nvar new_isEnabledAec = msg.data.new_state.attributes.isEnabledAec\n\n// Предыдущее состояние матрицы\nvar old_matrix = [\n    msg.data.old_state.attributes.out1,\n    msg.data.old_state.attributes.out2,\n    msg.data.old_state.attributes.out3,\n    msg.data.old_state.attributes.out4,\n    msg.data.old_state.attributes.out5,\n    msg.data.old_state.attributes.out6,\n    // msg.data.old_state.attributes.out7,\n    // msg.data.old_state.attributes.out8,\n]\n\n// Новое состояние матрицы\nvar new_matrix = [\n    msg.data.new_state.attributes.out1,\n    msg.data.new_state.attributes.out2,\n    msg.data.new_state.attributes.out3,\n    msg.data.new_state.attributes.out4,\n    msg.data.new_state.attributes.out5,\n    msg.data.new_state.attributes.out6,\n    // msg.data.new_state.attributes.out7,\n    // msg.data.new_state.attributes.out8,\n]\n\n\n// Предыдущие чувствительности входов\nvar old_ingain = [\n    msg.data.old_state.attributes.in1Gain,\n    msg.data.old_state.attributes.in2Gain,\n    msg.data.old_state.attributes.in3Gain,\n    msg.data.old_state.attributes.in4Gain,\n    msg.data.old_state.attributes.in5Gain,\n    msg.data.old_state.attributes.in6Gain,\n    // msg.data.old_state.attributes.in7Gain,\n    // msg.data.old_state.attributes.in8Gain,\n]\n\n// Новые чувствительности входов\nvar new_ingain = [\n    msg.data.new_state.attributes.in1Gain,\n    msg.data.new_state.attributes.in2Gain,\n    msg.data.new_state.attributes.in3Gain,\n    msg.data.new_state.attributes.in4Gain,\n    msg.data.new_state.attributes.in5Gain,\n    msg.data.new_state.attributes.in6Gain,\n    // msg.data.new_state.attributes.in7Gain,\n    // msg.data.new_state.attributes.in8Gain,\n]\n\n// Предыдущие чувствительности выходов\nvar old_outgain = [\n    msg.data.old_state.attributes.out1Gain,\n    msg.data.old_state.attributes.out2Gain,\n    msg.data.old_state.attributes.out3Gain,\n    // msg.data.old_state.attributes.out4Gain,\n    // msg.data.old_state.attributes.out5Gain,\n    // msg.data.old_state.attributes.out6Gain,\n    // msg.data.old_state.attributes.out7Gain,\n    // msg.data.old_state.attributes.out8Gain,\n]\n\n// Новые чувствительности выходов\nvar new_outgain = [\n    msg.data.new_state.attributes.out1Gain,\n    msg.data.new_state.attributes.out2Gain,\n    msg.data.new_state.attributes.out3Gain,\n    // msg.data.new_state.attributes.out4Gain,\n    // msg.data.new_state.attributes.out5Gain,\n    // msg.data.new_state.attributes.out6Gain,\n    // msg.data.new_state.attributes.out7Gain,\n    // msg.data.new_state.attributes.out8Gain,\n]\n\n// Предыдущее чувствительность AEC\nvar old_aecGain = msg.data.old_state.attributes.aecGain\n\n// Новое чувствительность AEC\nvar new_aecGain = msg.data.new_state.attributes.aecGain\n\n\n// Массив выходных сообщений\nvar messages = []\n\n\nfor (let i = 0; i < 6; i++) {\n\n    // Включение/выключение входа\n    if (old_isEnabledIn[i] != new_isEnabledIn[i] && typeof new_isEnabledIn[i] != \"undefined\") {\n\n        var input = Number(i + 1)\n\n        if (Number(new_isEnabledIn[i]) == 1) {\n            var power = true\n        } else if (Number(new_isEnabledIn[i]) == 0) {\n            var power = false\n        }\n\n        messages.push({\n            input: input,\n            power: power,\n            type: \"set input power\",\n            new_isEnabledIn: new_isEnabledIn,\n            new_isEnabledOut: new_isEnabledOut,\n            new_isEnabledAEC: new_isEnabledAec,\n            new_matrix: new_matrix\n        })\n    }\n\n    // Включение/выключение выхода\n    if (old_isEnabledOut[i] != new_isEnabledOut[i] && typeof new_isEnabledOut[i] != \"undefined\") {\n        var output = Number(i + 1)\n\n        if (Number(new_isEnabledOut[i]) == 1) {\n            var power = true\n        } else if (Number(new_isEnabledOut[i]) == 0) {\n            var power = false\n        }\n\n        messages.push({\n            output: output,\n            power: power,\n            type: \"set output power\",\n            new_isEnabledIn: new_isEnabledIn,\n            new_isEnabledOut: new_isEnabledOut,\n            new_isEnabledAEC: new_isEnabledAec,\n            new_matrix: new_matrix\n        })\n    }\n\n    // Переключения матрицы\n    if (old_matrix[i] != new_matrix[i]) {\n\n        if (typeof old_matrix[i] == \"undefined\") {\n            old_matrix[i] = []\n        }\n\n\n\n        // Подключение входа к выходу\n        if (typeof new_matrix[i] != \"undefined\") {\n\n            for (let j = 0; j < new_matrix[i].length; j++) {\n\n                if (!(old_matrix[i].includes(new_matrix[i][j]))) {\n\n                    var output = Number(i + 1)\n\n                    var input = Number(new_matrix[i][j])\n\n                    messages.push({\n                        output: output,\n                        input: input,\n                        type: \"set input to output\",\n                        new_isEnabledIn: new_isEnabledIn,\n                        new_isEnabledOut: new_isEnabledOut,\n                        new_isEnabledAEC: new_isEnabledAec,\n                        new_matrix: new_matrix\n                    })\n                }\n\n            }\n\n        }\n\n\n        // Отключение входа от выхода\n        for (let j = 0; j < old_matrix[i].length; j++) {\n\n            if (typeof new_matrix[i] != \"undefined\") {\n\n                if (!(new_matrix[i].includes(old_matrix[i][j]))) {\n\n                    var output = Number(i + 1)\n\n                    var input = Number(old_matrix[i][j])\n\n                    messages.push({\n                        output: output,\n                        input: input,\n                        type: \"remove input from output\",\n                        new_isEnabledIn: new_isEnabledIn,\n                        new_isEnabledOut: new_isEnabledOut,\n                        new_isEnabledAEC: new_isEnabledAec,\n                        new_matrix: new_matrix\n                    })\n                }\n\n            }\n            \n        }\n\n    }\n\n\n    // Изменение чувствительности входа\n    if (old_ingain[i] != new_ingain[i] && typeof new_ingain[i] != \"undefined\") {\n\n        var input = Number(i + 1)\n\n        var input_gain = Number(new_ingain[i])\n\n        messages.push({\n            input: input,\n            input_gain: input_gain + flow.get(\"inputOffsets\").get(input),\n            type: \"set input gain\",\n            new_isEnabledIn: new_isEnabledIn,\n            new_isEnabledOut: new_isEnabledOut,\n            new_isEnabledAEC: new_isEnabledAec,\n            new_matrix: new_matrix\n        })\n    }\n\n    // Изменение чувствительности выхода\n    if (old_outgain[i] != new_outgain[i] && typeof new_outgain[i] != \"undefined\") {\n\n        var output = Number(i + 1)\n\n        var output_gain = Number(new_outgain[i])\n\n        messages.push({\n            output: output,\n            output_gain: output_gain + flow.get(\"outputOffsets\").get(output),\n            type: \"set output gain\",\n            new_isEnabledIn: new_isEnabledIn,\n            new_isEnabledOut: new_isEnabledOut,\n            new_isEnabledAEC: new_isEnabledAec,\n            new_matrix: new_matrix\n        })\n    }\n\n}\n\n\n// Включение/выключение AEC\nif (old_isEnabledAec != new_isEnabledAec && typeof new_isEnabledAec != \"undefined\") {\n\n    var outputs_for_aec = flow.get(\"outputs_for_aec\")\n\n    for (let i = 0; i < outputs_for_aec.length; i++) {\n\n        if (new_isEnabledAec == 1) {\n            messages.push({\n                output: outputs_for_aec[i],\n                input: new_matrix.length + 29,\n                type: \"set input to output\",\n                new_isEnabledIn: new_isEnabledIn,\n                new_isEnabledOut: new_isEnabledOut,\n                new_isEnabledAEC: new_isEnabledAec,\n                new_matrix: new_matrix\n            })\n        } else if (new_isEnabledAec == 0) {\n            messages.push({\n                output: outputs_for_aec[i],\n                input: new_matrix.length + 29,\n                type: \"remove input from output\",\n                new_isEnabledIn: new_isEnabledIn,\n                new_isEnabledOut: new_isEnabledOut,\n                new_isEnabledAEC: new_isEnabledAec,\n                new_matrix: new_matrix\n            })\n        }\n    }\n}\n\n// Изменение чувствительности AEC\nif (old_aecGain != new_aecGain && typeof new_aecGain != \"undefined\") {\n\n    var outputs_for_aec = flow.get(\"outputs_for_aec\")\n\n    for (let i = 0; i < outputs_for_aec.length; i++) {\n\n        messages.push({\n            aec: new_ingain.length + 28,\n            output: outputs_for_aec[i],\n            aec_gain: new_aecGain + flow.get(\"aecOffset\"),\n            type: \"set aec gain\",\n            new_isEnabledIn: new_isEnabledIn,\n            new_isEnabledOut: new_isEnabledOut,\n            new_isEnabledAEC: new_isEnabledAec,\n            new_matrix: new_matrix\n        })\n    }\n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 400,
        "wires": [
            [
                "8978a104ee6aadba"
            ]
        ]
    },
    {
        "id": "89249d89d2bcefdc",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "7. Изменение gain AEC",
        "info": "",
        "x": 1090,
        "y": 320,
        "wires": []
    },
    {
        "id": "9ac68ccd2e9751a1",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "outputs for aec",
        "func": "// var outputs_for_aec = [2, 3]\n// flow.set(\"outputs_for_aec\", outputs_for_aec)\n\nflow.set(\"outputs_for_aec\", flow.get('trackable_outputs_aec'))\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 1160,
        "wires": [
            []
        ]
    },
    {
        "id": "db861fad8676c537",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "Выходы, отслеживаемые для aec",
        "info": "",
        "x": 400,
        "y": 1120,
        "wires": []
    },
    {
        "id": "e872ddb0f5fcf25e",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "НАСТРОЙКА",
        "info": "",
        "x": 330,
        "y": 1080,
        "wires": []
    },
    {
        "id": "935fa0aa4d9d4652",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "",
        "props": [],
        "repeat": "0.075",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 170,
        "y": 2900,
        "wires": [
            [
                "3eb4558523b3ae81"
            ]
        ]
    },
    {
        "id": "3eb4558523b3ae81",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 340,
        "y": 2900,
        "wires": [
            [
                "df62cfd95bb6dbbc"
            ]
        ]
    },
    {
        "id": "df62cfd95bb6dbbc",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "if device_statuses.attributes.audioprocessor == 2",
        "property": "device_statuses.attributes.audioprocessor",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 650,
        "y": 2900,
        "wires": [
            [
                "481d2779f576f8b2"
            ]
        ]
    },
    {
        "id": "fb9acc669d199a95",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "inputs, outputs",
        "func": "msg.inputs = [1]\n\nmsg.outputs = [1]\n\nflow.set(\"volume_first_input\", msg.inputs[0])\nflow.set(\"volume_last_output\", msg.outputs[msg.outputs.length - 1])\n\nmsg.rate = 1000 / (msg.inputs.length + msg.outputs.length)\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 2960,
        "wires": [
            [
                "4d4c41d98ec4b409"
            ]
        ]
    },
    {
        "id": "0d268f9f7d568cc2",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "Отслеживаемые для \"градусника\" входы и выходы",
        "info": "",
        "x": 1100,
        "y": 2920,
        "wires": []
    },
    {
        "id": "0fab2d1ad76890bb",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "НАСТРОЙКА",
        "info": "",
        "x": 970,
        "y": 2880,
        "wires": []
    },
    {
        "id": "481d2779f576f8b2",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "audioprocessor",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 180,
        "y": 2960,
        "wires": [
            [
                "c72fd62537a7f016"
            ]
        ]
    },
    {
        "id": "c72fd62537a7f016",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "if audioprocessor.attributes.volumeIndicator is true",
        "property": "audioprocessor.attributes.volumeIndicator",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 490,
        "y": 2960,
        "wires": [
            [
                "fb9acc669d199a95"
            ]
        ]
    },
    {
        "id": "a23bd48b1d06d66e",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "+ state",
        "func": "msg.state = msg.volume.state\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 3140,
        "wires": [
            [
                "75a688652e79edaf",
                "2139ad3966b0e0e0"
            ]
        ]
    },
    {
        "id": "af2da0abed1f099d",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "Отслеживание уровня сигнала на входах и выходах",
        "info": "",
        "x": 300,
        "y": 2860,
        "wires": []
    },
    {
        "id": "aa2e2d1e619e45a4",
        "type": "range",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "minin": "57800",
        "maxin": "65535",
        "minout": "-6",
        "maxout": "6",
        "action": "clamp",
        "round": true,
        "property": "msg.input_level",
        "name": "",
        "x": 1190,
        "y": 3120,
        "wires": [
            [
                "29142f00041110b0"
            ]
        ]
    },
    {
        "id": "917be49b5486cd2f",
        "type": "range",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "minin": "57800",
        "maxin": "65535",
        "minout": "-6",
        "maxout": "6",
        "action": "clamp",
        "round": true,
        "property": "msg.output_level",
        "name": "",
        "x": 1190,
        "y": 3160,
        "wires": [
            [
                "0bb9e6c804da448b"
            ]
        ]
    },
    {
        "id": "0e203a836564688f",
        "type": "api-call-service",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "volume",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "",
        "service": "",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 2500,
        "y": 3160,
        "wires": [
            []
        ]
    },
    {
        "id": "2b2bbbf12faf48bf",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "volume",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.volume",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "volume",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 500,
        "y": 3140,
        "wires": [
            [
                "a23bd48b1d06d66e"
            ]
        ]
    },
    {
        "id": "fa7f082596b39866",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "all input levels",
        "func": "var volume_first_input = flow.get(\"volume_first_input\")\nvar all_levels = flow.get(\"all_levels\")\n\nif (msg.input == volume_first_input) {\n    all_levels = {}\n    all_levels[\"in\" + msg.input + \"Vol\"] = msg.input_level\n} else {\n    all_levels[\"in\" + msg.input + \"Vol\"] = msg.input_level\n}\n\nflow.set(\"all_levels\", all_levels)\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 3120,
        "wires": [
            [
                "a12f9dfe7d4ef7ee"
            ]
        ]
    },
    {
        "id": "059b751d137216e6",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "all output levels",
        "func": "var volume_last_output = flow.get(\"volume_last_output\")\nvar all_levels = flow.get(\"all_levels\")\n\nif (msg.output == volume_last_output) {\n    all_levels[\"out\" + msg.output + \"Vol\"] = msg.output_level\n    msg.all_levels_complete = true\n} else {\n    all_levels[\"out\" + msg.output + \"Vol\"] = msg.output_level\n}\n\nflow.set(\"all_levels\", all_levels)\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 3160,
        "wires": [
            [
                "af70808c2f97f4f2",
                "deb7a5f4392c4ea2"
            ]
        ]
    },
    {
        "id": "8ccc5fa6c916781c",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 3100,
        "wires": [
            [
                "d9aeb2b489ae219c"
            ]
        ]
    },
    {
        "id": "d9aeb2b489ae219c",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "all_levels",
                "pt": "flow",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 330,
        "y": 3100,
        "wires": [
            []
        ]
    },
    {
        "id": "0ef90ef88e3371a3",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "+ all_levels",
        "func": "msg.all_levels = flow.get(\"all_levels\")\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2110,
        "y": 3160,
        "wires": [
            [
                "c57f1fec7d4674bc"
            ]
        ]
    },
    {
        "id": "af70808c2f97f4f2",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "if msg.all_levels_complete is true",
        "property": "all_levels_complete",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1860,
        "y": 3160,
        "wires": [
            [
                "0ef90ef88e3371a3"
            ]
        ]
    },
    {
        "id": "c57f1fec7d4674bc",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "payload for volume",
        "func": "msg.payload = {}\nmsg.payload[\"domain\"] = \"python_script\"\nmsg.payload[\"service\"] = \"set_state\"\nmsg.payload[\"data\"] = msg.all_levels\nmsg.payload[\"data\"][\"entity_id\"] = \"sensor.volume\"\nmsg.payload[\"data\"][\"state\"] = msg.state\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2310,
        "y": 3160,
        "wires": [
            [
                "0e203a836564688f",
                "d608d44e4c94b308"
            ]
        ]
    },
    {
        "id": "6f8788c1db69dd5a",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "Коммутация входов",
        "info": "",
        "x": 1390,
        "y": 3080,
        "wires": []
    },
    {
        "id": "29142f00041110b0",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "input commutation",
        "func": "let inputs = new Map();\n\n// inputs.set(номер физического входа, номер входа от интерфейса):\ninputs.set(1, 1)\ninputs.set(2, 2)\ninputs.set(3, 3)\ninputs.set(4, 4)\ninputs.set(5, 2)\ninputs.set(6, 3)\ninputs.set(7, 7)\ninputs.set(8, 8)\n\nif (inputs.has(msg.input))\n{\n    msg.input = inputs.get(msg.input)\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1390,
        "y": 3120,
        "wires": [
            [
                "fa7f082596b39866"
            ]
        ]
    },
    {
        "id": "184faf2782f0c0ab",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "НАСТРОЙКА",
        "info": "",
        "x": 1370,
        "y": 3040,
        "wires": []
    },
    {
        "id": "8289e88936d42b17",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "Коммутация выходов",
        "info": "",
        "x": 1400,
        "y": 3200,
        "wires": []
    },
    {
        "id": "0bb9e6c804da448b",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "output commutation",
        "func": "let outputs = new Map();\n\n// outputs.set(номер физического выхода, номер выхода от интерфейса):\noutputs.set(1, 1)\noutputs.set(2, 2)\noutputs.set(3, 3)\noutputs.set(4, 4)\noutputs.set(5, 5)\noutputs.set(6, 6)\noutputs.set(7, 7)\noutputs.set(8, 8)\n\nif (outputs.has(msg.output))\n{\n    msg.output = outputs.get(msg.output)\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1390,
        "y": 3160,
        "wires": [
            [
                "059b751d137216e6",
                "28918d78d969e786"
            ]
        ]
    },
    {
        "id": "aa0b321bfc40fd70",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "audiomute = false && micmute = false",
        "func": "msg.payload = {}\nmsg.payload[\"domain\"] = \"python_script\"\nmsg.payload[\"service\"] = \"set_state\"\nmsg.payload[\"data\"] = {}\n\n// var state = new Date()\n// state = state.getTime()\n\nmsg.payload[\"data\"][\"entity_id\"] = \"sensor.custom_buttons\"\nmsg.payload[\"data\"][\"state\"] = msg.state\nmsg.payload[\"data\"][\"audiomute\"] = false\nmsg.payload[\"data\"][\"micmute\"] = false\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1390,
        "y": 940,
        "wires": [
            [
                "4c3c0fddaa84ae75"
            ]
        ]
    },
    {
        "id": "1f8ee790babf07f7",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "data_to_save",
        "func": "if ((Object.keys(msg.data.new_state.attributes).length) > 4)\n{\n    msg.payload = msg.data.new_state\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 840,
        "wires": [
            [
                "9e08894cc520a955"
            ]
        ]
    },
    {
        "id": "9e08894cc520a955",
        "type": "DataIn",
        "z": "455bfc6c2c30aeae",
        "collection": "d6688dbfdb474a0f",
        "name": "-> audioprocessor",
        "update": false,
        "path": "/",
        "x": 570,
        "y": 840,
        "wires": []
    },
    {
        "id": "c72f3049424fc02f",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "Запоминание состояния",
        "info": "",
        "x": 190,
        "y": 800,
        "wires": []
    },
    {
        "id": "b402dd53e00400b4",
        "type": "server-state-changed",
        "z": "455bfc6c2c30aeae",
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.audioprocessor",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": true,
        "ignorePrevStateUnknown": true,
        "ignorePrevStateUnavailable": true,
        "ignoreCurrentStateUnknown": true,
        "ignoreCurrentStateUnavailable": true,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 160,
        "y": 840,
        "wires": [
            [
                "1f8ee790babf07f7"
            ]
        ]
    },
    {
        "id": "4c3c0fddaa84ae75",
        "type": "api-call-service",
        "z": "455bfc6c2c30aeae",
        "name": "custom_buttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1660,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "66992bb175f9045c",
        "type": "server-state-changed",
        "z": "455bfc6c2c30aeae",
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.audioprocessor",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 160,
        "y": 1500,
        "wires": [
            [
                "d4d077696c270988"
            ]
        ]
    },
    {
        "id": "8978a104ee6aadba",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "input commutation",
        "func": "try\n{\n    if (flow.get('inputs').has(msg.input))\n    {\n        msg.input = flow.get('inputs').get(msg.input)\n    }\n}\nfinally \n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 400,
        "wires": [
            [
                "30d57f8d8e521ead"
            ]
        ]
    },
    {
        "id": "30d57f8d8e521ead",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "output commutation",
        "func": "try\n{\n    if (flow.get('outputs').has(msg.output))\n    {\n        msg.output = flow.get('outputs').get(msg.output)\n    }\n}\nfinally \n{\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 400,
        "wires": [
            [
                "f40ee1b5d82a87ff"
            ]
        ]
    },
    {
        "id": "c4fa7640b26953ea",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"show\":[\"АУДИОПРОЦЕССОР_Править_вход\"], \"hide\":[\"АУДИОПРОЦЕССОР_Править_выход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4220,
        "y": 580,
        "wires": [
            [
                "59bec82412c3d66f"
            ]
        ]
    },
    {
        "id": "2214b3d6a7839511",
        "type": "ui_button",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "group": "b52da2819ad1aaab",
        "order": 4,
        "width": 8,
        "height": 1,
        "passthru": false,
        "label": "Вернуть к заводским настройкам",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "rotate_left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3180,
        "y": 580,
        "wires": [
            [
                "09281a5096086d2b"
            ]
        ]
    },
    {
        "id": "931795757bdac252",
        "type": "ui_form",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "label": "",
        "group": "4baa93912120146e",
        "order": 2,
        "width": 6,
        "height": 1,
        "options": [
            {
                "label": "Программный вход",
                "value": "inSoftware",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Физический вход",
                "value": "inHardware",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Уставка",
                "value": "inOffset",
                "type": "number",
                "required": false,
                "rows": null
            }
        ],
        "formValue": {
            "inSoftware": "",
            "inHardware": "",
            "inOffset": ""
        },
        "payload": "",
        "submit": "Подтвердить",
        "cancel": "",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "className": "",
        "x": 4430,
        "y": 620,
        "wires": [
            [
                "fb9f10a025c83ee6"
            ]
        ]
    },
    {
        "id": "c21940de1df54ce7",
        "type": "ui_button",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "group": "4baa93912120146e",
        "order": 1,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Закрыть",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 4000,
        "y": 540,
        "wires": [
            [
                "7caf70e9de82cf5a"
            ]
        ]
    },
    {
        "id": "8a3a916a9b0d9785",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "get data to refresh table",
        "func": "var inputs = flow.get('inputs')\nvar inputOffsets = flow.get('inputOffsets')\nvar data = []\nnode.warn(inputOffsets)\nfor (const key of inputs.keys()) {\n  node.warn(key)\n  data.push({'inSoftware': key, 'inHardware': inputs.get(key), 'inOffset': inputOffsets.get(key)})\n}\n\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3750,
        "y": 620,
        "wires": [
            [
                "276c626fed566b1f",
                "b7ba19df86462a66"
            ]
        ]
    },
    {
        "id": "fe2514d03ef7b76b",
        "type": "ui_button",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "group": "b52da2819ad1aaab",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-plus-square",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3090,
        "y": 620,
        "wires": [
            [
                "afe71a99c7f970c7"
            ]
        ]
    },
    {
        "id": "fb9f10a025c83ee6",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "validation",
        "func": "if ((msg.payload.inHardware >= 0) && (msg.payload.inSoftware <= flow.get('inputs').size) && (msg.payload.inSoftware >= 1))\n{\n    msg.log = 'ok'\n    var inputs = flow.get('inputs')\n    inputs.set(msg.payload.inSoftware, msg.payload.inHardware)\n    flow.set('inputs', inputs)\n\n    var inputOffsets = flow.get('inputOffsets')\n    inputOffsets.set(msg.payload.inSoftware, msg.payload.inOffset)\n    flow.set('inputOffsets', inputOffsets)\n}\nelse\n{\n    msg.log = 'incorrect'\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3700,
        "y": 680,
        "wires": [
            [
                "15429fab940de0c2"
            ]
        ]
    },
    {
        "id": "cf25b6918f7d0aab",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "AMA Inpits",
        "info": "",
        "x": 3100,
        "y": 400,
        "wires": []
    },
    {
        "id": "4fc3e485b2fa7329",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 5590,
        "y": 660,
        "wires": [
            [
                "93deb2bd2aa4f560"
            ]
        ]
    },
    {
        "id": "65859349c6bba818",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "debug 115",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 6200,
        "y": 660,
        "wires": []
    },
    {
        "id": "6567951054bd5b02",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "Коммутация входов",
        "info": "",
        "x": 5790,
        "y": 620,
        "wires": []
    },
    {
        "id": "b897fae184abd16c",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "Коммутация выходов",
        "info": "",
        "x": 6020,
        "y": 620,
        "wires": []
    },
    {
        "id": "93deb2bd2aa4f560",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "input commutation",
        "func": "if (flow.get('inputs').has(msg.input))\n{\n    msg.input = flow.get('inputs').get(msg.input)\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5790,
        "y": 660,
        "wires": [
            [
                "3581e38b96c78e25"
            ]
        ]
    },
    {
        "id": "3581e38b96c78e25",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "output commutation",
        "func": "if (flow.get('outputs').has(msg.output))\n{\n    msg.output = flow.get('outputs').get(msg.output)\n}\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 6010,
        "y": 660,
        "wires": [
            [
                "65859349c6bba818"
            ]
        ]
    },
    {
        "id": "112d5b53b1f58a29",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "get inputs",
        "func": "msg.inputs = flow.get('inputs')\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5760,
        "y": 740,
        "wires": [
            [
                "40cdf32bb66d8a68"
            ]
        ]
    },
    {
        "id": "40cdf32bb66d8a68",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "debug 116",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "inputs",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 5980,
        "y": 740,
        "wires": []
    },
    {
        "id": "90bba888bfee6123",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "Check >>",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 5600,
        "y": 740,
        "wires": [
            [
                "112d5b53b1f58a29"
            ]
        ]
    },
    {
        "id": "afe71a99c7f970c7",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "manage inputs (add)",
        "func": "if (flow.get('inputs') == undefined) \n{\n    flow.set('inputs', new Map())\n    flow.set('trackable_inputs', [])\n}\n/*\nif (flow.get('outputs') == undefined)\n{\n    flow.set('outputs', new Map())\n    flow.set('trackable_outputs', [])\n    flow.set('trackable_outputs_aec', [])\n}\n*/\nif (flow.get('inputOffsets') == undefined) \n{\n    flow.set('inputOffsets', new Map())\n}\n\nvar inputs = flow.get('inputs')\ninputs.set(inputs.size + 1, inputs.size + 1)\nflow.set('inputs', inputs)\n\nvar inputOffsets = flow.get('inputOffsets')\ninputOffsets.set(inputOffsets.size + 1, -15) // Default\nflow.set('inputOffsets', inputOffsets)\n\nmsg.inputs = inputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3420,
        "y": 620,
        "wires": [
            [
                "8a3a916a9b0d9785"
            ]
        ]
    },
    {
        "id": "6ee617d5993fca9f",
        "type": "ui_button",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "group": "b52da2819ad1aaab",
        "order": 2,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3090,
        "y": 660,
        "wires": [
            [
                "5bcde998d55bdfdf"
            ]
        ]
    },
    {
        "id": "5bcde998d55bdfdf",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "manage inputs (del)",
        "func": "var inputs = flow.get('inputs')\nvar trackable_inputs = flow.get('trackable_inputs')\n\nvar index = trackable_inputs.indexOf(inputs.size.toString())\nif (index != -1)\n{\n    trackable_inputs.splice(index, 1)\n    flow.set('trackable_inputs', trackable_inputs)\n}\n\ninputs.delete(inputs.size)\nflow.set('inputs', inputs)\n\nvar inputOffsets = flow.get('inputOffsets')\ninputOffsets.delete(inputOffsets.size)\nflow.set('inputOffsets', inputOffsets)\n\nmsg.inputs = inputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3420,
        "y": 660,
        "wires": [
            [
                "8a3a916a9b0d9785"
            ]
        ]
    },
    {
        "id": "7caf70e9de82cf5a",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"hide\":[\"АУДИОПРОЦЕССОР_Править_вход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4220,
        "y": 540,
        "wires": [
            [
                "59bec82412c3d66f"
            ]
        ]
    },
    {
        "id": "48f6e4a6d7bf712d",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "to form",
        "func": "var key = msg.row + 1\nvar val = flow.get('inputs').get(msg.row + 1)\nvar offset = flow.get('inputOffsets').get(msg.row + 1)\n\nflow.set('selectedInput', {'inSoftware': key, 'inHardware': val, 'inOffset': offset})\n\nmsg.payload = flow.get('selectedInput')\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4200,
        "y": 620,
        "wires": [
            [
                "931795757bdac252"
            ]
        ]
    },
    {
        "id": "15429fab940de0c2",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "log",
        "property": "log",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "incorrect",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ok",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 3810,
        "y": 760,
        "wires": [
            [
                "52d30ea8afd42e96",
                "acd6f65561747fed"
            ],
            [
                "678da774be3b6b6b",
                "64bcb6985781f1a8"
            ]
        ]
    },
    {
        "id": "95adbf1c4cf52dc8",
        "type": "ui_toast",
        "z": "455bfc6c2c30aeae",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Вход назначен",
        "name": "Successful",
        "x": 4170,
        "y": 780,
        "wires": []
    },
    {
        "id": "bbd30cfe9f26b953",
        "type": "ui_toast",
        "z": "455bfc6c2c30aeae",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Укажите вход в пределах табличных значений",
        "name": "Incorrect",
        "x": 4180,
        "y": 740,
        "wires": []
    },
    {
        "id": "52d30ea8afd42e96",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3990,
        "y": 740,
        "wires": [
            [
                "bbd30cfe9f26b953"
            ]
        ]
    },
    {
        "id": "678da774be3b6b6b",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3990,
        "y": 780,
        "wires": [
            [
                "95adbf1c4cf52dc8"
            ]
        ]
    },
    {
        "id": "acd6f65561747fed",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "return last data",
        "func": "msg.payload = { 'inSoftware': msg.payload.inSoftware, 'inHardware': flow.get('inputs').get(msg.payload.inSoftware), 'inOffset': flow.get('inputOffsets').get(msg.payload.inSoftware) }\nmsg.event = {'bbox': [580, 221, 898, 173]}\nmsg.socketid = 'w0SaiBu-ePmh8nhNAABF'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4020,
        "y": 700,
        "wires": [
            [
                "931795757bdac252"
            ]
        ]
    },
    {
        "id": "09281a5096086d2b",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "reset func",
        "func": "var inputs = flow.get('inputs')\n\nfor (const key of inputs.keys()) {\n  inputs.set(key, key)\n}\n\nflow.set('inputs', inputs)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3460,
        "y": 580,
        "wires": [
            [
                "8a3a916a9b0d9785"
            ]
        ]
    },
    {
        "id": "64bcb6985781f1a8",
        "type": "delay",
        "z": "455bfc6c2c30aeae",
        "name": "-->",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 3470,
        "y": 760,
        "wires": [
            [
                "8a3a916a9b0d9785"
            ]
        ]
    },
    {
        "id": "e7e19f5e500f9e7e",
        "type": "DataIn",
        "z": "455bfc6c2c30aeae",
        "collection": "685e1e326592eb00",
        "name": "-> audioprocessor_config",
        "update": false,
        "path": "/",
        "x": 4450,
        "y": 440,
        "wires": []
    },
    {
        "id": "e2477159c076c84b",
        "type": "DataOut",
        "z": "455bfc6c2c30aeae",
        "collection": "685e1e326592eb00",
        "name": "audioprocessor_config ->",
        "path": "/",
        "error": false,
        "x": 4450,
        "y": 400,
        "wires": [
            [
                "31bc5b57916fe925"
            ]
        ]
    },
    {
        "id": "31bc5b57916fe925",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "set all to flow",
        "func": "for (let el of msg.payload)\n{\n    if ((el['attr'] == 'inputs') || (el['attr'] == 'outputs') || (el['attr'] == 'inputOffsets') || (el['attr'] == 'outputOffsets')) {\n        const map = new Map(Object.entries(el['val']).map(([key, value]) => [Number(key), value]));\n        flow.set(el['attr'], map)\n    }\n    else\n    {\n        flow.set(el['attr'], el['val'])\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4670,
        "y": 400,
        "wires": [
            [
                "39963bdaec60f1ee"
            ]
        ]
    },
    {
        "id": "159da2d08339e689",
        "type": "server-state-changed",
        "z": "455bfc6c2c30aeae",
        "name": "about",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.about",
        "entityIdType": "exact",
        "outputInitially": false,
        "ifState": "",
        "ifStateType": "str",
        "outputOnlyOnStateChange": false,
        "for": "0",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "about",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.about",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "haltifstate": "",
        "halt_if_type": "str",
        "output_only_on_state_change": false,
        "x": 3270,
        "y": 400,
        "wires": [
            [
                "a6070370fa7cdb97"
            ]
        ]
    },
    {
        "id": "f56d80a049a8d19e",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "Вызов сохраненного состояния при старте HomeAssistant",
        "info": "",
        "x": 3440,
        "y": 360,
        "wires": []
    },
    {
        "id": "6f9128cecb1840ef",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "new about.home_assistant is true",
        "property": "about.new_state.attributes.home_assistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 3960,
        "y": 400,
        "wires": [
            [
                "65180de7d9605bf2"
            ]
        ]
    },
    {
        "id": "a6070370fa7cdb97",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "old about.home_assistant != new about.home_assistant",
        "property": "about.old_state.attributes.home_assistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "about.new_state.attributes.home_assistant",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 3570,
        "y": 400,
        "wires": [
            [
                "6f9128cecb1840ef"
            ]
        ]
    },
    {
        "id": "f58403f01b2cebec",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "get all from flow",
        "func": "var keys = flow.keys()\nvar ans = []\nfor (let key of keys) {\n    if (Object.prototype.toString.call(flow.get(key)) == '[object Map]') {\n        ans.push({ 'attr': key, 'val': Object.fromEntries(flow.get(key))})\n    }\n    else\n    {\n        ans.push({ 'attr': key, 'val': flow.get(key)})\n    }\n}\nmsg.payload = ans\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4220,
        "y": 440,
        "wires": [
            [
                "e7e19f5e500f9e7e"
            ]
        ]
    },
    {
        "id": "04a0e487c2f8f70b",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "get outputs",
        "func": "msg.outputs = flow.get('outputs')\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5770,
        "y": 780,
        "wires": [
            [
                "4b1ff056263c182b"
            ]
        ]
    },
    {
        "id": "4b1ff056263c182b",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "debug 117",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "outputs",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 5980,
        "y": 780,
        "wires": []
    },
    {
        "id": "1116e852a81b3e80",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "Check >>",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 5600,
        "y": 780,
        "wires": [
            [
                "04a0e487c2f8f70b"
            ]
        ]
    },
    {
        "id": "bcd6604afb1d24ce",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"show\":[\"АУДИОПРОЦЕССОР_Править_выход\"], \"hide\":[\"АУДИОПРОЦЕССОР_Править_вход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4220,
        "y": 1100,
        "wires": [
            [
                "4067f8838880ebac"
            ]
        ]
    },
    {
        "id": "fa9898542ac77e0d",
        "type": "ui_button",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "group": "e75c15142175c3bc",
        "order": 4,
        "width": 8,
        "height": 1,
        "passthru": false,
        "label": "Вернуть к заводским настройкам",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "rotate_left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3180,
        "y": 1100,
        "wires": [
            [
                "d987594c30f43463"
            ]
        ]
    },
    {
        "id": "99b2f66c79a66009",
        "type": "ui_form",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "label": "",
        "group": "a00da0272f194b50",
        "order": 2,
        "width": 6,
        "height": 1,
        "options": [
            {
                "label": "Программный выход",
                "value": "outSoftware",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Физический выход",
                "value": "outHardware",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Уставка",
                "value": "outOffset",
                "type": "number",
                "required": false,
                "rows": null
            }
        ],
        "formValue": {
            "outSoftware": "",
            "outHardware": "",
            "outOffset": ""
        },
        "payload": "",
        "submit": "Подтвердить",
        "cancel": "",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": "",
        "className": "",
        "x": 4430,
        "y": 1140,
        "wires": [
            [
                "2c1f3d1e153da703",
                "889101a4b59d2b91"
            ]
        ]
    },
    {
        "id": "bcc937e6358f22bb",
        "type": "ui_button",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "group": "a00da0272f194b50",
        "order": 1,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Закрыть",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 4000,
        "y": 1060,
        "wires": [
            [
                "c96a2ee154dad9b3"
            ]
        ]
    },
    {
        "id": "328dcefd3c7ebbf0",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "get data to refresh table",
        "func": "var outputs = flow.get('outputs')\nvar outputOffsets = flow.get('outputOffsets')\nvar data = []\nnode.warn(outputOffsets)\nfor (const key of outputs.keys()) {\n  node.warn(key)\n  data.push({ 'outSoftware': key, 'outHardware': outputs.get(key), 'outOffset': outputOffsets.get(key) })\n}\n\nmsg.payload = data\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3750,
        "y": 1140,
        "wires": [
            [
                "6f727b69d4a1584d",
                "c320452b49c5920e"
            ]
        ]
    },
    {
        "id": "95229f817b6c27a1",
        "type": "ui_button",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "group": "e75c15142175c3bc",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-plus-square",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3090,
        "y": 1140,
        "wires": [
            [
                "32b3b0d407b9ec2a"
            ]
        ]
    },
    {
        "id": "2c1f3d1e153da703",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "validation",
        "func": "if ((msg.payload.outHardware >= 0) && (msg.payload.outSoftware <= flow.get('outputs').size) && (msg.payload.outSoftware >= 1))\n{\n    msg.log = 'ok'\n    var outputs = flow.get('outputs')\n    outputs.set(msg.payload.outSoftware, msg.payload.outHardware)\n    flow.set('outputs', outputs)\n\n    var outputOffsets = flow.get('outputOffsets')\n    outputOffsets.set(msg.payload.outSoftware, msg.payload.outOffset)\n    flow.set('outputOffsets', outputOffsets)\n}\nelse\n{\n    msg.log = 'incorrect'\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3700,
        "y": 1200,
        "wires": [
            [
                "c212e96fbb49f258"
            ]
        ]
    },
    {
        "id": "f3d5ba06f07504c8",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "AMA Outputs",
        "info": "",
        "x": 3110,
        "y": 920,
        "wires": []
    },
    {
        "id": "32b3b0d407b9ec2a",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "manage outputs (add)",
        "func": "/*\nif (flow.get('inputs') == undefined) {\n    flow.set('inputs', new Map())\n    flow.set('trackable_inputs', [])\n}\n*/\nif (flow.get('outputs') == undefined)\n{\n    flow.set('outputs', new Map())\n    flow.set('trackable_outputs', [])\n}\n\nif (flow.get('outputOffsets') == undefined) {\n    flow.set('outputOffsets', new Map())\n}\n\nvar outputs = flow.get('outputs')\noutputs.set(outputs.size + 1, outputs.size + 1)\nflow.set('outputs', outputs)\n\nvar outputOffsets = flow.get('outputOffsets')\noutputOffsets.set(outputOffsets.size + 1, -15) // Default\nflow.set('outputOffsets', outputOffsets)\n\nmsg.outputs = outputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3420,
        "y": 1140,
        "wires": [
            [
                "328dcefd3c7ebbf0"
            ]
        ]
    },
    {
        "id": "789d08b76035a9c6",
        "type": "ui_button",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "group": "e75c15142175c3bc",
        "order": 2,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-trash",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 3090,
        "y": 1180,
        "wires": [
            [
                "2b3f281c97cd0f90"
            ]
        ]
    },
    {
        "id": "2b3f281c97cd0f90",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "manage outputs (del)",
        "func": "var outputs = flow.get('outputs')\nvar trackable_outputs = flow.get('trackable_outputs')\nvar trackable_outputs_aec = flow.get('trackable_outputs_aec')\n\nvar index = trackable_outputs.indexOf(outputs.size.toString())\nif (index != -1)\n{\n    trackable_outputs.splice(index, 1)\n    flow.set('trackable_outputs', trackable_outputs)\n}\n\nvar index_aec = trackable_outputs_aec.indexOf(outputs.size.toString())\nif (index_aec != -1)\n{\n    trackable_outputs_aec.splice(index_aec, 1)\n    flow.set('trackable_outputs_aec', trackable_outputs_aec)\n}\n\noutputs.delete(outputs.size)\nflow.set('outputs', outputs)\n\nvar outputOffsets = flow.get('outputOffsets')\noutputOffsets.delete(outputOffsets.size)\nflow.set('outputOffsets', outputOffsets)\n\nmsg.outputs = outputs\nreturn msg\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3420,
        "y": 1180,
        "wires": [
            [
                "328dcefd3c7ebbf0"
            ]
        ]
    },
    {
        "id": "c96a2ee154dad9b3",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"hide\":[\"АУДИОПРОЦЕССОР_Править_выход\"]}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4220,
        "y": 1060,
        "wires": [
            [
                "4067f8838880ebac"
            ]
        ]
    },
    {
        "id": "6b21f71b7a0be319",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "to form",
        "func": "var key = msg.row + 1\nvar val = flow.get('outputs').get(msg.row + 1)\nvar offset = flow.get('outputOffsets').get(msg.row + 1)\n\nflow.set('selectedOutput', {'outSoftware': key, 'outHardware': val, 'outOffset': offset})\n\nmsg.payload = flow.get('selectedOutput')\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4200,
        "y": 1140,
        "wires": [
            [
                "99b2f66c79a66009"
            ]
        ]
    },
    {
        "id": "c212e96fbb49f258",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "log",
        "property": "log",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "incorrect",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ok",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 3810,
        "y": 1280,
        "wires": [
            [
                "6df769877b0d1643",
                "07754bf102360273"
            ],
            [
                "5f76726e6279b44c",
                "a886750b73e4b79c"
            ]
        ]
    },
    {
        "id": "2d2fe1fe8656d548",
        "type": "ui_toast",
        "z": "455bfc6c2c30aeae",
        "position": "top right",
        "displayTime": "1",
        "highlight": "green",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Вход назначен",
        "name": "Successful",
        "x": 4170,
        "y": 1300,
        "wires": []
    },
    {
        "id": "d4fb224a8f2ef628",
        "type": "ui_toast",
        "z": "455bfc6c2c30aeae",
        "position": "top right",
        "displayTime": "2",
        "highlight": "red",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "Укажите вход в пределах табличных значений",
        "name": "Incorrect",
        "x": 4180,
        "y": 1260,
        "wires": []
    },
    {
        "id": "6df769877b0d1643",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3990,
        "y": 1260,
        "wires": [
            [
                "d4fb224a8f2ef628"
            ]
        ]
    },
    {
        "id": "5f76726e6279b44c",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "' '",
        "func": "msg.payload = ' '\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3990,
        "y": 1300,
        "wires": [
            [
                "2d2fe1fe8656d548"
            ]
        ]
    },
    {
        "id": "07754bf102360273",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "return last data",
        "func": "msg.payload = {'outSoftware': msg.payload.outSoftware, 'outHardware': flow.get('outputs').get(msg.payload.outSoftware), 'outOffset': flow.get('outputOffsets').get(msg.payload.outSoftware) }\nmsg.event = {'bbox': [580, 221, 898, 173]}\nmsg.socketid = 'w0SaiBu-ePmh8nhNAABF'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4020,
        "y": 1220,
        "wires": [
            [
                "99b2f66c79a66009"
            ]
        ]
    },
    {
        "id": "d987594c30f43463",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "reset func",
        "func": "var outputs = flow.get('outputs')\n\nfor (const key of outputs.keys()) {\n  outputs.set(key, key)\n}\n\nflow.set('outputs', outputs)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3460,
        "y": 1100,
        "wires": [
            [
                "328dcefd3c7ebbf0"
            ]
        ]
    },
    {
        "id": "a886750b73e4b79c",
        "type": "delay",
        "z": "455bfc6c2c30aeae",
        "name": "-->",
        "pauseType": "delay",
        "timeout": "0",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 3470,
        "y": 1280,
        "wires": [
            [
                "328dcefd3c7ebbf0"
            ]
        ]
    },
    {
        "id": "70310fe70f1fac26",
        "type": "ui_template",
        "z": "455bfc6c2c30aeae",
        "group": "631fc494a4cc4190",
        "name": "checkbox",
        "order": 1,
        "width": 2,
        "height": 6,
        "format": "<script>\n(function($scope) {\n $scope.sendRow = function(obj) {\n    $scope.send({ \"checkbox\":  obj});\n };\n})(scope);\n</script>\n<form>\n    <fieldset style=\"width:68%\">\n    <legend>Входы</legend>\n        <div ng-repeat=\"x in msg.inputs\">\n            <label>{{x.NAME}}\n                <input  type=\"checkbox\"\n                        style=\"float:left; position: relative; top: 5px;\"\n                        ng-model=\"x.STATE\"\n                        ng-change=\"sendRow({var:x.NAME, state: x.STATE})\">\n            </label>\n        </div>\n    </fieldset>\n    <fieldset style=\"width:50%\">\n        <legend>Выходы</legend>\n        <div ng-repeat=\"x in msg.outputs\">\n            <label>{{x.NAME}}\n                    <input  type=\"checkbox\" \n                            style=\"float:left; position: relative; top: 5px;\"\n                            ng-model=\"x.STATE\"\n                            ng-change=\"sendRow({var:x.NAME, state: x.STATE})\">\n                </label>\n        </div>\n    </fieldset>\n</form>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 4820,
        "y": 1280,
        "wires": [
            [
                "29f2f35ac6b3d8a9"
            ]
        ]
    },
    {
        "id": "e973b3c6744f9b5b",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "get ins & outs",
        "func": "let inputs = [];\nfor (let i = 1; i <= flow.get('inputs').size; i++) {\n    let state = false\n    if (flow.get('trackable_inputs').includes(i.toString()))\n    {\n        state = true\n    }\n    inputs.push({ 'NAME': i.toString() + ' ', 'STATE': state}); // Пробел, чтобы названия не совпадали с выходами\n}\n\n\nlet outputs = [];\nfor (let i = 1; i <= flow.get('outputs').size; i++) {\n    let state = false\n    if (flow.get('trackable_outputs').includes(i.toString())) {\n        state = true\n    }\n    outputs.push({'NAME': i.toString(), 'STATE': state});\n}\n\nmsg.inputs = inputs\nmsg.outputs = outputs\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4640,
        "y": 1280,
        "wires": [
            [
                "70310fe70f1fac26"
            ]
        ]
    },
    {
        "id": "b1068847983c1da9",
        "type": "link in",
        "z": "455bfc6c2c30aeae",
        "name": "to checkbox",
        "links": [
            "81e3ad27280ab7a6",
            "c320452b49c5920e",
            "b7ba19df86462a66"
        ],
        "x": 4505,
        "y": 1300,
        "wires": [
            [
                "e973b3c6744f9b5b",
                "0bd7600ad9d0e0c8",
                "ac3dc5dd76b04137"
            ]
        ]
    },
    {
        "id": "0a2c5bdddbe8b556",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "AMA Buttons",
        "info": "",
        "x": 4630,
        "y": 1240,
        "wires": []
    },
    {
        "id": "29f2f35ac6b3d8a9",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "manage trackable",
        "func": "let trackable_inputs = flow.get('trackable_inputs')\nif (trackable_inputs == undefined)\n{\n    trackable_inputs = []\n}\n\nlet trackable_outputs = flow.get('trackable_outputs')\nif (trackable_outputs == undefined)\n{\n    trackable_outputs = []\n}\nif (msg.checkbox.var.slice(-1) == ' ')\n{\n    let name = msg.checkbox.var.slice(0, -1)\n    let state = msg.checkbox.state\n    if (state)\n    {\n        trackable_inputs.push(name)\n    }\n    else\n    {\n        trackable_inputs.splice(trackable_inputs.indexOf(name), 1)\n    }\n    flow.set('trackable_inputs', trackable_inputs)\n}\nelse\n{   \n    let name = msg.checkbox.var\n    let state = msg.checkbox.state\n    if (state)\n    {\n        trackable_outputs.push(name)\n    }\n    else\n    {\n        trackable_outputs.splice(trackable_outputs.indexOf(name), 1)\n    }\n    flow.set('trackable_outputs', trackable_outputs)\n}\n\nmsg.trackable_inputs = trackable_inputs\nmsg.trackable_outputs = trackable_outputs\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5010,
        "y": 1280,
        "wires": [
            []
        ]
    },
    {
        "id": "e7c9325cc7fe40ef",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "clear all and fields",
        "func": "var keys = flow.keys()\n\nfor (let key of keys)\n{\n    flow.set(key, undefined);\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 6610,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "cdf836bdbbabfdb3",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "CLEAR",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 6430,
        "y": 740,
        "wires": [
            [
                "e7c9325cc7fe40ef"
            ]
        ]
    },
    {
        "id": "7bc0a5836cf823e9",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "check all and fields",
        "func": "var keys = flow.keys()\nmsg.keys = keys\nfor (let key of keys)\n{\n    msg[key] = flow.get(key);\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 6610,
        "y": 780,
        "wires": [
            [
                "ad10972356dbd3b3"
            ]
        ]
    },
    {
        "id": "acc46dd8d38dfb72",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "Check",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 6430,
        "y": 780,
        "wires": [
            [
                "7bc0a5836cf823e9"
            ]
        ]
    },
    {
        "id": "ad10972356dbd3b3",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "name": "FLOW.KEYS",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 6800,
        "y": 780,
        "wires": []
    },
    {
        "id": "20c04666ecf1e96d",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "readme.txt",
        "info": "trackable_inputs - массив отслеживаемых входов\ntrackable_outputs - массив отслеживаемых выходов\n\nЭтот элемент будет работать в потоке аудиопроцессора в механизме кнопок общего мьюта",
        "x": 4980,
        "y": 1240,
        "wires": []
    },
    {
        "id": "2e5784d775cc8a71",
        "type": "ui_ui_control",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "events": "all",
        "x": 4800,
        "y": 820,
        "wires": [
            [
                "d643ce6871642e32"
            ]
        ]
    },
    {
        "id": "4e9ad9e67a819ca4",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"tab\":\"КОНФИГУРАТОР\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4580,
        "y": 820,
        "wires": [
            [
                "2e5784d775cc8a71"
            ]
        ]
    },
    {
        "id": "40f203576ca7975e",
        "type": "ui_button",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "group": "a7308f94ab8d29d3",
        "order": 1,
        "width": 1,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "arrow_back",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 4390,
        "y": 820,
        "wires": [
            [
                "4e9ad9e67a819ca4"
            ]
        ]
    },
    {
        "id": "81e3ad27280ab7a6",
        "type": "link out",
        "z": "455bfc6c2c30aeae",
        "name": "from INs",
        "mode": "link",
        "links": [
            "b1068847983c1da9",
            "2b6f9ce9b97ab53e"
        ],
        "x": 5155,
        "y": 820,
        "wires": []
    },
    {
        "id": "d643ce6871642e32",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "payload == 'connect'",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "connect",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 5000,
        "y": 820,
        "wires": [
            [
                "81e3ad27280ab7a6"
            ]
        ]
    },
    {
        "id": "0bd7600ad9d0e0c8",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "get outs_aec",
        "func": "let outputs_aec = [];\nfor (let i = 1; i <= flow.get('outputs').size; i++) {\n    let state = false\n    if (flow.get('trackable_outputs_aec').includes(i.toString()))\n    {\n        state = true\n    }\n    outputs_aec.push({ 'NAME': i.toString(), 'STATE': state}); // Пробел, чтобы названия не совпадали с выходами\n}\n\nmsg.outputs_aec = outputs_aec\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4630,
        "y": 1320,
        "wires": [
            [
                "71aa3a85839a98ba"
            ]
        ]
    },
    {
        "id": "53788730fe279c4d",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "manage trackable_aec",
        "func": "let trackable_outputs_aec = flow.get('trackable_outputs_aec')\nif (trackable_outputs_aec == undefined)\n{\n    trackable_outputs_aec = []\n}\n\nlet name = msg.checkbox.var\nlet state = msg.checkbox.state\nif (state)\n{\n    trackable_outputs_aec.push(name)\n}\nelse\n{\n    trackable_outputs_aec.splice(trackable_outputs_aec.indexOf(name), 1)\n}\nflow.set('trackable_outputs_aec', trackable_outputs_aec)\n\nmsg.trackable_outputs_aec = trackable_outputs_aec\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5020,
        "y": 1320,
        "wires": [
            [
                "9028cf82013968e1"
            ]
        ]
    },
    {
        "id": "9028cf82013968e1",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "outputs for aec",
        "func": "// var outputs_for_aec = [2, 3]\n// flow.set(\"outputs_for_aec\", outputs_for_aec)\n\nflow.set(\"outputs_for_aec\", flow.get('trackable_outputs_aec'))\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5240,
        "y": 1320,
        "wires": [
            []
        ]
    },
    {
        "id": "0abb71d7422b89e1",
        "type": "ping",
        "z": "455bfc6c2c30aeae",
        "protocol": "IPv4",
        "mode": "triggered",
        "name": "",
        "host": "",
        "timer": "2",
        "inputs": 1,
        "x": 650,
        "y": 2000,
        "wires": [
            [
                "586f80d33bb8cb12"
            ]
        ]
    },
    {
        "id": "f631e8113da078a4",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "false",
        "func": "msg.payload = false;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 2040,
        "wires": [
            [
                "586f80d33bb8cb12"
            ]
        ]
    },
    {
        "id": "7af687b528e42d1c",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "is empty?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 500,
        "y": 2020,
        "wires": [
            [
                "0abb71d7422b89e1"
            ],
            [
                "f631e8113da078a4"
            ]
        ]
    },
    {
        "id": "cf837a351e5c45cd",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4190,
        "y": 500,
        "wires": [
            [
                "7caf70e9de82cf5a"
            ]
        ]
    },
    {
        "id": "7cfe1a4b10dcda2f",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4190,
        "y": 1020,
        "wires": [
            [
                "c96a2ee154dad9b3"
            ]
        ]
    },
    {
        "id": "defb544456d366f3",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "Refresh table with start flows",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 4440,
        "y": 360,
        "wires": [
            [
                "e2477159c076c84b"
            ]
        ]
    },
    {
        "id": "dc459d77a928ea2e",
        "type": "link in",
        "z": "455bfc6c2c30aeae",
        "name": "> save",
        "links": [
            "b7ba19df86462a66",
            "c320452b49c5920e",
            "6d74da8ba618bbc8"
        ],
        "x": 4105,
        "y": 440,
        "wires": [
            [
                "f58403f01b2cebec"
            ]
        ]
    },
    {
        "id": "39963bdaec60f1ee",
        "type": "link out",
        "z": "455bfc6c2c30aeae",
        "name": "load >",
        "mode": "link",
        "links": [
            "417ddfae4c3e1e6b",
            "c7f03ceb117f114c",
            "b93451ea85a0d531"
        ],
        "x": 4815,
        "y": 400,
        "wires": []
    },
    {
        "id": "417ddfae4c3e1e6b",
        "type": "link in",
        "z": "455bfc6c2c30aeae",
        "name": "refresh ins",
        "links": [
            "39963bdaec60f1ee"
        ],
        "x": 3655,
        "y": 580,
        "wires": [
            [
                "8a3a916a9b0d9785"
            ]
        ]
    },
    {
        "id": "b7ba19df86462a66",
        "type": "link out",
        "z": "455bfc6c2c30aeae",
        "name": "get data ins >",
        "mode": "link",
        "links": [
            "b1068847983c1da9",
            "dc459d77a928ea2e",
            "2b6f9ce9b97ab53e"
        ],
        "x": 3845,
        "y": 580,
        "wires": []
    },
    {
        "id": "c7f03ceb117f114c",
        "type": "link in",
        "z": "455bfc6c2c30aeae",
        "name": "refresh outs",
        "links": [
            "39963bdaec60f1ee"
        ],
        "x": 3655,
        "y": 1100,
        "wires": [
            [
                "328dcefd3c7ebbf0"
            ]
        ]
    },
    {
        "id": "c320452b49c5920e",
        "type": "link out",
        "z": "455bfc6c2c30aeae",
        "name": "get data outs >",
        "mode": "link",
        "links": [
            "b1068847983c1da9",
            "dc459d77a928ea2e",
            "2b6f9ce9b97ab53e"
        ],
        "x": 3845,
        "y": 1100,
        "wires": []
    },
    {
        "id": "276c626fed566b1f",
        "type": "ui_table",
        "z": "455bfc6c2c30aeae",
        "group": "b52da2819ad1aaab",
        "name": "Входы",
        "order": 3,
        "width": 8,
        "height": 3,
        "columns": [
            {
                "field": "inSoftware",
                "title": "Программный",
                "width": "33%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "inHardware",
                "title": "Физический",
                "width": "33%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "inOffset",
                "title": "Уставка",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 3990,
        "y": 620,
        "wires": [
            [
                "c4fa7640b26953ea",
                "48f6e4a6d7bf712d"
            ]
        ]
    },
    {
        "id": "6f727b69d4a1584d",
        "type": "ui_table",
        "z": "455bfc6c2c30aeae",
        "group": "e75c15142175c3bc",
        "name": "Выходы",
        "order": 3,
        "width": 8,
        "height": 3,
        "columns": [
            {
                "field": "outSoftware",
                "title": "Программный",
                "width": "33%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "outHardware",
                "title": "Физический",
                "width": "33%",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "outOffset",
                "title": "Уставка",
                "width": "",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 4000,
        "y": 1140,
        "wires": [
            [
                "bcd6604afb1d24ce",
                "6b21f71b7a0be319"
            ]
        ]
    },
    {
        "id": "b46b8e6742b271fa",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1360,
        "y": 2220,
        "wires": [
            [
                "64c789ab755271fc"
            ]
        ]
    },
    {
        "id": "64c789ab755271fc",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "property": "device_statuses.attributes.audioprocessor",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1550,
        "y": 2220,
        "wires": [
            [
                "0fa561e8befa4ef3"
            ]
        ]
    },
    {
        "id": "1bc29dfd86aab680",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1360,
        "y": 2300,
        "wires": [
            [
                "05e0ca97d7028893"
            ]
        ]
    },
    {
        "id": "05e0ca97d7028893",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "property": "device_statuses.attributes.audioprocessor",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1550,
        "y": 2300,
        "wires": [
            [
                "0fbb4c1765dd273a"
            ]
        ]
    },
    {
        "id": "9b8164e501183863",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "property": "device_statuses.attributes.audioprocessor",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1550,
        "y": 2140,
        "wires": [
            [
                "16220b81bbec7e2b"
            ]
        ]
    },
    {
        "id": "2e1ad9fc41d04cca",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1360,
        "y": 2140,
        "wires": [
            [
                "9b8164e501183863"
            ]
        ]
    },
    {
        "id": "43c305f449e4df96",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 1740,
        "wires": [
            [
                "2b3b1c9579711c7f"
            ]
        ]
    },
    {
        "id": "86b2170cfb5c7e13",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 440,
        "y": 1740,
        "wires": [
            [
                "43c305f449e4df96"
            ]
        ]
    },
    {
        "id": "16220b81bbec7e2b",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1720,
        "y": 2140,
        "wires": [
            [
                "7622317968ca161c"
            ]
        ]
    },
    {
        "id": "0fa561e8befa4ef3",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1720,
        "y": 2220,
        "wires": [
            [
                "e38e0c2d0c6731da"
            ]
        ]
    },
    {
        "id": "0fbb4c1765dd273a",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1720,
        "y": 2300,
        "wires": [
            [
                "ef8ed995b4489292"
            ]
        ]
    },
    {
        "id": "2ff236ee76ec6257",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 1300,
        "wires": [
            [
                "11a51041b985cd75"
            ]
        ]
    },
    {
        "id": "9acfa20595297dab",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 760,
        "y": 1300,
        "wires": [
            [
                "2ff236ee76ec6257"
            ]
        ]
    },
    {
        "id": "07bfbfb6b095f83c",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 940,
        "wires": [
            [
                "aa0b321bfc40fd70"
            ]
        ]
    },
    {
        "id": "6b5b2f62b01617bb",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.custom_buttons",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 980,
        "y": 940,
        "wires": [
            [
                "07bfbfb6b095f83c"
            ]
        ]
    },
    {
        "id": "a3bf691013187121",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 1500,
        "wires": [
            [
                "35a9c8d97c85246b"
            ]
        ]
    },
    {
        "id": "a4f739ac344d5832",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.custom_buttons",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 520,
        "y": 1500,
        "wires": [
            [
                "a3bf691013187121"
            ]
        ]
    },
    {
        "id": "dd8e2f3338e01fda",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "STATE?",
        "info": "",
        "x": 1040,
        "y": 1440,
        "wires": []
    },
    {
        "id": "5cc0f645cca2faef",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "event parsing",
        "func": "// Предыдущее состояние выходов\nvar old_isEnabledOut = [\n    msg.data.old_state.attributes.isEnabledOut1,\n    msg.data.old_state.attributes.isEnabledOut2,\n    msg.data.old_state.attributes.isEnabledOut3,\n    msg.data.old_state.attributes.isEnabledOut4\n]\n\n// Новое состояние выходов\nvar new_isEnabledOut = [\n    msg.data.new_state.attributes.isEnabledOut1,\n    msg.data.new_state.attributes.isEnabledOut2,\n    msg.data.new_state.attributes.isEnabledOut3,\n    msg.data.new_state.attributes.isEnabledOut4\n]\n\n// Предыдущее состояние матрицы\nvar old_out = [\n    msg.data.old_state.attributes.out1,\n    msg.data.old_state.attributes.out2,\n    msg.data.old_state.attributes.out3,\n    msg.data.old_state.attributes.out4\n]\n\n// Новое состояние матрицы\nvar new_out = [\n    msg.data.new_state.attributes.out1,\n    msg.data.new_state.attributes.out2,\n    msg.data.new_state.attributes.out3,\n    msg.data.new_state.attributes.out4\n]\n\n// Массив выходных сообщений\nvar messages = []\n\n   \nfor (let i = 0; i < new_out.length; i++) {\n    \n    // Включение/выключение выхода\n    if (old_isEnabledOut[i] != new_isEnabledOut[i] && typeof new_isEnabledOut[i] != \"undefined\") {\n\n        var output = Number(i + 1)\n\n        if (Number(new_isEnabledOut[i]) == 1) {\n            var power = true\n        } else if (Number(new_isEnabledOut[i]) == 0) {\n            var power = false\n        }\n\n        messages.push({\n            output: output,\n            power: power,\n            type: \"set output power\",\n            new_isEnabledOut: new_isEnabledOut,\n            new_out: new_out\n        })\n    }\n\n    // Переключение матрицы\n    if (old_out[i] != new_out[i] && typeof new_out[i] != \"undefined\") {\n\n        var output = Number(i + 1)\n\n        var input = Number(new_out[i])\n\n        messages.push({\n            output: output,\n            input: input,\n            type: \"set input to output\",\n            new_isEnabledOut: new_isEnabledOut,\n            new_out: new_out\n        })\n    }\n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 1560,
        "wires": [
            []
        ]
    },
    {
        "id": "65180de7d9605bf2",
        "type": "delay",
        "z": "455bfc6c2c30aeae",
        "name": "150 ms",
        "pauseType": "delay",
        "timeout": "150",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 4200,
        "y": 400,
        "wires": [
            [
                "e2477159c076c84b"
            ]
        ]
    },
    {
        "id": "49f7f08df22ca509",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "good state?",
        "property": "device_statuses.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 810,
        "y": 2060,
        "wires": [
            [
                "de2d11183d5ff4c3"
            ]
        ]
    },
    {
        "id": "b2993cb49e1e3a71",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "fix (не проверяли)",
        "info": "Тут надо брать state с custom buttons, а не с ama?",
        "x": 1010,
        "y": 900,
        "wires": []
    },
    {
        "id": "a6480e2a2615b322",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "fix",
        "info": "Чтобы в гонке записей статусов устройств никто не перебил изначально записываемый state от фронтенда",
        "x": 970,
        "y": 2060,
        "wires": []
    },
    {
        "id": "4d2942a23b009293",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "Stereo",
        "func": "if ((msg.type == \"set input to output\" || msg.type == \"remove input from output\") && msg.output == 1) {\n    msg.output = 2\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 320,
        "wires": [
            [
                "f40ee1b5d82a87ff"
            ]
        ]
    },
    {
        "id": "53f3b757fad568b1",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "Для стерео",
        "info": "то, что назначается на 1 выход, назначается и на 2\nт.к. у колонки есть L и R каналы",
        "x": 850,
        "y": 280,
        "wires": []
    },
    {
        "id": "f4a56590f64bb37e",
        "type": "api-call-service",
        "z": "455bfc6c2c30aeae",
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "all",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1520,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "4571ea37851328f6",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "fix",
        "info": "queue - all messages",
        "x": 1490,
        "y": 1040,
        "wires": []
    },
    {
        "id": "0770e0799ff3eb91",
        "type": "DataOut",
        "z": "455bfc6c2c30aeae",
        "collection": "d6688dbfdb474a0f",
        "name": "audioprocessor ->",
        "path": "/",
        "error": false,
        "x": 990,
        "y": 1000,
        "wires": [
            [
                "da13e58249bcdfbd"
            ]
        ]
    },
    {
        "id": "48573ab3daeacdf7",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "+ state, data",
        "func": "// var state = new Date()\n// state = state.getTime()\n\nvar data = msg.payload.attributes\ndata[\"entity_id\"] = msg.payload.entity_id\ndata[\"state\"] = Number(msg.state) + 1\ndata[\"isEnabledOut1\"] = 1\ndata[\"isEnabledOut2\"] = 1\ndata[\"isEnabledOut3\"] = 1\ndata[\"isEnabledOut4\"] = 1\n\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\": data\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1330,
        "y": 1000,
        "wires": [
            [
                "f4a56590f64bb37e"
            ]
        ]
    },
    {
        "id": "da13e58249bcdfbd",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomatrix",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1160,
        "y": 1000,
        "wires": [
            [
                "48573ab3daeacdf7"
            ]
        ]
    },
    {
        "id": "03d6e9fb7c8bf157",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "input gain",
        "func": "// ВХОДНЫЕ ПАРАМЕТРЫ:\n// msg.input: int - Номер входа\n// msg.input_gain: float - Уровень чувствительности входа от -72.0 до 12.0\n\n\n// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Input = 299 (0x012B)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0x2B\nmsg.module_type_low = 0x01\n\n// Тип параметра Gain для модуля Input = 1\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x01\nmsg.parameter_type_low = 0x00\n\n// value1 = (номер входа - 1)\n// в формате двух байтов c обратным порядком\nmsg.value1_high = msg.input - 1\nmsg.value1_low = 0x00\n\n// value2 = (Уровень чувствительности * 100), если Уровень чувствительности >= 0\n// value2 = (65536 + Уровень чувствительности * 100), если Уровень чувствительности < 0\n// в формате двух байтов c обратным порядком\nif (msg.input_gain >= 0) {\n    var value2_raw = msg.input_gain * 100\n} else {\n    var value2_raw = 65536 + (msg.input_gain * 100)\n}\nmsg.value2_high = value2_raw % 256\nmsg.value2_low = ~~(value2_raw / 256)\n\nif (msg.value2_low > 255)\n{\n    msg.value2_low = 255\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1540,
        "y": 420,
        "wires": [
            [
                "73c446ccd9abed0b"
            ]
        ]
    },
    {
        "id": "bfccb32ce6bd362b",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "output gain",
        "func": "// ВХОДНЫЕ ПАРАМЕТРЫ:\n// msg.output: int - Номер входа\n// msg.output_gain: float - Уровень чувствительности выхода от -72.0 до 12.0\n\n\n// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Output = 295 (0x0127)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0x27\nmsg.module_type_low = 0x01\n\n// Тип параметра Gain для модуля Output = 1\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x01\nmsg.parameter_type_low = 0x00\n\n// value1 = (номер входа - 1)\n// в формате двух байтов c обратным порядком\nmsg.value1_high = msg.output - 1\nmsg.value1_low = 0x00\n\n// value2 = (Уровень чувствительности * 100), если Уровень чувствительности >= 0\n// value2 = (65536 + Уровень чувствительности * 100), если Уровень чувствительности < 0\n// в формате двух байтов c обратным порядком\nif (msg.output_gain >= 0) {\n    var value2_raw = msg.output_gain * 100\n} else {\n    var value2_raw = 65536 + (msg.output_gain * 100)\n}\nmsg.value2_high = value2_raw % 256\nmsg.value2_low = ~~(value2_raw / 256)\n\nif (msg.value2_low > 255)\n{\n    msg.value2_low = 255\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 520,
        "wires": [
            [
                "73c446ccd9abed0b"
            ]
        ]
    },
    {
        "id": "4d0e8d4d55ee400f",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "set aec gain",
        "func": "// Команда на запись\nmsg.message_type = 0x21\n\n// ID модуля Sound mixer = 166 (0x00A6)\n// в формате двух байтов c обратным порядком\nmsg.module_type_high = 0xA6\nmsg.module_type_low = 0x00\n\n// Тип параметра Mixing gain для модуля Mixer = 2\n// в формате двух байтов c обратным порядком\nmsg.parameter_type_high = 0x02\nmsg.parameter_type_low = 0x00\n\n// Старший байт value1 = номер AEC\n// Старший байт value1 = номер выхода - 1\nmsg.value1_high = msg.aec\nmsg.value1_low = msg.output - 1\n\n// value2 = (Уровень чувствительности * 100), если Уровень чувствительности >= 0\n// value2 = (65535 + Уровень чувствительности * 100), если Уровень чувствительности < 0\n// в формате двух байтов c обратным порядком\nif (msg.aec_gain >= 0) {\n    var value2_raw = msg.aec_gain * 100\n} else {\n    var value2_raw = 65535 + (msg.aec_gain * 100)\n}\nmsg.value2_high = value2_raw % 256\nmsg.value2_low = value2_raw / 256\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 640,
        "wires": [
            [
                "73c446ccd9abed0b"
            ]
        ]
    },
    {
        "id": "033fbe4fd2ec1b50",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 960,
        "wires": [
            [
                "325ce6ef7eada1fb"
            ]
        ]
    },
    {
        "id": "325ce6ef7eada1fb",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 300,
        "y": 960,
        "wires": [
            [
                "2148b98896f99946"
            ]
        ]
    },
    {
        "id": "cc99e324ef8b529e",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "attrs qty",
        "func": "if (Object.keys(msg.data.attributes).length <= 2)\n{\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 960,
        "wires": [
            [
                "0770e0799ff3eb91",
                "6b5b2f62b01617bb"
            ]
        ]
    },
    {
        "id": "c9da35ed44c52fb8",
        "type": "link out",
        "z": "455bfc6c2c30aeae",
        "name": "from button to mute",
        "mode": "link",
        "links": [
            "624977f5c9b7905e"
        ],
        "x": 1035,
        "y": 1360,
        "wires": []
    },
    {
        "id": "2148b98896f99946",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "state",
        "func": "msg.state = Number(msg.data.state)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 960,
        "wires": [
            [
                "5665e171afbba957"
            ]
        ]
    },
    {
        "id": "5665e171afbba957",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 610,
        "y": 960,
        "wires": [
            [
                "cc99e324ef8b529e"
            ]
        ]
    },
    {
        "id": "6c330a923f674d38",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "inputs",
        "payloadType": "flow",
        "x": 220,
        "y": 40,
        "wires": [
            [
                "b3434014d21561d2"
            ]
        ]
    },
    {
        "id": "b3434014d21561d2",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "name": "debug 215",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 410,
        "y": 180,
        "wires": []
    },
    {
        "id": "803dc591c0f03a5a",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "outputs",
        "payloadType": "flow",
        "x": 210,
        "y": 80,
        "wires": [
            [
                "b3434014d21561d2"
            ]
        ]
    },
    {
        "id": "a2ab2606e9a88220",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "outputsToUsb",
        "payloadType": "flow",
        "x": 190,
        "y": 160,
        "wires": [
            [
                "b3434014d21561d2"
            ]
        ]
    },
    {
        "id": "2f2b4a08a44d564c",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "inputsToUsb",
        "payloadType": "flow",
        "x": 200,
        "y": 120,
        "wires": [
            [
                "b3434014d21561d2"
            ]
        ]
    },
    {
        "id": "7115ea804f829fb7",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "audioprocessorModel",
        "payloadType": "flow",
        "x": 170,
        "y": 200,
        "wires": [
            [
                "b3434014d21561d2"
            ]
        ]
    },
    {
        "id": "a05ea27568740434",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 160,
        "wires": [
            [
                "425163e936a8b985"
            ]
        ]
    },
    {
        "id": "ef2ba151df97a72f",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "inputs",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2200,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "10914f7d228c7bed",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 60,
        "wires": [
            [
                "f9cb2cd55d094507"
            ]
        ]
    },
    {
        "id": "40b12d7627eeb4f1",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "outputs",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2210,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "5835cf76e19dfbcd",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 100,
        "wires": [
            [
                "dcdbc09401ac66e9"
            ]
        ]
    },
    {
        "id": "dcdbc09401ac66e9",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "name": "inputsToUsb = [1, 4]",
        "rules": [
            {
                "t": "set",
                "p": "inputsToUsb",
                "pt": "flow",
                "to": "[1, 4]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "b941ee7cc37e79ff",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 200,
        "wires": [
            [
                "3e0cf7b54625826c"
            ]
        ]
    },
    {
        "id": "3e0cf7b54625826c",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "name": "outputsToUsb = [1, 3, 5]",
        "rules": [
            {
                "t": "set",
                "p": "outputsToUsb",
                "pt": "flow",
                "to": "[1, 3, 5]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "ca13cdeb84ced06e",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 260,
        "wires": [
            [
                "eeced343dd90552d"
            ]
        ]
    },
    {
        "id": "eeced343dd90552d",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "name": "audioprocessorModel = clevermic88",
        "rules": [
            {
                "t": "set",
                "p": "audioprocessorModel",
                "pt": "flow",
                "to": "clevermic88",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2070,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "425163e936a8b985",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "1 = \"usb\"",
        "func": "msg.payload = new Map();\n\nmsg.payload.set(1, \"usb\");\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1980,
        "y": 160,
        "wires": [
            [
                "ef2ba151df97a72f"
            ]
        ]
    },
    {
        "id": "f9cb2cd55d094507",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "1 = \"usb\"",
        "func": "msg.payload = new Map();\n\nmsg.payload.set(1, \"usb\");\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1980,
        "y": 60,
        "wires": [
            [
                "40b12d7627eeb4f1"
            ]
        ]
    },
    {
        "id": "c097144d321174bc",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "usb?",
        "property": "output",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1330,
        "y": 180,
        "wires": [
            [
                "506eb9cd5c662f72"
            ],
            [
                "90013be72d5922df"
            ]
        ]
    },
    {
        "id": "506eb9cd5c662f72",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "inputs to usb",
        "func": "var messages = []\n\nfor (var i in flow.get(\"inputsToUsb\")) {\n    if (flow.get(\"audioprocessorModel\") == 'clevermic44') {\n        msg.value1_low = 4\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic88') {\n        msg.value1_low = 8\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic1616') {\n        msg.value1_low = 16\n    }\n\n    if (msg.power == true) {\n        msg.value2_high = 0x01\n    } else {\n        msg.value2_high = 0x00\n    }\n\n    messages.push({\n        \"message_type\": 0x21,\n        \"module_type_high\": 0xA6,\n        \"module_type_low\": 0x00,\n        \"parameter_type_high\": 0x01,\n        \"parameter_type_low\": 0x00,\n        \"value1_high\": flow.get(\"inputsToUsb\")[i] - 1,\n        \"value1_low\": msg.value1_low,\n        \"value2_high\": msg.value2_high,\n        \"value2_low\": 0x00\n    })\n\n    \n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 160,
        "wires": [
            [
                "73c446ccd9abed0b"
            ]
        ]
    },
    {
        "id": "904cc2dc3f022c03",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "usb?",
        "property": "output",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1370,
        "y": 500,
        "wires": [
            [
                "5bcaa950cc40aa87"
            ],
            [
                "bfccb32ce6bd362b"
            ]
        ]
    },
    {
        "id": "5bcaa950cc40aa87",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "usb out gain",
        "func": "var messages = []\n\nfor (var i in flow.get(\"inputsToUsb\")) {\n    if (flow.get(\"audioprocessorModel\") == 'clevermic44') {\n        msg.value1_low = 4\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic88') {\n        msg.value1_low = 8\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic1616') {\n        msg.value1_low = 16\n    }\n\n    if (msg.output_gain >= 0) {\n        var value2_raw = msg.output_gain * 100\n    } else {\n        var value2_raw = 65535 + (msg.output_gain * 100)\n    }\n    msg.value2_high = value2_raw % 256\n    msg.value2_low = value2_raw / 256\n\n    messages.push({\n        \"message_type\": 0x21,\n        \"module_type_high\": 0xA6,\n        \"module_type_low\": 0x00,\n        \"parameter_type_high\": 0x02,\n        \"parameter_type_low\": 0x00,\n        \"value1_high\": flow.get(\"inputsToUsb\")[i] - 1,\n        \"value1_low\": msg.value1_low,\n        \"value2_high\": msg.value2_high,\n        \"value2_low\": msg.value2_low\n    })\n\n    \n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 480,
        "wires": [
            [
                "73c446ccd9abed0b"
            ]
        ]
    },
    {
        "id": "c090747b17a21abd",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "usb?",
        "property": "input",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1330,
        "y": 80,
        "wires": [
            [
                "de5a7595ea3b0d36"
            ],
            [
                "35463285ede61798"
            ]
        ]
    },
    {
        "id": "de5a7595ea3b0d36",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "usb to outputs",
        "func": "var messages = []\n\nfor (var i in flow.get(\"outputsToUsb\")) {\n    if (flow.get(\"audioprocessorModel\") == 'clevermic44') {\n        msg.value1_high = 5\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic88') {\n        msg.value1_high = 9\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic1616') {\n        msg.value1_high = 17\n    }\n    if (msg.power == true) {\n        msg.value2_high = 0x01\n    } else {\n        msg.value2_high = 0x00\n    }\n\n    messages.push({\n        \"message_type\": 0x21,\n        \"module_type_high\": 0xA6,\n        \"module_type_low\": 0x00,\n        \"parameter_type_high\": 0x01,\n        \"parameter_type_low\": 0x00,\n        \"value1_high\": msg.value1_high,\n        \"value1_low\": flow.get(\"outputsToUsb\")[i] - 1,\n        \"value2_high\": msg.value2_high,\n        \"value2_low\": 0x00\n    })\n\n    \n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1520,
        "y": 60,
        "wires": [
            [
                "73c446ccd9abed0b"
            ]
        ]
    },
    {
        "id": "f4687e7243774dba",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "name": "usb?",
        "property": "input",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1370,
        "y": 400,
        "wires": [
            [
                "5a9daba4bb8bb506"
            ],
            [
                "03d6e9fb7c8bf157"
            ]
        ]
    },
    {
        "id": "5a9daba4bb8bb506",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "usb in gain",
        "func": "var messages = []\n\nfor (var i in flow.get(\"outputsToUsb\")) {\n    if (flow.get(\"audioprocessorModel\") == 'clevermic44') {\n        msg.value1_high = 5\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic88') {\n        msg.value1_high = 9\n    } else if (flow.get(\"audioprocessorModel\") == 'clevermic1616') {\n        msg.value1_high = 17\n    }\n\n    if (msg.input_gain >= 0) {\n        var value2_raw = msg.input_gain * 100\n    } else {\n        var value2_raw = 65535 + (msg.input_gain * 100)\n    }\n    msg.value2_high = value2_raw % 256\n    msg.value2_low = value2_raw / 256\n\n    messages.push({\n        \"message_type\": 0x21,\n        \"module_type_high\": 0xA6,\n        \"module_type_low\": 0x00,\n        \"parameter_type_high\": 0x02,\n        \"parameter_type_low\": 0x00,\n        \"value1_high\": msg.value1_high,\n        \"value1_low\": flow.get(\"outputsToUsb\")[i] - 1,\n        \"value2_high\": msg.value2_high,\n        \"value2_low\": msg.value2_low\n    })\n\n    \n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 380,
        "wires": [
            [
                "73c446ccd9abed0b"
            ]
        ]
    },
    {
        "id": "3512008e9319069e",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "inputOffsets",
        "payloadType": "flow",
        "x": 200,
        "y": 240,
        "wires": [
            [
                "b3434014d21561d2"
            ]
        ]
    },
    {
        "id": "a2ed6fedf569ba19",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "outputOffsets",
        "payloadType": "flow",
        "x": 190,
        "y": 280,
        "wires": [
            [
                "b3434014d21561d2"
            ]
        ]
    },
    {
        "id": "3a400bd0ed67fa88",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 300,
        "wires": [
            [
                "406c9d341cd50fda"
            ]
        ]
    },
    {
        "id": "3aba87c15d795ac2",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 340,
        "wires": [
            [
                "226d6799c68e3de0"
            ]
        ]
    },
    {
        "id": "226d6799c68e3de0",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "1: -19",
        "func": "msg.payload = new Map();\n\nmsg.payload.set(1, -19);\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1970,
        "y": 340,
        "wires": [
            [
                "652367bb22c03bbf"
            ]
        ]
    },
    {
        "id": "406c9d341cd50fda",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "1: -20",
        "func": "msg.payload = new Map();\n\nmsg.payload.set(1, -20);\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1970,
        "y": 300,
        "wires": [
            [
                "e7e7d98357b95fc9"
            ]
        ]
    },
    {
        "id": "652367bb22c03bbf",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "outputOffsets",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2230,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "e7e7d98357b95fc9",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "inputOffsets",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2220,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "b6dec30c57773e7a",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1820,
        "y": 380,
        "wires": [
            [
                "9ed82c74268028f4"
            ]
        ]
    },
    {
        "id": "9ed82c74268028f4",
        "type": "change",
        "z": "455bfc6c2c30aeae",
        "name": "aecOffset = -15",
        "rules": [
            {
                "t": "set",
                "p": "aecOffset",
                "pt": "flow",
                "to": "-15",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2000,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "90b36d1893742952",
        "type": "inject",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "aecOffset",
        "payloadType": "flow",
        "x": 210,
        "y": 320,
        "wires": [
            [
                "b3434014d21561d2"
            ]
        ]
    },
    {
        "id": "5caa52078184f5a3",
        "type": "ui_template",
        "z": "455bfc6c2c30aeae",
        "group": "5e769546c6912ed1",
        "name": "checkbox",
        "order": 1,
        "width": 2,
        "height": 6,
        "format": "<script>\n    (function($scope) {\n $scope.sendRow = function(obj) {\n    $scope.send({ \"checkbox\":  obj});\n };\n})(scope);\n</script>\n<form>\n    <fieldset style=\"width:50%\">\n        <legend>Выходы</legend>\n        <div ng-repeat=\"x in msg.outputsToUsb\">\n            <label>{{x.NAME}}\n                    <input  type=\"checkbox\" \n                            style=\"float:left; position: relative; top: 5px;\"\n                            ng-model=\"x.STATE\"\n                            ng-change=\"sendRow({var:x.NAME, state: x.STATE})\">\n                </label>\n        </div>\n    </fieldset>\n</form>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 5140,
        "y": 1480,
        "wires": [
            [
                "bd87b8e3479880ef"
            ]
        ]
    },
    {
        "id": "dafd0ab2cd35104f",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "get outs",
        "func": "let outputsToUsb = [];\nfor (let i = 1; i <= flow.get('outputs').size; i++) {\n    let state = false\n    if (flow.get('outputsToUsb').includes(i))\n    {\n        state = true\n    }\n    outputsToUsb.push({ 'NAME': i.toString(), 'STATE': state}); // Пробел, чтобы названия не совпадали с выходами\n}\n\nmsg.outputsToUsb = outputsToUsb\nmsg.inputs = flow.get(\"inputs\")\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4300,
        "y": 1620,
        "wires": [
            []
        ]
    },
    {
        "id": "2b6f9ce9b97ab53e",
        "type": "link in",
        "z": "455bfc6c2c30aeae",
        "name": "to checkbox",
        "links": [
            "81e3ad27280ab7a6",
            "c320452b49c5920e",
            "b7ba19df86462a66"
        ],
        "x": 4175,
        "y": 1640,
        "wires": [
            [
                "dafd0ab2cd35104f",
                "777ef8a0e5980ea8"
            ]
        ]
    },
    {
        "id": "d28b7b4ab2aca372",
        "type": "comment",
        "z": "455bfc6c2c30aeae",
        "name": "AMA Buttons",
        "info": "",
        "x": 4310,
        "y": 1580,
        "wires": []
    },
    {
        "id": "bd87b8e3479880ef",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "manage USB_in",
        "func": "let outputsToUsb = flow.get('outputsToUsb')\nif (outputsToUsb == undefined)\n{\n    outputsToUsb = []\n}\n\nlet name = Number(msg.checkbox.var)\nlet state = msg.checkbox.state\nif (state)\n{\n    outputsToUsb.push(name)\n}\nelse\n{\n    outputsToUsb.splice(outputsToUsb.indexOf(name), 1)\n}\nflow.set('outputsToUsb', outputsToUsb)\n\nmsg.outputsToUsb = outputsToUsb\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5320,
        "y": 1480,
        "wires": [
            []
        ]
    },
    {
        "id": "c707bce2cfbe6af6",
        "type": "ui_template",
        "z": "455bfc6c2c30aeae",
        "group": "d73db9aefa1d5022",
        "name": "checkbox",
        "order": 1,
        "width": 2,
        "height": 6,
        "format": "<script>\n    (function($scope) {\n $scope.sendRow = function(obj) {\n    $scope.send({ \"checkbox\":  obj});\n };\n})(scope);\n</script>\n<form>\n    <fieldset style=\"width:68%\">\n        <legend>Входы</legend>\n        <div ng-repeat=\"x in msg.inputsToUsb\">\n            <label>{{x.NAME}}\n                <input  type=\"checkbox\"\n                        style=\"float:left; position: relative; top: 5px;\"\n                        ng-model=\"x.STATE\"\n                        ng-change=\"sendRow({var:x.NAME, state: x.STATE})\">\n            </label>\n        </div>\n    </fieldset>\n</form>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 5140,
        "y": 1520,
        "wires": [
            [
                "c1baf60f6d63e4c3"
            ]
        ]
    },
    {
        "id": "777ef8a0e5980ea8",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "get ins",
        "func": "let inputsToUsb = [];\nfor (let i = 1; i <= flow.get('inputs').size; i++) {\n    let state = false\n    if (flow.get('inputsToUsb').includes(i))\n    {\n        state = true\n    }\n    inputsToUsb.push({ 'NAME': i.toString(), 'STATE': state}); // Пробел, чтобы названия не совпадали с выходами\n}\n\nmsg.inputsToUsb = inputsToUsb\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4290,
        "y": 1660,
        "wires": [
            []
        ]
    },
    {
        "id": "c1baf60f6d63e4c3",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "manage USB_out",
        "func": "let inputsToUsb = flow.get('inputsToUsb')\nif (inputsToUsb == undefined)\n{\n    inputsToUsb = []\n}\n\nlet name = Number(msg.checkbox.var)\nlet state = msg.checkbox.state\nif (state)\n{\n    inputsToUsb.push(name)\n}\nelse\n{\n    inputsToUsb.splice(inputsToUsb.indexOf(name), 1)\n}\nflow.set('inputsToUsb', inputsToUsb)\n\nmsg.inputsToUsb = inputsToUsb\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5330,
        "y": 1520,
        "wires": [
            []
        ]
    },
    {
        "id": "ed04aea80c7f637e",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "set Model",
        "func": "flow.set(\"audioprocessorModel\", msg.payload)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4620,
        "y": 1520,
        "wires": [
            [
                "1b737d09550a3c88"
            ]
        ]
    },
    {
        "id": "0fdb5d444acf57af",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "get outs",
        "func": "let outputsToUsb = [];\nfor (let i = 1; i <= msg.size; i++) {\n    let state = false\n    if (flow.get('outputsToUsb').includes(i))\n    {\n        state = true\n    }\n    outputsToUsb.push({ 'NAME': i.toString(), 'STATE': state}); // Пробел, чтобы названия не совпадали с выходами\n}\n\nmsg.outputsToUsb = outputsToUsb\nmsg.inputs = flow.get(\"inputs\")\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4960,
        "y": 1480,
        "wires": [
            [
                "5caa52078184f5a3"
            ]
        ]
    },
    {
        "id": "9db68b98a0e778c1",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "get ins",
        "func": "let inputsToUsb = [];\nfor (let i = 1; i <= msg.size; i++) {\n    let state = false\n    if (flow.get('inputsToUsb').includes(i))\n    {\n        state = true\n    }\n    inputsToUsb.push({ 'NAME': i.toString(), 'STATE': state}); // Пробел, чтобы названия не совпадали с выходами\n}\n\nmsg.inputsToUsb = inputsToUsb\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4950,
        "y": 1520,
        "wires": [
            [
                "c707bce2cfbe6af6"
            ]
        ]
    },
    {
        "id": "b93451ea85a0d531",
        "type": "link in",
        "z": "455bfc6c2c30aeae",
        "name": "> set model",
        "links": [
            "39963bdaec60f1ee"
        ],
        "x": 4505,
        "y": 1480,
        "wires": [
            [
                "0c1b8b89561e2ca4"
            ]
        ]
    },
    {
        "id": "0c1b8b89561e2ca4",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "get Model",
        "func": "msg.payload = flow.get(\"audioprocessorModel\")\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4620,
        "y": 1480,
        "wires": [
            [
                "1b737d09550a3c88",
                "e9b0f6d4b3a9c4a3"
            ]
        ]
    },
    {
        "id": "1b737d09550a3c88",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "set size",
        "func": "if (msg.payload == 'clevermic44') {\n    msg.size = 4\n} else if (msg.payload == 'clevermic88') {\n    msg.size = 8\n} else if (msg.payload == 'clevermic1616') {\n    msg.size = 16\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4800,
        "y": 1500,
        "wires": [
            [
                "0fdb5d444acf57af",
                "9db68b98a0e778c1"
            ]
        ]
    },
    {
        "id": "e9b0f6d4b3a9c4a3",
        "type": "ui_dropdown",
        "z": "455bfc6c2c30aeae",
        "name": "APr model",
        "label": "",
        "tooltip": "",
        "place": "Выберите модель",
        "group": "e1b3f68bc0754e54",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "Clevermic 44D",
                "value": "clevermic44",
                "type": "str"
            },
            {
                "label": "Clevermic 88D",
                "value": "clevermic88",
                "type": "str"
            },
            {
                "label": "Clevermic 1616D",
                "value": "clevermic1616",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 4450,
        "y": 1520,
        "wires": [
            [
                "ed04aea80c7f637e",
                "6d74da8ba618bbc8"
            ]
        ]
    },
    {
        "id": "6d74da8ba618bbc8",
        "type": "link out",
        "z": "455bfc6c2c30aeae",
        "name": "from Apr Model",
        "mode": "link",
        "links": [
            "dc459d77a928ea2e"
        ],
        "x": 4505,
        "y": 1560,
        "wires": []
    },
    {
        "id": "889101a4b59d2b91",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "name": "debug 219",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 4630,
        "y": 1140,
        "wires": []
    },
    {
        "id": "71aa3a85839a98ba",
        "type": "ui_template",
        "z": "455bfc6c2c30aeae",
        "group": "70a61739c2079d6d",
        "name": "checkbox",
        "order": 2,
        "width": 2,
        "height": 5,
        "format": "<script>\n(function($scope) {\n $scope.sendRow = function(obj) {\n    $scope.send({ \"checkbox\":  obj});\n };\n})(scope);\n</script>\n<form>\n    <fieldset style=\"width:68%\">\n    <legend>Выходы</legend>\n        <div ng-repeat=\"x in msg.outputs_aec\">\n            <label>{{x.NAME}}\n                <input  type=\"checkbox\"\n                        style=\"float:left; position: relative; top: 5px;\"\n                        ng-model=\"x.STATE\"\n                        ng-change=\"sendRow({var:x.NAME, state: x.STATE})\">\n            </label>\n        </div>\n    </fieldset>\n</form>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 4820,
        "y": 1320,
        "wires": [
            [
                "53788730fe279c4d"
            ]
        ]
    },
    {
        "id": "596a714d4e644be0",
        "type": "ui_text_input",
        "z": "455bfc6c2c30aeae",
        "name": "AEC level",
        "label": "Уставка",
        "tooltip": "[-72,12]",
        "group": "70a61739c2079d6d",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 4820,
        "y": 1360,
        "wires": [
            [
                "d83d4c10d6456431"
            ]
        ]
    },
    {
        "id": "ac3dc5dd76b04137",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "get aecOffset",
        "func": "msg.payload = flow.get('aecOffset')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4630,
        "y": 1360,
        "wires": [
            [
                "596a714d4e644be0"
            ]
        ]
    },
    {
        "id": "d83d4c10d6456431",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "set aecOffset",
        "func": "flow.set('aecOffset', msg.payload)\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4990,
        "y": 1360,
        "wires": [
            []
        ]
    },
    {
        "id": "dad64ab91c2d161f",
        "type": "switch",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "if audioprocessor.attributes.volumeIndicator is true",
        "property": "audioprocessor.attributes.volumeIndicator",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 490,
        "y": 3320,
        "wires": [
            [
                "9d61750b78f6ab56"
            ]
        ]
    },
    {
        "id": "ca1d2b929f47fbb0",
        "type": "api-current-state",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "audioprocessor",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 520,
        "y": 3400,
        "wires": [
            [
                "dad64ab91c2d161f"
            ]
        ]
    },
    {
        "id": "8f0ae2c87f72b9df",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "debug 231",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 170,
        "y": 3440,
        "wires": []
    },
    {
        "id": "eecd0fa43ee2b601",
        "type": "function",
        "z": "455bfc6c2c30aeae",
        "name": "set micmute",
        "func": "if (msg.payload.data.micmute) {\n    msg.micmute = \"on\"\n    return msg;\n}\nelse {\n    msg.micmute = \"off\"\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 1460,
        "wires": [
            [
                "c9da35ed44c52fb8"
            ]
        ]
    },
    {
        "id": "629e57bcd494539c",
        "type": "delay",
        "z": "455bfc6c2c30aeae",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "5",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": true,
        "outputs": 1,
        "x": 2130,
        "y": 540,
        "wires": [
            [
                "582bc3e43662af5a"
            ]
        ]
    },
    {
        "id": "a12f9dfe7d4ef7ee",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "debug 237",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1790,
        "y": 3120,
        "wires": []
    },
    {
        "id": "c2e23d017ee3fa22",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "debug 238",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1590,
        "y": 2960,
        "wires": []
    },
    {
        "id": "d608d44e4c94b308",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "debug 239",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2490,
        "y": 3220,
        "wires": []
    },
    {
        "id": "deb7a5f4392c4ea2",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "debug 240",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1710,
        "y": 3220,
        "wires": []
    },
    {
        "id": "28918d78d969e786",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "debug 241",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1490,
        "y": 3260,
        "wires": []
    },
    {
        "id": "1319888d7a313f4c",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "debug 242",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1170,
        "y": 3240,
        "wires": []
    },
    {
        "id": "2139ad3966b0e0e0",
        "type": "debug",
        "z": "455bfc6c2c30aeae",
        "d": true,
        "name": "debug 243",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 3220,
        "wires": []
    },
    {
        "id": "095b8c3c52affec4",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "Состояние TCGroup",
        "info": "",
        "x": 160,
        "y": 80,
        "wires": []
    },
    {
        "id": "cab5b23f45f466d7",
        "type": "server-state-changed",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg_keyboard",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.tcg_keyboard",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "seconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 130,
        "y": 480,
        "wires": [
            [
                "2bb65ab2a1cde4d6"
            ]
        ]
    },
    {
        "id": "2bb65ab2a1cde4d6",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "Формирование URL",
        "func": "var prefix = \"http://\"\nif (flow.get('secure'))\n{\n    prefix = \"https://\"\n}\nif (msg.payload.new_state.attributes.button == \"hangup\") {\n    msg.url = prefix + global.get(\"tcgroup_ip\") + \"/api/?cmd=hangup\"\n} else if (msg.payload.new_state.attributes.button == \"dial\") {\n    msg.url = prefix + global.get(\"tcgroup_ip\") + \"/api/?cmd=accept\"\n} else {\n    msg.url = prefix + global.get(\"tcgroup_ip\") + \"/api/?key=\" + msg.payload.new_state.attributes.button\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 480,
        "wires": [
            [
                "ece8424fd0b4393e"
            ]
        ]
    },
    {
        "id": "f4fb81f882833974",
        "type": "server-state-changed",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg_setter",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.tcg_setter",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 120,
        "y": 720,
        "wires": [
            [
                "1f3782d599932c85"
            ]
        ]
    },
    {
        "id": "5cfba24d86d3e6a3",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "Сброс call",
        "func": "msg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\":\n    {\n        \"entity_id\": \"sensor.tcg_setter\",\n        \"call\": null,\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 760,
        "wires": [
            [
                "73d9be89c0ea60ed"
            ]
        ]
    },
    {
        "id": "73d9be89c0ea60ed",
        "type": "api-call-service",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg_setter",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 880,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "b77857aaa9dd7b5b",
        "type": "http request",
        "z": "e4fac40aa2dddfeb",
        "name": "Отправка POST-запроса",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "551589e82f0e975d",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "digest",
        "senderr": false,
        "headers": [],
        "x": 750,
        "y": 660,
        "wires": [
            [
                "ecf5cc402e564a39"
            ]
        ]
    },
    {
        "id": "e8aae55eb4643bdf",
        "type": "inject",
        "z": "e4fac40aa2dddfeb",
        "name": "",
        "props": [],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 120,
        "wires": [
            [
                "c390411918bf605e"
            ]
        ]
    },
    {
        "id": "c390411918bf605e",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "msg.url для video.json",
        "func": "msg.url = \"http://\" + global.get(\"tcgroup_ip\") + \"/video.json\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 120,
        "wires": [
            [
                "58651bf9c3b52b90"
            ]
        ]
    },
    {
        "id": "58651bf9c3b52b90",
        "type": "http request",
        "z": "e4fac40aa2dddfeb",
        "name": "http://.../video.json",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "0da1bcc0b8679e07",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "digest",
        "senderr": false,
        "headers": [],
        "x": 610,
        "y": 120,
        "wires": [
            [
                "fb8959ee08567ee2"
            ]
        ]
    },
    {
        "id": "fb8959ee08567ee2",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "+ msg.video",
        "func": "msg.video = JSON.parse(msg.payload)\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 120,
        "wires": [
            [
                "2f6e787945b08d1a"
            ]
        ]
    },
    {
        "id": "2f6e787945b08d1a",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "msg.url для audio.json",
        "func": "msg.url = \"http://\" + global.get(\"tcgroup_ip\") + \"/audio.json\"\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 160,
        "wires": [
            [
                "915a77c776400bf7"
            ]
        ]
    },
    {
        "id": "915a77c776400bf7",
        "type": "http request",
        "z": "e4fac40aa2dddfeb",
        "name": "http://.../audio.json",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "0aba6329bf5a0d4f",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "digest",
        "senderr": false,
        "headers": [],
        "x": 610,
        "y": 160,
        "wires": [
            [
                "dff54f4307ba7b08"
            ]
        ]
    },
    {
        "id": "dff54f4307ba7b08",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "+ msg.audio",
        "func": "msg.audio = JSON.parse(msg.payload)\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 160,
        "wires": [
            [
                "0959b39380462c28"
            ]
        ]
    },
    {
        "id": "94a75859b3b52898",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "msg.url для connections.json",
        "func": "msg.url = \"http://\" + global.get(\"tcgroup_ip\") + \"/connections.json\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 240,
        "wires": [
            [
                "e9b840fa0f6946d0"
            ]
        ]
    },
    {
        "id": "e9b840fa0f6946d0",
        "type": "http request",
        "z": "e4fac40aa2dddfeb",
        "name": "http://.../connections.json",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "dd3fe36ba9957e32",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "digest",
        "senderr": false,
        "headers": [],
        "x": 630,
        "y": 240,
        "wires": [
            [
                "ee6e9591e59a7af6"
            ]
        ]
    },
    {
        "id": "ee6e9591e59a7af6",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "+ msg.connections",
        "func": "msg.connections = JSON.parse(msg.payload)\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 240,
        "wires": [
            [
                "f8a4bffd22ef3090",
                "8425ac98d69f39fb"
            ]
        ]
    },
    {
        "id": "0959b39380462c28",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "msg.url для sysinfo.json",
        "func": "msg.url = \"http://\" + global.get(\"tcgroup_ip\") + \"/sysinfo.json\"\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 200,
        "wires": [
            [
                "ed1a4725b2b4d91e"
            ]
        ]
    },
    {
        "id": "ed1a4725b2b4d91e",
        "type": "http request",
        "z": "e4fac40aa2dddfeb",
        "name": "http://.../sysinfo.json",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "031803e327f8c64f",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "digest",
        "senderr": false,
        "headers": [],
        "x": 620,
        "y": 200,
        "wires": [
            [
                "6fc11f6a7a1c9d51"
            ]
        ]
    },
    {
        "id": "6fc11f6a7a1c9d51",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "+ msg.sysinfo",
        "func": "msg.sysinfo = JSON.parse(msg.payload)\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 200,
        "wires": [
            [
                "94a75859b3b52898"
            ]
        ]
    },
    {
        "id": "b3c71e85aeecc503",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "+ camera, mic, speaker, audiolevel, conference, pip, presentation, standby",
        "func": "let camera = !(msg.video[\"camera\"][\"mute\"])\n\nlet mic = !(msg.audio[\"audio\"][\"capture\"][\"mute\"])\n\nlet speaker = !(msg.audio[\"audio\"][\"render\"][\"mute\"])\n\nlet audiolevel_raw = msg.audio[\"audio\"][\"render\"][\"level\"]\nlet audiolevel = Math.round((audiolevel_raw[0] / audiolevel_raw[1]) * 100)\n\nlet conference = null\nif (msg.connections[\"connection_list\"].length == 0) {\n    conference = null\n} else {\n    conference = msg.connections[\"connection_list\"]\n}\n\nlet pip = !(msg.video[\"camera\"][\"hide\"])\n\nlet presentation = msg.video[\"presentation\"][\"outgoing\"]\n\nlet standby = msg.sysinfo.sleep\n\n/*\nif (camera != msg.tcg_getter.attributes.camera)\n{\n    node.warn('camera')\n}\nif (mic != msg.tcg_getter.attributes.mic)\n{\n    node.warn('mic')\n}\nif (speaker != msg.tcg_getter.attributes.speaker)\n{\n    node.warn('speaker')\n}\nif (audiolevel != msg.tcg_getter.attributes.audiolevel)\n{\n    node.warn('audiolevel')\n}\nif (conference != msg.tcg_getter.attributes.conference)\n{\n    node.warn('conference')\n}\nif (pip != msg.tcg_getter.attributes.pip)\n{\n    node.warn('pip')\n}\nif (presentation != msg.tcg_getter.attributes.presentation)\n{\n    node.warn('presentation')\n}\nif (standby != msg.tcg_getter.attributes.standby)\n{\n    node.warn('standby')\n}\n*/\n\n\nif (camera != msg.tcg_getter.attributes.camera ||\n    mic != msg.tcg_getter.attributes.mic ||\n    speaker != msg.tcg_getter.attributes.speaker ||\n    audiolevel != msg.tcg_getter.attributes.audiolevel ||\n    conference != msg.tcg_getter.attributes.conference ||\n    pip != msg.tcg_getter.attributes.pip ||\n    presentation != msg.tcg_getter.attributes.presentation ||\n    standby != msg.tcg_getter.attributes.standby) {\n    msg.payload = {\n        \"domain\": \"python_script\",\n        \"service\": \"set_state\",\n        \"data\":\n        {\n            \"entity_id\": \"sensor.tcg_getter\",\n            // \"state\": Number(msg.state) + 1,\n            \"state\": Number(msg.tcg_getter.state) + 1,\n            \"camera\": camera,\n            \"mic\": mic,\n            \"speaker\": speaker,\n            \"conference\": conference,\n            \"audiolevel\": audiolevel,\n            \"pip\": pip,\n            \"presentation\": presentation,\n            \"standby\": standby\n        }\n    }\n\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 300,
        "wires": [
            [
                "390f6bc9d91a56f5"
            ]
        ]
    },
    {
        "id": "390f6bc9d91a56f5",
        "type": "api-call-service",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg_getter",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1620,
        "y": 300,
        "wires": [
            [
                "9f1a5bdbc66762df"
            ]
        ]
    },
    {
        "id": "6215d9d91de5354a",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "Нажатия кнопок TCGroup",
        "info": "",
        "x": 170,
        "y": 440,
        "wires": []
    },
    {
        "id": "e716cedacb93e270",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "Звонок с TCGroup",
        "info": "",
        "x": 150,
        "y": 680,
        "wires": []
    },
    {
        "id": "1f3782d599932c85",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "Разбор команды",
        "func": "var prefix = \"http://\"\nif (flow.get('secure')) {\n    prefix = \"https://\"\n}\n\nlet call = msg.payload.new_state.attributes.call\nlet standby = msg.payload.new_state.attributes.standby\n\nif (call) {\n    msg.cmd_type = \"call\"\n    if (call[0] == \"link\") {\n        msg.url = prefix + global.get(\"tcgroup_ip\") + \"/cmd\"\n        msg.address = call[1].split(\"/\")\n        msg.payload = \"trydial 0 00\" + msg.address[msg.address.length - 1] + \"@\" + msg.server\n    } else {\n        msg.url = prefix + global.get(\"tcgroup_ip\") + \"/cmd\"\n        msg.payload = \"trydial 0 \" + call[1]\n    }\n    return msg\n}\n\n\nif (standby === true) {\n    msg.cmd_type = \"standby\"\n    msg.payload = \"set sleep try\"\n    msg.url = prefix + global.get(\"tcgroup_ip\") + \"/cmd\"\n    return msg\n} else {\n    msg.cmd_type = \"standby\"\n    msg.url = prefix + global.get(\"tcgroup_ip\") + \"/api/?key=power\"\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 720,
        "wires": [
            [
                "3860b62b567ad8c7"
            ]
        ]
    },
    {
        "id": "9bc833dee4e7ee30",
        "type": "server-state-changed",
        "z": "e4fac40aa2dddfeb",
        "name": "custom_buttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.custom_buttons",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "cbtns",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 140,
        "y": 620,
        "wires": [
            [
                "ffc99177e50d9c57"
            ]
        ]
    },
    {
        "id": "ffc99177e50d9c57",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "Формирование URL",
        "func": "var prefix = \"http://\"\nif (flow.get('secure')) {\n    prefix = \"https://\"\n}\n\nlet group_scene = msg.cbtns.new_state.attributes.group\n\nif (group_scene) {\n    msg.url = prefix + global.get(\"tcgroup_ip\") + \"/api/?key=home\"\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 620,
        "wires": [
            [
                "b77857aaa9dd7b5b"
            ]
        ]
    },
    {
        "id": "ce57d2db16f44d4c",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "Нажатие кнопки Home на TCGroup при вызове кастомной сцены Group",
        "info": "",
        "x": 320,
        "y": 580,
        "wires": []
    },
    {
        "id": "3860b62b567ad8c7",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "cmd_type",
        "property": "cmd_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "standby",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "call",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 500,
        "y": 720,
        "wires": [
            [
                "b77857aaa9dd7b5b"
            ],
            [
                "5cfba24d86d3e6a3",
                "d8e73eaf23aa01ba"
            ]
        ]
    },
    {
        "id": "d8e73eaf23aa01ba",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "Sip -> sip",
        "func": "msg.payload = msg.payload.replace(\"Sip\", \"sip\")\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 720,
        "wires": [
            [
                "b77857aaa9dd7b5b"
            ]
        ]
    },
    {
        "id": "f213037c12848808",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "+ old_status, new_status, standby",
        "func": "msg.prev_status = msg.device_statuses.attributes.tcg\n\nmsg.new_status = msg.payload\n\nmsg.standby = msg.standby.attributes.standby\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 1060,
        "wires": [
            [
                "f83b4739c2eb8ee5"
            ]
        ]
    },
    {
        "id": "4998de9a7e543af5",
        "type": "api-current-state",
        "z": "e4fac40aa2dddfeb",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 640,
        "y": 940,
        "wires": [
            [
                "a4e919cec40c81ec"
            ]
        ]
    },
    {
        "id": "70dea9d67e6f0990",
        "type": "api-call-service",
        "z": "e4fac40aa2dddfeb",
        "name": "device_statuses.tcg = 0",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"tcg\":0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1810,
        "y": 1080,
        "wires": [
            []
        ]
    },
    {
        "id": "441cb815501ef2c7",
        "type": "api-current-state",
        "z": "e4fac40aa2dddfeb",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 620,
        "y": 1020,
        "wires": [
            [
                "f213037c12848808"
            ]
        ]
    },
    {
        "id": "85912e3d961fee99",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "payload",
        "func": "msg.payload = global.get(\"tcgroup_ip\")\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 940,
        "wires": [
            [
                "d92f1e9cafafd932"
            ]
        ]
    },
    {
        "id": "d92f1e9cafafd932",
        "type": "ping",
        "z": "e4fac40aa2dddfeb",
        "protocol": "IPv4",
        "mode": "triggered",
        "name": "",
        "host": "",
        "timer": "2",
        "inputs": 1,
        "x": 470,
        "y": 940,
        "wires": [
            [
                "4998de9a7e543af5"
            ]
        ]
    },
    {
        "id": "f132fccb3cf3e103",
        "type": "inject",
        "z": "e4fac40aa2dddfeb",
        "name": "ping >",
        "props": [],
        "repeat": "2",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 120,
        "y": 940,
        "wires": [
            [
                "85912e3d961fee99"
            ]
        ]
    },
    {
        "id": "9e39b9422ef7139f",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "switch msg.standby",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turning on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turning off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 990,
        "y": 1160,
        "wires": [
            [
                "436efa250a2f42cb"
            ],
            [
                "5a41c24d9d83c336"
            ],
            [
                "5a41c24d9d83c336"
            ],
            [
                "8b2f84dd2a92caa7"
            ]
        ]
    },
    {
        "id": "e203d3d2dd20ee14",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "1. on",
        "info": "",
        "x": 950,
        "y": 1220,
        "wires": []
    },
    {
        "id": "d9d34b4c09fc7a67",
        "type": "api-call-service",
        "z": "e4fac40aa2dddfeb",
        "name": "device_statuses.tcg = 1",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"tcg\":1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1810,
        "y": 1160,
        "wires": [
            []
        ]
    },
    {
        "id": "2ecb4e1b96b29535",
        "type": "api-call-service",
        "z": "e4fac40aa2dddfeb",
        "name": "device_statuses.tcg = 2",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"tcg\":2}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1810,
        "y": 1240,
        "wires": [
            []
        ]
    },
    {
        "id": "f64d1dbf48ebf9c4",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "2. turning on",
        "info": "",
        "x": 970,
        "y": 1260,
        "wires": []
    },
    {
        "id": "da2c9abe5f494a36",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "3. turning off",
        "info": "",
        "x": 970,
        "y": 1300,
        "wires": []
    },
    {
        "id": "cc2ed98fd782e8d6",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "4. off",
        "info": "",
        "x": 950,
        "y": 1340,
        "wires": []
    },
    {
        "id": "9371e36f0f7d40ca",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "Отслеживание статуса",
        "info": "",
        "x": 160,
        "y": 900,
        "wires": []
    },
    {
        "id": "f83b4739c2eb8ee5",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "new_status == false",
        "property": "new_status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "false",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 740,
        "y": 1100,
        "wires": [
            [
                "436efa250a2f42cb"
            ],
            [
                "9e39b9422ef7139f"
            ]
        ]
    },
    {
        "id": "669f523043f8f737",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "Нужно добавить отправку TCGroup в StandBy",
        "info": "",
        "x": 240,
        "y": 1000,
        "wires": []
    },
    {
        "id": "98f3842d21c3f61f",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "conference",
        "property": "tcg_getter.attributes.conference[0].call_state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "confirmed",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setup",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 710,
        "y": 1680,
        "wires": [
            [
                "d8aed46cfb1e7c20"
            ],
            [
                "d8aed46cfb1e7c20"
            ]
        ]
    },
    {
        "id": "346174f8c589f9b0",
        "type": "server-state-changed",
        "z": "e4fac40aa2dddfeb",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.standby",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 130,
        "y": 1680,
        "wires": [
            [
                "53c78fbba599b981"
            ]
        ]
    },
    {
        "id": "b350595fe2555ecb",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "Прекращение звонка",
        "info": "",
        "x": 180,
        "y": 1640,
        "wires": []
    },
    {
        "id": "f8a4bffd22ef3090",
        "type": "api-current-state",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg_getter",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.tcg_getter",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "tcg_getter",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1060,
        "y": 240,
        "wires": [
            [
                "b45e6a1a7a543ec8"
            ]
        ]
    },
    {
        "id": "5a41c24d9d83c336",
        "type": "api-current-state",
        "z": "e4fac40aa2dddfeb",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1240,
        "y": 1160,
        "wires": [
            [
                "9e64b98f59427252"
            ]
        ]
    },
    {
        "id": "9e64b98f59427252",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "",
        "property": "device_statuses.attributes.tcg",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1430,
        "y": 1160,
        "wires": [
            [
                "9582886e784da34b"
            ]
        ]
    },
    {
        "id": "8b2f84dd2a92caa7",
        "type": "api-current-state",
        "z": "e4fac40aa2dddfeb",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1240,
        "y": 1240,
        "wires": [
            [
                "8ce42ad3bbfc113e"
            ]
        ]
    },
    {
        "id": "8ce42ad3bbfc113e",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "",
        "property": "device_statuses.attributes.tcg",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "2",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1430,
        "y": 1240,
        "wires": [
            [
                "18fc26f8ebede2f9"
            ]
        ]
    },
    {
        "id": "f79cb56b7af799fc",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "",
        "property": "device_statuses.attributes.tcg",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1430,
        "y": 1080,
        "wires": [
            [
                "4dd96c6615db02cf"
            ]
        ]
    },
    {
        "id": "436efa250a2f42cb",
        "type": "api-current-state",
        "z": "e4fac40aa2dddfeb",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1240,
        "y": 1080,
        "wires": [
            [
                "f79cb56b7af799fc"
            ]
        ]
    },
    {
        "id": "4dd96c6615db02cf",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 1080,
        "wires": [
            [
                "70dea9d67e6f0990"
            ]
        ]
    },
    {
        "id": "9582886e784da34b",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 1160,
        "wires": [
            [
                "d9d34b4c09fc7a67"
            ]
        ]
    },
    {
        "id": "18fc26f8ebede2f9",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "state + 1",
        "func": "msg.state = Number(msg.device_statuses.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 1240,
        "wires": [
            [
                "2ecb4e1b96b29535"
            ]
        ]
    },
    {
        "id": "b45e6a1a7a543ec8",
        "type": "api-current-state",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg_setter",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.tcg_setter",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1220,
        "y": 240,
        "wires": [
            [
                "b3c71e85aeecc503"
            ]
        ]
    },
    {
        "id": "a4e919cec40c81ec",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "good state?",
        "property": "device_statuses.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 630,
        "y": 980,
        "wires": [
            [
                "441cb815501ef2c7"
            ]
        ]
    },
    {
        "id": "c4b8c2014f17e755",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "fix",
        "info": "Чтобы в гонке записей статусов устройств никто не перебил изначально записываемый state от фронтенда",
        "x": 790,
        "y": 980,
        "wires": []
    },
    {
        "id": "977c1d042bd35c8c",
        "type": "inject",
        "z": "e4fac40aa2dddfeb",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1290,
        "y": 740,
        "wires": [
            [
                "642d928687524268"
            ]
        ]
    },
    {
        "id": "642d928687524268",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "msg.url для video.json",
        "func": "msg.url = \"https://\" + global.get(\"tcgroup_ip\") + \"/video.json\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 740,
        "wires": [
            [
                "3970ed95f5e556e4"
            ]
        ]
    },
    {
        "id": "3970ed95f5e556e4",
        "type": "http request",
        "z": "e4fac40aa2dddfeb",
        "name": "http://.../video.json",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "4f6d1b4955f77a17",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "digest",
        "senderr": false,
        "headers": [],
        "x": 1750,
        "y": 740,
        "wires": [
            [
                "38dbc21d4d14dea8"
            ]
        ]
    },
    {
        "id": "8ecedf95b9c91d1f",
        "type": "debug",
        "z": "e4fac40aa2dddfeb",
        "name": "debug 194",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2130,
        "y": 720,
        "wires": []
    },
    {
        "id": "38dbc21d4d14dea8",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "",
        "property": "statusCode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "401",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1930,
        "y": 740,
        "wires": [
            [
                "8ecedf95b9c91d1f"
            ],
            [
                "5424f1f55845bef6"
            ]
        ]
    },
    {
        "id": "ad9f3579c95c5f17",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "401",
        "info": "",
        "x": 1970,
        "y": 700,
        "wires": []
    },
    {
        "id": "5424f1f55845bef6",
        "type": "debug",
        "z": "e4fac40aa2dddfeb",
        "name": "debug 195",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2130,
        "y": 760,
        "wires": []
    },
    {
        "id": "d2f7bfb53175308e",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "state + 1",
        "func": "var state = msg.standby.state\nmsg = {}\nmsg.state = Number(state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1700,
        "y": 360,
        "wires": [
            [
                "a3e0feba8c46f092"
            ]
        ]
    },
    {
        "id": "a3e0feba8c46f092",
        "type": "api-call-service",
        "z": "e4fac40aa2dddfeb",
        "name": "SB turningoff",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.standby\",\"state\":{{state}},\"standby\":\"turningoff\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 1870,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "58457c2e4f1be9f5",
        "type": "api-current-state",
        "z": "e4fac40aa2dddfeb",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1340,
        "y": 360,
        "wires": [
            [
                "8faed38697fa8e39"
            ]
        ]
    },
    {
        "id": "8faed38697fa8e39",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "standby == on",
        "property": "standby.attributes.standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1520,
        "y": 360,
        "wires": [
            [
                "d2f7bfb53175308e"
            ]
        ]
    },
    {
        "id": "bec2585b633e2740",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "264983",
        "info": "",
        "x": 1850,
        "y": 320,
        "wires": []
    },
    {
        "id": "73c53d08352b2fb8",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "d": true,
        "name": "false",
        "func": "flow.set('secure', false)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1450,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "6c0339218f6f3f9f",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "d": true,
        "name": "true",
        "func": "flow.set('secure', true)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1450,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "2de5da35090439e1",
        "type": "inject",
        "z": "e4fac40aa2dddfeb",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1300,
        "y": 820,
        "wires": [
            [
                "73c53d08352b2fb8"
            ]
        ]
    },
    {
        "id": "184944d1fb461a03",
        "type": "inject",
        "z": "e4fac40aa2dddfeb",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1300,
        "y": 860,
        "wires": [
            [
                "6c0339218f6f3f9f"
            ]
        ]
    },
    {
        "id": "ecf5cc402e564a39",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "statusCode == 302",
        "property": "statusCode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "302",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 990,
        "y": 660,
        "wires": [
            [
                "fa93c2a7d8c3abe4"
            ]
        ]
    },
    {
        "id": "fa93c2a7d8c3abe4",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "secure = true",
        "func": "flow.set('secure', true)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1190,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "8425ac98d69f39fb",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "msg.url для connections.json",
        "func": "msg.url = \"http://\" + global.get(\"tcgroup_ip\") + \"/config.json\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 280,
        "wires": [
            [
                "725bc9e969636952"
            ]
        ]
    },
    {
        "id": "725bc9e969636952",
        "type": "http request",
        "z": "e4fac40aa2dddfeb",
        "name": "http://.../connections.json",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "dd3fe36ba9957e32",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "digest",
        "senderr": false,
        "headers": [],
        "x": 630,
        "y": 280,
        "wires": [
            [
                "3ef0d3456fa32cbc"
            ]
        ]
    },
    {
        "id": "3ef0d3456fa32cbc",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "+ msg.connections",
        "func": "msg.config = JSON.parse(msg.payload)\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 320,
        "wires": [
            [
                "8e438bd07ad782f0"
            ]
        ]
    },
    {
        "id": "8e438bd07ad782f0",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "set secure",
        "func": "flow.set('secure', msg.config.config.httpd.https.enable)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "53c78fbba599b981",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "standby == turningon",
        "property": "standby.new_state.attributes.standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "turningon",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 300,
        "y": 1680,
        "wires": [
            [
                "45344341656c6904"
            ]
        ]
    },
    {
        "id": "d8aed46cfb1e7c20",
        "type": "api-current-state",
        "z": "e4fac40aa2dddfeb",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.tcg_keyboard",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 900,
        "y": 1680,
        "wires": [
            [
                "a340ca34bf63d218"
            ]
        ]
    },
    {
        "id": "45344341656c6904",
        "type": "api-current-state",
        "z": "e4fac40aa2dddfeb",
        "name": "get conference",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.tcg_getter",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "tcg_getter",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 520,
        "y": 1680,
        "wires": [
            [
                "98f3842d21c3f61f"
            ]
        ]
    },
    {
        "id": "a340ca34bf63d218",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "Прекращение звонка",
        "func": "msg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\":\n    {\n        \"entity_id\": \"sensor.tcg_keyboard\",\n        \"state\": Number(msg.state) + 1,\n        \"button\": \"hangup\",\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 1680,
        "wires": [
            [
                "93b83402a015013e"
            ]
        ]
    },
    {
        "id": "93b83402a015013e",
        "type": "api-call-service",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg_keyboard",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1300,
        "y": 1680,
        "wires": [
            []
        ]
    },
    {
        "id": "9f1a5bdbc66762df",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "conference",
        "property": "tcg_getter.attributes.conference[0].call_state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "setup",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "confirmed",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1150,
        "y": 360,
        "wires": [
            [
                "58457c2e4f1be9f5"
            ],
            [
                "58457c2e4f1be9f5"
            ]
        ]
    },
    {
        "id": "024b2276a6f2d1de",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "switch msg.standby",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "turningoff",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "turningon",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1150,
        "y": 1960,
        "wires": [
            [
                "798778cc5ed79b90"
            ],
            [
                "f754f8b10fe0b1d5"
            ]
        ]
    },
    {
        "id": "241e2de74bdd0431",
        "type": "server-state-changed",
        "z": "e4fac40aa2dddfeb",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.standby",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 130,
        "y": 1960,
        "wires": [
            [
                "f3783c95b272a6f6"
            ]
        ]
    },
    {
        "id": "ce18c008a45e37b8",
        "type": "api-call-service",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg_setter standby OFF",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.tcg_setter\",\"state\":\"{{state}}\",\"standby\":false}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1650,
        "y": 1940,
        "wires": [
            []
        ]
    },
    {
        "id": "f3783c95b272a6f6",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "+ state, standby",
        "func": "var state = new Date()\nmsg.state = state.getTime()\n\nmsg.standby = msg.standby.new_state.attributes.standby\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 1960,
        "wires": [
            [
                "4df5ab866f331c39"
            ]
        ]
    },
    {
        "id": "5f326f64eabe7c43",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "2. standby == \"turning on\"",
        "info": "",
        "x": 1170,
        "y": 1920,
        "wires": []
    },
    {
        "id": "9377939af2f2864a",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "1. standby == \"turning off\"",
        "info": "",
        "x": 1170,
        "y": 1880,
        "wires": []
    },
    {
        "id": "35bd25791641afe3",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "Режим StandBy",
        "info": "",
        "x": 160,
        "y": 1920,
        "wires": []
    },
    {
        "id": "aaebf5dfe38b7531",
        "type": "api-call-service",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg_setter standby ON",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.tcg_setter\",\"state\":\"{{state}}\",\"standby\":true}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1640,
        "y": 1980,
        "wires": [
            []
        ]
    },
    {
        "id": "7b259219c90f6b5a",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 1960,
        "wires": [
            [
                "2f64f8a94912f615"
            ]
        ]
    },
    {
        "id": "cc52cde67c33b04e",
        "type": "api-current-state",
        "z": "e4fac40aa2dddfeb",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.tcg_setter",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 640,
        "y": 1960,
        "wires": [
            [
                "7b259219c90f6b5a"
            ]
        ]
    },
    {
        "id": "4df5ab866f331c39",
        "type": "delay",
        "z": "e4fac40aa2dddfeb",
        "name": "",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 480,
        "y": 1960,
        "wires": [
            [
                "cc52cde67c33b04e"
            ]
        ]
    },
    {
        "id": "ece8424fd0b4393e",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "key",
        "property": "payload.new_state.attributes.button",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "hangup",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 510,
        "y": 480,
        "wires": [
            [
                "831a35818a8f95cb"
            ],
            [
                "0c1a1f55b0998361"
            ]
        ]
    },
    {
        "id": "831a35818a8f95cb",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "* 2",
        "func": "var msgs = [msg, msg]\nreturn [msgs]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 460,
        "wires": [
            [
                "0c1a1f55b0998361"
            ]
        ]
    },
    {
        "id": "0c1a1f55b0998361",
        "type": "delay",
        "z": "e4fac40aa2dddfeb",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "6",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 710,
        "y": 520,
        "wires": [
            [
                "b77857aaa9dd7b5b"
            ]
        ]
    },
    {
        "id": "740457a4894959e5",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "hangup",
        "info": "",
        "x": 510,
        "y": 440,
        "wires": []
    },
    {
        "id": "fc5bbba082ce5f81",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "otherwise",
        "info": "",
        "x": 520,
        "y": 520,
        "wires": []
    },
    {
        "id": "798778cc5ed79b90",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg standby == true",
        "property": "tcg_getter.attributes.standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1390,
        "y": 1940,
        "wires": [
            [
                "ce18c008a45e37b8"
            ]
        ]
    },
    {
        "id": "f754f8b10fe0b1d5",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg standby == false",
        "property": "tcg_getter.attributes.standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1400,
        "y": 1980,
        "wires": [
            [
                "aaebf5dfe38b7531"
            ]
        ]
    },
    {
        "id": "2f64f8a94912f615",
        "type": "api-current-state",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg_getter",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.tcg_getter",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "tcg_getter",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 960,
        "y": 1960,
        "wires": [
            [
                "024b2276a6f2d1de"
            ]
        ]
    },
    {
        "id": "722a467ec625abdd",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "267050",
        "info": "",
        "x": 1390,
        "y": 1900,
        "wires": []
    },
    {
        "id": "fde331333b7ef0b2",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "+ state",
        "func": "var data = {}\ndata[\"entity_id\"] = 'sensor.tcg_setter'\ndata[\"state\"] = Number(msg.state) + 1\nmsg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\": data\n}\n\nreturn msg\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 1500,
        "wires": [
            [
                "57857654fae4a9bd"
            ]
        ]
    },
    {
        "id": "0fa9c28bc325f0dc",
        "type": "api-current-state",
        "z": "e4fac40aa2dddfeb",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.tcg_setter",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 980,
        "y": 1500,
        "wires": [
            [
                "fde331333b7ef0b2"
            ]
        ]
    },
    {
        "id": "3e898ca8e2553701",
        "type": "server-state-changed",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg_getter",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.tcg_getter",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": false,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 140,
        "y": 1500,
        "wires": [
            [
                "37b288e8faea9edc"
            ]
        ]
    },
    {
        "id": "3098dd24440136db",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "flag == checked",
        "property": "flag_tcg",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "checked",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 640,
        "y": 1500,
        "wires": [
            [],
            [
                "ee3e29d5fdb10f82"
            ]
        ]
    },
    {
        "id": "37b288e8faea9edc",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "state",
        "func": "msg.state = Number(msg.state)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 1500,
        "wires": [
            [
                "7cec201ef52ac945"
            ]
        ]
    },
    {
        "id": "5a3650f0c1712705",
        "type": "comment",
        "z": "e4fac40aa2dddfeb",
        "name": "fix",
        "info": "200 ms",
        "x": 130,
        "y": 1460,
        "wires": []
    },
    {
        "id": "7cec201ef52ac945",
        "type": "switch",
        "z": "e4fac40aa2dddfeb",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 450,
        "y": 1500,
        "wires": [
            [
                "3098dd24440136db"
            ]
        ]
    },
    {
        "id": "ee3e29d5fdb10f82",
        "type": "function",
        "z": "e4fac40aa2dddfeb",
        "name": "flag = true",
        "func": "flow.set('flag_tcg', 'checked')\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 1500,
        "wires": [
            [
                "0fa9c28bc325f0dc"
            ]
        ]
    },
    {
        "id": "57857654fae4a9bd",
        "type": "api-call-service",
        "z": "e4fac40aa2dddfeb",
        "name": "tcg_setter standby OFF",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.tcg_setter\",\"state\":\"{{state}}\",\"standby\":false}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1330,
        "y": 1500,
        "wires": [
            []
        ]
    },
    {
        "id": "2c2a6c6d8b66e23f",
        "type": "server-state-changed",
        "z": "c9de95d1b59eeb87",
        "name": "custom_scenes",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.custom_scenes",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "scenes",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 140,
        "y": 300,
        "wires": [
            [
                "191dc7ac72b73864"
            ]
        ]
    },
    {
        "id": "1e9101c447b7702c",
        "type": "switch",
        "z": "c9de95d1b59eeb87",
        "name": "call or save",
        "property": "scenes.new_state.attributes.eventscene",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "call",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "save",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 510,
        "y": 260,
        "wires": [
            [
                "2ccec333eec21c9b"
            ],
            [
                "59b04e909ebe09ca"
            ]
        ]
    },
    {
        "id": "66c3aa0502b2ca6c",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "videomixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomixer",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "data.vmi",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1030,
        "y": 460,
        "wires": [
            [
                "b244cdd3a04acdf4"
            ]
        ]
    },
    {
        "id": "b244cdd3a04acdf4",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "videomatrix",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomatrix",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "data.vma",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1030,
        "y": 500,
        "wires": [
            [
                "6641d64d08c6f21e"
            ]
        ]
    },
    {
        "id": "5319f1441a77923b",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "data.apr",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1040,
        "y": 420,
        "wires": [
            [
                "66c3aa0502b2ca6c"
            ]
        ]
    },
    {
        "id": "54976a93c4ceb2db",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "form data to save",
        "func": "var data = Object()\nvar sensors = Object.keys(msg.data)\nfor (const sensor of sensors) {\n    data[sensor] = msg.data[sensor].attributes\n}\nreturn { scene: msg.scenes.new_state.attributes.currentscene, data: data}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 620,
        "wires": [
            [
                "8f6295ba0476e083"
            ]
        ]
    },
    {
        "id": "6641d64d08c6f21e",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "data.cur",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1040,
        "y": 540,
        "wires": [
            [
                "54976a93c4ceb2db"
            ]
        ]
    },
    {
        "id": "edecf26b613f87bc",
        "type": "comment",
        "z": "c9de95d1b59eeb87",
        "name": "Бизнес-логика CustomScenes",
        "info": "",
        "x": 190,
        "y": 260,
        "wires": []
    },
    {
        "id": "e277ec347976ac2d",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "custom_buttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.custom_buttons",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "data.cbtns",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1040,
        "y": 380,
        "wires": [
            [
                "22aa87c422928340"
            ]
        ]
    },
    {
        "id": "2ccec333eec21c9b",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "payload.state",
        "func": "if (Number(msg.scenes.new_state.state) > Number(global.get(\"time\"))) {\n    global.set(\"time\", Number(msg.scenes.new_state.state));\n}\n\nvar state = global.get(\"time\")\nmsg.payload = { state: state }\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 180,
        "wires": [
            [
                "ca87eb23a1a03b79"
            ]
        ]
    },
    {
        "id": "7847e512d229e381",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "form data to load",
        "func": "// var state = new Date()\n// state = state.getTime()\n\nvar sensors = Object.keys(msg.payload)\nfor (const sensor of sensors) {\n    msg.payload[sensor][\"entity_id\"] = 'sensor.' + msg.payload[sensor][\"friendly_name\"].toLowerCase()\n    // msg.payload[sensor][\"state\"] = state\n}\n\n// msg.state = state\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1670,
        "y": 240,
        "wires": [
            [
                "218d32b0afedc374"
            ]
        ]
    },
    {
        "id": "a07b62907999e9b0",
        "type": "file",
        "z": "c9de95d1b59eeb87",
        "name": "save 1",
        "filename": "/data/JsonDB/customscene1.json",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1850,
        "y": 480,
        "wires": [
            [
                "1179cb85b14b7469"
            ]
        ]
    },
    {
        "id": "6617fb96927b52eb",
        "type": "json",
        "z": "c9de95d1b59eeb87",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1170,
        "y": 220,
        "wires": [
            [
                "1fc991a648588f50"
            ]
        ]
    },
    {
        "id": "119b216fe2b17b9e",
        "type": "file in",
        "z": "c9de95d1b59eeb87",
        "name": "read 1",
        "filename": "/data/JsonDB/customscene1.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1010,
        "y": 40,
        "wires": [
            [
                "6617fb96927b52eb"
            ]
        ]
    },
    {
        "id": "260c5e4442ab3bfb",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "custom_scenes set stagescene",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.custom_scenes\", \"stagescene\": 1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 2250,
        "y": 460,
        "wires": [
            [
                "4a0b2d605e4f8324"
            ]
        ]
    },
    {
        "id": "e744454e3e3fe987",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "msg.payload.apr",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 2240,
        "y": 280,
        "wires": [
            [
                "504f3f981473a408"
            ]
        ]
    },
    {
        "id": "0e4dc10b61c259c7",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "videomatrix",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "msg.payload.vma",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 2230,
        "y": 360,
        "wires": [
            [
                "bc6051c138d50222"
            ]
        ]
    },
    {
        "id": "821d74933588ddee",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "videomixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "msg.payload.vmi",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 2230,
        "y": 320,
        "wires": [
            [
                "991a6fd933f0fbc9"
            ]
        ]
    },
    {
        "id": "56bc0af6a5ef2b74",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "current_values",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "msg.payload.cur",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 2240,
        "y": 400,
        "wires": [
            [
                "1179cb85b14b7469"
            ]
        ]
    },
    {
        "id": "18f748553ed2fdbc",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "custom_buttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "msg.payload.cbtns",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 2240,
        "y": 240,
        "wires": [
            [
                "a72c3b9063963e6c"
            ]
        ]
    },
    {
        "id": "1fc991a648588f50",
        "type": "switch",
        "z": "c9de95d1b59eeb87",
        "name": "is empty",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "empty"
            },
            {
                "t": "nempty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1300,
        "y": 220,
        "wires": [
            [
                "86d0e319b2db85ab"
            ],
            [
                "7ff8a6e72b3ad934"
            ]
        ]
    },
    {
        "id": "68988aa901fb4479",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "error",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.errors\", \"state\":{{state}}, \"errorCode\":{{errorCode}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1930,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "86d0e319b2db85ab",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "error data",
        "func": "var errorCode = 1\n\nreturn {errorCode: errorCode};",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1460,
        "y": 200,
        "wires": [
            [
                "7e12df8257a7f585"
            ]
        ]
    },
    {
        "id": "1179cb85b14b7469",
        "type": "delay",
        "z": "c9de95d1b59eeb87",
        "name": "1 c",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2050,
        "y": 460,
        "wires": [
            [
                "260c5e4442ab3bfb"
            ]
        ]
    },
    {
        "id": "45c54a5deb61fd71",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "d": true,
        "name": "action?",
        "func": "var old_currentscene = msg.scenes.old_state.attributes.currentscene;\nvar old_eventscene = msg.scenes.old_state.attributes.eventscene;\nvar old_stagescene = msg.scenes.old_state.attributes.stagescene;\n\nvar new_currentscene = msg.scenes.new_state.attributes.currentscene;\nvar new_eventscene = msg.scenes.new_state.attributes.eventscene;\nvar new_stagescene = msg.scenes.new_state.attributes.stagescene;\n\nif (old_currentscene == new_currentscene && old_eventscene == new_eventscene && old_stagescene == new_stagescene)\n{\n    msg.answer = false\n}\nelse\n{ \n    msg.answer = true\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 340,
        "wires": [
            [
                "d0d281cbd7324102"
            ]
        ]
    },
    {
        "id": "d0d281cbd7324102",
        "type": "switch",
        "z": "c9de95d1b59eeb87",
        "d": true,
        "name": "if action",
        "property": "answer",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 500,
        "y": 300,
        "wires": [
            [
                "1e9101c447b7702c"
            ]
        ]
    },
    {
        "id": "7ff8a6e72b3ad934",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "customscenes",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.custom_scenes\", \"stagescene\": 0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1480,
        "y": 240,
        "wires": [
            [
                "7847e512d229e381"
            ]
        ]
    },
    {
        "id": "c5eab9c1866ed597",
        "type": "switch",
        "z": "c9de95d1b59eeb87",
        "name": "standby off",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 290,
        "y": 380,
        "wires": [
            [
                "45c54a5deb61fd71",
                "1e9101c447b7702c"
            ],
            [
                "0a30815684e6ba71"
            ]
        ]
    },
    {
        "id": "191dc7ac72b73864",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 300,
        "y": 300,
        "wires": [
            [
                "54cfbb6a80389223"
            ]
        ]
    },
    {
        "id": "54cfbb6a80389223",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "standby status",
        "func": "var standby = msg.standby.attributes.standby;\n{ \n    msg.standby = standby\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 340,
        "wires": [
            [
                "c5eab9c1866ed597"
            ]
        ]
    },
    {
        "id": "ea08388aa053e4c7",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "errors",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.errors\", \"state\":{{state}}, \"errorCode\":{{errorCode}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 650,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "5eccb39e0da9a308",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "custom_scenes",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.custom_scenes\", \"currentscene\": 0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 620,
        "y": 420,
        "wires": [
            [
                "76d13a9f8af955da"
            ]
        ]
    },
    {
        "id": "0a30815684e6ba71",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "real act in SB",
        "func": "var errorCode = 2\n\nvar flag_do = true\n\nvar old_cur = msg.scenes.old_state.attributes.currentscene\nvar old_evnt = msg.scenes.old_state.attributes.eventscene\nvar old_stg = msg.scenes.old_state.attributes.stagescene\n\nvar new_cur = msg.scenes.new_state.attributes.currentscene\nvar new_evnt = msg.scenes.new_state.attributes.eventscene\nvar new_stg = msg.scenes.new_state.attributes.stagescene\n\nif (old_cur == new_cur && old_evnt == new_evnt && old_stg == new_stg && new_cur == 0)\n{\n    flag_do = false\n}\n\nreturn {flag_do: flag_do, errorCode: errorCode};",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 380,
        "wires": [
            [
                "2acc508d5936203e"
            ]
        ]
    },
    {
        "id": "2acc508d5936203e",
        "type": "switch",
        "z": "c9de95d1b59eeb87",
        "name": "real act in SB",
        "property": "flag_do",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 630,
        "y": 380,
        "wires": [
            [
                "5eccb39e0da9a308"
            ]
        ]
    },
    {
        "id": "22aa87c422928340",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "cbtns convert (string -> boolean)",
        "func": "if (msg.data.cbtns.attributes['tv'] === 'False') {\n    msg.data.cbtns.attributes['tv'] = false\n} else if (msg.data.cbtns.attributes['tv'] === 'True') {\n    msg.data.cbtns.attributes['tv'] = true\n}\n\nif (msg.data.cbtns.attributes['room'] === 'False') {\n    msg.data.cbtns.attributes['room'] = false\n} else if (msg.data.cbtns.attributes['room'] === 'True') {\n    msg.data.cbtns.attributes['room'] = true\n}\n\nif (msg.data.cbtns.attributes['home'] === 'False') {\n    msg.data.cbtns.attributes['home'] = false\n} else if (msg.data.cbtns.attributes['home'] === 'True') {\n    msg.data.cbtns.attributes['home'] = true\n}\n\nif (msg.data.cbtns.attributes['group'] === 'False') {\n    msg.data.cbtns.attributes['group'] = false\n} else if (msg.data.cbtns.attributes['group'] === 'True') {\n    msg.data.cbtns.attributes['group'] = true\n}\n\nif (msg.data.cbtns.attributes['aim'] === 'False') {\n    msg.data.cbtns.attributes['aim'] = false\n} else if (msg.data.cbtns.attributes['aim'] === 'True') {\n    msg.data.cbtns.attributes['aim'] = true\n}\n\nif (msg.data.cbtns.attributes['homeDisable'] === 'False') {\n    msg.data.cbtns.attributes['homeDisable'] = false\n} else if (msg.data.cbtns.attributes['homeDisable'] === 'True') {\n    msg.data.cbtns.attributes['homeDisable'] = true\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1330,
        "y": 380,
        "wires": [
            [
                "5319f1441a77923b"
            ]
        ]
    },
    {
        "id": "59b04e909ebe09ca",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "custom_scenes",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.custom_scenes\", \"stagescene\": 0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 860,
        "y": 380,
        "wires": [
            [
                "e277ec347976ac2d"
            ]
        ]
    },
    {
        "id": "4a0b2d605e4f8324",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "d": true,
        "name": "customscenes set currentscene = 0",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.custom_scenes\", \"currentscene\": 0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 2540,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "ea8fc14e9f79f130",
        "type": "server-state-changed",
        "z": "c9de95d1b59eeb87",
        "name": "custom_buttons",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.custom_buttons",
        "entityIdType": "exact",
        "outputInitially": true,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "cbtns",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 120,
        "y": 1220,
        "wires": [
            [
                "b9b42bcff00df6ac"
            ]
        ]
    },
    {
        "id": "96d31900b8b39e02",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "",
        "func": "var group = msg.cbtns.new_state.attributes.group;\nvar room = msg.cbtns.new_state.attributes.room;\nvar home = msg.cbtns.new_state.attributes.home;\nvar oldgroup = msg.cbtns.old_state.attributes.group;\nvar oldroom = msg.cbtns.old_state.attributes.room;\nvar oldhome = msg.cbtns.old_state.attributes.home;\nvar domain = 'python_script';\nvar service = 'set_state';\nvar data = {};\ndata.entity_id = \"sensor.custom_buttons\";\n\n// if (Number(msg.cbtns.new_state.state) > Number(global.get(\"time\"))) {\n//     global.set(\"time\", Number(msg.cbtns.new_state.state));\n// }\n\n// data.state = global.get(\"time\")\n// var state = data.state\n\n// var state = new Date()\n// state = state.getTime()\n\nvar state = msg.state\n\ndata.room = false;\ndata.group = false;\ndata.home = false;\n\nif (group === true) {\n    var comm = \"group\";\n    return {\n        domain:domain,\n        service:service,\n        data:JSON.stringify(data),\n        comm:comm,\n        state:state,\n        reset:\"\"\n    };\n} else if (room === true) {\n    var comm = \"room\";\n    return {\n        domain:domain,\n        service:service,\n        data:JSON.stringify(data),\n        comm:comm,\n        state:state,\n        reset:\"\"\n    };\n} else if (home === true) {\n    var comm = \"home\";\n    return {\n        domain:domain,\n        service:service,\n        data:JSON.stringify(data),\n        comm:comm,\n        state:state,\n        reset:\"\"\n    };\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 1160,
        "wires": [
            [
                "48eaf8deea6f54d3",
                "255b3e8552aba123",
                "c58db0923aec2156"
            ]
        ]
    },
    {
        "id": "c58db0923aec2156",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "Room/Group",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{{{data}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "{{domain}}",
        "mergecontext": "",
        "x": 650,
        "y": 1160,
        "wires": [
            [
                "14b65524a6ef778c",
                "2b5667d3fbac0b1b",
                "419b99e797a00a1c"
            ]
        ]
    },
    {
        "id": "14b65524a6ef778c",
        "type": "switch",
        "z": "c9de95d1b59eeb87",
        "name": "",
        "property": "comm",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "group",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "room",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "home",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 930,
        "y": 1040,
        "wires": [
            [
                "dc9bc682d333bfc1"
            ],
            [
                "4807180721386bcb"
            ],
            [
                "52b74362e4628b54"
            ]
        ]
    },
    {
        "id": "e665acdb93365b0b",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "VideoMatrix",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomatrix\",\"state\":{{state}}, \"out1\": 3, \"out2\": 3, \"out3\": 1, \"isEnabledOut1\": 1, \"isEnabledOut2\": 1, \"isEnabledOut3\": 1, \"isEnabledOut4\": 1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1430,
        "y": 1000,
        "wires": [
            [
                "2da918917bd884d2"
            ]
        ]
    },
    {
        "id": "9323de2e75894998",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "d": true,
        "name": "VideoMatrix",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomatrix\",\"state\":{{state}}, \"out1\": 2, \"out2\": 2, \"out3\": 2, \"isEnabledOut1\": 1, \"isEnabledOut2\": 1, \"isEnabledOut3\": 1, \"isEnabledOut4\": 1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1430,
        "y": 1040,
        "wires": [
            [
                "45c2175193c5dd20"
            ]
        ]
    },
    {
        "id": "885515520ed51dec",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.audioprocessor\",\"state\":{{state}}, \"isEnabledAec\": 1, \"isEnabledIn1\": 1, \"isEnabledOut1\": 1, \"isEnabledIn2\": 1, \"isEnabledOut2\": 1, \"isEnabledIn3\": 1, \"isEnabledOut3\": 1, \"isEnabledIn4\": 1, \"isEnabledOut4\": 1, \"out1\": [], \"out2\": [], \"out3\": [], \"out4\": [], \"out1Gain\": 0, \"out2Gain\": 0, \"out3Gain\": 0, \"out4Gain\": 0, \"in1Gain\": 0, \"in2Gain\": 0, \"in3Gain\": 0, \"in4Gain\": 0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1940,
        "y": 1080,
        "wires": [
            []
        ]
    },
    {
        "id": "b30cf5e2136cc710",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "d": true,
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.audioprocessor\",\"state\":{{state}}, \"isEnabledIn1\": 1, \"isEnabledOut1\": 1, \"isEnabledIn2\": 1, \"isEnabledOut2\": 1, \"isEnabledIn3\": 1, \"isEnabledOut3\": 1, \"isEnabledIn4\": 1, \"isEnabledOut4\": 1, \"out1\": [], \"out2\": [], \"out3\": [], \"out4\": [], \"out1Gain\": 0, \"out2Gain\": 0, \"out3Gain\": 0, \"out4Gain\": 0, \"in1Gain\": 0, \"in2Gain\": 0, \"in3Gain\": 0, \"in4Gain\": 0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1940,
        "y": 1040,
        "wires": [
            []
        ]
    },
    {
        "id": "98c381f00a894c66",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "audioprocessor",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\": \"sensor.audioprocessor\", \"state\": {{state}}, \"isEnabledAec\": 0, \"isEnabledIn1\": 1, \"isEnabledOut1\": 1, \"isEnabledIn2\": 1, \"isEnabledOut2\": 1, \"isEnabledIn3\": 1, \"isEnabledOut3\": 1, \"isEnabledIn4\": 1, \"isEnabledOut4\": 1, \"out1\": [], \"out2\": [], \"out3\": [], \"out4\": [], \"out1Gain\": 0, \"out2Gain\": 0, \"out3Gain\": 0, \"out4vol\": 0, \"in1Gain\": 0, \"in2Gain\": 0, \"in3Gain\": 0, \"in4Gain\": 0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1940,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "48eaf8deea6f54d3",
        "type": "buffer-maker",
        "z": "c9de95d1b59eeb87",
        "name": "",
        "specification": "spec",
        "specificationType": "ui",
        "items": [
            {
                "name": "1",
                "type": "byte",
                "length": 1,
                "dataType": "str",
                "data": "179"
            },
            {
                "name": "2",
                "type": "byte",
                "length": 1,
                "dataType": "str",
                "data": "19"
            },
            {
                "name": "3",
                "type": "byte",
                "length": 1,
                "dataType": "str",
                "data": "198"
            },
            {
                "name": "4",
                "type": "byte",
                "length": 1,
                "dataType": "str",
                "data": "00"
            },
            {
                "name": "5",
                "type": "byte",
                "length": 1,
                "dataType": "str",
                "data": "00"
            },
            {
                "name": "6",
                "type": "byte",
                "length": 1,
                "dataType": "str",
                "data": "00"
            }
        ],
        "swap1": "",
        "swap2": "",
        "swap3": "",
        "swap1Type": "swap",
        "swap2Type": "swap",
        "swap3Type": "swap",
        "msgProperty": "payload",
        "msgPropertyType": "str",
        "x": 650,
        "y": 1220,
        "wires": [
            [
                "afbadda8500fdd48"
            ]
        ]
    },
    {
        "id": "afbadda8500fdd48",
        "type": "link out",
        "z": "c9de95d1b59eeb87",
        "name": "AudioControl",
        "mode": "link",
        "links": [],
        "x": 595,
        "y": 1280,
        "wires": []
    },
    {
        "id": "255b3e8552aba123",
        "type": "link out",
        "z": "c9de95d1b59eeb87",
        "name": "Reset",
        "mode": "link",
        "links": [],
        "x": 595,
        "y": 1100,
        "wires": []
    },
    {
        "id": "270b80c06b51f85e",
        "type": "comment",
        "z": "c9de95d1b59eeb87",
        "name": "HOME ROOM GROUP",
        "info": "",
        "x": 140,
        "y": 1180,
        "wires": []
    },
    {
        "id": "b9b42bcff00df6ac",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 140,
        "y": 1320,
        "wires": [
            [
                "25e03d0974add0b7"
            ]
        ]
    },
    {
        "id": "25e03d0974add0b7",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "standby status",
        "func": "var standby = msg.standby.attributes.standby;\n{ \n    msg.standby = standby\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 160,
        "y": 1360,
        "wires": [
            [
                "36b543ae514a5bfb"
            ]
        ]
    },
    {
        "id": "36b543ae514a5bfb",
        "type": "switch",
        "z": "c9de95d1b59eeb87",
        "name": "standby off",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 330,
        "y": 1360,
        "wires": [
            [
                "abc1b8ed6771a97a"
            ],
            [
                "af0c52daad9e2a05"
            ]
        ]
    },
    {
        "id": "af0c52daad9e2a05",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "real act in SB",
        "func": "var errorCode = 2\n\nvar flag_do = true\n\nvar old_group = msg.cbtns.old_state.attributes.group\nvar old_room = msg.cbtns.old_state.attributes.room\nvar old_home = msg.cbtns.old_state.attributes.home\n\nvar new_group = msg.cbtns.new_state.attributes.group\nvar new_room = msg.cbtns.new_state.attributes.room\nvar new_home = msg.cbtns.new_state.attributes.home\n\nif (old_group == new_group && old_room == new_room && old_home == new_home)\n{\n    flag_do = false\n}\n\nreturn {flag_do: flag_do, errorCode: errorCode};",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 1420,
        "wires": [
            [
                "d027a6498f3adfab"
            ]
        ]
    },
    {
        "id": "d027a6498f3adfab",
        "type": "switch",
        "z": "c9de95d1b59eeb87",
        "name": "real act in SB",
        "property": "flag_do",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 510,
        "y": 1420,
        "wires": [
            [
                "eee484481774d990"
            ]
        ]
    },
    {
        "id": "b2ee6a83f58badda",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "error",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.errors\", \"state\":{{state}}, \"errorCode\":{{errorCode}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 990,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "8d46395fae6d6b10",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "VideoMixer",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomixer\",\"state\":{{state}}, \"out1\": 1, \"out2\": 1, \"mode\": \"normal\"}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 930,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "46620a71ad6c9b44",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "chair = 0",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.chair\",\"state\":{{state}}, \"chair\": 0}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 920,
        "y": 1200,
        "wires": [
            []
        ]
    },
    {
        "id": "6e8cf6dc5b034800",
        "type": "comment",
        "z": "c9de95d1b59eeb87",
        "name": "GREEN",
        "info": "",
        "x": 90,
        "y": 1060,
        "wires": []
    },
    {
        "id": "0019e0f393412069",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.payload.cbtns.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2020,
        "y": 240,
        "wires": [
            [
                "18f748553ed2fdbc"
            ]
        ]
    },
    {
        "id": "218d32b0afedc374",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.custom_buttons",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1860,
        "y": 240,
        "wires": [
            [
                "0019e0f393412069"
            ]
        ]
    },
    {
        "id": "1b4ee91307a0691d",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1780,
        "y": 200,
        "wires": [
            [
                "68988aa901fb4479"
            ]
        ]
    },
    {
        "id": "7e12df8257a7f585",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.errors",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1620,
        "y": 200,
        "wires": [
            [
                "1b4ee91307a0691d"
            ]
        ]
    },
    {
        "id": "881e9838e59574dd",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.payload.apr.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2020,
        "y": 280,
        "wires": [
            [
                "e744454e3e3fe987"
            ]
        ]
    },
    {
        "id": "a72c3b9063963e6c",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1860,
        "y": 280,
        "wires": [
            [
                "881e9838e59574dd"
            ]
        ]
    },
    {
        "id": "82e319e36c101f80",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.payload.vmi.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2020,
        "y": 320,
        "wires": [
            [
                "821d74933588ddee"
            ]
        ]
    },
    {
        "id": "504f3f981473a408",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomixer",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1860,
        "y": 320,
        "wires": [
            [
                "82e319e36c101f80"
            ]
        ]
    },
    {
        "id": "1f028a3c99d983b2",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.payload.vma.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2020,
        "y": 360,
        "wires": [
            [
                "0e4dc10b61c259c7"
            ]
        ]
    },
    {
        "id": "991a6fd933f0fbc9",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomatrix",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1860,
        "y": 360,
        "wires": [
            [
                "1f028a3c99d983b2"
            ]
        ]
    },
    {
        "id": "040363a6492ca7a5",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.payload.cur.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2020,
        "y": 400,
        "wires": [
            [
                "56bc0af6a5ef2b74"
            ]
        ]
    },
    {
        "id": "bc6051c138d50222",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.current_values",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1860,
        "y": 400,
        "wires": [
            [
                "040363a6492ca7a5"
            ]
        ]
    },
    {
        "id": "09c04ffa3e5dc783",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 460,
        "wires": [
            [
                "ea08388aa053e4c7"
            ]
        ]
    },
    {
        "id": "76d13a9f8af955da",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.errors",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 340,
        "y": 460,
        "wires": [
            [
                "09c04ffa3e5dc783"
            ]
        ]
    },
    {
        "id": "bca17b424ab33e65",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 1420,
        "wires": [
            [
                "b2ee6a83f58badda"
            ]
        ]
    },
    {
        "id": "eee484481774d990",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.errors",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 680,
        "y": 1420,
        "wires": [
            [
                "bca17b424ab33e65"
            ]
        ]
    },
    {
        "id": "335d250406feb787",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 1220,
        "wires": [
            [
                "96d31900b8b39e02"
            ]
        ]
    },
    {
        "id": "abc1b8ed6771a97a",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.custom_buttons",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 320,
        "y": 1280,
        "wires": [
            [
                "335d250406feb787"
            ]
        ]
    },
    {
        "id": "89cdf34d0705b675",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 1160,
        "wires": [
            [
                "46620a71ad6c9b44"
            ]
        ]
    },
    {
        "id": "2b5667d3fbac0b1b",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.chair",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 920,
        "y": 1160,
        "wires": [
            [
                "89cdf34d0705b675"
            ]
        ]
    },
    {
        "id": "ec4299ab7ced2572",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 1260,
        "wires": [
            [
                "8d46395fae6d6b10"
            ]
        ]
    },
    {
        "id": "419b99e797a00a1c",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomixer",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 920,
        "y": 1260,
        "wires": [
            [
                "ec4299ab7ced2572"
            ]
        ]
    },
    {
        "id": "dc9bc682d333bfc1",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomatrix",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1100,
        "y": 1000,
        "wires": [
            [
                "b04b547309eb42bc"
            ]
        ]
    },
    {
        "id": "b04b547309eb42bc",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 1000,
        "wires": [
            [
                "e665acdb93365b0b"
            ]
        ]
    },
    {
        "id": "2da918917bd884d2",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1600,
        "y": 1000,
        "wires": [
            [
                "1999bc61ef79994b"
            ]
        ]
    },
    {
        "id": "1999bc61ef79994b",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 1000,
        "wires": [
            [
                "98c381f00a894c66"
            ]
        ]
    },
    {
        "id": "4807180721386bcb",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "d": true,
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomatrix",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1100,
        "y": 1040,
        "wires": [
            [
                "1077d8df353e9ce4"
            ]
        ]
    },
    {
        "id": "1077d8df353e9ce4",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "d": true,
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 1040,
        "wires": [
            [
                "9323de2e75894998"
            ]
        ]
    },
    {
        "id": "52b74362e4628b54",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.videomatrix",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1100,
        "y": 1080,
        "wires": [
            [
                "f8ee027d92e14b24"
            ]
        ]
    },
    {
        "id": "f8ee027d92e14b24",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 1080,
        "wires": [
            [
                "1697880835d42563"
            ]
        ]
    },
    {
        "id": "45c2175193c5dd20",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "d": true,
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1600,
        "y": 1040,
        "wires": [
            [
                "f1ad2fcde9f5264c"
            ]
        ]
    },
    {
        "id": "f1ad2fcde9f5264c",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "d": true,
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 1040,
        "wires": [
            [
                "b30cf5e2136cc710"
            ]
        ]
    },
    {
        "id": "0c65a35190274369",
        "type": "api-current-state",
        "z": "c9de95d1b59eeb87",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.audioprocessor",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1600,
        "y": 1080,
        "wires": [
            [
                "57968983cbf2a184"
            ]
        ]
    },
    {
        "id": "57968983cbf2a184",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "state + 1",
        "func": "msg.state = Number(msg.state) + 1\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 1080,
        "wires": [
            [
                "885515520ed51dec"
            ]
        ]
    },
    {
        "id": "1697880835d42563",
        "type": "api-call-service",
        "z": "c9de95d1b59eeb87",
        "name": "VideoMatrix",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.videomatrix\",\"state\":{{state}}, \"out1\": 1, \"out2\": 1, \"out3\": 1, \"isEnabledOut1\": 1, \"isEnabledOut2\": 1, \"isEnabledOut3\": 1, \"isEnabledOut4\": 1}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "service_domain": "python_script",
        "mergecontext": "",
        "x": 1430,
        "y": 1080,
        "wires": [
            [
                "0c65a35190274369"
            ]
        ]
    },
    {
        "id": "c5902b734b946269",
        "type": "inject",
        "z": "c9de95d1b59eeb87",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 210,
        "y": 1760,
        "wires": [
            [
                "5fd8a42aa33656cc"
            ]
        ]
    },
    {
        "id": "5fd8a42aa33656cc",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "msg.url для video.json",
        "func": "msg.url = \"http://\" + global.get(\"tcgroup_ip\") + \"/video.json\"\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 1760,
        "wires": [
            [
                "6913f0f652bb5eb2"
            ]
        ]
    },
    {
        "id": "6913f0f652bb5eb2",
        "type": "http request",
        "z": "c9de95d1b59eeb87",
        "name": "http://.../video.json",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "02fd5d52443f358c",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [],
        "x": 670,
        "y": 1760,
        "wires": [
            [
                "c1ccea700f87fd5b"
            ]
        ]
    },
    {
        "id": "c1ccea700f87fd5b",
        "type": "debug",
        "z": "c9de95d1b59eeb87",
        "name": "debug 199",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 930,
        "y": 1760,
        "wires": []
    },
    {
        "id": "18b9167e1ba6ef8a",
        "type": "comment",
        "z": "c9de95d1b59eeb87",
        "name": "401",
        "info": "",
        "x": 910,
        "y": 1720,
        "wires": []
    },
    {
        "id": "b89978412e35bbc9",
        "type": "file",
        "z": "c9de95d1b59eeb87",
        "name": "save 2",
        "filename": "/data/JsonDB/customscene2.json",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1850,
        "y": 520,
        "wires": [
            [
                "1179cb85b14b7469"
            ]
        ]
    },
    {
        "id": "ca87eb23a1a03b79",
        "type": "switch",
        "z": "c9de95d1b59eeb87",
        "name": "call",
        "property": "scenes.new_state.attributes.currentscene",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "3",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "4",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "5",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "6",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "7",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "8",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 8,
        "x": 830,
        "y": 180,
        "wires": [
            [
                "119b216fe2b17b9e"
            ],
            [
                "ca0a83f2e0d7b669"
            ],
            [
                "4c7d3c2eb3e87290"
            ],
            [
                "c1041fd817d356fe"
            ],
            [
                "7ee925b2547954d9"
            ],
            [
                "346d818aefc3a812"
            ],
            [
                "f0909387b00b2e5f"
            ],
            [
                "afdea1b6240ef8a3"
            ]
        ]
    },
    {
        "id": "ca0a83f2e0d7b669",
        "type": "file in",
        "z": "c9de95d1b59eeb87",
        "name": "read 2",
        "filename": "/data/JsonDB/customscene2.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1010,
        "y": 80,
        "wires": [
            [
                "6617fb96927b52eb"
            ]
        ]
    },
    {
        "id": "8f6295ba0476e083",
        "type": "function",
        "z": "c9de95d1b59eeb87",
        "name": "for compare (needed later)",
        "func": "return { payload: msg.data, buffer_to_compare: msg.data, scene: msg.scene}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1460,
        "y": 620,
        "wires": [
            [
                "c587c7685bd348d1"
            ]
        ]
    },
    {
        "id": "c587c7685bd348d1",
        "type": "switch",
        "z": "c9de95d1b59eeb87",
        "name": "save",
        "property": "scene",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "2",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "3",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "4",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "5",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "6",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "7",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "8",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 8,
        "x": 1670,
        "y": 620,
        "wires": [
            [
                "a07b62907999e9b0"
            ],
            [
                "b89978412e35bbc9"
            ],
            [
                "999add3dc374690e"
            ],
            [
                "c1d8748bc8c5b569"
            ],
            [
                "dcfbb05d502a598e"
            ],
            [
                "f5e3fe0b0fa07131"
            ],
            [
                "fcb0d68c313650b0"
            ],
            [
                "fefde54f454af97e"
            ]
        ]
    },
    {
        "id": "4c7d3c2eb3e87290",
        "type": "file in",
        "z": "c9de95d1b59eeb87",
        "name": "read 3",
        "filename": "/data/JsonDB/customscene3.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1010,
        "y": 120,
        "wires": [
            [
                "6617fb96927b52eb"
            ]
        ]
    },
    {
        "id": "c1041fd817d356fe",
        "type": "file in",
        "z": "c9de95d1b59eeb87",
        "name": "read 4",
        "filename": "/data/JsonDB/customscene4.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1010,
        "y": 160,
        "wires": [
            [
                "6617fb96927b52eb"
            ]
        ]
    },
    {
        "id": "7ee925b2547954d9",
        "type": "file in",
        "z": "c9de95d1b59eeb87",
        "name": "read 5",
        "filename": "/data/JsonDB/customscene5.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1010,
        "y": 200,
        "wires": [
            [
                "6617fb96927b52eb"
            ]
        ]
    },
    {
        "id": "346d818aefc3a812",
        "type": "file in",
        "z": "c9de95d1b59eeb87",
        "name": "read 6",
        "filename": "/data/JsonDB/customscene6.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1010,
        "y": 240,
        "wires": [
            [
                "6617fb96927b52eb"
            ]
        ]
    },
    {
        "id": "f0909387b00b2e5f",
        "type": "file in",
        "z": "c9de95d1b59eeb87",
        "name": "read 7",
        "filename": "/data/JsonDB/customscene7.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1010,
        "y": 280,
        "wires": [
            [
                "6617fb96927b52eb"
            ]
        ]
    },
    {
        "id": "afdea1b6240ef8a3",
        "type": "file in",
        "z": "c9de95d1b59eeb87",
        "name": "read 8",
        "filename": "/data/JsonDB/customscene8.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1010,
        "y": 320,
        "wires": [
            [
                "6617fb96927b52eb"
            ]
        ]
    },
    {
        "id": "999add3dc374690e",
        "type": "file",
        "z": "c9de95d1b59eeb87",
        "name": "save 3",
        "filename": "/data/JsonDB/customscene3.json",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1850,
        "y": 560,
        "wires": [
            [
                "1179cb85b14b7469"
            ]
        ]
    },
    {
        "id": "c1d8748bc8c5b569",
        "type": "file",
        "z": "c9de95d1b59eeb87",
        "name": "save 4",
        "filename": "/data/JsonDB/customscene4.json",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1850,
        "y": 600,
        "wires": [
            [
                "1179cb85b14b7469"
            ]
        ]
    },
    {
        "id": "dcfbb05d502a598e",
        "type": "file",
        "z": "c9de95d1b59eeb87",
        "name": "save 5",
        "filename": "/data/JsonDB/customscene5.json",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1850,
        "y": 640,
        "wires": [
            [
                "1179cb85b14b7469"
            ]
        ]
    },
    {
        "id": "f5e3fe0b0fa07131",
        "type": "file",
        "z": "c9de95d1b59eeb87",
        "name": "save 6",
        "filename": "/data/JsonDB/customscene6.json",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1850,
        "y": 680,
        "wires": [
            [
                "1179cb85b14b7469"
            ]
        ]
    },
    {
        "id": "fcb0d68c313650b0",
        "type": "file",
        "z": "c9de95d1b59eeb87",
        "name": "save 7",
        "filename": "/data/JsonDB/customscene7.json",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1850,
        "y": 720,
        "wires": [
            [
                "1179cb85b14b7469"
            ]
        ]
    },
    {
        "id": "fefde54f454af97e",
        "type": "file",
        "z": "c9de95d1b59eeb87",
        "name": "save 8",
        "filename": "/data/JsonDB/customscene8.json",
        "filenameType": "str",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1850,
        "y": 760,
        "wires": [
            [
                "1179cb85b14b7469"
            ]
        ]
    },
    {
        "id": "fa1291a45519f5e5",
        "type": "serial in",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "serial": "3f5e7803babf95d3",
        "x": 130,
        "y": 860,
        "wires": [
            [
                "cdbd7cae32960dbb"
            ]
        ]
    },
    {
        "id": "98bba8018e8911ea",
        "type": "serial out",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "serial": "3f5e7803babf95d3",
        "x": 1820,
        "y": 600,
        "wires": []
    },
    {
        "id": "d26fbbcead3b259b",
        "type": "join",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "mode": "custom",
        "build": "array",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 530,
        "y": 880,
        "wires": [
            [
                "9aeedbe48e7946c7",
                "d0a8204a715b8df0"
            ]
        ]
    },
    {
        "id": "cdbd7cae32960dbb",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "msg.complete if 0xFE",
        "func": "msg.payload = msg.payload[0]\n\nif (msg.payload == 0xFE) {\n    msg.complete = true\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 880,
        "wires": [
            [
                "d26fbbcead3b259b"
            ]
        ]
    },
    {
        "id": "86e38f8c681b3763",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "b6056333df096b58"
            ]
        ]
    },
    {
        "id": "b6056333df096b58",
        "type": "DataOut",
        "z": "f7c5cff35e94fee9",
        "collection": "76a7ab145891ea38",
        "name": "mic_info ->",
        "path": "/",
        "error": false,
        "x": 290,
        "y": 60,
        "wires": [
            [
                "2b02f82b4bb30298"
            ]
        ]
    },
    {
        "id": "2b02f82b4bb30298",
        "type": "debug",
        "z": "f7c5cff35e94fee9",
        "name": "mic_info",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 60,
        "wires": []
    },
    {
        "id": "aeb32c224c99c1f8",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "Переключить 1 микрофон",
        "props": [
            {
                "p": "data.new_state.attributes.mic",
                "v": "1",
                "vt": "num"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 170,
        "y": 600,
        "wires": [
            [
                "2eefc30b6f498c78"
            ]
        ]
    },
    {
        "id": "9aeedbe48e7946c7",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "mute all",
        "func": "if (JSON.stringify(msg.payload).includes(\"100,255,255\")) {\n    return msg\n}\n\n// if (\n//     msg.payload[0] == 0xAA &&\n//     msg.payload[1] == 0xAA &&\n//     msg.payload[5] == 0x64 &&\n//     msg.payload[6] == 0xFF &&\n//     msg.payload[7] == 0xFF\n// ) {\n//     return msg\n// }\n\n// if (\n//     msg.payload[0] == 0x00 &&\n//     msg.payload[1] == 0x00 &&\n//     msg.payload[2] == 0x00 &&\n//     msg.payload[3] == 0x00 &&\n//     msg.payload[4] == 0x00 &&\n//     msg.payload[5] == 0x00 &&\n//     msg.payload[6] == 0xFE\n// ) {\n//     return msg\n// }",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 1060,
        "wires": [
            [
                "769c61dbc51e94e3"
            ]
        ]
    },
    {
        "id": "769c61dbc51e94e3",
        "type": "DataOut",
        "z": "f7c5cff35e94fee9",
        "collection": "76a7ab145891ea38",
        "name": "mic_info ->",
        "path": "/",
        "error": false,
        "x": 850,
        "y": 1060,
        "wires": [
            [
                "d613026e2fb9fd4f"
            ]
        ]
    },
    {
        "id": "d613026e2fb9fd4f",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "micStates = [false], currentMic = 0, micQueue = [ ]",
        "func": "var micStates = [\"unused\"]\n\nfor (var i in msg.payload) {\n    micStates.push(false)\n}\n\nflow.set(\"micStates\", micStates)\nflow.set(\"currentMic\", 0)\nflow.set(\"micQueue\", [])\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1150,
        "y": 1060,
        "wires": [
            [
                "fbf4532ca0d43226"
            ]
        ]
    },
    {
        "id": "0791dba35228381a",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "micStates, micQueue, currentMic, speakerMax, mutedMics",
        "props": [
            {
                "p": "micStates",
                "v": "micStates",
                "vt": "flow"
            },
            {
                "p": "micQueue",
                "v": "micQueue",
                "vt": "flow"
            },
            {
                "p": "currentMic",
                "v": "currentMic",
                "vt": "flow"
            },
            {
                "p": "speakerMax",
                "v": "speakerMax",
                "vt": "flow"
            },
            {
                "p": "mutedMics",
                "v": "mutedMics",
                "vt": "flow"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 290,
        "y": 220,
        "wires": [
            [
                "267f004ba62d28dd"
            ]
        ]
    },
    {
        "id": "267f004ba62d28dd",
        "type": "debug",
        "z": "f7c5cff35e94fee9",
        "name": "micStates, micQueue, currentMic, speakerMax, mutedMics",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 760,
        "y": 220,
        "wires": []
    },
    {
        "id": "94d567640b2e72f8",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "+ power",
        "func": "msg.mic = Number(msg.data.new_state.attributes.mic)\n\nmsg.micStates = flow.get(\"micStates\")\n\nif (msg.micStates[msg.mic] == false) {\n    msg.power = true\n} else {\n    msg.power = false\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 600,
        "wires": [
            [
                "7d872ff3b7115555"
            ]
        ]
    },
    {
        "id": "7d872ff3b7115555",
        "type": "DataOut",
        "z": "f7c5cff35e94fee9",
        "collection": "76a7ab145891ea38",
        "name": "mic_info ->",
        "path": "/",
        "error": false,
        "x": 590,
        "y": 600,
        "wires": [
            [
                "2febceb9ebdb5405"
            ]
        ]
    },
    {
        "id": "2febceb9ebdb5405",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "+ rawMicId, cmd",
        "func": "msg.rawMicId = msg.payload[msg.mic][0]\n\nif (msg.power == true) {\n    msg.cmd = 0x74\n} else if (msg.power == false) {\n    msg.cmd = 0x73\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 600,
        "wires": [
            [
                "31c84793eded8eba"
            ]
        ]
    },
    {
        "id": "31c84793eded8eba",
        "type": "buffer-maker",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "specification": "spec",
        "specificationType": "ui",
        "items": [
            {
                "name": "item1",
                "type": "byte",
                "length": 1,
                "dataType": "str",
                "data": "0x00"
            },
            {
                "name": "item2",
                "type": "byte",
                "length": 1,
                "dataType": "str",
                "data": "0x00"
            },
            {
                "name": "item3",
                "type": "byte",
                "length": 1,
                "dataType": "str",
                "data": "0x00"
            },
            {
                "name": "item4",
                "type": "byte",
                "length": 1,
                "dataType": "str",
                "data": "0x00"
            },
            {
                "name": "item5",
                "type": "byte",
                "length": 1,
                "dataType": "str",
                "data": "0x08"
            },
            {
                "name": "item6",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "cmd"
            },
            {
                "name": "item7",
                "type": "byte",
                "length": 1,
                "dataType": "str",
                "data": "0x00"
            },
            {
                "name": "item8",
                "type": "byte",
                "length": 1,
                "dataType": "msg",
                "data": "rawMicId"
            }
        ],
        "swap1": "",
        "swap2": "",
        "swap3": "",
        "swap1Type": "swap",
        "swap2Type": "swap",
        "swap3Type": "swap",
        "msgProperty": "payload",
        "msgPropertyType": "str",
        "x": 970,
        "y": 600,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "d0a8204a715b8df0",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "ON or OFF",
        "func": "if (msg.payload.includes(0xAA) && !msg.payload.includes(0xFF)) {\n   return msg \n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1140,
        "wires": [
            [
                "b7f41ef46ff9cbe8"
            ]
        ]
    },
    {
        "id": "bd4918302d3df0cb",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "split by 0xAA",
        "func": "msg.payload = msg.payload.reduce((acc, item) => {\n     if (item === 0xAA) {\n            acc.push([])\n        } else {\n            if (acc.length === 0) {\n                acc.push([])\n            }\n            acc[acc.length - 1].push(item)\n        }\n        return acc\n    }, [])\n\nvar messages = []\n\nfor (var i in msg.payload) {\n    if (msg.payload[i].length != 0 && (msg.payload[i].includes(0x63) || msg.payload[i].includes(0x64))) {\n        messages.push({\n            message: msg.payload[i]\n        })\n    }\n}\n\nreturn [messages]",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 1140,
        "wires": [
            [
                "08ec230e1cc41df3"
            ]
        ]
    },
    {
        "id": "08ec230e1cc41df3",
        "type": "DataOut",
        "z": "f7c5cff35e94fee9",
        "collection": "76a7ab145891ea38",
        "name": "mic_info ->",
        "path": "/",
        "error": false,
        "x": 1050,
        "y": 1140,
        "wires": [
            [
                "1beb50fe8868efd1"
            ]
        ]
    },
    {
        "id": "1beb50fe8868efd1",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "+ power, mic",
        "func": "if (msg.message[3] == 0x63) {\n    msg.power = true\n} else if (msg.message[3] = 0x64) {\n    msg.power = false\n}\n\nfor (var i in msg.payload) {\n    if (msg.payload[i][0] == msg.message[5]) {\n        msg.mic = i\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 1140,
        "wires": [
            [
                "379fcf07fa1276de"
            ]
        ]
    },
    {
        "id": "379fcf07fa1276de",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "refresh micStates, micQueue, currentMic",
        "func": "var micStates = flow.get(\"micStates\")\nvar micQueue = flow.get(\"micQueue\")\nmsg.mic = Number(msg.mic)\n\nif (msg.power == true) {\n    micStates[msg.mic] = true\n\n    micQueue.push(Number(msg.mic))\n\n    if (micQueue.length > flow.get(\"speakerMax\")) {\n        msg.overQueue = true\n        msg.mic = micQueue.shift()\n        msg.power = false\n    }\n} else {\n    micStates[msg.mic] = false\n\n    var index = micQueue.indexOf(msg.mic)\n    if (index > -1) {\n        micQueue.splice(index, 1)\n    }\n}\nif (micQueue.length >= 1) {\n    flow.set(\"currentMic\", micQueue[micQueue.length - 1])\n} else {\n    flow.set(\"currentMic\", 0)\n}\n\nflow.set(\"micStates\", micStates)\nflow.set(\"micQueue\", micQueue)\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 1140,
        "wires": [
            [
                "fbf4532ca0d43226",
                "438ae0eae4a8c9f8"
            ]
        ]
    },
    {
        "id": "b7c92a5225bded28",
        "type": "comment",
        "z": "f7c5cff35e94fee9",
        "name": "19200 8 N 1",
        "info": "",
        "x": 130,
        "y": 940,
        "wires": []
    },
    {
        "id": "c627d54c18de89f5",
        "type": "comment",
        "z": "f7c5cff35e94fee9",
        "name": "after a silence of ' ' ms",
        "info": "",
        "x": 160,
        "y": 980,
        "wires": []
    },
    {
        "id": "cfd33b2292d1cb6e",
        "type": "comment",
        "z": "f7c5cff35e94fee9",
        "name": "binary buffers",
        "info": "",
        "x": 130,
        "y": 1020,
        "wires": []
    },
    {
        "id": "54414ec95d459fa9",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "Установить протокол VISCA",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "[\"0x00\", \"0x00\", \"0x37\", \"0xE4\", \"0x07\", \"0xE4\", \"0x30\"]",
        "payloadType": "bin",
        "x": 1300,
        "y": 380,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "3208e7b8598c0e9f",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "Установить режим FREE",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "[\"0x00\", \"0x00\", \"0x58\", \"0x89\", \"0x08\", \"0x76\", \"0x50\", \"0xFF\"]",
        "payloadType": "bin",
        "x": 1290,
        "y": 420,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "fbf4532ca0d43226",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "+ micStates, currentMic",
        "func": "var micQueue = flow.get(\"micQueue\")\n\nif (micQueue.length > 0) {\n    var currentMic = micQueue[micQueue.length - 1]\n} else {\n    currentMic = 0\n}\n\nreturn {\n    micStates: flow.get(\"micStates\"),\n    currentMic: currentMic\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1810,
        "y": 1060,
        "wires": [
            [
                "6518699013ae3659",
                "90514b884b97a164"
            ]
        ]
    },
    {
        "id": "6518699013ae3659",
        "type": "api-current-state",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.confsystem_getter",
        "state_type": "num",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 2100,
        "y": 800,
        "wires": [
            [
                "af7acdd977cfb2d3"
            ]
        ]
    },
    {
        "id": "af7acdd977cfb2d3",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "payload for confsystem_getter",
        "func": "msg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\":\n    {\n        \"entity_id\": \"sensor.confsystem_getter\",\n        \"state\": 9744893122014,\n        \"mics\": msg.micStates,\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2410,
        "y": 800,
        "wires": [
            [
                "559f38b3e7276b38"
            ]
        ]
    },
    {
        "id": "559f38b3e7276b38",
        "type": "api-call-service",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "all",
        "x": 2710,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "90514b884b97a164",
        "type": "api-current-state",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.custom_buttons",
        "state_type": "num",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 2090,
        "y": 860,
        "wires": [
            [
                "5bc854d705407b14"
            ]
        ]
    },
    {
        "id": "5bc854d705407b14",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "+ aim",
        "func": "var aim = msg.data.attributes.aim\n\nif (aim) {\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2330,
        "y": 860,
        "wires": [
            [
                "e53aba8bb8c89496"
            ]
        ]
    },
    {
        "id": "62551063a72268fe",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "payload for chair",
        "func": "msg.payload = {\n    \"domain\": \"python_script\",\n    \"service\": \"set_state\",\n    \"data\":\n    {\n        \"entity_id\": \"sensor.chair\",\n        \"state\": Number(msg.state) + 1,\n        \"chair\": msg.currentMic,\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2790,
        "y": 860,
        "wires": [
            [
                "99b526e2c57958f7"
            ]
        ]
    },
    {
        "id": "93ad3d90123c5b24",
        "type": "api-call-service",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "all",
        "x": 3170,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "2baf259dea7dcc7f",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "func",
        "func": "var oldstatus = msg.device_statuses.attributes.bkr;\nvar status = 0\nvar sb = msg.sb.attributes.standby\n\nif (sb == \"turningon\" || sb == \"turningoff\") {\n    status = 1;\n}\nelse if (sb == \"off\") {\n    status = 2;\n}\nelse if (sb == \"on\") {\n    status = 0;\n}\n\n// var state = new Date()\n// msg.state = state.getTime()\nmsg.state = Number(msg.device_statuses.state) + 1\n\nif (oldstatus != status) {\n    return {status:status, state:msg.state};\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 420,
        "wires": [
            [
                "8cb6fc9946cdf54c"
            ]
        ]
    },
    {
        "id": "be18abe978e3c4d0",
        "type": "api-current-state",
        "z": "f7c5cff35e94fee9",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 340,
        "y": 420,
        "wires": [
            [
                "ab6ce28c6dbb3159"
            ]
        ]
    },
    {
        "id": "8cb6fc9946cdf54c",
        "type": "api-call-service",
        "z": "f7c5cff35e94fee9",
        "name": "BKR_Status",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "debugenabled": false,
        "domain": "python_script",
        "service": "set_state",
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "data": "{\"entity_id\":\"sensor.device_statuses\",\"state\":{{state}},\"bkr\":{{status}}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "x": 830,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "ab6ce28c6dbb3159",
        "type": "api-current-state",
        "z": "f7c5cff35e94fee9",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "sb",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 520,
        "y": 420,
        "wires": [
            [
                "2baf259dea7dcc7f"
            ]
        ]
    },
    {
        "id": "6697780f96308683",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": ">",
        "props": [],
        "repeat": "1",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 130,
        "y": 420,
        "wires": [
            [
                "987717f07b9c7ec9"
            ]
        ]
    },
    {
        "id": "2737ec64b6941029",
        "type": "server-state-changed",
        "z": "f7c5cff35e94fee9",
        "name": "confsystem_setter",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.confsystem_setter",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 210,
        "y": 720,
        "wires": [
            [
                "2eefc30b6f498c78"
            ]
        ]
    },
    {
        "id": "e53aba8bb8c89496",
        "type": "api-current-state",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.chair",
        "state_type": "num",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "state",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "for": "",
        "forType": "num",
        "forUnits": "milliseconds",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 2540,
        "y": 860,
        "wires": [
            [
                "62551063a72268fe"
            ]
        ]
    },
    {
        "id": "7ffeec3979b6dbdc",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{}",
        "payloadType": "json",
        "x": 130,
        "y": 100,
        "wires": [
            [
                "5dbb02c8e6f58315"
            ]
        ]
    },
    {
        "id": "5dbb02c8e6f58315",
        "type": "DataIn",
        "z": "f7c5cff35e94fee9",
        "collection": "76a7ab145891ea38",
        "name": "-> mic_info",
        "update": false,
        "path": "/",
        "x": 290,
        "y": 100,
        "wires": []
    },
    {
        "id": "c652208e7ba3e0d7",
        "type": "change",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "speakerMax",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2400,
        "y": 260,
        "wires": [
            [
                "39f807c60581fd10"
            ]
        ]
    },
    {
        "id": "438ae0eae4a8c9f8",
        "type": "switch",
        "z": "f7c5cff35e94fee9",
        "name": "overQueue is true",
        "property": "overQueue",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1790,
        "y": 1140,
        "wires": [
            [
                "7d872ff3b7115555"
            ]
        ]
    },
    {
        "id": "463c341bb12d3590",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "unmuted OFF",
        "func": "msg.payload = Buffer.from([0x00,0x00,0x00,0x00,0x08,0x73,0xFF,0xFF])\nconst mutedMics = flow.get(\"micQueue\")\nflow.set(\"mutedMics\", mutedMics)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 960,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "624977f5c9b7905e",
        "type": "link in",
        "z": "f7c5cff35e94fee9",
        "name": "mute to serial",
        "links": [
            "c9da35ed44c52fb8"
        ],
        "x": 845,
        "y": 980,
        "wires": [
            [
                "97f1ba650d308090"
            ]
        ]
    },
    {
        "id": "97f1ba650d308090",
        "type": "switch",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "property": "micmute",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 950,
        "y": 980,
        "wires": [
            [
                "463c341bb12d3590"
            ],
            [
                "aeb0e8ed4c01ebcc"
            ]
        ]
    },
    {
        "id": "b0e463c4553e0ec9",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "muted ON",
        "func": "const micInfo = msg.payload\nconst mutedMics = flow.get(\"mutedMics\")\nconst ids = mutedMics.map(mic => micInfo[mic.toString()]);\n\nvar msgs = []\n\nfor (const id of ids) {\n    var msg = {};\n    msg.payload = Buffer.from([0x00, 0x00, 0x00, 0x00, 0x08, 0x74, 0x00, id[0]])\n    msgs.push(msg)\n}\n\nreturn [msgs];",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 1000,
        "wires": [
            [
                "0b368ae508246d20"
            ]
        ]
    },
    {
        "id": "aeb0e8ed4c01ebcc",
        "type": "DataOut",
        "z": "f7c5cff35e94fee9",
        "collection": "76a7ab145891ea38",
        "name": "mic_info ->",
        "path": "/",
        "error": false,
        "x": 1130,
        "y": 1000,
        "wires": [
            [
                "b0e463c4553e0ec9"
            ]
        ]
    },
    {
        "id": "eb1c6398dedbb6b1",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "ids",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"1\":[2,0],\"2\":[21,0],\"3\":[24,0],\"4\":[16,0],\"5\":[1,0]}",
        "payloadType": "json",
        "x": 130,
        "y": 140,
        "wires": [
            [
                "5dbb02c8e6f58315"
            ]
        ]
    },
    {
        "id": "0b368ae508246d20",
        "type": "delay",
        "z": "f7c5cff35e94fee9",
        "name": "4 msg/s",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "4",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1440,
        "y": 1000,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "7604577ee98b11e3",
        "type": "comment",
        "z": "f7c5cff35e94fee9",
        "name": "OP#271889",
        "info": "",
        "x": 690,
        "y": 1180,
        "wires": []
    },
    {
        "id": "f68c43abd7dd4884",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "mic off",
        "func": "msg.payload = Buffer.from([0x00, 0x00, 0x00, 0x00, 0x08, 0x73, 0x00, msg.id])\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1233.5,
        "y": 1218.75,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "caed61cb279ab39c",
        "type": "switch",
        "z": "f7c5cff35e94fee9",
        "name": "micmute",
        "property": "custom_buttons.attributes.micmute",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 800,
        "y": 1220,
        "wires": [
            [
                "bd4918302d3df0cb"
            ],
            [
                "53c93f8dcaeabf3b"
            ]
        ]
    },
    {
        "id": "b7f41ef46ff9cbe8",
        "type": "api-current-state",
        "z": "f7c5cff35e94fee9",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.custom_buttons",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "custom_buttons",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 660,
        "y": 1220,
        "wires": [
            [
                "caed61cb279ab39c"
            ]
        ]
    },
    {
        "id": "53c93f8dcaeabf3b",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "single mic ON",
        "func": "var index = msg.payload.indexOf(0x63)\nif (!(index === -1)) {\n    msg.id = msg.payload[index + 2] // OP#271889\n    return msg\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 1220,
        "wires": [
            [
                "f68c43abd7dd4884"
            ]
        ]
    },
    {
        "id": "858ae5dd5691c5af",
        "type": "comment",
        "z": "f7c5cff35e94fee9",
        "name": "OP#271889",
        "info": "",
        "x": 1030,
        "y": 1180,
        "wires": []
    },
    {
        "id": "d6d5bcd5353745dd",
        "type": "comment",
        "z": "f7c5cff35e94fee9",
        "name": "OP#271889",
        "info": "",
        "x": 1330,
        "y": 960,
        "wires": []
    },
    {
        "id": "f86cb920fdf018d3",
        "type": "ui_numeric",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "label": "Кол-во спикеров",
        "tooltip": "",
        "group": "d5d40670147f334f",
        "order": 1,
        "width": 5,
        "height": 1,
        "wrap": false,
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "format": "{{value}}",
        "min": 0,
        "max": 10,
        "step": 1,
        "className": "",
        "x": 2150,
        "y": 260,
        "wires": [
            [
                "c652208e7ba3e0d7"
            ]
        ]
    },
    {
        "id": "609fe08b6ba4b180",
        "type": "DataIn",
        "z": "f7c5cff35e94fee9",
        "d": true,
        "collection": "5617fff903bf834f",
        "name": "-> confsystem_config",
        "update": false,
        "path": "/",
        "x": 1820,
        "y": 180,
        "wires": []
    },
    {
        "id": "87ba44ba58b1ccb2",
        "type": "DataOut",
        "z": "f7c5cff35e94fee9",
        "d": true,
        "collection": "5617fff903bf834f",
        "name": "confsystem_config ->",
        "path": "/",
        "error": false,
        "x": 1820,
        "y": 140,
        "wires": [
            [
                "638ecdf1f8ebb48a"
            ]
        ]
    },
    {
        "id": "638ecdf1f8ebb48a",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "d": true,
        "name": "set all to flow",
        "func": "for (let el of msg.payload)\n{\n    if ((el['attr'] == 'inputs') || (el['attr'] == 'outputs')) {\n        const map = new Map(Object.entries(el['val']).map(([key, value]) => [Number(key), value]));\n        flow.set(el['attr'], map)\n    }\n    else\n    {\n        flow.set(el['attr'], el['val'])\n    }\n}\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2030,
        "y": 140,
        "wires": [
            [
                "0858bde9af846e24"
            ]
        ]
    },
    {
        "id": "d95a1f4496f4d9ab",
        "type": "comment",
        "z": "f7c5cff35e94fee9",
        "d": true,
        "name": "Вызов сохраненного состояния при старте HomeAssistant",
        "info": "",
        "x": 1020,
        "y": 100,
        "wires": []
    },
    {
        "id": "b359891c149007f3",
        "type": "switch",
        "z": "f7c5cff35e94fee9",
        "d": true,
        "name": "new about.home_assistant is true",
        "property": "about.new_state.attributes.home_assistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1540,
        "y": 140,
        "wires": [
            [
                "87ba44ba58b1ccb2"
            ]
        ]
    },
    {
        "id": "d0c3bb217ed91b8b",
        "type": "switch",
        "z": "f7c5cff35e94fee9",
        "d": true,
        "name": "old about.home_assistant != new about.home_assistant",
        "property": "about.old_state.attributes.home_assistant",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "about.new_state.attributes.home_assistant",
                "vt": "msg"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1150,
        "y": 140,
        "wires": [
            [
                "b359891c149007f3"
            ]
        ]
    },
    {
        "id": "39f807c60581fd10",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "d": true,
        "name": "get all from flow",
        "func": "var keys = flow.keys()\nvar ans = []\nfor (let key of keys) {\n    if (Object.prototype.toString.call(flow.get(key)) == '[object Map]') {\n        ans.push({ 'attr': key, 'val': Object.fromEntries(flow.get(key))})\n    }\n    else\n    {\n        ans.push({ 'attr': key, 'val': flow.get(key)})\n    }\n}\nmsg.payload = ans\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 180,
        "wires": [
            [
                "609fe08b6ba4b180"
            ]
        ]
    },
    {
        "id": "ee1f5ccef40019a4",
        "type": "server-state-changed",
        "z": "f7c5cff35e94fee9",
        "d": true,
        "name": "about",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.about",
        "entityIdType": "exact",
        "outputInitially": false,
        "ifState": "",
        "ifStateType": "str",
        "outputOnlyOnStateChange": false,
        "for": "0",
        "forType": "num",
        "forUnits": "milliseconds",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "about",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.about",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "haltifstate": "",
        "halt_if_type": "str",
        "output_only_on_state_change": false,
        "x": 850,
        "y": 140,
        "wires": [
            [
                "d0c3bb217ed91b8b"
            ]
        ]
    },
    {
        "id": "745e624a3b5957cb",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "d": true,
        "name": "Refresh table with start flows",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1800,
        "y": 100,
        "wires": [
            [
                "87ba44ba58b1ccb2"
            ]
        ]
    },
    {
        "id": "0858bde9af846e24",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "d": true,
        "name": "get speakerMax",
        "func": "msg.payload = flow.get('speakerMax')\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1940,
        "y": 260,
        "wires": [
            [
                "f86cb920fdf018d3"
            ]
        ]
    },
    {
        "id": "cf3973af72f4a70a",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "micQueue = []",
        "func": "flow.set(\"micQueue\", [])\nflow.set(\"mutedMics\", [])\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1400,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "be91d5501d6fc998",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": ">",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1890,
        "y": 700,
        "wires": [
            [
                "02090b1463381210"
            ]
        ]
    },
    {
        "id": "02090b1463381210",
        "type": "api-current-state",
        "z": "f7c5cff35e94fee9",
        "name": "get state",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.confsystem_getter",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 2050,
        "y": 700,
        "wires": [
            [
                "5eb0fbce432cb77c"
            ]
        ]
    },
    {
        "id": "5eb0fbce432cb77c",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "state",
        "func": "msg.state = Number(msg.data.state)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2200,
        "y": 700,
        "wires": [
            [
                "0369c9dbe0eb42fd"
            ]
        ]
    },
    {
        "id": "0369c9dbe0eb42fd",
        "type": "switch",
        "z": "f7c5cff35e94fee9",
        "name": "good state",
        "property": "state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "10000000000",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2360,
        "y": 700,
        "wires": [
            [
                "7be420e69f962617"
            ]
        ]
    },
    {
        "id": "ad32197d5ad4a890",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "unmuted OFF",
        "func": "msg.payload = Buffer.from([0x00,0x00,0x00,0x00,0x08,0x73,0xFF,0xFF])\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2700,
        "y": 700,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "7be420e69f962617",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "attrs qty",
        "func": "if (Object.keys(msg.data.attributes).length <= 2)\n{\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2520,
        "y": 700,
        "wires": [
            [
                "ad32197d5ad4a890"
            ]
        ]
    },
    {
        "id": "eb482f5a3c000d65",
        "type": "switch",
        "z": "f7c5cff35e94fee9",
        "name": "switch msg.standby",
        "property": "standby",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "turningon",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1350,
        "y": 1420,
        "wires": [
            [
                "463c341bb12d3590"
            ]
        ]
    },
    {
        "id": "821dbde4b39f6370",
        "type": "server-state-changed",
        "z": "f7c5cff35e94fee9",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 5,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entityId": "sensor.standby",
        "entityIdType": "exact",
        "outputInitially": false,
        "stateType": "num",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "standby",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            }
        ],
        "x": 1010,
        "y": 1420,
        "wires": [
            [
                "694f54dfb7b64966"
            ]
        ]
    },
    {
        "id": "694f54dfb7b64966",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "standby",
        "func": "msg.standby = msg.standby.new_state.attributes.standby\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 1420,
        "wires": [
            [
                "eb482f5a3c000d65"
            ]
        ]
    },
    {
        "id": "4cda85c459ee08bd",
        "type": "comment",
        "z": "f7c5cff35e94fee9",
        "name": "2. turning on",
        "info": "",
        "x": 1330,
        "y": 1380,
        "wires": []
    },
    {
        "id": "a4dfc758e5d5050c",
        "type": "comment",
        "z": "f7c5cff35e94fee9",
        "name": "1. turning off",
        "info": "",
        "x": 1330,
        "y": 1340,
        "wires": []
    },
    {
        "id": "5e5383646ff00354",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "1",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x01\"]",
        "payloadType": "bin",
        "x": 1190,
        "y": 1620,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "2d0702a1a9b3fbff",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "2",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x02\"]",
        "payloadType": "bin",
        "x": 1190,
        "y": 1660,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "9673a65e0d7ac966",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "3",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x03\"]",
        "payloadType": "bin",
        "x": 1130,
        "y": 1700,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "b7bbdd4c37cc68cd",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "4",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x04\"]",
        "payloadType": "bin",
        "x": 1130,
        "y": 1740,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "4624404ef08c47b6",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "5",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x05\"]",
        "payloadType": "bin",
        "x": 1130,
        "y": 1780,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "84293205807ea5ec",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "6",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x06\"]",
        "payloadType": "bin",
        "x": 1130,
        "y": 1820,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "620bec4e5721743e",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "7",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x07\"]",
        "payloadType": "bin",
        "x": 1130,
        "y": 1860,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "c6890218fc93086b",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "8",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x08\"]",
        "payloadType": "bin",
        "x": 1130,
        "y": 1900,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "134ec29647e106f0",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "9",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x09\"]",
        "payloadType": "bin",
        "x": 1130,
        "y": 1940,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "5d02c5cc695de6ef",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "A",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x0A\"]",
        "payloadType": "bin",
        "x": 1130,
        "y": 1980,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "42ebd442cc0e1391",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "Мьют всех",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.5",
        "topic": "",
        "x": 830,
        "y": 680,
        "wires": [
            [
                "4d432e6c0ca330cb"
            ]
        ]
    },
    {
        "id": "4d432e6c0ca330cb",
        "type": "change",
        "z": "f7c5cff35e94fee9",
        "name": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x06\",\"0x75\"]",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x06\",\"0x75\"]",
                "tot": "bin"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1110,
        "y": 680,
        "wires": [
            [
                "3025ac347f2890b7",
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "3025ac347f2890b7",
        "type": "delay",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "pauseType": "delay",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1390,
        "y": 680,
        "wires": [
            [
                "a508d47b32633d68"
            ]
        ]
    },
    {
        "id": "a508d47b32633d68",
        "type": "change",
        "z": "f7c5cff35e94fee9",
        "name": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x73\",\"0xFF\",\"0xFF\"]",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x73\",\"0xFF\",\"0xFF\"]",
                "tot": "bin"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1070,
        "y": 740,
        "wires": [
            [
                "cf3973af72f4a70a",
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "2eefc30b6f498c78",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "mic ui<->hw commutation",
        "func": "if (msg.data.new_state.attributes.mic == 1) {\n    msg.data.new_state.attributes.mic = 1\n    return msg\n} else if (msg.data.new_state.attributes.mic == 2) {\n    msg.data.new_state.attributes.mic = 2\n    return msg\n} if (msg.data.new_state.attributes.mic == 3) {\n    msg.data.new_state.attributes.mic = 3\n    return msg\n} else if (msg.data.new_state.attributes.mic == 4) {\n    msg.data.new_state.attributes.mic = 4\n    return msg\n} else if (msg.data.new_state.attributes.mic == 5) {\n    msg.data.new_state.attributes.mic = 5\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 540,
        "wires": [
            [
                "94d567640b2e72f8"
            ]
        ]
    },
    {
        "id": "987717f07b9c7ec9",
        "type": "switch",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "property": "mc10_mute",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 290,
        "y": 340,
        "wires": [
            [
                "87a23ef84493245c"
            ],
            [
                "be18abe978e3c4d0"
            ]
        ]
    },
    {
        "id": "6a5d0442d2de8a98",
        "type": "function",
        "z": "f7c5cff35e94fee9",
        "name": "func",
        "func": "var oldstatus = msg.device_statuses.attributes.bkr;\nvar status = 0\n\nmsg.state = Number(msg.device_statuses.state) + 1\n\nif (oldstatus != status) {\n    return {status:status, state:msg.state};\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 340,
        "wires": [
            [
                "8cb6fc9946cdf54c"
            ]
        ]
    },
    {
        "id": "87a23ef84493245c",
        "type": "api-current-state",
        "z": "f7c5cff35e94fee9",
        "name": "device_statuses",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.device_statuses",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "device_statuses",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 440,
        "y": 340,
        "wires": [
            [
                "8a5323a5e320e943"
            ]
        ]
    },
    {
        "id": "8a5323a5e320e943",
        "type": "api-current-state",
        "z": "f7c5cff35e94fee9",
        "name": "standby",
        "server": "e0c11a67bf2b1ad5",
        "version": 3,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.standby",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "sb",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 620,
        "y": 340,
        "wires": [
            [
                "6a5d0442d2de8a98"
            ]
        ]
    },
    {
        "id": "eda0cda3be6f0362",
        "type": "comment",
        "z": "f7c5cff35e94fee9",
        "name": "ВЕРХНЯЯ ВЕТКА ТОЛЬКО ДЛЯ ДЕМО-ЗОНЫ",
        "info": "",
        "x": 600,
        "y": 300,
        "wires": []
    },
    {
        "id": "99b526e2c57958f7",
        "type": "switch",
        "z": "f7c5cff35e94fee9",
        "name": "",
        "property": "mc10_mute",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2970,
        "y": 860,
        "wires": [
            [
                "93ad3d90123c5b24"
            ]
        ]
    },
    {
        "id": "054e8a43d40cc1cd",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "0x18",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x18\"]",
        "payloadType": "bin",
        "x": 1190,
        "y": 2380,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "6e4884b1f306ca10",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "B",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x0B\"]",
        "payloadType": "bin",
        "x": 1130,
        "y": 2020,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "4c3afd756ec49ea0",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "C",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x0C\"]",
        "payloadType": "bin",
        "x": 1130,
        "y": 2060,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "8a31118aea9865d6",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "D",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x0D\"]",
        "payloadType": "bin",
        "x": 1130,
        "y": 2100,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "4044c1d030910e59",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "0x10",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x10\"]",
        "payloadType": "bin",
        "x": 1190,
        "y": 2180,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    },
    {
        "id": "0bd7791d3aee4276",
        "type": "inject",
        "z": "f7c5cff35e94fee9",
        "name": "0x15",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.5",
        "topic": "",
        "payload": "[\"0x00\",\"0x00\",\"0x00\",\"0x00\",\"0x08\",\"0x74\",\"0x00\",\"0x15\"]",
        "payloadType": "bin",
        "x": 1190,
        "y": 2280,
        "wires": [
            [
                "98bba8018e8911ea"
            ]
        ]
    }
]